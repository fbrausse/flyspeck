
\section{Supporting Flyspeck in a Semantic Wiki}

Starting from a minimal set of requirements, we have evaluated the
applicability of two concrete semantic wikis to Flyspeck.  We used two
different frameworks: a prototype developed on top of Semantic
MediaWiki, and our own semantic wiki SWiM.  Based on the results of
this pre-study, we establish a roadmap for tailoring SWiM to
specifically meet the needs of the Flyspeck collaborators.

\subsection{Motivation}
\label{sec:req}

The Flyspeck project has garnered significant enthusiasm in the
theorem proving community: Hales has given talks about the project at
a number of prestigious conferences, and aspects of Flyspeck are
currently a motivation behind at least 3 PhD dissertations.  
Currently, though, Flyspeck is not ready for crowdsourcing.  Because
definitions rely so heavily on each other, and the lemma statements
rely on the definitions, a close team including Hales need to 
computerize the definitions so that the mathematical constants
are well formed\footnote{For example, you can represent a vector as
a function from the integers to the reals, or as a tuple of reals.
The operations of vector spaces will depend on this representation, etc.}.
While some degree of modularity is certainly possible, we think
it probable that Hales will oversee this process directly.
Once the formal definitions are complete, however, the rest
of the project can proceed practically in parallel.  

To build a prototype, we therefore computerized the definitions and
lemma statements of the first chapter of
the book (Trigonometry), in the Twelf\cite{Schurmann:1999:Twelf} 
proof assistant.  Once that was complete, we imagined the
kinds of behaviors the wiki should support.

\ednote{@Sean/Florian: One/two sentences about Twelf! (here or in
  some other section where it's appropriate, either workflow or flyspeck) What
  is it, why was it originally chosen? --CL
  SM: it doesn't really matter that it's Twelf, except that that's the
only system currently supported by our infrastructure.  They don't need
to know that.  At this level of detail all provers are the same.
}

An example usage scenario is as follows.  A user
wishes to contribute to Flyspeck.  She looks at our wiki main page,
which shows her what still needs to be done.  Prefering analysis to
geometry, she searches for open problems involoving analysis.  This
returns a list of lemmas related to analysis from which she can
choose one that seems possible given her time constraints. She
downloads the relevant formal definitions and lemmas, along with the
text of a paper proof culled from Hales' book.  She uses a proof
assistant to begin formalizing the paper proof (or some variant
thereof).  At some point, she needs clarification on some definition and additionally
has an idea on how to generalize this lemma.  She thus asks for help
and makes comments on a wiki forum.  She completes her proof, and
uploads the proof assistant file to the wiki.  The wiki checks the proof
for correctness and then adds it to the database.

With this scenario in mind, we propose that the wiki should minimally offer: 

\begin{itemize} 
\item A database of the theory, constant, and lemma definitions 
\item A way to browse the database by category, or search with keywords 
\item A way to download the definitions, lemmas statements and proofs (when they exist). 
\item A way to upload new proofs 
\item A forum to discuss issues involved in the formalizations 
\end{itemize} 

\subsection{Requirements}

So far, the Flyspeck project has four core members who collaborate via
Google Code~\cite{website:GoogleCode}.  While the services offered by
Google Code (a Subversion repository, a mailing list, and others) were
found to be sufficient for the core development team, we were not
satisfied with the wiki integrated into the Google Code web interface.
Lacking support for mathematical formulae, it would not even allow for
presenting the theorems and lemmas to be formally proved in a
human-readable fashion.  Furthermore, GoogleCode offers very
little \emph{structuring} support, which we believe will be
essential for browsing and querying Flyspeck's 
(eventually) large knowledge collection.

Our focus in this work is on making the extent and structure of
Flyspeck comprehensible and on communicating where work needs to be
done.  For this the outline of the whole proof from the
book\cite{Hales:2007:FlyspeckBook} needs to be represented in the
wiki, where the mathematical statements (including definitions,
lemmas, and theorems) are available in a human-readable way (with
formulae in \LaTeX\ or presentational MathML) as well as a
computerized presentation suitable for downloading into a theorem
prover.  In order to obtain a well-structured network of knowledge
items, each mathematical statement should be presented on one wiki
page, which shows its human-readable representation from the book,
offers additional space for annotation, and allows for downloading a
formal representation.  We consider the following kinds of annotations
desirable:

\begin{description}
\item[Categorization by topic:] In the beginning, one would mirror the narrative structure
  of the book (e.\,g.\ ``ball'' being a subsection of ``primitive volumes'', which in turn
  is a section of the chapter ``volume calculations'').  Standardized ways of classifying
  mathematical topics, such as the Mathematical Subject Classification
  (MSC)\cite{AMS:MSC2000}, could be added later.
\item[Project-organization metadata] such as whether the proof
  of a lemma has already been computerized, or if someone is currently 
  attempting a proof.  This is essential so that two people don't duplicate
  work.
\item[Dependency links:] These can be links from individual symbols in mathematical
  formulae to the place where they are declared, or from any page $p$ to other pages
  containing knowledge that is required for understanding $p$ --- either pages in the same
  wiki, or external resources like PlanetMath or Wikipedia articles.
\item[Discussion posts] should be strongly tied to the topic being discussed, and they
  should be classified into categories like question, answer, explanation,
  etc.
\end{description}

To the visitor and potential collaborator, an impression of the extent and structure of
the project --- its size and its specialization into diverse fields of
mathematics --- must be given, as well as tools for browsing and querying the knowledge.
The topical structure as well as the dependencies must be browsable via links.  Not only
should it be possible to query knowledge items by their annotations, but important query
results must also be available as dynamically generated lists.  Examples for queries are:

\begin{enumerate}
\item\label{item:proven-lemma} ``Which lemmas about composite regions have not been
  computerized so far?''
\item ``Are there textual resources I can read in order to understand Jordan's curve
  theorem?''
\item ``What lemmas are difficult to prove?''
  \begin{enumerate}
  \item \ldots in the sense that many people have already attempted them, but given up
  \item\label{item:question-count} \ldots in the sense that many people have asked
    questions in the related discussion
  \end{enumerate}
\item \ldots\ednote{@Christoph: Check Matthias' BSc thesis for further ideas. --CL}
\end{enumerate}

A volunteer who is willing to work out and contribute a computerized
proof for some lemma should be able to download a self-contained
computerized representation of this lemma and everything it depends
on.  Assuming that the Flyspeck book is written in a linear order, this could be all
definitions and lemmas \emph{before} the current one in the narrative order of the
book.  

\ednote{@Florian: Do we want to convert between theorem
  proving languages?  Is this feasible with OMDoc?
  SM: definitely not for this paper.  Out of scope in my opinion.}.

For the integration of the contributed proofs, we currently envisage
that a small group of maintainers will integrate submitted formal
proofs into one central ``master'' proof script outside of the wiki
and have this script checked semi-automatically.  Metadata about the
progress of the proof, e.\,g.\ who contributed the proof, ill be added
to the wiki.  

\ednote{SM: put this in related work
In a later phase, it has to be investigated whether
formal proofs can also be collaboratively developed and validated in
the wiki (cf.\ section~\ref{sec:wiki-pa}).}

\newcommand{\wikipage}[5]{\node[draw,text width=5cm,font=\tiny\sffamily] (#1) at #2 {
    {\footnotesize\bfseries #3}\\
    #4
    ~\\[1em]
    [Download Isabelle representation]\\
    #5
  };}
\begin{figure}
  \centering
  \begin{tikzpicture}[set style={{default}+=[scale=1.5,font=\sffamily]},default,xscale=.8]
    \wikipage{lemma}{(0,0)}{Lemma 1.3}{The cosine is an even function.  The sine is an odd function.\\
      $\cos(-x)=\cos(x),\qquad\sin(-x)=-\sin(x)$}{Page type: Lemma\\
      Topic: Trigonometry\\
      Proven: no (3 unsuccessful attempts)}
    \wikipage{cos}{(6,0)}{Cosine}{$cos\colon\mathbb{R}\to\mathbb{R},x\mapsto\ldots$}{
      Page type: Definition\\
      Topic: Trigonometry
    }
    \wikipage{todo}{(0,3)}{To do}{Unproven lemmas:
      \begin{itemize}
      \item Lemma 1.3
      \item \ldots
      \end{itemize}
    }{
      Page type: Overview
    }
    \draw[->] (lemma) -- node[above] {usesSymbol} (cos);
    \draw[->] (todo) -- node[left] {references} (lemma);
  \end{tikzpicture}
  \caption{Page structure}
  \label{fig:pagestructure}
\end{figure}

\ednote{To do: put the following into the right place --CL} Currently we are investigating
whether Twelf is actually appropriate for formalizing Flyspeck.  We are also investigating
Isabelle, but we consider the design of the wiki support to be largely independent of that
decision.  After ???\ednote{@Sean: insert number} years, we consider the basic narrative
structure of the book a sufficiently stable for modeling the structure of the wiki after
it.  During the formalization of the knowledge, we anticipate that mainly its axiomatic
parts (i.\,e.\ the way concepts are defined) will undergo major refactoring in order to
facilitate the actual development of the proofs, as certain areas of mathematics the
Kepler proof heavily relies on, such as geometry, are underrepresented in the existing
formal mathematical libraries of theorem provers\ednote{@Sean: this is in a nutshell what
  you once told me about this; is it sufficient?}.  Additional refactoring support by the
wiki would thus be of advantage.

Secondly, we have not yet committed to a definitive workflow for formalizing the book.
Given the size of the book, which is much smaller than the size of the final
proofs\ednote{@Sean: right?}, the current Flyspeck core team may be able to create formal
representations of the symbol declarations, definitions, and lemmas manually and upload
them to the wiki.  On the other hand, wikis support a workflow where different groups of
authors, such as domain experts or proof-readers, collaborate in formalizing knowledge
step by step.  This potential could also be unleashed for Flyspeck.

