(*  tests of nonlinear inequalities from main.hl *)
(* removed from glpk model OXLZLEZ *)

(*
let mk_tm23 i3 i5 i6 = 
  let x i = List.nth [`&2`; `&2 * hminus`; `&2 * hplus` ; `sqrt8`] i in
  let X i = x (i+1) in
  let mid i = if (i=1) then 1 else 0 in
  let m = mk_small_numeral in
  let w1 = 1 +  mid i6 in
  let w2 = 1 + mid i3 + mid i5 in
    list_mk_comb (template23, [x i3;X i3; x i5;X i5; x i6 ;X i6; m w1; m w2]);; 

let mk_ineq23 i3 i5 i6 = all_forall (snd(dest_eq(concl(BETAS_CONV (mk_tm23 i3 i5 i6)))));;

let add23 i3 i5 i6 = 
  add {
    id = Printf.sprintf "ZTGIJCF23 %d %d %d 7907792228" i3 i5 i6;
    ineq = mk_ineq23 i3 i5 i6;
    doc = "This is the 2&3-cell inequality for five or more leaves.";
    tags = [Cfsqp;Flypaper];
  };;

 for i3=0 to 2 do 
 for i5 = 0 to 2 do
 for i6 = 0 to 2 do
   add23 i3 i5 i6 done done done;;
*)


let _ = 
{
  id = "QITNPEA 9507854632";
  ineq = all_forall `ineq
   [(&2 * hminus,y1, &2 * hplus);
    (&2,y2, &2 * hminus);
    (&2,y3, &2 * hminus);
    (#2 ,y4, #2.1);
    (&2,y5, &2 * hminus);
    (&2,y6, &2 * hminus)
   ]
    ((gamma23f y1 y2 y3 y4 y5 y6 1 1 sqrt2 lmfun - #0.00242
    - #0.00609451*dih_y y1 y2 y3 y4 y5 y6 > #0.0) \/
    (y_of_x rad2_x y1 y2 y3 y4 y5 y6 < &2) \/
    (eta_y y1 y2 y6 > sqrt2 ) \/
    (eta_y y1 y3 y5 > sqrt2))`;
  doc =   "
     Note the upper bound on $y_4$ is $2.1$.
     This is an inequality for 23-cells used to prove the cluster inequality.";
  tags = [Cfsqp;Clusterlp];
};;

let _ = 
{
  id = "QITNPEA 9507854632";
  ineq = all_forall `ineq
   [(&2 * hminus,y1, &2 * hplus);
    (&2,y2, &2 * hminus);
    (&2,y3, &2 * hminus);
    (#2 ,y4, #2.1);
    (&2,y5, &2 * hminus);
    (&2,y6, &2 * hminus)
   ]
    ((gamma23f y1 y2 y3 y4 y5 y6 1 1 sqrt2 lmfun - #0.00242
    - #0.00609451*dih_y y1 y2 y3 y4 y5 y6 > #0.0) \/
    (y_of_x rad2_x y1 y2 y3 y4 y5 y6 < &2) \/
    (eta_y y1 y2 y6 > sqrt2 ) \/
    (eta_y y1 y3 y5 > sqrt2))`;
  doc =   "
     Note the upper bound on $y_4$ is $2.1$.  The same inequality holds when
    $y_4\\ge 2.1$.  In fact, \\ineq{4003532128} is even stronger.
     This is an inequality for $23$-cells used to prove the cluster inequality.";
  tags = [Cfsqp;Clusterlp];
};;

test_ineq {
  id = "2";
  ineq = all_forall `ineq
   [(&2 * hminus,y1, &2 * hplus);
    (&2,y2, &2 * hminus);
    (&2,y3, &2 * hminus);
    (#2 ,y4, &2 * hminus);
    (&2,y5, &2 * hminus);
    (&2,y6, &2 * hminus)
   ]
  ( (gamma4f y1 y2 y3 y4 y5 y6 lmfun > #0.0) \/
    (dih_y y1 y2 y3 y4 y5 y6 < #1.575) )`;
  doc =   "test";
  tags = [];
};;

let _ =  
{
  id = "QITNPEA 4 blades, 3 quarters, 1 23-cell";
  ineq = all_forall `ineq
   [(&2 * hminus,y1, &2 * hplus);
    (&2,y2, &2 * hminus);
    (&2,y3, &2 * hminus);
    (&2,y4, sqrt8);
    (&2,y5, &2 * hminus);
    (&2,y6, &2 * hminus);
    (&2,y7, &2 * hminus);
    (&2,y8, &2 * hminus);
    (&2,y9, &2 * hminus);
    (&2,y10, &2 * hminus);
    (&2,y11, &2 * hminus);
    (&2,y12, &2 * hminus);
    (&2,y13, &2 * hminus)
   ]
    ((gamma23f y1 y2 y3 y4 y5 y6 1 1 sqrt2 lmfun 
    + gamma4f y1 y3 y7 y9 y12 y5 lmfun 
    + gamma4f y1 y7 y8 y10 y13 y12  lmfun 
    + gamma4f y1 y8 y2 y11 y6 y13  lmfun > #0.0) \/
     (
    dih_y y1 y2 y3 y4 y5 y6 
    + dih_y y1 y3 y7 y9 y12 y5  
    + dih_y y1 y7 y8 y10 y13 y12   
    + dih_y y1 y8 y2 y11 y6 y13   < &2 * pi
      ) \/
     (y_of_x rad2_x y1 y2 y3 y4 y5 y6 < &2))`;
  doc =   "
     This is a numerical test of the 4-blade inequality in the case of three quarters
     and one 23-cell.  It is too large to be directly checked by rigorous nonlinear
     optimization. Instead it is broken into smaller pieces.";
  tags = [Cfsqp;Clusterlp;Derived];
};;

let _ =  
{
  id = "OCTAHEDRON OXLZLEZ TEST 4 blades, 3 quarters, 1 4-cell wt 1/2";
  ineq = all_forall `ineq
   [(&2 * hminus,y1, &2 * hplus);
    (&2,y2, &2 * hminus);
    (&2,y3, &2 * hminus);
    (&2 * hminus ,y4,  &2 *hplus);
    (&2,y5, &2 * hminus);
    (&2,y6, &2 * hminus);
    (&2,y7, &2 * hminus);
    (&2,y8, &2 * hminus);
    (&2,y9, &2 * hminus);
    (&2,y10, &2 * hminus);
    (&2,y11, &2 * hminus);
    (&2,y12, &2 * hminus);
    (&2,y13, &2 * hminus)
   ]
    ((gamma4f y1 y2 y3 y4 y5 y6 lmfun / &2 + beta_bump_force_y y1 y2 y3 y4 y5 y6 
    + gamma4f y1 y3 y7 y9 y12 y5 lmfun 
    + gamma4f y1 y7 y8 y10 y13 y12  lmfun 
    + gamma4f y1 y8 y2 y11 y6 y13  lmfun > #0.0) \/
     (
    dih_y y1 y2 y3 y4 y5 y6 
    + dih_y y1 y3 y7 y9 y12 y5  
    + dih_y y1 y7 y8 y10 y13 y12   
    + dih_y y1 y8 y2 y11 y6 y13   > &2 * pi
      ) \/
    (
    dih_y y1 y2 y3 y4 y5 y6 
    + dih_y y1 y3 y7 y9 y12 y5  
    + dih_y y1 y7 y8 y10 y13 y12   
    + dih_y y1 y8 y2 y11 y6 y13   < &2 * pi - #0.002
      ) )`;
  doc =   "
     This is a numerical test of the 4-blade inequality in the case of three quarters
     and one 4-cell of wt 1/2.  
     This is the most important case of the inequality.
     It is too large to be directly checked by rigorous nonlinear
     optimization. Instead it is broken into smaller pieces.";
  tags = [Cfsqp;Clusterlp;Derived];
};;


