%% Quadratic Volumes
%% File Created 3/22/07.

\section{Properties of Measure}

Nowhere do we need a notion
of integration.  Measure alone suffices.  (However, there are a few
volumes described below that I do not see how to calculate without
first writing them as an integral.)

We need a concepts of null set, measurable set, and volume in
three dimensions.  For our purposes, we can take the
the three dimensional Lebesgue measure.   
The null sets can be defined
to be the sets of zero Lebesgue measure. The measurable sets can
be defined as the bounded Lebesgue measurable sets.  The volume of
a measurable set can be defined as its Lebesgue measure.
As we will see in a moment, we need considerably less than Lebesgue measure.



\subsection{properties of null sets}\label{sec:null}

We assume a notion of null set with the following
properties.

\begin{enumerate}%[Null Set]
\item A finite union of null sets is a null set.\\
 \item A plane is a null set.\\
 \item A sphere is a null set.\\
 \item A circular cone is a null set; that is, a union of all
  lines through a fixed point $P$ and forming fixed
 forming fixed angle with a line through $P$.
\tlabel{enum:null}
\end{enumerate}

We write $A\equiv B$ if sets $A$ and $B$ are equal up to a null set.
That is, there exists a null set $E$ such that
   $(A\setminus B) \cup (B\setminus A) \subset E$.
\index{null set}\index{ZZZequiv@$\equiv$}

\subsection{properties of measurability}\label{sec:measure}

We assume a notion of measurability that has the following properties.

\begin{enumerate}%[Measurable set]
 \item The union of two measurable sets is measurable.\\
 \item The intersection of two measurable sets is measurable.\\
 \item The difference of two measurable sets is measurable.
\tlabel{enum:measure}
\end{enumerate}

\subsection{properties of volume}\label{sec:volume}

We assume a notion of volume that has the following properties.

\begin{enumerate}%[Volume]
 \item The volume is defined for every measurable set.  It is
    a non-negative real number.
 \item If $X$ and $Y$ are  measurable, and if
 the symmetric difference of
 $X$ and $Y$ is contained in a null set, then 
    $X$ and $Y$ have the same volume.\\
 \item If $X$ and $Y$ are measurable sets, and if $X\cap
 Y$ is contained in a null set, then
    $$
    \op{vol}(X\cup Y) = \op{vol}(X) + \op{vol}(Y).
    $$
  \item (linear stretch) If $X\subset \ring{R}^3$, $t\in\ring{R}$, 
    $i=1,2,3$, and $e_i\in\ring{R}^3$ is the $i$th standard basis vector,
    set 
      $$T_i(X,t) = \{ u + (t-1) u_i e_i \mid u\in X\}.
      $$
    If $X$ is measurable, then $X'=T_i(X,t)$ is as well,
    and $\op{vol}(X') = |t|\op{vol}(X)$.
  \item (translation) If $X\subset \ring{R}^3$ and $v\in\ring{R}^3$, then let
    $X+v = \{x + v\mid x\in X\}$.  If $X$ is measurable, then $X+v$ is
    as well, and $\op{vol}(X) = \op{vol}(X+v)$.
\tlabel{enum:volume}
\end{enumerate}

In particular, if $X$ is contained in a null set, we may take
$X=Y$ in the preceding to deduce that $\op{vol}(X)=0$.

In addition to these properties, we will also need specific
volume calculations of primitive regions as described in
Lemmas~\ref{lemma:prim-volume} and~\ref{lemma:wedge-vol}.
%% NB Don't need lemma:wedge-sol because solid of a FR is a SC.
%% Don't need lemma:prim-sol, because solds are SC or ST.

\begin{lemma}\rating{300}  Let $\op{vol}$ be the Lebesgue measure
on $\ring{R}^3$. Let $B$ be the collection of all bounded Lebesgue
measurable subsets of $\ring{R}^3$.  Let $N$ be the collection of all
Lebesgue measurable subsets of $\ring{R}^3$ of measure zero.
Then
\begin{itemize}
\item  The collection $N$ satisfies the null set properties of Section~\ref{sec:null}
\item The collection $B$ satisfies the measurability properties of Section~\ref{sec:measure}
\item  $\op{vol}$ on $B$ satisfies the volume properties of Section~\ref{sec:volume}.  
\end{itemize}
\end{lemma}

\subsection{radial sets and solid angle}\label{sec:solid}


Surface integrals are not required in this book.  Although
the `solid angle' is traditionally defined as a surface integral,
we give an alternative definition based on volume.


\begin{definition}
    A set $C$ is $r$-radial at center $x$ if  $C\subset B(x,r)$
    and if
        $x + u \in C$ implies
        $x + t u \in C$ for all $t$ satisfying $0\le |u| t < r$.
A set $C$ is eventually radial at center $x$ if $C\cap B(x,r)$ is
$r$-radial at center $x$, for some $r>0$.
\end{definition}

\begin{lemma}\tlabel{lemma:r-r'}
Assume that $C$ is measurable and $r$-radial at $x$.  Let $0\le r'<r$,
then $C\cap B(x,r')$ is measurable and
$\op{vol}(C\cap B(x,r')) = \op{vol}(C) (r'/r)^3$.
\end{lemma}

\begin{proof}  We can transform $C$ into $C\cap B(x,r')$ by
a series of translations and stretch transformations.
\end{proof}


\begin{definition}\tlabel{def:sol}
If $C$ is measurable and eventually radial at center $x$, then we
define the solid angle of $C$ at $x$ to be
    $$
    \op{sol}(x,C) = 3 \op{vol}(C\cap B(x,r))/r^3,
    $$
where $r$ is as in the definition of eventually radial. 
By Lemma~\ref{lemma:r-r'}, this
definition is independent of any such $r$.  When the center $x$ is
clear from the context, we write $\op{sol}(C)$ for
$\op{sol}(x,C)$.
\end{definition}



The following properties follow immediately from the definitions.
If $C$ is $r$-radial for some $r>0$ then it is eventually radial.
If $C$ is measurable and $r$-radial, then the volume of $C$
satisfies
    $$
    \op{vol}(C) = \op{sol}(C) r^3/3.
    $$
If $C$ is bounded away from $x$, then $C$ is eventually radial at
$x$, and $\op{sol}(C) = 0$.

\begin{lemma}  If $C$ and $C'$ are  $r$-radial
at $v_0$, then $C\cap C'$ is also $r$-radial at
$x$.
\end{lemma}






\section{Primitive Volumes}

We accept 
certain elementary volume calculations as axioms.  
These regions will be called primitive volumes.  There are only
a few primitive volumes.
All further
volumes calculations will be obtained from these through the basic
properties of measure.   
Our treatment of volume 
is hardly about measure at all.  The focus is rather on
the geometry of the various regions and how to decompose them into
primitives.

We prefer to take the volume of open sets whenever that can be
arranged.  We begin with a description of some of the primitive
regions.






\subsection{ball}

\begin{definition}  The open ball $B(x,r)$ with center $x$ and
radius $r$ is the set
    $$
    \{ y\in\ring{R}^3 \mid |x-y| < r.\}
    $$
\end{definition}



\subsection{wedge}


The set $\op{aff}^0_+(\{v_0,v_1\},\{v_2,v_3\})$ was defined
in Definition~\ref{def:aff}.  We call it a lune.  It is the intersection
of two open half-spaces
    $$
    \op{aff}^0_+(\{v_0,v_1\},\{v_2,v_3\})
    =\op{aff}^0_+(\{v_0,v_1,v_2\},v_3)\cap
    \op{aff}^0_+(\{v_0,v_1,v_3\},v_2)
    $$


A lune has a dihedral angle $\dih(\{v_0,v_1\},\{v_2,v_3\})$ between
$0$ and $\pi$.   For angles that are larger than $\pi$,  we use a wedge
$W(v_0,v_1,w_1,w_2)$.  Assume that $v_0\ne v_1$ and that
$w_1$ and $w_2$ do not lie on
the line $\op{aff}\{v_0,v_1\}$.  Set
$$
W(v_0,v_1,w_1,w_2) = 
  \{x\not\in\op{aff}\{v_0,v_1\} \mid 
  0< \op{azim}(v_0,v_1,w_1,x) < \op{azim}(v_0,v_1,w_1,w_2)\}.
$$
When the angle is less than $\pi$, there is no difference between
a wedge and a lune:

\begin{lemma} Let $\{v_0,v_1,v_2,v_3\}$ be a set of four points
in $\ring{R}^3$.  Assume that the set is not coplanar.
Assume that $\op{azim}(v_0,v_1,v_2,v_3)<\pi$.
Then,
   $$W(v_0,v_1,v_2,v_3) = \op{aff}^0_-(\{v_0,v_1\},\{v_2,v_3\}).$$
\end{lemma}


\subsection{solid triangle}

\begin{definition} The solid triangle $ST(v_0,\{v_1,v_2,v_3\},r)$ is
specified by four points $v_i\in\ring{R}^3$, and a radius $r\ge0$. 
    $$
    ST(v_0,\{v_1,v_2,v_3\},r) = 
    B(v_0,r)\cap \op{cone}(v_0,\{v_1,v_2,v_3\}).
    $$
\end{definition}



\subsection{conic cap}

% renamed from spherical cap.

\begin{definition}
The conic cap $SC(v_0,v_1,r,a)$ is specified by an apex
$v_0\in\ring{R}^3$, a radius $r\ge0$, a non-zero vector $v_1-v_0$ giving
direction, and constant $a$.  The conic cap is the intersection of
the ball $B(v_0,r)$ with a solid right-circular cone:
    $$
    SC(v_0,v_1,r,a)=\{y \in B(v_0,r) \mid (y-v_0)\cdot (v_1-v_0) > |y-v_0|\, |v_1-v_0|\, a\}.
    $$
\end{definition}

\subsection{frustum}

\begin{definition}\tlabel{def:p:rcone}
%\begin{definition}\tlabel{def:rcone} % from tarski..
\index{rcone}\index{right-circular cone}
We define the following collection of right-circular cones.
If $v$ and $w$ are points in $\ring{R}^3$, and
  $h\in\ring{R}$, then set
  $$\begin{array}{lll}
    \op{rcone}(v,w,h) &= \{x\mid (x-v)\cdot (w-v) \ge |x-v|\,|w-v| h\},\\
    \op{rcone}^0(v,w,h) &= \{x\mid (x-v)\cdot (w-v) > |x-v|\,|w-v| h\}.\\
    \op{rcone}_-^0(v,w,h) &= \{x\mid (x-v)\cdot (w-v) < |x-v|\,|w-v| h\}.\\
    \partial\op{rcone}(v,w,h) &= \{x\mid (x-v)\cdot (w-v) = |x-v|\,|w-v| h\}.\\
    \end{array}
    $$
\end{definition}



\begin{definition} The frustum
$FR(v_0,v_1,h',h,a)$ is specified by an apex $v_0\in\ring{R}^3$, heights
$0\le h'\le h$, a vector $v_1-v_0$ giving its direction, and
$a\in[0,1]$. The set $FR$ is given as
    $$
    \{ y \in\op{rcone}^0(v_0,v_1,a) \mid \ 
       h'|v_1-v_0| < (y-v_0) \cdot (v_1-v_0) < h|v_1-v_0| \}.
    $$
\end{definition}

That is, the frustum is the part of a right-circular cone between two
parallel planes that cut the axis of the cone at a right angle.
When $h'=0$, the frustum extends to the apex of the cone, and
we write $FR(v_0,v_1,h,a)=FR(v_0,v_1,h',h,a)$.

\subsection{tetrahedron}

\begin{definition} A tetrahedron is a set of the form
$$\op{conv}^0\{v_1,v_2,v_3,v_4\}.$$
\end{definition}

By Lemma~\ref{tarski:hedra-tope}, this set can also be described
as the intersection of four open half-spaces, with each bounding
plane defined by three of the four points.
Taking this into account, we note that
the sets in this section have all been defined by linear and quadratic
constraints.

\subsection{primitive}

\begin{definition} A primitive region is any of the following.

\begin{enumerate}%%[Primitive Volumes]
 \item A solid triangle $ST$.
 \item A tetrahedron $S$.
 \item A wedge of a frustum (with $h'=0$); 
that is, the intersection of a frustum with
 a wedge:
    $$
     FR(v_0,v_1,h,a) \cap W(v_0,v_1,v_2,v_3).
    $$
\item A wedge of a conic cap; that is, the intersection of a conic cap
with
    a wedge:
    $$
    SC(v_0,v_1,r,c) \cap W(v_0,v_1,v_2,v_3).
    $$
\tlabel{enum:volume-prim}
\end{enumerate}

\end{definition}

\subsection{primitive volume calculation}\label{sec:primitive}

\begin{lemma}\tlabel{lemma:prim-volume} 
\begin{enumerate} 
 \item \rating{250} Let $v_1,v_2,v_3$ be unit vectors.
   A solid triangle $ST(v_0,\{v_1,v_2,v_3\},r)$ has volume
   $$
   (\alpha_{123}+\alpha_{231}+\alpha_{312}-\pi)r^3/3,
   $$
   where $\alpha_{ijk} = \dih_V(\{v_0,v_i\},\{v_j,v_k\})$.
  \item \rating{250} The conic cap $SC(v_0,v_1,r,a)$ has volume:
   $$
    2\pi(1-a) r^3/3,
   $$
 \item \rating{250} A frustum $FR(v_0,v_1,h,a)$ has volume:
   $$
   \pi (t^2-h^2) h/3,\quad h = t a.
   $$
 \item\rating{250} A tetrahedron $\op{conv}^0(\{v_1,v_2,v_3,v_4\})$ has volume:
   $$
   \sqrt{\Delta(x_{12},x_{13},x_{14},x_{34},x_{24},x_{23})}/12,
   $$
   where $x_{ij} = |v_i-v_j|^2$.
\end{enumerate}
\end{lemma}

Euler's formula (Lemma~\ref{lemma:euler}) gives an
equivalent expression for $(\alpha_{123}+\alpha_{231}+\alpha_{312}-\pi)$.
Euler's formula will often be used instead of this formula.

\begin{proof}
The formula for the volume of a solid triangle is $r^3/3$ times
its solid angle.  The formula 
   $$\alpha_{123}+\alpha_{231}+\alpha_{312}-\pi$$
for the area of a spherical triangle is classical.    
The conic cap volume is
$r^3/3$ times its solid angle.  
The volume of a right-circular cone is $1/3$ its base times height.
The volume of a tetrahedron is
   $$|\det(v_2-v_1,v_3-v_1,v_4-v_1)|/6.$$
By Lemma~\ref{tarski:cm4}, 
the square of this determinant is given by a formula
$\op{CM}_4(x_{ij})$, which by Lemma~\ref{tarski:cm4} is
$\Delta/4$, with $\Delta\ge0$.  The result follows.
\end{proof}



\subsection{wedge}\label{sec:wedge}

If the region is realized by revolution along an axis $\op{aff}\{v_0,v_1\}$, 
then
we can also give the volume of the intersection of the region
with a wedge $W=W(v_0,v_1,v_2,v_3)$.
  In the following
let $\theta = \azim(v_0,v_1,v_2,v_3)$.

\begin{lemma}\tlabel{lemma:wedge-vol}  Let $C$ be either $SC(v_0,v_1,r,a)$ or
   $FR(v_0,v_1,h,a)$.  Let $m$ be the volume of $C$.  
   Then $C\cap W$ has volume $m\,\theta/(2\pi)$.   
\end{lemma}

\begin{lemma}\tlabel{lemma:wedge-sol}  Let $C$ be either $SC(v_0,v_1,r,a)$ or
   $FR(v_0,v_1,h,a)$.  Then $C$ and $C\cap W$ are eventually 
radial at $v_0$. Furthermore,
    $C\cap W$ solid angle 
  $s\,\theta/(2\pi)$, where $s$ is the solid angle of $C$.
\end{lemma}


\begin{proof}
These are elementary integrals.
\end{proof}


\subsection{solid angle of primitives}

All of the primitive sets are eventually radial at the natural
base point $v_0$, so we may take their
solid angle.  By Lemma~\ref{lemma:wedge-sol}, it is enough to compute
the solid angle before intersecting with a wedge.

\begin{lemma} \tlabel{lemma:prim-sol}
\begin{enumerate}
    \item  $ST(v_0,\{v_1,v_2,v_3\})$ is eventually radial at $v_0$
     with solid angle 
     $$
     (\alpha_{123}+\alpha_{231}+\alpha_{312}-\pi),\quad
     \alpha_{ijk}=\dih_V(\{v_0,v_i\},\{v_j,v_k\}).
     $$
    \item $\op{conv}^0\{v_0,v_1,v_2,v_3\}$ is eventually radial at $v_0$
      with solid angle
           $$
     (\alpha_{123}+\alpha_{231}+\alpha_{312}-\pi),\quad
     \alpha_{ijk}=\dih_V(\{v_0,v_i\},\{v_j,v_k\}).
     $$
    \item $SC(v_0,v_1,r,a)$ is eventually radial at $v_0$ with solid
      angle 
      $2\pi(1-a)$.
    \item $FR(v_0,v_1,h,a)$ is eventually radial at $v_0$ with solid
      angle
        $$
        2\pi (1-a).
        $$
\end{enumerate}
\end{lemma}

\begin{proof} In every case, the intersection of 
  the region with $B(v_0,r')$, for $r'>0$ sufficiently small, is
  a conic cap or a solid triangle.  These two volumes have
  already been calculated.  This gives the results as stated.
\end{proof}

\subsection{combining solid angle and volume}

It is often convenient to consider various linear combinations
of the solid angle and volume of eventually radial sets.  

\begin{definition}\label{def:sovo}
With
that in mind, we define the function
  $$
  \op{sovo}(v_0,V,\lambda) = \lambda_v \op{vol}(V) + \lambda_s
  \op{sol}(v_0,V),
  $$
where $V$ is a measurable set that is eventually radial at $v_0$
and $\lambda=(\lambda_v,\lambda_s)$ is a pair of real numbers
determining the linear combination.
\end{definition}

We define some auxiliary functions that will help us express
the value of $\op{sovo}$ on primitive regions.

\begin{definition}\tlabel{def:A}\tlabel{def:phi}
Define the function
 $$
 \phi(h,t,\lambda)=
   \lambda_v  t h (t+h)/6 + \lambda_s 
 $$
Define the function
 $$A(h,t,\lambda) = (1-h/t) (\phi(h,t,\lambda) - \phi(t,t,\lambda)).$$
\index{A}
\index{phi}
\end{definition}

\begin{lemma} If $V$ is measurable and $t$-radial at $v_0$,
then $$\op{sovo}(v_0,V,\lambda) = \op{sol}(v_0,V)\phi(t,t,\lambda).$$
\end{lemma}

\begin{proof} We have $$\vol(V) = \op{sol}(v_0,V)t^3/3,$$
so $$\op{sovo}(v_0,V,\lambda) = 
  \op{sol}(v_0,V)(\lambda_v t^3/3 + \lambda_s) = 
   \op{sol}(v_0,V)\phi(t,t,\lambda).$$
\end{proof}

\begin{lemma}\tlabel{lemma:sovoFR} Let $0 < h < t$.
Set $F  = FR(v_0,v_1,h,h/t)$ and $s = \sol(v_0,F)$.
  We have
  $$
  \begin{array}{lll}
  \op{sovo}(v_0,F,\lambda) 
   &= s
  \phi(h,t,\lambda) \\
   &= 2\pi A(h,t,\lambda) + s\phi(t,t,\lambda).
  \end{array}
  $$
\end{lemma}

\begin{proof}    From the primitive volume calculations,
we have 
  $$
  \begin{array}{lll}
  s &= 2\pi(t-h)/t,\\
  \op{vol}(F) &= \pi(t^2-h^2)h/3\\
      &= s t h (t+h)/6,\\
  \op{sovo}(v_0,F) &= 
     \lambda_v s t h (t+h)/6 + \lambda_s s\\
   &= s \phi(h,t,\lambda).
  \end{array}
  $$
Also,
  $$
  \begin{array}{lll}
  s\phi(h,t,\lambda) &= 2\pi (1-h/t)\phi(h,t,\lambda)\\
  &= 2\pi A(h,t,\lambda) + 2\pi (1-h/t)\phi(t,t,\lambda)\\
  &= 2\pi A(h,t,\lambda) + s \phi(t,t,\lambda).
  \end{array}
  $$
\end{proof}

\section{Scissors and Volumes}
\tlabel{sec:measure-second}

There are many other volumes that can be computed from the
primitive ones enumerated in Definition~\ref{enum:volume-prim}.

\subsection{lune}  

To give a simple example of a derived volume, we consider the
lune $A=\op{aff}_+^0(\{v_0,v_1\},\{v_2,v_3\})$.  It is eventually
radial at $v_0$, so we may compute its solid angle.

\begin{lemma}  $\sol(v_0,A) = 2\dih_V(\{v_0,v_1\},\{v_2,v_3\})$.
\end{lemma}

\begin{proof}
Let $B_{\pm} = \op{aff}_\pm(\{v_0,v_2,v_3\},v_1)$.  $B_- \cap B_+$
is a null set.  The intersections $A\cap B_{\pm}\cap B(v_0,r)$ 
are solid triangles.  This gives the solid angle of $A$ as
follows:
   $$\begin{array}{lll}
   \sol(v_0,A) &= \sol(v_0,A\cap B_+)+\sol(v_0,A\cap B_-) \\
   &= 
   \sol(ST(v_0,\{v_1,v_2,v_3\})) + \sol(ST(v_0,\{v_1',v_2,v_3\})) \\
   &=
   2\dih_V(\{v_0,v_1\},\{v_2,v_3\}).
   \end{array}
   $$
Here, we have used $v_1'= 2 v_0 - v_1$, the reflection of $v_1$
through $v_0$.  The usual calculation of the volume of a solid triangle
inverts this proof, 
and derives the volume from the solid angle of a lune.
\end{proof}



\begin{lemma}\tlabel{lemma:wedge:sol} 
Assume that the sets $\{v_0,v_1,w_1\}$ and
$\{v_0,v_1,w_w\}$ are not collinear. 
$$\sol(v_0,W(v_0,v_1,w_1,w_2)) = 2\op{azim}(v_0,v_1,w_1,w_2).$$
\end{lemma}    

\begin{proof} Every wedge is a union of two lunes, up to a null set.
\end{proof}

\begin{lemma}  
   $$
   \begin{array}{lll}
    \op{sol}(v_0,B(v_0,t)) &= 4\pi\\
    \op{vol}(v_0,B(v_0,t)) &= 4\pi t^3/3\\
    \op{sovo}(v_0,B(v_0,t),\lambda) &= 4 \pi \phi(t,t,\lambda).
   \end{array}
   $$
\end{lemma}

\begin{proof}
The ball is $t$-radial at $v_0$, so the volume is given by
Definition~\ref{def:sol} in terms of solid angle.  It is enough
to check that a hemisphere has solid angle $2\pi$.  This follows
from Lemma~\ref{lemma:wedge:sol}.
\end{proof}  




\subsection{Rogers simplex}

\begin{definition} \tlabel{def:ortho}
An {\it orthosimplex} is a tetrahedron
    $$\op{conv}^0(x,x+v_1,x+v_1+v_2,x+v_1+v_2+v_3),$$
where $v_i\cdot v_j=0$, for $1\le i<j\le 3$.   We write
$\op{orth}^0(x,v_1,v_2,v_3)$ for this orthosimplex.
 \index{orthosimplex}
\end{definition}

\begin{figure}[htb]
  \centering
  \myincludegraphics{\ps/rogers.eps}
  \caption{The Rogers simplex is an orthosimplex.}
  \tlabel{fig:rogers}
\end{figure}


\begin{definition} \tlabel{def:rog}
Let $\{v_0,v_1,v_2,v_3\}$ be a set of four points in $\ring{R}^3$.
Assume that they are not coplanar.  Let $p$ be the circumcenter
of $\{v_0,v_1,v_2\}$ and $r$ its circumradius (see Definition~\ref{def:circumrad2}).  Let $c\ge r$.
By Lemma~\ref{tarski:rog-exist}, there exists a unique
point $p'$ in $A=\op{aff}_+(\{v_0,v_1,v_2\},v_3)$ at equal distance $c$
from $v_0,v_1,v_2$.
Let $$
    \op{rog}^0(v_0,v_1,v_2,v_3,c) = 
    \op{ortho}^0(v_0,w_1,w_2,w_3),
    \quad w_1=(v_0+v_1)/2,\quad w_1+w_2=p,\quad w_1+w_2+w_3=p'.
    $$
(We define $\op{rog}(v_0,\ldots,v_3,c)$ similarly, where we use
$\op{conv}$ instead of $\op{conv}^0$.)
We take $\op{rog}^0$ to be the empty set, if $c< r$.
 \index{rogers simplex}
\end{definition}

\begin{lemma} The vectors $w_1,w_2,w_3$ of Definition~\ref{def:ortho}
are indeed mutually orthogonal.
\end{lemma}

\begin{proof} The orthogonality of $w_1$ and $w_2$ is found in
Lemma~\ref{tarski:eta-ortho}.  The orthogonality of $w_3$ with the
others is found in Lemma~\ref{tarski:rog-ortho}.
\end{proof}

\begin{definition}
Let $\eta(x,y,z)$ be the circumradius of a triangle with sides
$x,y,z$, and let $\eta_V(v_0,v_1,v_2) = \eta(|v_0-v_1|,|v_0-v_2|,|v_1-v_2|)$.
\index{circumradius}
\index{ZZeta@$\eta$}
\end{definition}

\begin{definition}\tlabel{def:abc}
We associate with $\op{rog}^0(v_0,v_1,v_2,v_3,c)$ the constants
$a=|v_1-v_0|/2$, $b=\eta_V(v_0,v_1,v_2)$, and $c$.
We call these the $abc$ parameters of $\op{rog}^0$. 
\end{definition}

The Rogers simplex is a tetrahedron.  Hence it is one of our
primitive regions.  It is eventually radial at $v_0$, hence
it has a solid angle at $v_0$.  When we mention its dihedral
angle, it is understood that it refers to 
   $$
   \dih_V(\{v_0,v_1\},\{v_2,p'\})=\dih_V(\{v_0,(v_0+v_1)/2\},\{p,p'\}),
   $$
where $p$ and $p'$ are the points 
constructed in Definition~\ref{def:rog}.

The squares of the edge lengths of the tetrahedron are
   $$
   (a^2,b^2,c^2,c^2-b^2,c^2-a^2,b^2-a^2).
   $$
Define the functions
   $$
   \begin{array}{lll}
     \op{volR}(a,b,c) &= \begin{cases}
       a\sqrt{(b^2-a^2)(c^2-b^2)}/6& 0 < a < b < c,\\
       0,&\text{otherwise}
       \end{cases}\\
     \op{solR}(a,b,c) &= \begin{cases}
      2 \arctan\left(\sqrt{\frac{(b-a) (c-b)}{(a+b)
   (b+c)}}\right).& 0 < a < b < c,\\
      0,&\text{otherwise}
     \end{cases}\\
     \op{dihR}(a,b,c) &= \begin{cases}
      \arctan\left(\sqrt{\left((c^2 - b^2)/(b^2 - a^2)\right)}\right)
      & 0 < a < b < c,\\
      0,&\text{otherwise}
     \end{cases}
     \end{array}
   $$
Specializing the formulas for dihedral angle, volume, and solid angle to this
setting we get the following expressions for volume and solid angle.
(The calculation of the
 solid angle formula is based on Euler's formula in 
Lemma~\ref{lemma:euler}.)

\begin{lemma}\label{lemma:rog:abc} 
Let $R=\op{rog}^0(v_0,v_1,v_2,v_3,c)$ and let $a$, $b$,
$c$ be the $abc$-parameters of $R$.  Let $\op{dih}(R)$ be the dihedral
angle of $R$ along the edge extending along $\op{aff}\{v_0,v_1\}$.  Then
$$
\begin{array}{lll}
\op{vol}(R) &= \op{volR}(a,b,c)\\
\op{sol}(v_0,R) &= \op{solR}(a,b,c)\\
\op{dih}(R) &= \op{dihR}(a,b,c)\\
\end{array}
$$
\end{lemma}





\begin{remark}
The volume of a unit cube aligned along the coordinate axes is $1$.  
If we want to insist on deriving all volumes from the primitive
volumes, then we can derive the volume of the cube by partitioning
it into six Rogers simplices,
each of volume $\op{vorR}(1,\sqrt2,\sqrt3) = 1/6$, for a total
of $1$, as desired.  Figure~\ref{fig:rogers} shows one of the six
Rogers simplices.
\end{remark}



\subsection{Rogers's lemma}


The following lemma is the key step in the proof of Rogers's
bound on the density of sphere packings \cite{Rog58}.

\begin{lemma} \tlabel{lemma:rogers}
Suppose that $a,b,c$ and $a',b',c'$
are real numbers that satisfy $0 <a \le b \le c$, $0 \le a'\le b'\le c'$,
$a \le a'$, $b \le b'$, $c \le c'$. Then
  $$
  \op{solR}(a',b',c')\op{volR}(a,b,c) \le \op{solR}(a,b,c)\op{volR}(a',b',c').
  $$
\end{lemma}

\begin{proof} If any of the equalities hold: $a=b$, $b=c$, $a'=b'$,
$b'=c'$, then both sides are zero.  We assume $a<b<c$ and $a'<b'<c'$.
Let $w_1=a\,e_1,w_2=\sqrt{b^2-a^2}\, e_2,w_3=\sqrt{c^2-b^2}\, e_3,$
for the standard basis $\{e_1,e_2,e_3\}$.  Each point of the orthosimplex
$S = \op{ortho}^0(0,w_1,w_2,w_3)$ has
the form
   $$s(t_1,t_2,t_3) = t_1 w_1 + t_2 w_2 + t_3 w_3$$
where $t_i>0$ and $t_1+t_2+t_3< 1$.  Similarly,
we define $w'_i$, $S'$, and $s'(t_1,t_2,t_3)$ for the primed objects.

The inequality of the lemma is equivalent to
  $$
  \frac{\sol(0,S')}{\op{vol}(S')} \le \frac{\sol(0,S)}{\op{vol}(S)}.
  $$
By the scaling properties of the measure, $\op{solR}$ and $\op{volR}$ both
scale by the same factor under linear stretching along coordinate axes.
By such a transformation, $S'$ can be transformed to $S$.  The
transformation $T$ is given by 
   $$
   T s'(t_1,t_2,t_3) = s(t_1,t_2,t_3).
   $$
Under this transformation $T$, the volumes become equal.
The desired inequality follows from
   $$
   \sol(0,T S') \le \sol(0,S).
   $$
This follows if the transformation $T$ satisfies
   $T(S'\cap B(0,r))\subset S\cap B(0,r)$.
By Lemma~\ref{tarski:rog-lemma}, we have that 
   $$|s(t_1,t_2,t_3)|\le |s'(t_1,t_2,t_3)|.$$
This means that $T$ carries each point of $S'$ to a point closer to
the origin.  In particular,
  $T(S'\cap B(0,r))\subset S\cap B(0,r)$.
\end{proof}

%% WW Repeated parts of def.
\begin{definition}  Define 
  $$
  \begin{array}{lll}
  \dtet &= \sqrt8 \arctan(\sqrt2/5)\\
  \doct &= \pi/\sqrt8 - \sqrt2 \arctan(\sqrt2/5)\\
  \delta(a,b,c)&= \op{solR}(a,b,c)/(3\op{volR}(a,b,c)),
  \end{array}
  $$
for $a<b<c$.  
\index{ZZdeltatet@$\dtet$}
\index{ZZdeltaoct@$\doct$}
\index{ZZdelta@$\delta$}
\end{definition}

\begin{lemma}\tlabel{lemma:doct-calc}
  $\delta(1,2/\sqrt{3},\sqrt2)=\doct$.
\end{lemma}

\begin{proof}  In this calculation, we do not use Euler's formula
for the solid angle (Lemma~\ref{lemma:euler}).  
Use the dihedral angle formula instead.
A calculation gives
  $$
  \doct(1,2/\sqrt{3},\sqrt2)=
  3 \sqrt{2} \left(\frac{\pi }{4}-\arctan
   \left(\frac{1}{\sqrt{2}}\right)\right).$$
To complete the proof, we need the trig identity
  $$\arctan(\sqrt2/5)  = 3\arctan(\sqrt2/2)-\pi/2.$$
Both sides are between $0$ and $\pi/2$.  Thus, we can prove this
by taking the tangent of both sides. By the addition formula
(Lemma~\ref{lemma:tan-add}),
if $x=\arctan(\sqrt2/2)$, then
   $$\tan(3 x) = \frac{\tan^3(x) - 3\tan(x)}{1-3 \tan^2(x)} = -5/\sqrt2.$$
The result follows.
\end{proof}

\begin{lemma}\tlabel{lemma:dtet-cal}
  $\delta(1,2/\sqrt3,\sqrt6/2)=\dtet$.
\end{lemma}

\begin{proof} Calculating as in Lemma~\ref{lemma:doct-calc}, and using
the same trig identity, we get
$$\begin{array}{lll}
  \delta &=
2\sqrt{2} \left(3\arctan\left(\sqrt2/2\right) - \pi/2)\right),\\
  &=2\sqrt{2}\left(\arctan\left(\sqrt2/5\right)\right),\\
  &=\dtet
\end{array}
$$
\end{proof}

\begin{lemma}\tlabel{lemma:rog-doct}
Suppose $1\le a\le  b\le c$,  $2/\sqrt{3}\le b$, and $\sqrt2\le c$.  Then
$$
\delta(a,b,c) \le \doct.
$$
\end{lemma}

\begin{proof} This follows from Lemma~\ref{lemma:rogers} and
Lemma~\ref{lemma:doct-calc}.
\end{proof}

\begin{lemma}\tlabel{lemma:rog-tet}
Let $1\le a \le b \le c$, $2/\sqrt{3}\le b$ and $\sqrt6/2\le c$.
Then $\delta(a,b,c) \le  \dtet$.
\end{lemma}

\begin{proof}  This follows from Lemma~\ref{lemma:rogers} and
Lemma~\ref{lemma:dtet-cal}.
\end{proof}

By Lemma~\ref{tarski:eta-root3}, the circumradius of a triangle
with sides at least $2$ is always at least $\eta(2,2,2)=2/\sqrt3$.



\subsection{quoin}

Define the function $\op{quovol}$ when $0<a<b<c$ by
    \begin{equation}
    \begin{array}{lll}
    6\,\op{quovol}(a,b,c) &= (a+2c)  %
    % -(a^2+ac-2c^2)
    (c-a)^2\arctan(e)
        +a(b^2-a^2)e\\&-4c^3\arctan(e(b-a)/(b+c)),
    \tlabel{eqn:3.3}
    \end{array}
    \end{equation}
where $e\ge0$ is given by $e^2(b^2-a^2)=(c^2-b^2)$.
Extend the function by $0$, when the condition $0<a<b<c$ fails.


\begin{definition}\label{def:quoin}
Let $\{v_0,v_1,v_2,v_3\}$ be a set of four points in $\ring{R}^3$.
Let $c>  \eta_V(v_0,v_1,v_2)$.  Let $p$ be the circumcenter
of $\{v_0,v_1,v_2\}$.  Let $p'$ be the point 
in $\op{aff}_+(\{v_0,v_1,v_2\},v_3)$ at equal distance $c$
from $v_0,v_1,v_2$ (given by Lemma~\ref{tarski:mk-point}).
We define
$\op{quo}(v_0,v_1,v_2,v_3,c)$ to be the following set 
(Figure~\ref{fig:quoin}):
   $$
   B(v_0,c) \cap \op{aff}_+^0(\{v_0,v_1,v_2\},v_3)
   \cap \op{aff}_-^0(\{v_0,p,p'\},v_1) \cap
   \op{aff}_-^0(\{v_1,p,p'\},v_0).
   $$
We associate with this set the $abc$-parameters, defined
by $a = |v_0-v_1|/2$, $b=|p-v_0|$, $c$ (as given).
\end{definition}

\begin{figure}[htb]
  \centering
  \myincludegraphics{\ps/quoin.eps}
  \caption{The quoin above a Rogers simplex is the part of the
  shaded solid outside
   the illustrated box.  It is bounded by the two
  shaded planes, the plane through
   the front face of the box, and a sphere
   centered at the origin passing through the opposite corner of the box.}
  \tlabel{fig:quoin}
\end{figure}



\begin{lemma}\tlabel{lemma:quo-vol}
Let $Q=\op{quo}(v_0,v_1,v_2,v_3,c)$. Let $(a,b,c)$ be the
$abc$-parameters of $Q$.  
Then $$\op{vol}(Q) = \op{quovol}(a,b,c).$$
%
 \index{quoin}
\end{lemma}

\begin{proof} We give the proof in some detail, because it illustrates
our method of calculating derived volumes from primitive volumes.  Moreover,
this is a key calculation used in several other identities.
The calculations are essentially formal.

Let $\chi_X$ be the characteristic
function of $X$.  If $P = \chi_X$, write $\bar P$ for the characteristic
function of the complement of $X$.  We consider characteristic functions
only up to a null set, and this means that we can ignore issues such
as whether we take open half-spaces or closed half-spaces and so forth.

Set
$$
\begin{array}{llll}
  A &= \chi_X,\quad X = B(v_0,c)&\text{(ball)}\\
  B &= \chi_X,\quad X = \op{aff}_+^0(\{v_0,v_1,v_2\},v_3)&\text{(front)}\\
  C &= \chi_X,\quad X = \op{aff}_-^0(\{(v_0+v_1)/2,p,p'\},v_0)
    &\text{(top)}\\
  D &= \chi_X,\quad X = \op{aff}_-^0(\{v_0,p,p'\},v_1)&\text{(diag)}\\
  E &= \chi_X,\quad X = \op{aff}_+^0(\{v_0,v_1,p'\},p)&\text{(diag)}\\
  F &= \chi_X,\quad X = \op{rcone}^0(v_0,v_1,a/c)\\
\end{array}
$$

We see from Figure~\ref{fig:quoin} that we have the following implications
$(f(x)=1)\implies (g(x)=1)$ when $f,g$ are any of the following characteristic
functions
  $$
   (f,g) = (B\bar C \bar D E,A),\quad
   (B\bar C E F,A),\quad (A B C D, E),\quad (A B C E,F).
  $$
(These implications are justified without pictures in Lemmas~\ref{tarski:BCDE},\ref{tarski:BCEF},\ref{tarski:ABCD}, and~\ref{tarski:ABCE}.)
We recognize $ABEF$ as the characteristic function $[SC]$ of a
conic cap, $B\bar C E F$ as the characteristic function $[WFR]$ of a
wedge of a frustum,  $AB\bar D E$ as the characteristic function $[ST]$
of a solid triangle, $B\bar C\bar D E$ as the characteristic function $[R]$
of a Rogers simplex.  The characteristic function $[Q]$
of the quoin is given
by $A B C D$.  We let $[X]$ be the characteristic function of
$A B C \bar D E$.

We then have formally that
$$
\begin{array}{lllll} \,[SC] &=  A B E F \\
     &= A B \bar C E F &+ A B C E F\\
     &= B \bar C E F &+ A B C D E F &+ A B C \bar D E F\\
     &= [WFR] &+ A B C D &+ A B C \bar D E\\
     &= [WFR] &+ [Q] &+ [X]\\ 
     \,[ST] &= A B \bar D E\\
     &= A B C \bar D E &+ A B \bar C \bar D E\\
     &= [X] &+ B \bar C \bar D E\\
     &= [X] &+ [R].
\end{array}
$$
Solving for $[Q]$, we get
\begin{equation}\tlabel{eqn:qr}
  [Q] = [SC] - [WFR] + [R] - [ST].
\end{equation}
Thus, the volume of a quoin is expressed in terms of primitive volumes.
Substituting the given formulas for the volumes of primitives, we obtain
the result.  (It is necessary to use the Euler formula for solid
angle.)
\end{proof}

\begin{remark}  This type of analysis can be turned into an algorithm
for computing regions described by quadratic constraints in terms
of primitive volumes \cite{quad}.  All the volumes that arise in \cite{DCG}
can be computed by this algorithm.
In particular, the proof of Lemma~\ref{lemma:quo-vol} follows from
the algorithm.
\end{remark}

\begin{remark}\tlabel{rem:RQ}  
We can rewrite Equation~\ref{eqn:qr} as
$$
  [ST]-[R] = ([SC]-[WFR]) - [Q].
$$
That is, as we can see from Figure~\ref{fig:quoin}, the region
in a ball above and outside a Rogers simplex is the same as the
region in a ball above and outside a frustum and outside the quoin.
\end{remark}

\begin{lemma}\tlabel{lemma:solquo}  The quoin
$\quo(v_0,v_1,v_2,v_3,c)$ is eventually radial at $v_0$ and
has solid angle $0$.
\end{lemma}


\begin{proof}  This is trivial, because the quoin is bounded
away from $v_0$.
\end{proof} 

Consider the function
$\op{sovo}(v_0,\quo(v_0,v_1,v_2,v_3,c),\lambda)$, expressed
as a function of the $abc$-parameters of the quoin.  By
Lemma~\ref{lemma:solquo}, the contribution from the solid angle
is zero, so that
$$
\op{sovo}(v_0,\quo(v_0,v_1,v_2,v_3,c),\lambda) = 
 \lambda_v \op{quovol}(a,b,c).
$$


\begin{lemma}\tlabel{lemma:sovo:rog}  Let $R = \op{rog}^0(v_0,
v_1,v_2,v_3,c)$.  Let $(a,b,c)$ be the $abc$-parameters of $R$.
Let $Q=\quo(v_0,v_1,v_2,v_3,c)$.  Let $\op{dih}(R)$ be the
dihedral angle of $R$ along $\{v_0,v_1\}$.
Then
  $$
  \begin{array}{lll}
  \op{sovo}(v_0,R,\lambda) = \sol(v_0,R)\phi(c,c,\lambda) +
  \op{sovo}(v_0,Q) + \op{dih}(R)\,\, A(a,c,\lambda).
  \end{array}
  $$
\end{lemma}

\begin{proof}
By the identity of Remark~\ref{rem:RQ}, we have
  $$
  \op{sovo}(v_0,R,\lambda) - \op{sovo}(v_0,Q) = 
  \op{sovo}(v_0,ST,\lambda) - \op{sovo}(v_0,SC,\lambda) + 
  \op{sovo}(v_0,WFR,\lambda),
  $$
for regions $ST$, $SC$, $WFR$ described in that remark.
We have from previous calculations that
  $$
  \begin{array}{lll}
  \op{sovo}(v_0,ST,\lambda) &= \sol(v_0,ST)\phi(c,c,\lambda) \\ &= 
  \sol(v_0,R)\phi(c,c,\lambda)\\
  \op{sovo}(v_0,WFR,\lambda) &= \op{sol}(v_0,FR)\,\frac{\dih(R)}{2\pi}
   \phi(a,c,\lambda)\\
  \op{sovo}(v_0,SC,\lambda) &= \op{sol}(v_0,FR)\,\frac{\dih(R)}{2\pi}
   \phi(c,c,\lambda)\\ 
  \op{sol}(v_0,FR) (\phi(a,c,\lambda) -\phi(c,c,\lambda)) &=
   2\pi A(a,c,\lambda).
  \end{array}
  $$
The result follows from these equations.
\end{proof}



%\subsection{caps}
%
%\begin{lemma}\tlabel{lemma:cap-rogers}
%Let $B(0,t)$ be a ball of radius $t$ centered at the origin.  Let
%$v_1$ and $v_2$ be vertices.  Assume that $|v_1|< 2t$ and $|v_2|<2
%t$.  Truncate the ball by cutting away the caps
%   $$\op{cap}_i = \{x\in B(0,t) :  |x- v_i| < |x|\}.$$
%Assume that the circumradius of the triangle $\{0,v_1,v_2\}$ is
%less than $t$. Then the intersection of the caps, $\op{cap}_1\cap
%\op{cap}_2$, is the union of four quoins.
%\end{lemma}
%
%\begin{proof} This is true by inspection.  See Figure~\ref{fig:capriquoin}.
%Slice the intersection $\op{cap}_1\cap\op{cap}_2$ into four pieces
%by two perpendicular planes: the plane through $\{0,v_1,v_2\}$,
%and the plane perpendicular to the first and passing through $0$
%and the circumcenter of $\{0,v_1,v_2\}$.  Each of the four pieces
%is a quoin.
%\end{proof}
%
%\begin{figure}[htb]
%  \centering
%  \myincludegraphics{\ps/capriquoin.eps}
%  \caption{The intersection of two caps on the unit ball can
%   be partitioned into four quoins (shaded).}
%  \tlabel{fig:capriquoin}
%\end{figure}
%

\subsection{truncating Rogers}

\begin{lemma}\tlabel{lemma:sovo:truncRog}
Let $R_c=\op{rog}^0(v_0,v_1,v_2,v_3,c)$.  Let $r$ be the
circumradius of $\{v_0,v_1,v_2\}$.  Assume that $r$, $t$,
and $c$ are positive real numbers that satisfy $r, t\le c$.
Let $d$ be the dihedral angle of $R_c$ along the edge $\{v_0,v_1\}$.
Then
   $$
   \op{sovo}(v_0,R_c\cap B(v_0,t),\lambda) = 
   d [(1-\cos\psi)\phi(t,t,\lambda)+A(h,t,\lambda)]
   -s \phi(t,t,\lambda) + \lambda_v \op{quovol}(a,b,t),
   $$
where $s = d (1-\cos\psi) - \sol(v_0,R_c)$,   $h=|v_0-v_1|/2$,
and $\cos\psi = h/c$.
\end{lemma}

\begin{proof}  Let $R_t= \op{rog}^0(v_0,v_1,v_2,v_3,t)$.   Let
$q_t$ (resp. $q_c$) be the point at equidistance $t$ 
(resp. $c$) from $v_0,v_1,v_2$ in
$\op{aff}_+(\{v_0,v_1,v_2\},v_3)$.
If $t\ge r$, then the unique existence of $q_t$ is given by
Lemma~\ref{tarski:rog-exist}.  If $t< r$, set $R_t=\emptyset$ and
$q_t=v_2$.
When $t>r$, the point $q_t$ (resp. $q_c$) is an extreme point of $R_t$ (resp. $R_c$).

Set
  $$
  \begin{array}{lll}
  W_1 &= W(v_0,v_1,v_2,q_t),\\  
  W_2 &= W(v_0,v_1,q_t,q_c).\\
  A &= \op{rcone}^0(v_0,v_1,h/t),\\
  \bar A &= \op{rcone}^0_-(v_0,v_1,h/t).\\
  \end{array}
  $$
We have the following relations by Lemmas~\ref{tarski:wedge-union},
\ref{tarski:rogers-ball}, \ref{tarski:rogers2}, \ref{tarski:rcone-ball}, \ref{tarski:rogers-FR}:
  $$
  \begin{array}{rll}
  R_c \cap (W_1\cup W_2) &\equiv R_c,\\
  W_1\cap W_2 &= \emptyset\\
  R_c \cap B \cap W_1 &= R_t \cap B = R_t\\
  R_c\cap B \cap W_2 \cap A &= FR(v_0,v_1,h,h/t)\cap W_2\\
  \end{array}
  $$
Also, by Lemma~\ref{tarski:rogers-rad},
  $$R_c\cap B\cap W_2\cap \bar A = W_2\cap B\cap \bar A \cap
   \op{aff}_+^0(\{v_0,q_t,q_c\},v_1).$$ 
This is measurable and $t$-radial
at $v_0$.
For simplicity, surpress the parameters $v_0$ and $\lambda$ from
$\op{sovo}$.  It follows from these identities and the
Lemmas~\ref{lemma:sovo:rog} 
and~\ref{lemma:sovoFR} that
  $$
  \begin{array}{lll}
  \op{sovo}(R_c\cap B) &= \op{sovo}(R_c\cap B\cap W_1) + 
  \op{sovo}(R_c\cap B\cap W_2)\\
  &= \op{sovo}(R_t)+ \op{sovo}(R_c\cap B\cap W_2\cap A) +
  \op{sovo}(R_c\cap B\cap W_2\cap \bar A).\\
  \op{sovo}(R_t) &=\sol(R_t)\phi(t,t,\lambda) + \op{sovo}(Q) +
     \dih(R_t) A(h,t,\lambda).\\
  \op{sovo}(R_c\cap B\cap W_2\cap A) &= \op{sovo}(FR(v_0,v_1,h,h/t)\cap W_2)\\
   &= \dih(R_c) A(h,t,\lambda) + \sol(W_2\cap R_c\cap B\cap A)\phi(t,t,\lambda).\\
   \op{sovo}(R_c\cap B\cap W_2\cap \bar A) &= 
        \sol(R_c\cap B\cap W_2\cap \bar A) \phi(t,t,\lambda)\\
   &= (\sol(R_c)-\sol(R_c\cap B\cap W_2\cap A) -\sol(R_t))\phi(t,t,\lambda).
  \end{array}
  $$
Combining these equations, we get the result.
\end{proof}

%\begin{lemma}\label{lemma:truncRog:noQ}
%Let $R=\op{ortho}^0(w_0,v_1,v_2,v_3)$ and $B=B(w_0,t)$.
%Assume that $|v_1|< t < |v_1+v_2|$.  Then
%$$
%  \begin{array}{lll}
%  \op{sovo}(w_0,B\cap R,\lambda) &=
%  \sol(R)\phi(t,t,\lambda) + \dih(R)(1-y/(2t))(\phi(y/2,t,\lambda)
%  -(\phi(t,t,\lambda)))\\
%  &=\sol(R)\phi(t,t,\lambda) + \dih(R) A(y/2,t,\lambda)\\
%  \end{array}
%$$
%\end{lemma}
%
%We note that this formula is that obtained from Lemma~\ref{lemma:sovo:truncRog} by setting the quoin term to zero.
%
%\begin{proof}
%Set
%  $$
%  \begin{array}{lll}
%  A &= \{x \mid (x-v_0)\cdot (v_1-v_0) > |x-v_0| |v_1-v_0| (y/2t)\},\\
%  \bar A &= \{x \mid (x-v_0)\cdot (v_1-v_0) < |x-v_0| |v_1-v_0| (y/2t)\},\\
%  W &= W(w_0,w_0+v_1,w_0+v_1+v_2,w+0+v_1+v_2+v_3\\ 
%  \end{array}
%  $$
%We have that $R\cap (A\cap \bar A)\equiv R$ and $A\cap \bar A=\emptyset$.
%Also, by Lemma~\ref{tarski},
% Put these in Tarski in the Volume section.
%  $$
%  \begin{array}{lll}
%  R\cap B\cap A &= FR(v_0,v_1,h,y/(2t))\cap W\\
%  \end{array}
%  $$
%Also, $R\cap B\cap\bar A$ is measurable and $t$-radial
%at $v_0$.
%
%We have
%  $$
%  \begin{array}{lll}
%  \op{sovo}(B\cap R) &= \op{sovo}(A\cap B\cap R) + \op{sovo}(\bar A\cap B\cap R) \\
%   \op{sovo}(\bar A\cap B\cap R) &= \sol(\bar A\cap B\cap R) \phi(t,t,\lambda)\\
%    &= (\sol(B\cap R)-\sol(A\cap B\cap R))\phi(t,t,\lambda)\\
%    &= (\sol(B\cap R)-\sol(FR\cap W))\phi(t,t,\lambda)\\
%  \op{sovo}(A\cap B\cap R) &= \op{sovo}(FR\cap W)\\
%     &=\sol(FR\cap W)\phi(y/2,t,\lambda)\\
%   \sol(FR\cap W) &= \dih(R)\sol(FR)/(2\pi)\\
%  \sol(FR) = 2\pi (1-y/(2t))\\
%  \end{array}
%  $$
%These identities combine to give the proof.
%\end{proof}
%

\section{Composite Regions}\tlabel{sec:tcc}
    %\oldlabel{4.10}

We will consider in this section several different types
of regions that are composites of pieces that have already been
considered.  The various regions share certain features.

The constructions will depend on points
 $v_0,v_1,w_1,w_2\in\ring{R}^3$. Assume that $\{v_0,v_1,w_1,w_2\}$
is not coplanar.  We also choose constants $c_1,c_2>0$.
Let
$W=W(v_0,v_1,w_1,w_2)$ be the corresponding wedge.  
Let $p_i$ be the circumcenter of
$\{v_0,v_1,w_i\}$ and $b_i$ its circumradius.
Let $u_i$ be the normal to $\{v_0,v_1,w_i\}$, directed so that
$(-1)^i\azim(v_0,v_1,w_i,w_i+u_i) < 0$.  That is, $u_i$ points
from the half-plane $\op{aff}_+^0(\{v_0,v_1\},w_i)$ into the wedge $W$.
For $c_i > b_i$, let $q_i = q(c_i) = p_i + s_i u_i$ (with $s_i>0$) be the
unique point that is equidistant $c_i$ from $v_0,v_1,w_i$.
(The unique existence of $q_i$ is established by Lemma~\showref{tarski:rog-exist}.)
If $c_i\le b_i$, we set $c_i=w_i$.
By the choice of normals $u_i$, we have that
 $$
 0\le \op{azim}(v_0,v_1,w_1,q_1), \text{ and }
 \op{azim}(v_0,v_1,w_1,q_2) \le \op{azim}(v_0,v_1,w_1,w_2).
 $$
Equality occurs exactly when $c_1\le b_1$ (resp. $c_2\le b_2$).
We make the assumption that
\begin{equation}\tlabel{eqn:q1q2}
\op{azim}(v_0,v_1,w_1,q_1) \le \op{azim}(v_0,v_1,w_1,q_2).
\end{equation}
(This assumption will be briefly lifted in Section~\showref{sec:inverted}.)

We define the wedges 
$$
   \begin{array}{lll}
   W &= W(v_0,v_1,w_1,w_2)\\
   W_1 &= W(v_0,v_1,w_1,q_1)\\
   W_2 &= W(v_0,v_1,q_2,w_2)\\
   W'' &= W(v_0,v_1,q_1,q_2)\\
   \end{array}
$$
Under Assumption~\ref{eqn:q1q2}, we have that
$W_1,W_2,W''$ are mutually disjoint, and that
   $$
   W \equiv W_1 \cup W_2 \cup W''.
   $$
Define Rogers simpices for $i=1,2$:
  $$
  \begin{array}{lll}
  R_i &= \op{ortho}^0(v_0,v_1,w_i,w_i+u_i,c_i)\\
  R_i'&= \op{ortho}^0(v_0,w_i,v_1,v_1+u_i,c_i)\\
  \end{array}
  $$
The $abc$-parameters of $R_i$ are $a=|v_1-v_0|/2$, $b_i$, $c_i$.
Those of $R_i$ are $a'_i=|w_i-v_0|/2$, $b_i$, $c_i$.
The dihedral angle of $R_i$ along the edge $\{v_0,v_1\}$ is
equal to the dihedral angle (and azimuth angle) of $W_i$.
We have $R_i,R_i'\subset W_i$.

The composites that we consider will be constructed in various
ways from $R_i,R'_i$ and regions $W''\cap X$, for various regions
$X$ that are rotationally symmetric along the line $\op{aff}\{v_0,v_1\}$.
In the following subsections, we specialize this general
context to various specific composites.

\subsection{plates}

The first composite that we consider will be called a plate.

\begin{definition}\tlabel{def:plate}
Let $v_0,v_1,w_1,w_2$ be points in $\ring{R}^3$ that are not
coplanar.  Let $t > 0$.  Choose $c_1=c_2=t$ and construct
the regions $R_1,R_2,W'',\ldots$ for the parameters 
$v_0,v_1,w_1,w_2,c_1,c_2$.
Define the plate in terms of the regions $R_1,R_2,W''$ as follows
  $$
  PL(v_0,v_1,w_1,w_2,t) = 
  R_1 \cup (W''\cap FR(v_0,v_1,h,h/t))\cup R_2,
  $$
where $h = |v_1-v_0|/2$.
\end{definition}

Under Assumption~\ref{eqn:q1q2}, the regions $R_1,R_2,(W''\cap FR)$
are disjoint and have the appearance of Figure~\ref{fig:plate}.
According to construction, if $t$ is less than the circumradius
of $\{v_0,v_1,w_i\}$, then the corresponding Rogers simplex $R_i$
is empty, the wedge $W_i$ is empty, and that piece can be dropped
from the description of the plate.

% Not yet sketched.
\begin{figure}[htb]
  \centering
  \myincludegraphics{noimage.eps}
  \caption{A plate}
  \tlabel{fig:plate}
\end{figure}


\begin{lemma}
Let $v_0,v_1,w_1,w_2$, $h,t$, be given as in the definition of
the plate. Let $q_i$ be the point constructed above. 
Assume that $h\le t$.  
Let $PL=PL(v_0,v_1,w_1,w_2,t)$.
Let $Q_i=\quo^0(v_0,v_1,w_i,q_i,t)$.
Then for all $\lambda$, we have
  $$
  \op{sovo}(v_0,PL,\lambda) = 
  \sol(v_0,PL)\phi(t,t,\lambda) + 
  \sum_{i=1}^2\op{sovo}(v_0,Q_i,\lambda) +
  \op{azim}(v_0,v_1,w_1,w_2) A(h,t,\lambda).
  $$
\end{lemma}

\begin{proof} We have already calculated the function $\op{sovo}$
on the individual pieces $R_i$ and $W''\cap FR$.  The result
follows by assembling the pieces into the composite and 
Lemmas~\ref{lemma:sovo:rog} and \ref{lemma:sovoFR}:
  $$
  \begin{array}{lll}
  \op{sovo}(PL) &= \op{sovo}(R_1) + \op{sovo}(R_2) + \op{sovo}(W''\cap FR) \\
  \op{sovo}(R_i) &= \op{sol}(R_i) \phi(t,t,\lambda) +\op{sovo}(Q_i)
   + \dih(R_i) A(h,t,\lambda)\\
  \op{sovo}(W''\cap FR) &= \op{sol}(W''\cap FR)\phi(t,t,\lambda) +
   \op{azim}(W'') A(h,t,\lambda)\\
  \sol(PL) &=\sol(R_1)+\sol(R_2)+\sol(W''\cap FR)\\
  \op{azim}(v_0,v_1,w_1,w_2) &= \dih(R_1)+\dih(R_2)+\op{azim}(W'').
  \end{array}
  $$
The result follows immediately from these equations.
\end{proof}



\subsection{corner cells}

Let $\{v_0,v_1,w_1,w_2\}$ be a set of four points in $\ring{R}^3$.  
Assume that $\{v_0,v_1,w_1,w_2\}$ is not coplanar.
We
attach a {\it corner cell} $CC(v_0,v_1,w_1,w_2,t,\mu)$
to these four points and positive
real parameters $t,\mu$.  Let $2h=|v_0-v_1|$
 %$b=\eta(2h,t,\mu)$, 
and $\psi=\arc(2h,t,\mu)$.

Construct the cone $C=\op{rcone}^0(v_0,v_1,\cos\psi)$.
Let $P$ be the half-space containing $v_0$ bounded by
the perpendicular bisector of  $\{v_0,v_1\}$.  Set
$$
  \begin{array}{lll}
  CC_1 &= C\cap P \cap B(v_0,t)\\
  W &=W(v_0,v_1,w_1,w_2) \\
  CC(v_0,v_1,w_1,w_2,t,\mu) &= CC_1 \cap W
  \end{array}
$$

\begin{lemma}\tlabel{lemma:sovo:CC} 
Suppose that $h/t \ge \cos\psi$.  Let the other notation
be as above.   We have
  $$
  \begin{array}{lll}
  \op{sovo}(v_0,CC(v_0,v_1,w_1,w_2,t,\mu),\lambda)&=
  \op{sovoCC}(y,\beta,t,\mu,\lambda), \text{ where } \\
  \op{sovoCC}(y,\beta,t,\mu,\lambda) &= 
         \beta \left((1-\cos\psi)\phi(t,t,\lambda)+
    A(h,t,\lambda)\right),\\
    \beta &= \op{azim}(v_0,v_1,w_1,w_2),\\
    \psi &= \arc(2h,t,\mu),\\
     2h=y &= |v_0-v_1|.
  \end{array}
  $$
\end{lemma}

\begin{proof}
Set
$$
 \begin{array}{lll}
 A &= \op{rcone}^0(v_0,v_1,h/t),\\
  \bar A &= \op{rcone}^0_-(v_0,v_1,h/t),\\
 W &= W(v_0,v_1,w_1,w_2)\\
 \end{array}
$$
It follows from the definitions and from the
fact that $\partial\op{rcone}(v_0,v_1,h/t)$
is a null set that
we have $A\cap \bar A = \emptyset$ and 
$A\cup \bar A \equiv \ring{R}^3$.
By Lemma~\ref{tarski:CC} and Lemma~\ref{tarski:CCbar}, we have 
$$
  \begin{array}{lll}
    A\cap CC &= W \cap FR(v_0,v_1,h,h/t)\\
    \bar A \cap CC &= \bar A \cap C \cap B(v_0,t).
  \end{array}
$$
This last set is
is $t$-radial and measurable.
It follows from Lemma~\ref{lemma:sovoFR} that
$$
  \begin{array}{lll}
  \op{sovo}(CC) &= \op{sovo}(A\cap CC) + \op{sovo}(\bar A\cap CC)\\
  \op{sovo}(A\cap CC) &= \op{sovo}(W\cap FR) \\
     &= \op{azim}(W) A(h,t,\lambda) + \sol(W\cap FR(v_0,v_1,h,h/t))\phi(t,t,\lambda)\\
  &=\op{azim}(W) A(h,t,\lambda) + (\sol(CC)-\sol(\bar A \cap CC))\phi(t,t,\lambda)\\
  \op{sovo}(\bar A \cap CC) &= \sol(\bar A \cap CC)\phi(t,t,\lambda)\\
  \sol(CC) &= \op{azim}(W) \sol(SC(v_0,v_1,t,\cos\psi))/(2\pi) \\
         &=\op{azim}(W) (1-\cos\psi)\\
  \end{array}
$$
The result follows immediately from these equations.
\end{proof}

\subsection{truncated corner cells}
%\subsection{Formulas for Truncated corner cells}
\tlabel{sec:ftcc}
    %\oldlabel{4.11}



%Starting from the corner cell $CC(v_0,v_1,w_1,w_2,t,\mu)$, 
We define a subset $TCC(v_0,v_1,w_1,w_2,t,\mu)$ of the corner cell
called
the {\it truncated corner cell}.  
We use the construction of $b_i$, $u_i$, $p_i$, $q_i$, $R_i$,
$W_1$, $W_2$, $W''$, $\ldots$ from Section~\ref{sec:tcc},
associated with the parameters $v_0,v_1,w_1,w_2$ and
$c_1=c_2 = h/\cos\psi$, where $h = |v_1-v_0|/2$.  
Assumption~\ref{eqn:q1q2} remains
in force.  Let $B  = B(v_0,t)$.

\begin{definition} We define the truncated corner cell
to be
$$
TCC(v_0,v_1,w_1,w_2,t,\mu) =
(R_1\cap B)\cup (R_2\cap B) \cup (W''\cap CC(v_0,v_1,w_1,w_2,t,\mu)).
$$
\end{definition}

%Let $y=y_1=2h$.
The points $p_i$ and
 $q_i$ are construction in Section~\ref{sec:tcc}.
We also need the Rogers simplices 
$R''_i= \op{rog}^0(v_0,v_1,w_i,q_i,t)$ based on the parameter
$t$, rather than $c_i$.  The Rogers simplex $R''_i$
has $abc$-parameters
$(h,b_i,t)$.  

Let $s(y_1,y_2,y_3,t,\lambda)$ be given by the following formula.
Let $b = \eta(y_1,y_2,y_3)$, $\psi = \arc(y_1,t,\lambda)$,
and $c = y_1/(2\cos\psi)$ in
  $$
  s(y_1,y_2,y_3) = \op{dihR}(h,b,c) (1-\cos\psi) - \op{solR}(h,b,c).
  $$


\begin{lemma}\label{lemma:tcc}  
Let $TCC=TCC(v_0,v_1,w_1,w_2,t,\mu)$ be as constructed.
Let $p_i$ be the circumcenter constructed in Section~\ref{sec:tcc}.
%Let $q_i(t)$  X
As usual, assume Condition~\ref{eqn:q1q2}.  
Let $y = 2h = |v_1-v_0|$.  
Let $s_i = s(y,|w_i-v_0|,|v_1-w_i|,t,\lambda)$, for $i=1,2$.
Assume that
$h/t \ge \cos\psi$.  
Let $Q_i = \op{quo}^0(v_0,v_1,w_i,q_i,t)$.  Then
  \begin{equation}\label{eqn:tcc}
  \begin{array}{lll}
  \op{sovo}(v_0,TCC,\lambda) &= 
  \op{azim}(v_0,v_1,w_1,w_2) \left((1-\cos\psi)\phi(t,t,\lambda)+
    A(y/2,t,\lambda)\right) \\
    &\quad + \op{sovo}(v_0,Q_1,\lambda) - s_1\phi(t,t,\lambda) \\
    &\quad + \op{sovo}(v_0,Q_2,\lambda) - s_2\phi(t,t,\lambda) \\
  \end{array}
  \end{equation}
\end{lemma}

\begin{proof}  The result follows by combining the function
$\op{sovo}$ on each of the pieces of the composite $TCC$.
By Lemmas~\ref{lemma:sovo:CC} and~\ref{lemma:sovo:truncRog},  
% noQ
we have
$$
\begin{array}{lll}
  \op{sovo}(TCC) &= \op{sovo}(W''\cap TCC) + \op{sovo}(W_1\cap TCC)
  + \op{sovo}(W_2\cap TCC)\\
  &=\op{sovo}(W''\cap TCC) + \op{sovo}(R_1\cap B)
  + \op{sovo}(R_2\cap B)\\
  &= \op{azim}(W'') \left((1-\cos\psi)\phi(t,t,\lambda)+
    A(h,t,\lambda)\right) 
   + \op{sovo}(R_1\cap B)
  + \op{sovo}(R_2\cap B)\\
  \op{azim}(W'') &= \op{azim}(v_0,v_1,w_1,w_2)-\dih(R_1)-\dih(R_2)\\
  \op{sovo}(R_i\cap B) &= \dih(R_i) [(1-\cos\psi)\phi(t,t,\lambda)+A(h,t,\lambda)]\\
   &\quad -(\dih(R_i) (1-\cos\psi) - \sol(R_i)) \phi(t,t,\lambda) + 
   \op{sovo}(v_0,Q_i,\lambda).
\end{array}
$$
The result follows from these equations and the definition of
the function $s$.
\end{proof}



We give a second expession for the truncated corner cell.
Let $A_i^\pm$ be the half-spaces
$$
  A_i^\pm = \op{aff}_\pm^0(\{v_0,p_i,q_i\},v_0).
$$
Let $L_i^\pm = CC(v_0,v_1,w_1,w_2,t,\lambda)\cap A_i^\pm$.

\begin{lemma}\label{lemma:LL}
We have
  $$
  TCC(v_0,v_1,w_1,w_2,t,\lambda) = L_1^+\cap L_2^+.
  $$
Moreover, 
$L_1^-\cap L_2^- =\emptyset$.
\end{lemma}

\begin{proof}
The second statement follows from the containment
   $L_i^- \subset W_i$, because, as we have seen,
$W_1$
from $W_2$.
Consider the first statement.  
We have
 $$
 W'' \cap TCC = W'' \cap CC = W'' \cap L_1^+ \cap L_1^-.
 $$
The first equality holds by construction of the truncated corner
cell.  The second equality holds because the parts $L_i^-$ excised
from $CC$ to form $TCC$ are contained in $W_i$.
We also have
  $$
  W_i \cap TCC = R_i \cap B(v_0,t) = W_i  \cap L_i^+.
  $$
%% XX IS THIS A NEW TARSKI??
The result follows.
\end{proof}




\subsection{inverted truncated corner cells}\tlabel{sec:inverted}
%\subsection{Analytic continuation} %DCG 13.3, p144
\oldlabel{5.3}

In this section, we develop a formula for $\op{sovo}$ on 
a truncated corner cell that remains valid if the 
Assumption~\ref{eqn:q1q2} is not in force.
When Assumption~\ref{eqn:q1q2} does not necessarily hold, we
define $TCC(v_0,v_1,w_1,w_2,t,\lambda) = L_1^+ \cap L_2^+$.
By Lemma~\ref{lemma:LL}, 
this is a compatible extension of the definition
of truncated corner cells, up to a null set.
The proof that $L_1^+\cap L_2^- = \emptyset$ 
relies on Assumption~\ref{eqn:q1q2}.


\begin{lemma} Let $\op{sovo}^g(v_0,TCC,\lambda)$ be given
by the right-hand side of Equation~\ref{eqn:tcc}.
If $\phi(t,t,\lambda) > 0$, then
   $$
   \op{sovo}(v_0,TCC,\lambda) > \op{sovo}^g(v_0,TCC,\lambda).
   $$
Furthermore, the sign is reversed if $\phi(t,t,\lambda) < 0$.
\end{lemma}

\begin{proof}
We have by inclusion-exclusion, the formula
$$
\begin{array}{lll}
\op{sovo}(v_0,TCC,\lambda) &=
\op{sovo}(v_0,CC,\lambda) -
\op{sovo}(v_0, L_1^-,\lambda) -
\op{sovo}(v_0, L_2^-,\lambda) \\
 &\quad +
\op{sovo}(v_0, L_1^- \cap L_2^-,\lambda).
\end{array}
$$

If we compare this formula with the calculations for 
$\op{sovo}(v_0,TCC,\lambda)$ in Lemma~\ref{lemma:tcc}, 
we find that, in the notation of that lemma:
$$
\op{sovo}(v_0,CC\cap L_i^-) = \op{sovo}(v_0,Q_i,\lambda) - s_i.
$$

Thus, the formula for $\op{sovo}(TCC)$ in the general case,
differs from the formula under Assumption~\ref{eqn:q1q2} through
the term $\op{sovo}(v_0,L_1^-\cap L_2^-,\lambda)$.

We note that $L_1^-\cap L_2^-$ is $t$-radial 
(Lemma~\ref{tarski:rCCinvert-rad}).  Thus,
$$
\op{sovo}(v_0,L_1^-\cap L_2^-,\lambda) =
\sol(v_0, L_1^-\cap L_2^-)\phi(t,t,\lambda)
$$
and
$$
\op{sovo}(v_0,TCC,\lambda) = \op{sovo}^g(v_0,TCC,\lambda) +
   \sol(v_0,L_1^-\cap L_2^-) \phi(t,t,\lambda).
$$
In particular, the direction of the inequality between
$\op{sovo}$ and $\op{sovo}^g$ is determined by the sign
of $\phi(t,t,\lambda)$.
\end{proof}



\subsection{overlapping truncated corner cells}
%\subsection{More on Truncated Corner Cells}



This section makes an estimate of the function $\op{sovo}$
on the union $CC_1\cup CC_2$ of two untruncated corner cells.
We use a parameter value $\lambda=\lambda_{sq}$ that will
not be defined until Section~\ref{sec:pos}.  Its exact value
does not concern us here.    For those who are curious, its
exact value is listed in the index.
%% XX unpleasant!

\begin{lemma}\tlabel{lemma:2tcc} 
For $i=1,2$, let $$CC_i =CC(v_0,v_i,w_i,u_i,t,\mu)$$ and 
be untruncated corner cells, both
with azimuth angle at least $\pi$ and parameters $t=1.255$ and 
$\mu=1.945$.
Assume $|v_1-v_2|\ge 3.2$.  Let $y_i =|v_i-v_0|$ and
let $\lambda = \lambda_{sq}$.
Suppose that
$2\le y_i\le 2t$.  Then
$\op{sovo}(v_0,CC_1\cup CC_2,\lambda) > 0.8862$.
\end{lemma}

%% WW Recheck proof. Constant was squander + pimax

\begin{proof}
%Suppose first that $CC_1$ and $CC_2$ are disjoint.
%Following the proof of Lemma~\ref{lemma:CC815}, 
%but with parameter $\mu=1.945$, a lower bound on
%$\op{sovo}$ is obtained when  $y=2t$,
%$\op{azim}=\pi$. The explicit formulas give 
%  $$\op{sovo}(v_0,C,\lambda) > 0.734$$
%for $C=CC,CC'$.
%The result follows in this case.
%
%Suppose that $CC$ meets $CC'$. 
We have
 $$
 \op{sovo}(CC_1\cup CC_2)=
 \op{sovo}(CC_1)+\op{sovo}(CC_2)-\op{sovo}(CC_1\cap CC_2).
 $$
It follows from Lemma~\ref{tarski:2CCrad} that
$CC_1\cap CC_2$ is $t$-radial at $v_0$.  Thus,
$$\op{sovo}(v_0,CC_1\cap CC_2,\lambda) =
  \sol(v_0,CC_1\cap CC_2)\phi(t,t,\lambda).$$

Let $q$ and $q'$ be the two points defined by distances
$t$ from $v_0$, $\mu$ from $v_1$, and $\mu$ from $v_2$.
The existence of such points is given by Lemma~\ref{tarski:mk-point}.
Let $A=\op{aff}_+(v_0,\{q,v_1,v_2\})$ and
$A'=\op{aff}_+(v_0,\{q',v_1,v_2\})$.
Let $rc_i = \op{rcone}^0(v_0,v_i,y_i/(2\cos\psi_i))$.
By Lemma~\ref{tarski:AA'}, we have the relations
$$
\begin{array}{lll}
CC_1\cap CC_2 &\equiv (A\cap CC_1\cap CC_2) \cup (A'\cap CC_1\cap CC_2).\\
\sol(v_0,A\cap CC_1\cap CC_2) &= \sol(v_0,A\cap CC_1) + \sol(v_0,A\cap CC_2)
  -\sol(v_0,A)\\
    &\le \sol(v_0,A\cap rc) + \sol(v_0,A\cap rc') - \sol(v_0,A)\\
    &= \sol(v_0, A \cap rc \cap rc').
\end{array}
$$
The constant $\phi(t,t,\lambda)$ is positive.  Thus, we
get a lower bound on $\op{sovo}(CC_1\cup CC_2)$ by taking 
the intersection $rc \cap rc'$ to be as large as possible.
By Lemma~\ref{tarski:rcone2}, 
this happens when $v_1$ is as close to $v_2$ as possible:
$|v_1-v_2|=\ell=3.2$.  Assume this.

The bound is now easily estimated in terms of primitive
regions.  Adding the similar
term for $A'$, we get
a function $f(y_1,y_2)$ that gives a lower bound on 
$\op{sovo}(CC_1\cup CC_2)$.  
    $$
    \begin{array}{lll}
    \alpha_1 &= \dih(y_1,t,y_2,\mu,\ell,\mu),\\
    \alpha_2 &= \dih(y_2,t,y_1,\mu,\ell,\mu),\\
    \sol &= \sol(y_2,t,y_1,\mu,\ell,\mu),\\
    \phi_i &= \phi(y_i/2,t,\lambda),\quad i=1,2,\\
    f(y_1,y_2,t,\mu,\lambda)&=
    2\phi(t,t,\lambda)\sol+
    2\sum_1^2 \alpha_i(1-y_i/(2t))(\phi(t,t,\lambda)-\phi_i)\\
        &\quad +
       \sum_1^2 \op{sovoCC}(y_i,\pi-2\alpha_i,t,\mu,\lambda).
    \end{array}
    $$
Here $\op{sovoCC}(y,\beta,t,\mu)$ is the function
of Lemma~\ref{lemma:sovo:CC}.
An interval calculation\footnote{\calc{115756648}} %A14
gives $f(y_1,y_2,t,\mu,\lambda)>0.8862$, for $y_1,y_2\in[2,2t]$,
$\lambda$ as given in the lemma, $\ell=3.2$, $t=1.255$, $\mu=1.945$.
%% RECHECK.  Carried out originally by S. Ferguson.
%% http://www.math.pitt.edu/~thales/kepler98/interval/html/ineq4.html
%% XX  I can't find it.  I think it is sam's file section_a14_9.c.
\end{proof}




%\section{Scores of Simplices and Cones}


%\begin{remark}\tlabel{remark:vor}\index{vor}\index{c-vor}\index{score}
% Deleted function {c-vor} that has been replaced by sovo

%\label{eqn:3.2} deleted. It should be replaced by sovo(FR) formula ref.

%\section{The Function K}
%\tlabel{sec:K} %DCG p105-106.
%% No longer used.  Proof of -1.04 lemma was rewritten.
%%
%
%We define a function $K(S)$ on
%certain simplices $S$ with circumradius at least $\sqr2$. Let
%$S=S(y_1,y_2,\ldots,y_6)$.  Let $R(a,b,c)$ denote a Rogers
%simplex. Set
%    \begin{equation}
%    K(S) = K_0(y_1,y_2,y_6)+K_0(y_1,y_3,y_5)
%    + \dih(S)(1-y_1/\sqr8) \phi(y_1/2,\sqr2),
%    \tlabel{eqn:KS}
%    \end{equation}
%where
%    $$
%    $$
%(If the given Rogers simplices do not exist because the condition
%$0<a<b<c$ is violated, we set the corresponding terms in these
%expressions to 0.) The function $K(S)$ represents the part of the
%score coming from the four Rogers simplices along two of the faces
%of $S$, and the conic region extending out to $\sqr2$ between the
%two Rogers simplices along the edge $y_1$ (Figure~\ref{fig:KS}).
%This region is closely related to the regions $\FC(v,W)$ of
%Definition~\ref{def:delta-e}, with the difference that the regions
%$\FC$ lie in a ball of radius $\eta(|v|,2,2t)$, but the regions
%here are truncated at $\sqrt2$.
%
%\begin{figure}[htb]
%  \centering
%  \myincludegraphics{\ps/diag43.ps}
%  \caption{The set measured by the function $K(S)$.}
%  \tlabel{fig:KS}
%\end{figure}
%
%

\subsection{crowns}
%\section{The Function anc}
\tlabel{sec:anc} %DCG p 107.

This subsection considers
one final composite region.
Let $\eta(x,y,z)$ be the circumradius of a triangle with
sides $x,y,z$. % and let $\eta_0(h,t) = \eta(2,2h,2t)$.

We return to the context established at the beginning
of Section~\ref{sec:tcc}.  We use the parameters $v_0,v_1,w_1,w_2$,
and $c=c_1=c_2=\eta(2,2h,2t)$, and $h =|v_0-v_1|/2 \le t$. 
Assumption~\ref{eqn:q1q2} remains in force.
Let $W_1,W_2,W'',W,R_i,R_i',p_i,q_i$ be as given at the
beginning of Section~\ref{sec:tcc}.
%
Let 
  $$\bar B = \bar B(v_0,t) = \{x \mid |x-v_0| > t\},$$
the complement of a closed ball of radius $t$ at $v_0$.
%
\begin{definition}\label{def:fitted-crown}
We define the fitted crown to be $FCR$, where
$$
\begin{array}{lll}
FC(v_0,v_1,w_2,w_2,t) &= \FCinner(v_0,v_1,w_1,w_2,t) \cup 
      FC_{rog} (v_0,v_1,w_1,w_2,t,1)\cup FC_{rog}(v_0,v_1,w_1,w_2,t,2)\\
%
\FCinner(v_0,v_1,w_1,w_2,t) &= (W'' \cap FR(v_0,v_1,h,h/c))\cup R_1 \cup R_2 \\
%
FC_{rog} (v_0,v_1,w_1,w_2,t,i) &= R_i'\\
%
FCR(v_0,v_1,w_1,w_2,t) &= FC(v_0,v_1,w_1,w_2,t) \cap \bar B.
\end{array}
$$
\index{fitted crown}\index{FC}\index{FCR}
\end{definition}

As described at the beginning of the section, the 
sets $R_i\cap \bar B$ and $R_i'\cap \bar B$ are empty
(and also $W_i=\emptyset$) when the circumradius of 
$\{v_0,v_1,w_i\}$ is greater than $c=c_i$.

We define some functions that will be used in a formula
for the value of $\op{sovo}$ on a fitted crown.
Define
\begin{equation}\cro(h,t,\lambda) =
2\pi(1-h/\eta(2,2h,2t))(\phi(h,\eta(2,2h,2t),\lambda)-\phi(t,t,\lambda)). 
\end{equation} 

\begin{lemma}\label{lemma:sovo:CR} 
Let $t$ and $h$ be real numbers satisfying 
$0 < t \le h$.
Let $b=h/\eta(2,2h,2t)$.
Let $CR=FR(v_0,v_1,h,b) \setminus B(v_0,t)$.
  Then
$$\op{sovo}(v_0,CR,\lambda) = \cro(h,t,\lambda).$$
\end{lemma}

\begin{proof}  Let $RC=\op{rcone}^0(v_0,v_1,h,b)$.
Then by Lemma~\ref{tarski:RCFR}, we have
$B' = B(v_0,t)\cap RC = FR\cap B(v_0,t)$.
Furthermore, $B'$ is $t$-radial with solid angle equal to that
of $FR$.  Thus, by Lemma~\ref{lemma:sovoFR},
$$
\begin{array}{lll}
\op{sovo}(CR) &= \op{sovo}(FR) - \op{sovo}(B')\\
 &= \op{sol}(FR) (\phi(h,b,\lambda) - \phi(t,t,\lambda))\\
 &= \cro(h,t,\lambda).
\end{array}
$$
\end{proof}

Similarly, if $WCR = W(v_0,v_1,w_1,w_2) \cap CR$, then
$$
\op{sovo}(v_0,WCR,\lambda) = \op{azim}(v_0,v_1,w_1,w_2)\cro(h,t,\lambda)/(2\pi),
$$
because $CR$ 
is rotationally symmetric about the axis $\op{aff}\{v_0,v_1\}$.


%\begin{figure}[htb]
%  \centering
%  \myincludegraphics{\ps/diag44.ps}
%  \caption{An illustration of the terms $\anc$.}
%  \tlabel{fig:anchor}
%\end{figure}

Let $\op{dihR}(a,b,c)$ be the dihedral angle along the edge
$\{v_0,v_1\}$ of a
Rogers simplex $\op{rog}^0(v_0,v_1,v_2,v_3,c)$ with $abc$-parameters
$(a,b,c)$.  Similarly, let $\op{solR}(a,b,c)$ (resp. $\op{sovoR}(a,b,c,\lambda)$)
be the solid angle (resp. value of $\op{sovo}$)
at $v_0$ of such a Rogers simplex.  By Lemma~\ref{lemma:rog:abc},
these values depend only on the $abc$-parameters.
Set
    \begin{equation}
    \begin{array}{lll}
    \anc(y_1,y_2,y_6,t,\lambda) &= 
     -\op{dihR}_1\cro(y_1/2,t,\lambda)/(2\pi)
       %
    -\op{dihR}_2\, A(y_2/2,t,\lambda) \\
        %(1-y_2/(2t))(\phi(y_2/2,t,\lambda)-\phi(t,t,\lambda))
      &+\sum_{i=1}^2 (\op{sovoR}_i - \op{solR}_i \phi(t,t,\lambda))\\
       %-\op{solR}_1\phi(t,t,\lambda)+\op{sovoR}_1\\
       % -\op{solR}_2\phi(t,t,\lambda) + \op{sovoR}_2,
    \tlabel{eqn:4.5}
    \end{array}
    \end{equation}\index{anc@$\anc$}
where $\op{dihR}_i$, $\op{solR}_i$, $\op{sovoR}_i$ are the values
of $\op{dihR}$, $\op{solR}$, and $\op{sovoR}(\cdot,\lambda)$
at $(a_i,b,c) = (y_i/2,\eta(y_1,y_2,y_6),\eta(2,y_1,2t))$, for $i=1,2$.
Recall that the terms are defined as zero if the inequalities
$0 < a_i \le b\le c$ are violated.  Hence, the function $\anc$ is
zero, except at points in a certain domain.

%% Moved from DCG 11.2 Contexts.
Set
    $$\kappa(y_1,y_2,y_3,y_5,y_6,\alpha,t,\lambda) =
   \alpha\,\cro(y_1/2,t,\lambda)/(2\pi) +
        \anc(y_1,y_2,y_6,t,\lambda)+\anc(y_1,y_3,y_5,t,\lambda).
    $$
    \index{zzkappa@$\kappa$}
We are finally ready to state the main result about fitted crowns.
Assumption~\ref{eqn:q1q2} remains in force.

\begin{lemma}\label{lemma:sovo:FCR}
Let $\{v_0,v_1,w_1,w_2\}$ be a set of four points in $\ring{R}^3$.
Assume the set is not planar.
Let $0 < t < h$, where $h = |v_1-v_0|/2$.
Set $\alpha = \op{azim}(v_0,v_1,w_1,w_2)$.
Let 
 $$(y_1,y_2,z_2,z_1) =
   (|w_1-v_0|,|w_2-v_0|,|w_2-v_1|,|w_1-v_1|).
 $$
Then
$$
\op{sovo}(v_0,FCR(v_0,v_1,w_1,w_2,t),\lambda) =
 \kappa(2h,y_1,y_2,z_2,z_1,\alpha,t,\lambda).
$$
\end{lemma}

\begin{proof}
Let $B = B(v_0,t)$.  We have
$$R\equiv (\bar B\cap R) \cup (B\cap R),\quad B\cap \bar B = \emptyset,
$$
for $R=R_i,R'_i$.  Moreover, $B\cap R_i$ is $t$-radial at $v_0$.
Thus, 
 $$
\begin{array}{lll}
 \op{sovo}(\bar B\cap R_i) &= \op{sovo}(R_i) - \op{sovo}(B\cap R_i)\\
 &= \op{sovo}(R_i) - \sol(R_i)\phi(t,t,\lambda) \\
 &= \op{anc}(2h,y_i,z_i) \\
    &\quad + \dih(R_i)\cro(h,t,\lambda)/(2\pi) + \dih(R'_i) A(y_i/2,t,\lambda)\\
  &\quad -(\op{sovo}(R_i') -\sol(R_i')\phi(t,t,\lambda)). \\
\end{array}
 $$
We have by Lemma~\ref{lemma:sovo:truncRog}, 
$$
\begin{array}{lll}
\op{sovo}(\bar B\cap R_i') &= \op{sovo}(R'_i) - \op{sovo}(B\cap R'_i)\\
\op{sovo}(B\cap R'_i) &= \sol(R'_i)\phi(t,t,\lambda) + \dih(R'_i) A(y_i/2,t,\lambda)\\
\end{array}
$$
We have by Lemma~\ref{lemma:sovo:CR} that
$$
\begin{array}{lll}
\op{sovo}(FCR) &= \op{sovo}(W''\cap FCR) + \op{sovo}(W_1\cap FCR)
 +\op{sovo}(W_2\cap FCR).\\
\op{sovo}(W_i\cap FCR) &= \op{sovo}(\bar B\cap R_i) + \op{sovo}(\bar B\cap R'_i).\\
 \op{sovo}(W''\cap FCR) &= \op{azim}(W'')\cro(h,t,\lambda)/(2\pi),\\
\op{azim}(v_0,v_1,w_1,w_2)&= \op{azim}(W'')+\dih(R_1)+\dih(R_2).\\
\end{array}
$$
These equations give the lemma.
\end{proof}

\begin{lemma}  The solid angle of $FCR(v_0,v_1,w_1,w_2,t,\lambda)$
is zero at $v_0$.
\end{lemma}

\begin{proof}  The region $FCR$ is contained in the complement
of the ball of radius $t>0$ at $v_0$.  It is bounded away from
zero.  Hence, its solid angle is zero.
\end{proof}

It follows that $\op{sovo}(v_0,FCR,\lambda) = \lambda_v\op{vol}(FCR)$,
where $\lambda=(\lambda_v,\lambda_s)$.



\section{Finiteness and Volume}

We have now developed all of the volume calculations that will
be needed in this book.   We finish this chapter with some 
elementary estimates based on the volumes of  cubes and balls.

\begin{lemma}\tlabel{lemma:Zcount}
    For all $p\in\ring{R}^3$ and all $r\ge 0$, the set
    $\ring{Z}^3\cap B(p,r)$ is finite of cardinality at most
    $4\pi (r+\sqrt3)^3/3$.
\end{lemma}

\begin{proof}  If $v\in\ring{Z}^3\cap B(p,r)$, then the ith
coordinate $v_i$ of $v$ must lie in the finite range
    $$
    p_i - r \le v_i \le p_i + r.
    $$
Hence there are only finitely many possibilities for $v$.


Place an open unit cube at each point of $\ring{Z}^3\cap B(p,r)$.
The cubes are measurable, disjoint, and contained in
$B(p,r+\sqrt3)$.  Thus, the combined volume of the cubes, which is
$|\ring{Z}^3\cap B(p,r)|$,  is no greater than the volume of the
containing ball.  The result follows.
\end{proof}

\begin{lemma}\tlabel{lemma:Zlow-count}
  For all $p\in\ring{R}^3$ and all $r\ge\sqrt3$, the set
    $\ring{Z}^3\cap B(p,r)$ is finite of cardinality at least
    $4\pi (r-\sqrt3)^3/3$.
\end{lemma}

\begin{proof} We have already established finiteness in
Lemma~\ref{lemma:Zcount}.  Place a closed unit cube at each point
of $\ring{Z}^3\cap B(p,r)$.  The cubes are measurable and cover
$B(p,r-\sqrt3)$.  Thus, the combined volume of the cubes is at
least the volume of the covered ball.  The result follows.
\end{proof}

\begin{lemma}\tlabel{lemma:Zr2}
For all $p\in\ring{R}^3$, and $k,k'>0$, there exists a $C$ such
that for all $r\ge k'$, we have
    $$
    \ring{Z}^3 \cap (B(p,r+k) \setminus B(p,r-k')) \le C r^2.
    $$
\end{lemma}

\begin{proof}  When $r \ge k'+\sqrt3$, the previous two lemmas show
that the cardinality is at most $4\pi/3$ times
    $$(r + +k + \sqrt3)^3 - (r - k' - \sqrt3)^3 \le C' r^2$$
for some $C'$.  Similarly, if $k'\le r\le k'+\sqrt3$, the
cardinality is at most some fixed constant $C''$.  The result
easily follows.
\end{proof}

