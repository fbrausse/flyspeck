%% Quadratic Volumes
%% File Created 3/22/07.

\chapter{Volume}

\section{Measure}
\indy{Index}{measure}

Nowhere does this book need a notion
of integration.  Measure alone suffices.  (However, there are a few
volumes described below that I do not see how to calculate without
first writing them as an integral.)

This book needs a concepts of null set, measurable set, and volume in
three dimensions.  For the purposes of this book, one can take the
the three dimensional Lebesgue measure.   
The null sets can be defined
to be the sets of zero Lebesgue measure. The measurable sets can
be defined as the bounded Lebesgue measurable sets.  The volume of
a measurable set can be defined as its Lebesgue measure.
As it will become clear in a moment, one needs considerably less than Lebesgue measure.
Most of the volumes to be considered were known in antiquity.
\indy{Index}{measure!Lebesgue}


\subsection{null set}\label{sec:null}
\indy{Index}{null set}

Assume a notion of null set with the following
properties.

\begin{enumerate}%[Null Set]
\item A finite union of null sets is a null set.\\
 \item A plane is a null set.\\
 \item A sphere is a null set.\\
 \item A circular cone is a null set; that is, a union of all
  lines through a fixed point $P$ and forming fixed
 forming fixed angle with a line through $P$.
\tlabel{enum:null}
\indy{Index}{null set}
\indy{Index}{plane}
\indy{Index}{sphere}
\indy{Index}{circular cone}
\end{enumerate}
\indy{Notation}{P@$P$ (point)}


Write $X\equiv Y$ if sets $X$ and $Y$ are equal up to a null set.
That is, there exists a null set $Z$ such that
   $(X\setminus Y) \cup (Y\setminus X) \subset Z$.
\indy{Index}{null set}
\indy{Notation}{1@$\equiv$}

\subsection{measurability}\label{sec:measure}
\indy{Index}{measure}

Assume a notion of measurability that has the following properties.

\begin{enumerate}%[Measurable set]
 \item Null sets are measurable.
 \item The union of two measurable sets is measurable.
 \item The intersection of two measurable sets is measurable.
 \item The difference of two measurable sets is measurable.
 \item Primitive regions are measurable (Definition~\ref{def:primitive}).
\tlabel{enum:measure}
\indy{Index}{null set}
\indy{Index}{primitive regions}
\end{enumerate}

\subsection{volume}\label{sec:volume}

Certain primitive regions are given in Definition~\ref{def:primitive}.
Assume a notion of volume that has the following properties.
\indy{Index}{primitive}

\begin{enumerate}%[Volume]
 \item The volume is defined for every measurable set.  It is
    a non-negative real number.
 \item The volume of a null set is $0$.
 \item If $X$ and $Y$ are  measurable, and if
 the symmetric difference of
 $X$ and $Y$ is contained in a null set, then 
    $X$ and $Y$ have the same volume.
 \item If $X$ and $Y$ are measurable sets, and if $X\cap
 Y$ is contained in a null set, then
    $$
    \op{vol}(X\cup Y) = \op{vol}(X) + \op{vol}(Y).
    $$
\indy{Notation}{X@$X$ (set)}
\indy{Notation}{Y@$Y$ (set)}
  \item (linear stretch) For $X\subset \ring{R}^3$, $v\in\ring{R}^3$, 
    set 
      $$
      T_v(X) = \{ (v_1u_1,v_2u_2,v_3u_3) \mid u\in X\}.
      $$
\indy{Notation}{Tv@$T_v$ (linear stretch)}
    If $X$ and $T_v(X)$ are measurable, then
     $\op{vol}(T_v(X)) = |v_1v_2v_3|\op{vol}(X)$.
  \item (translation) If $X\subset \ring{R}^3$ and $v\in\ring{R}^3$, then let
    $X+v = \{p + v\mid p\in X\}$.  If $X$ is measurable, then $X+v$ is
    as well, and $\op{vol}(X) = \op{vol}(X+v)$.
  \item (primitives) If $X$ is a primitive, then $X$ is measurable
    and $\op{vol}(X)$ is given by the formulas of Lemma~\ref{lemma:prim-volume}.
\tlabel{enum:volume}
\end{enumerate}
\indy{Index}{volume}
\indy{Index}{linear!stretch}
\indy{Index}{translation}
Volume calculations of primitive regions are given in 
Lemmas~\ref{lemma:prim-volume} and~\ref{lemma:wedge-vol}.
%% NB Don't need lemma:wedge-sol because solid of a \op{FR} is a \op{SC}.
%% Don't need lemma:prim-sol, because solds are \op{SC} or \op{ST}.

\begin{lemma}\guid{ATOAPUN}\oldrating{300}
\formalauthor{John Harrison}  
Let $\op{vol}$ be the Lebesgue measure
on $\ring{R}^3$. Let $B$ be the collection of all bounded Lebesgue
measurable subsets of $\ring{R}^3$.  Let $N$ be the collection of all
Lebesgue measurable subsets of $\ring{R}^3$ of measure zero.
Then
\begin{itemize}
\item  The collection $N$ satisfies the null set properties of Section~\ref{sec:null}
\item The collection $B$ satisfies the measurability properties of Section~\ref{sec:measure}
\item  $\op{vol}$ on $B$ satisfies the volume properties of Section~\ref{sec:volume}.  
\indy{Index}{measure!Lebesgue}
\end{itemize}
\end{lemma}
\indy{Notation}{B@$B$ (Lebesgue measurable subsets)}
\indy{Notation}{vol@$\op{vol}$}

\subsection{radial set and solid angle}\label{sec:solid}

Surface integrals are not required in this book.  Although
the `solid angle' is traditionally defined as a surface integral,
it is simpler to give an alternative definition based on volume.


\begin{definition}[open ball]  The open ball $B(p,r)$ with center $p$ and
radius $r$ is the set
    $$
    \{ y\in\ring{R}^3 \mid \norm{p}{y} < r.\}
    $$
\indy{Index}{open ball}
\indy{Notation}{open ball@$B(p,r)$}
\end{definition}



\begin{definition}[radial]
    A set $C$ is $r$-radial at center $p$ if  $C\subset B(p,r)$
    and if
        $p + u \in C$ implies
        $p + t u \in C$ for all $t$ satisfying $0 < \normo{u} t < r$.
A set $C$ is eventually radial at center $p$ if $C\cap B(p,r)$ is
$r$-radial at center $p$, for some $r>0$.
\indy{Index}{radial}
\end{definition}
\indy{Notation}{C@$C$ (set)}

\begin{lemma}\guid{PUACSHX}\tlabel{lemma:r-r'}\oldrating{140}\formalauthor{Nguyen Tat Thang, Nov 2008}
Assume that $C$ is measurable and $r$-radial at $p$.  Let $0\le r'<r$,
then $C\cap B(p,r')$ is measurable and
$\op{vol}(C\cap B(p,r')) = \op{vol}(C) (r'/r)^3$.
\end{lemma}

\begin{proof}  The radial set $C$ transforms into $C\cap B(p,r')$ by
a series of translations and stretch transformations.
\end{proof}


\begin{definition}[solid angle]\tlabel{def:sol}
When $C$ is measurable and eventually radial at center $p$, 
define the solid angle of $C$ at $p$ to be
    $$
    \op{sol}(p,C) = 3 \op{vol}(C\cap B(p,r))/r^3,
    $$
where $r$ is as in the definition of eventually radial. 
By Lemma~\ref{lemma:r-r'}, this
definition is independent of any such $r$.  When the center $p$ is
clear from the context, write $\op{sol}(C)$ for
$\op{sol}(p,C)$.
\indy{Index}{solid angle}
\indy{Notation}{solid angle@$\op{sol}$}
\end{definition}



The following properties follow immediately from the definitions.
If $C$ is $r$-radial for some $r>0$ then it is eventually radial.
If $C$ is measurable and $r$-radial, then the volume of $C$
satisfies
    $$
    \op{vol}(C) = \op{sol}(C) r^3/3.
    $$
If $C$ is bounded away from $p$, then $C$ is eventually radial at
$p$, and $\op{sol}(C) = 0$.
\indy{Index}{radial}

\begin{lemma}\guid{KODOBRF}\rating{60}  If $C$ and $C'$ are  $r$-radial
at $p$, then $C\cap C'$ is also $r$-radial at
$p$.
\end{lemma}






\section{Primitive Volume}
\indy{Index}{volume!primitive}

This book accepts
certain elementary volume calculations as axioms.  
These regions will be called primitive volumes.  There are only
a few primitive volumes.
All further
volumes calculations will be obtained from these through the basic
properties of measure.   
This treatment of volume is hardly about measure at all.  The focus is rather on the geometry of the various regions and how to decompose them into primitives.

To fix a convention, this book prefers to take the volume of open sets whenever that can be arranged.  It begins with a description of some of the primitive regions.

\subsection{wedge}
\indy{Index}{wedge}


The set $\op{aff}^0_+(\{v_0,v_1\},\{v_2,v_3\})$ was defined
in Definition~\ref{def:aff}.  Call it a lune.  It is the intersection
of two open half-spaces
    $$
    \op{aff}^0_+(\{v_0,v_1\},\{v_2,v_3\})
    =\op{aff}^0_+(\{v_0,v_1,v_2\},v_3)\cap
    \op{aff}^0_+(\{v_0,v_1,v_3\},v_2)
    $$
\indy{Notation}{aff0@$\op{aff}^0$ (lune)}


A lune has a dihedral angle $\dih(\{v_0,v_1\},\{v_2,v_3\})$ between
$0$ and $\pi$.   For angles that are larger than $\pi$,   a wedge
$W(v_0,v_1,w_1,w_2)$ is used instead of the lune.  Assume that $v_0\ne v_1$ and that
$w_1$ and $w_2$ do not lie on
the line $\op{aff}\{v_0,v_1\}$.  Set
$$
W(v_0,v_1,w_1,w_2) = 
  \{p\not\in\op{aff}\{v_0,v_1\} \mid 
  0< \op{azim}(v_0,v_1,w_1,p) < \op{azim}(v_0,v_1,w_1,w_2)\}.
$$
When the angle is less than $\pi$, there is no difference between
a wedge and a lune:
\indy{Index}{lune}
\indy{Index}{half-space}
\indy{Index}{angle!dihedral}
\indy{Index}{wedge}
\indy{Notation}{dih@$\dih$ (dihedral angle)}
\indy{Notation}{W@$W$ (wedge)}

\begin{lemma}\guid{VICUATE} Let $\{v_0,v_1,v_2,v_3\}$ be a set of four points
in $\ring{R}^3$.  Assume that the set is not coplanar.
Assume that $\op{azim}(v_0,v_1,v_2,v_3)<\pi$.
Then,
   $$W(v_0,v_1,v_2,v_3) = \op{aff}^0_-(\{v_0,v_1\},\{v_2,v_3\}).$$
\indy{Index}{coplanar}
\end{lemma}


\subsection{solid triangle}
\indy{Index}{solid triangle}

\begin{definition}[solid triangle] The solid triangle $\op{ST}(v_0,S,r)$ is
determined by  $v_0\in\ring{R}^3$, a finite subset $S\subset\ring{R}^3$,
and a radius $r\ge0$. 
    $$
    \op{ST}(v_0,S,r) = 
    B(v_0,r)\cap \op{cone}(v_0,S).
    $$
(Usually, $S=\{v_1,v_2,v_3\}$, and this accounts for
the name.)
\indy{Index}{solid triangle}
\indy{Notation}{solid triangle@$\op{ST}$ (solid triangle)}
\indy{Notation}{r@$r$ (radius)}
\end{definition}



\subsection{conic cap}
\indy{Index}{conic cap}

% renamed from spherical cap.

\begin{definition}[conic cap]
The conic cap $\op{SC}(v_0,v_1,r,a)$ is specified by an apex
$v_0\in\ring{R}^3$,  radius $r\ge0$,  non-zero vector $v_1-v_0$ giving
direction, and constant $a$.  The conic cap is the intersection of
the ball $B(v_0,r)$ with a solid right-circular cone:
    $$
    \op{SC}(v_0,v_1,r,a)=\{y \in B(v_0,r) \mid (y-v_0)\cdot (v_1-v_0) > \norm{y}{v_0}\, \norm{v_1}{v_0}\, a\}.
    $$
\indy{Index}{conic cap}
\indy{Index}{apex}
\indy{Index}{cone}
\indy{Notation}{conic cap@$\op{SC}$ (conic cap)}
\end{definition}

\subsection{frustum}
\indy{Index}{frustum}

\begin{definition}[rcone]\tlabel{def:p:rcone}
%\tlabel{def:rcone} % from Tarski collection..
\indy{Index}{cone!right-circular}
Define the following collection of right-circular cones.
If $v$ and $w$ are points in $\ring{R}^3$, and
  $h\in\ring{R}$, then set
  $$\begin{array}{lll}
    \op{rcone}(v,w,h) &= \{p\mid (p-v)\cdot (w-v) \ge \norm{p}{v}\,\norm{w}{v} h\},\\
    \op{rcone}^0(v,w,h) &= \{p\mid (p-v)\cdot (w-v) > \norm{p}{v}\,\norm{w}{v} h\}.\\
    %\op{rcone}_-^0(v,w,h) &= \{p\mid (p-v)\cdot (w-v) < \norm{p}{v}\,\norm{w}{v} h\}.\\
    %\partial\op{rcone}(v,w,h) &= \{p\mid (p-v)\cdot (w-v) = \norm{p}{v}\,\norm{w}{v} h\}.\\
    \end{array}
    $$
\end{definition}
\indy{Notation}{rcone@$\op{rcone}$}
\indy{Notation}{rcone2@$\op{rcone}^0$}
%\indy{Notation}{rcone3@$\op{rcone}_-^0$}
%\indy{Notation}{rcone4@$\partial\op{rcone}$}
\indy{Notation}{v@$v$ (point)}
\indy{Notation}{w@$w$ (point)}


\begin{definition}[frustum, FR] The frustum
$\op{FR}(v_0,v_1,h',h,a)$ is specified by an apex $v_0\in\ring{R}^3$, heights
$0\le h'\le h$, a vector $v_1-v_0$ giving its direction, and
$a\in[0,1]$. The set $\op{FR}$ is given as
    $$
    \{ y \in\op{rcone}^0(v_0,v_1,a) \mid \ 
       h'\norm{v_1}{v_0} < (y-v_0) \cdot (v_1-v_0) < h\norm{v_1}{v_0} \}.
    $$
\indy{Index}{frustum}
\indy{Notation}{frustum@$\op{FR}$ (frustum)}
\indy{Notation}{apex@$v_0$ (apex)}
\indy{Notation}{height@$0\le h' le h$ (height)}
\indy{Notation}{v1@$v_1$ (vector)}
\indy{Notation}{v0@$v_0$ (vector)}
\end{definition}

That is, the frustum is the part of a right-circular cone between two
parallel planes that cut the axis of the cone at a right angle.
When $h'=0$, the frustum extends to the apex of the cone.
Write $\op{FR}(v_0,v_1,h,a)=\op{FR}(v_0,v_1,h',h,a)$.

\subsection{tetrahedron}
\indy{Index}{tetrahedron}

\begin{definition}[tetrahedron] A tetrahedron is a set of the form
$$\op{conv}^0\{v_1,v_2,v_3,v_4\}.$$
\indy{Index}{tetrahedron}
\end{definition}

By Tarski arithmetic, %tarski: {hedra-tope}, 
this set can also be described
as the intersection of four open half-spaces, with each bounding
plane defined by three of the four points.
By taking this into account, it follows that
the sets in this section have all been defined by linear and quadratic
constraints.
\indy{Index}{Tarski arithmetic}

\subsection{primitive}
\indy{Index}{primitive}

\begin{definition}[primitive]\label{def:primitive} 
A primitive region is any of the following.

\begin{enumerate}%%[Primitive Volumes]
 \item A solid triangle $\op{ST}$.
\indy{Notation}{ST@$\op{ST}$ (triangle)}
 \item A tetrahedron $conv^0\{v_0,v_1,v_2,v_3\}$.
 \item A wedge of a frustum;
that is, the intersection of a frustum with
 a wedge:
    $$
     \op{FR}(v_0,v_1,h_1,h_2,a) \cap W(v_0,v_1,v_2,v_3).
    $$
\item A wedge of a conic cap; that is, the intersection of a conic cap
with
    a wedge:
    $$
    \op{SC}(v_0,v_1,r,c) \cap W(v_0,v_1,v_2,v_3).
    $$
\item a rectangle
    $$
    \{u \mid a_i < u_i < b_i,\text { for } i=1,2,3.\}.
    $$
\item A wedge of a ball
  $$
  B(v_0,r) \cap W(v_0,v_1,v_2,v_3).
  $$
%\item An ellipsoid
 %  $$
  % \{v \mid t_1 x_1^2 + t_2 x_2^2 + t_3 x_3^2 < r\},
  % $$
%where $t_1,t_2,t_3,r>0$.
\indy{Index}{solid triangle}
\indy{Index}{tetrahedron}
\indy{Index}{wedge}
\indy{Index}{frustum}
\indy{Index}{conic cap}
\indy{Index}{rectangle}
\indy{Index}{ball}
%\indy{Index}{ellipsoid}
\tlabel{enum:volume-prim}
\end{enumerate}
One could find a smaller set of primitives.  In particular, the
rectangle and wedge of a ball can be obtained from the others.  But
this would only make the definition more difficult to apply.

\end{definition}

\subsection{primitive volume calculation}\label{sec:primitive}

\begin{lemma}\guid{PAZNHPZ}\tlabel{lemma:prim-volume} 
\begin{enumerate} 
 \item \rating{250} Let $v_1,v_2,v_3$ be unit vectors.
   A solid triangle $\op{ST}(v_0,\{v_1,v_2,v_3\},r)$ is measurable and has volume
   $$
   (\alpha_{123}+\alpha_{231}+\alpha_{312}-\pi)r^3/3,
   $$
   where $\alpha_{ijk} = \dih_V(\{v_0,v_i\},\{v_j,v_k\})$.
  \item \rating{250} The conic cap $\op{SC}(v_0,v_1,r,a)$ is measurable and has volume:
   $$
    2\pi(1-a) r^3/3,
   $$
 \item \rating{250} A frustum $\op{FR}(v_0,v_1,h,a)$ (with $h'=0$) 
is measurable and has volume:
   $$
   \pi (t^2-h^2) h/3,\quad h = t a, 
   $$
 \item\rating{250} A tetrahedron $\op{conv}^0\{v_1,v_2,v_3,v_4\}$ is measurable and has volume:
   $$
   \sqrt{\Delta(x_{12},x_{13},x_{14},x_{34},x_{24},x_{23})}/12,
   $$
   where $x_{ij} = \norm{v_i}{v_j}^2$.
\item\rating{100} A rectangle $\op{rect}(a,b)$ is measurable and
has volume $0$ unless $a_i<b_i$ for all $i$.  In this case, the
volume is
$$(b_3-a_3)(b_2-a_2)(b_1-a_1).$$
 \item\rating{250} The intersection of a ball $B(v_0,r)$ with a wedge
 $W(v_0,v_1,v_2,v_3)$ is measurable.  The volume of the intersection
is 
   $$
   2 \theta r^3/3,\text{ for } r \ge 0,
   $$
where $\theta = \op{azim}(v_0,v_1,v_2,v_3)$.

\end{enumerate}
\end{lemma}

Euler's formula (Lemma~\ref{lemma:euler}) gives an
equivalent expression for $(\alpha_{123}+\alpha_{231}+\alpha_{312}-\pi)$.
Euler's formula will often be used instead of this formula.
\indy{Index}{Euler's formula}

\begin{proof}
The formula for the volume of a solid triangle is $r^3/3$ times
its solid angle.  The formula 
   $$\alpha_{123}+\alpha_{231}+\alpha_{312}-\pi$$
for the area of a spherical triangle is classical.    
The conic cap volume is
$r^3/3$ times its solid angle.  
The volume of a right-circular cone is $1/3$ its base times height.
The volume of a tetrahedron is
   $$|\det(v_2-v_1,v_3-v_1,v_4-v_1)|/6.$$
By Tarski arithmetic, %tarski: {cayley-menger-pos} 
the square of this determinant is given by a polynomial
$\op{CM}_4(x_{ij})$ in the squares of the edge-lengths. This is
$\Delta/4$, with $\Delta\ge0$.  The result follows.
\end{proof}
\indy{Notation}{CM@$\op{CM}_4$ (square of edge lengths)}



\subsection{wedge}\label{sec:wedge}
\indy{Index}{wedge}

When the region is realized by revolution along an axis $\op{aff}\{v_0,v_1\}$, 
one can also give the volume of the intersection of the region
with a wedge $W=W(v_0,v_1,v_2,v_3)$.  These intersections are measurable
by the last statement of Lemma~\ref{lemma:prim-volume} (with $r$ sufficiently
large).
  In the following
let $\theta = \azim(v_0,v_1,v_2,v_3)$.
\indy{Notation}{aff@$\op(aff)$}
\indy{Notation}{ZZtheta@$\theta$ (azim)}

\begin{lemma}\guid{DFNVMFM}\tlabel{lemma:wedge-vol}  Let $C$ be $\op{SC}(v_0,v_1,r,a)$, $B(v_0,r)$, or
   $\op{FR}(v_0,v_1,h,a)$.  Let $m$ be the volume of $C$.  
   Then $C\cap W$ has volume $m\,\theta/(2\pi)$.   
\end{lemma}
\indy{Notation}{C@$C$ (wedge)}

\begin{lemma}\guid{FMSWMVO}\tlabel{lemma:wedge-sol}  Let $C$ be either $\op{SC}(v_0,v_1,r,a)$, $B(v_0,r)$, or
   $\op{FR}(v_0,v_1,h,a)$.  Then $C$ and $C\cap W$ are eventually 
radial at $v_0$. Furthermore,
    $C\cap W$ solid angle 
  $s\,\theta/(2\pi)$, where $s$ is the solid angle of $C$.
\end{lemma}


\begin{proof}
These are elementary integrals.
\end{proof}


\subsection{primitive solid angle}

All of the primitive sets are eventually radial at the natural
base point $v_0$, and have a
solid angle.  By Lemma~\ref{lemma:wedge-sol}, it is enough to compute
the solid angle before intersecting with a wedge.
\indy{Notation}{v0@$v_0$ (base point)}

\begin{lemma}\guid{FUPXNLC} \tlabel{lemma:prim-sol}
\begin{enumerate}
    \item  $\op{ST}(v_0,\{v_1,v_2,v_3\})$ is eventually radial at $v_0$
     with solid angle 
     $$
     (\alpha_{123}+\alpha_{231}+\alpha_{312}-\pi),\quad
     \alpha_{ijk}=\dih_V(\{v_0,v_i\},\{v_j,v_k\}).
     $$
    \item $\op{conv}^0\{v_0,v_1,v_2,v_3\}$ is eventually radial at $v_0$
      with solid angle
           $$
     (\alpha_{123}+\alpha_{231}+\alpha_{312}-\pi),\quad
     \alpha_{ijk}=\dih_V(\{v_0,v_i\},\{v_j,v_k\}).
     $$
    \item $\op{SC}(v_0,v_1,r,a)$ is eventually radial at $v_0$ with solid
      angle 
      $2\pi(1-a)$.
    \item $\op{FR}(v_0,v_1,h,a)$ is eventually radial at $v_0$ with solid
      angle
        $$
        2\pi (1-a).
        $$
\indy{Index}{eventually radial}
\end{enumerate}
\end{lemma}
\indy{Notation}{conv0@$\op{conv^0}$}
\indy{Notation}{SC@$\op{SC}$}
\indy{Notation}{FR@$\op{FR}$}
\indy{Notation}{ZZalpha@$\alpha$ (angle)}
\indy{Notation}{dih@$\dih$}

\begin{proof} In every case, the intersection of 
  the region with $B(v_0,r')$, for $r'>0$ sufficiently small, is
  a conic cap or a solid triangle.  These two volumes have
  already been calculated.  This gives the results as stated.
\end{proof}


\section{Scissor and Volume}
\tlabel{sec:measure-second}

There are many other volumes that can be computed from the
primitive ones enumerated in Definition~\ref{enum:volume-prim}.

\subsection{lune}  
\indy{Index}{lune}

Consider the simple example of a derived volume given by a
lune $A=\op{aff}_+^0(\{v_0,v_1\},\{v_2,v_3\})$.  It is eventually
radial at $v_0$ and has a solid angle.
\indy{Notation}{A@$A$ (lune)}

\begin{lemma}\guid{WFFVGVF}  $\sol(v_0,A) = 2\dih_V(\{v_0,v_1\},\{v_2,v_3\})$.
\end{lemma}

\begin{proof}
Let $B_{\pm} = \op{aff}_\pm(\{v_0,v_2,v_3\},v_1)$.  $B_- \cap B_+$
is a null set.  The intersections $A\cap B_{\pm}\cap B(v_0,r)$ 
are solid triangles.  This gives the solid angle of $A$ as
follows:
   $$\begin{array}{lll}
   \sol(v_0,A) &= \sol(v_0,A\cap B_+)+\sol(v_0,A\cap B_-) \\
   &= 
   \sol(\op{ST}(v_0,\{v_1,v_2,v_3\})) + \sol(\op{ST}(v_0,\{v_1',v_2,v_3\})) \\
   &=
   2\dih_V(\{v_0,v_1\},\{v_2,v_3\}).
   \end{array}
   $$
Here,  $v_1'= 2 v_0 - v_1$, the reflection of $v_1$
through $v_0$.  The usual calculation of the volume of a solid triangle
inverts this proof, 
and derives the volume from the solid angle of a lune.
\end{proof}



\begin{lemma}\guid{CZOQFNL}\tlabel{lemma:wedge:sol} 
Assume that the sets $\{v_0,v_1,w_1\}$ and
$\{v_0,v_1,w_2\}$ are not collinear. 
$$\sol(v_0,W(v_0,v_1,w_1,w_2)) = 2\op{azim}(v_0,v_1,w_1,w_2).$$
\indy{Index}{collinear}
\end{lemma}    

\begin{proof} Every wedge is a union of two lunes, up to a null set.
\end{proof}

\begin{lemma}\guid{OXQZBJG}  
   $$
   \begin{array}{lll}
    \op{sol}(v_0,B(v_0,t)) &= 4\pi\\
    \op{vol}(v_0,B(v_0,t)) &= 4\pi t^3/3\\
    \op{sovo}(v_0,B(v_0,t),\lambda) &= 4 \pi \phi(t,t,\lambda).
   \end{array}
   $$
\end{lemma}

\begin{proof}
The ball is $t$-radial at $v_0$, so the volume is given by
Definition~\ref{def:sol} in terms of solid angle.  It is enough
to check that a hemisphere has solid angle $2\pi$.  This follows
from Lemma~\ref{lemma:wedge:sol}.
\end{proof}  




\subsection{Rogers simplex}
\indy{Index}{Rogers simplex}

\begin{definition}[orthosimplex, orth] \tlabel{def:ortho}
An {\it orthosimplex} is a tetrahedron
    $$\op{conv}^0(p,p+v_1,p+v_1+v_2,p+v_1+v_2+v_3),$$
where $v_i\cdot v_j=0$, for $1\le i<j\le 3$.   Write
$\op{orth}^0(p,v_1,v_2,v_3)$ for this orthosimplex.
 \indy{Index}{orthosimplex}
\indy{Notation}{orthosimplex@$\op{orth}^0$}
\end{definition}

\begin{figure}[htb]
  \centering
  %\myincludegraphics{\ps/rogers.eps}
  \caption{The Rogers simplex is an orthosimplex.}
  \tlabel{fig:rogers}
\end{figure}


\begin{definition}[Rogers simplex, rog] \tlabel{def:rog}
Let $\{v_0,v_1,v_2,v_3\}$ be a set of four points in $\ring{R}^3$.
Assume that they are not coplanar.  Let $p$ be the circumcenter
of $\{v_0,v_1,v_2\}$ and $r$ its circumradius (see Definition~\ref{def:etaV}).  Let $c\ge r$.
By Tarski arithmetic, %tarski: {rog-exist}, 
there exists a unique point $p'$ in $A=\op{aff}_+(\{v_0,v_1,v_2\},v_3)$ at equal distance $c$
from $v_0,v_1,v_2$.
\indy{Notation}{p@$p$ (circumcenter)}
Let 
$$
    \op{rog}^0(v_0,v_1,v_2,v_3,c) = 
    \op{orth}^0(v_0,w_1,w_2,w_3),
$$
$$
     w_1=(v_0+v_1)/2,\quad w_1+w_2=p,\quad w_1+w_2+w_3=p'.
$$
(Define $\op{rog}(v_0,\ldots,v_3,c)$ similarly, with
$\op{conv}$ instead of $\op{conv}^0$.)
Take $\op{rog}^0$ to be the empty set, if $c< r$.
 \indy{Index}{Rogers simplex}
\indy{Notation}{rogers simplex@$\op{rog}^0$}
\indy{Notation}{rogers simplex1@$\op{rog}$}
\end{definition}

\begin{lemma}\guid{XQBOVQF} The vectors $w_1,w_2,w_3$ of Definition~\ref{def:ortho}
are indeed mutually orthogonal.
\indy{Index}{orthogonality!mutual}
\end{lemma}

\begin{proof} The orthogonality of $w_1$ and $w_2$ is 
Tarski arithmetic. %tarski: {eta-ortho}.  
The orthogonality of $w_3$ with the others is also Tarski arithmetic. %tarski: {rog-ortho}.
\end{proof}

\begin{definition}[circumradius, $\eta$]\label{def:etaV}
Let $\eta(x,y,z)$ be the circumradius of a triangle with sides
$x,y,z$, and let $\eta_V(v_0,v_1,v_2) = \eta(\norm{v_0}{v_1},\norm{v_0}{v_2},\norm{v_1}{v_2})$.
\indy{Index}{circumradius}
\indy{Notation}{ZZeta@$\eta$(circumradius)}
\indy{Notation}{ZZetav@$\eta_v$}
\end{definition}

\begin{definition}[$abc$ parameter]\tlabel{def:abc}
Associate with $\op{rog}^0(v_0,v_1,v_2,v_3,c)$ the constants
$a=\norm{v_1}{v_0}/2$, $b=\eta_V(v_0,v_1,v_2)$, and $c$.
Call these the $abc$ parameters of $\op{rog}^0$.
\indy{Index}{abc parameter} 
\indy{Notation}{a@$a$ (constant)}
\indy{Notation}{b@$b$ (constant)}
\indy{Notation}{c@$c$ (constant)}
\end{definition}

The Rogers simplex is a tetrahedron.  Hence it is one of our
primitive regions.  It is eventually radial at $v_0$, hence
it has a solid angle at $v_0$.  The dihedral
angle, mentioned without further context, is understood to refer to 
   $$
   \dih_V(\{v_0,v_1\},\{v_2,p'\})=\dih_V(\{v_0,(v_0+v_1)/2\},\{p,p'\}),
   $$
\indy{Notation}{dih@$\dih_V$}
where $p$ and $p'$ are the points 
constructed in Definition~\ref{def:rog}.

The squares of the edge lengths of the tetrahedron are
   $$
   (a^2,b^2,c^2,c^2-b^2,c^2-a^2,b^2-a^2).
   $$
Define the functions
   $$
   \begin{array}{lll}
     \op{volR}(a,b,c) &= \begin{cases}
       a\sqrt{(b^2-a^2)(c^2-b^2)}/6& 0 < a < b < c,\\
       0,&\text{otherwise}
       \end{cases}\\
     \op{solR}(a,b,c) &= \begin{cases}
      2 \atn\left(\sqrt{{(a+b)(b+c)}},
         \sqrt{{(b-a) (c-b)}}\right).& 0 < a < b < c,\\
      0,&\text{otherwise}
     \end{cases}\\
     \op{dihR}(a,b,c) &= \begin{cases}
      \atn\left(\sqrt{b^2 - a^2},\sqrt{c^2 - b^2}\right)
      & 0 < a < b < c,\\
      0,&\text{otherwise}
     \end{cases}
     \end{array}
   $$
\indy{Notation}{volR@$\op{volR}$ (function)}
\indy{Notation}{solR@$\op{solR}$ (function)}
\indy{Notation}{dihR@$\op{dihR}$ (function)}
Specialization of the formulas for dihedral angle, volume, and solid angle to this
setting gives following expressions for volume and solid angle.
(The calculation of the
 solid angle formula is based on Euler's formula in 
Lemma~\ref{lemma:euler}.)

\begin{lemma}\guid{JJFHOIW}\label{lemma:rog:abc} 
Let $R=\op{rog}^0(v_0,v_1,v_2,v_3,c)$ and let $a$, $b$,
$c$ be the $abc$-parameters of $R$.  Let $\op{dih}(R)$ be the dihedral
angle of $R$ along the edge extending along $\op{aff}\{v_0,v_1\}$.  Then
$$
\begin{array}{lll}
\op{vol}(R) &= \op{volR}(a,b,c)\\
\op{sol}(v_0,R) &= \op{solR}(a,b,c)\\
\op{dih}(R) &= \op{dihR}(a,b,c)\\
\end{array}
$$
\end{lemma}
\indy{Notation}{a@$a$ (constant)}
\indy{Notation}{b@$b$ (constant)}
\indy{Notation}{c@$c$ (constant)}
\indy{Notation}{R@$R$}

\section{Finiteness and Volume}

Previous sections have developed all of the volume calculations that will
be needed in this book.  This chapter concludes with some 
elementary estimates based on the volumes of  cubes and balls.

\begin{lemma}\guid{WQZISRI}
\oldrating{100}
\formalauthor{Nguyen Tat Thang}
\rating{0}
\tlabel{lemma:Zcount}
    For all $p\in\ring{R}^3$ and all $r\ge 0$, the set
    $\ring{Z}^3\cap B(p,r)$ is finite of cardinality at most
    $4\pi (r+\sqrt3)^3/3$.
\indy{Index}{finite cardinality}
\end{lemma}

\begin{proof}  If $v\in\ring{Z}^3\cap B(p,r)$, then the ith
coordinate $v_i$ of $v$ must lie in the finite range
    $$
    p_i - r \le v_i \le p_i + r.
    $$
Hence there are only finitely many possibilities for $v$.


Place an open unit cube at each point of $\ring{Z}^3\cap B(p,r)$.
The cubes are measurable, disjoint, and contained in
$B(p,r+\sqrt3)$.  Thus, the combined volume of the cubes, which is
$\card(\ring{Z}^3\cap B(p,r))$,  is no greater than the volume of the
containing ball.  The result follows.
\end{proof}

\begin{lemma}\guid{PWVIIOL}
\oldrating{100}
\formalauthor{Nguyen Tat Thang}
\rating{0}
\tlabel{lemma:Zlow-count}
  For all $p\in\ring{R}^3$ and all $r\ge\sqrt3$, the set
    $\ring{Z}^3\cap B(p,r)$ is finite of cardinality at least
    $4\pi (r-\sqrt3)^3/3$.
\end{lemma}

\begin{proof}  Lemma~\ref{lemma:Zcount} establishes finiteness.  Place a closed unit cube at each point
of $\ring{Z}^3\cap B(p,r)$.  The cubes are measurable and cover
$B(p,r-\sqrt3)$.  Thus, the combined volume of the cubes is at
least the volume of the covered ball.  The result follows.
\end{proof}

\begin{lemma}\guid{TXIWYHI}
\oldrating{50}
\rating{0}
\formalauthor{Nguyen Tat Thang}
\tlabel{lemma:Zr2}
For all $p\in\ring{R}^3$, and $r_0,r_1>0$, there exists a $C$ such
that for all $r\ge r_1$, 
    $$
    \ring{Z}^3 \cap (B(p,r+r_0) \setminus B(p,r-r_1)) \le C r^2.
    $$
\end{lemma}

\begin{proof}  When $r \ge r_1+\sqrt3$, the previous two lemmas show
that the cardinality is at most $4\pi/3$ times
    $$(r +r_0 + \sqrt3)^3 - (r - r_1 - \sqrt3)^3 \le C' r^2$$
for some $C'$.  Similarly, if $r_1\le r\le r_1+\sqrt3$, the
cardinality is at most some fixed constant $C''$.  The result
easily follows.
\end{proof}

