% Flyspeck
% Thomas C. Hales
% Starting with Chapter on Tame Hypermaps




\label{sec:tame}


This chapter defines a class of hypermaps.  Hypermaps in this class
are said to be {\it tame}.  In the next chapter, we give a complete
classification of all tame hypermaps.  This classification of tame
hypermaps was carried out by computer.   This classification solves a
major step of the sphere packing problem.\FIXX{Unresolved chapter issues: \begin{itemize}\item $A$ vs. $v$ for nodes
\item $\sigma'$ for aggregates $\sigma''$ for full hypermap.
\item Allow the pentagon-triangle into the definition of tame graph.
    Show there is at most one.  Let it be the seed.
\end{itemize}}

\section{Definition and Classification}


\begin{definition}[triangle,~quadrilateral,~exceptional]
Faces of cardinality $3$ are called {\it triangles}, those of
cardinality $4$ are called {\it quadrilaterals}, and so forth. Let
$p_v$ be the number of triangles incident with a node $v$. A face of
cardinality at least $5$ is called an {\it exceptional\/} face.
 %
 \index{Index}{triangle}
 \index{Index}{exceptional}
 \index{Index}{quadrilateral}
 \index{Index}{exceptional!face}
 \index{Index}{pZ@$p_v$}
\end{definition}

\begin{definition}[type,~$(p,q,r)$]\label{definition:type}
The {\it type\/} of a node is defined to be a triple of
non-negative integers $(p,q,r)$, where $p$ is the number of
triangles containing the node, $q$ is the number of quadrilaterals
containing it, and $r$ is the number of exceptional faces.
%
 \index{Index}{type (of a node)}
\end{definition}


\subsection{weight assignment}\label{sec:wtassign}

We call the constant $\op{tgt}=14.8$, which arises repeatedly in
this section, the {\it target}.  (This constant arises as an
approximation to $4\pi\zeta -8\approx 14.7947$, where $\zeta =
1/(2\arctan(5,\sqrt{2})$.)
%
 \index{Index}{target}\index{Index}{tgt@$\op{tgt}=14.8$}
 \index{Greek}{ZZdzeta@$\zeta= 1/(2\arctan(5,\sqrt{2}))$}

\begin{definition}[a]
  Define $a:\ring{N}\to \ring{R}$ by
  $$a(n) = \begin{cases}
    14.8 &n=0,1,2,\\
    1.4 & n=3,\\
    1.5 & n=4,\\
    0 & \text{otherwise.}
  \end{cases}
  $$
\end{definition}

\begin{definition}[b]
  Define $b:\ring{N}\times \ring{N}\to \ring{R}$ by $b(p,q)=14.8$,
  except for the values in the following table
  (with  $\op{tgt}=14.8$):
  {
  \def\tx{\op{tgt}}
  $$\begin{matrix}  &q=0&1&2&3&4\\
           p=0&\tx&\tx&\tx&7.135&10.649\\
           1&\tx&\tx&6.95&7.135&\tx\\
           2&\tx&8.5&4.756&12.981&\tx\\
           3&\tx&3.642&8.334&\tx&\tx\\
           4&4.139&3.781&\tx&\tx&\tx\\
           5&0.55&11.22&\tx&\tx&\tx\\
           6&6.339&\tx&\tx&\tx&\tx
   \end{matrix}
   $$
   }
\end{definition}

\begin{definition}[c]
  Define $c:\ring{N}\to \ring{R}$ by
  $$c(n) = \begin{cases}
    1 & n=3,\\
    0 & n=4,\\
    -1.03 &n=5,\\
    -2.06 &n=6,\\
    -3.03 &\text{otherwise.}
    \end{cases}
    $$
\end{definition}

\begin{definition}[d]
    Define $d:\ring{N}\to \ring{R}$ by
  $$d(n) = \begin{cases}
    0 & n=3, \\
    2.378 & n=4, \\
    4.896 & n=5, \\
    7.414 & n=6, \\
    9.932 & n=7, \\
    10.916 & n=8,\\
    \op{tgt}=14.8 & \text{otherwise}.
  \end{cases}
  $$
\end{definition}

\begin{definition}[separated]
A set $V$ of nodes in a hypermap is called a {\it separated\/} set
of nodes if the following four conditions hold.
%
 \index{Index}{separated set}
    \begin{enumerate}
      \item Every node in $V$ is incident with an exceptional face.
      \item No two
        nodes in $V$ are adjacent.  (That is, no edge is incident
        with two different nodes in $V$.)
      \item No quadrilateral in $V$ is incident with two different nodes
        in $V$.
      \item Each node in $V$ has cardinality 5.
    \end{enumerate}
\end{definition}

We write $\card(S)$ for the cardinality of a finite set $S$.\index{Index}{card}
\index{Index}{cardinality}


\begin{definition}[weight~assignment]
%
A {\it weight assignment\/} of a hypermap $H$ is a function $w$ on
the set of faces of $H$, taking values in the set of non-negative
real numbers. A weight assignment is {\it admissible} if the
following properties hold:
%
 \index{Index}{weight assignment}
 \index{Index}{admissible (weight assignment)}
\begin{enumerate}
  \item If the face $F$ has cardinality $n$, then
        $w(F) \ge d(n)$
  \item If a node $v$ has type $(p,q,0)$, then
        $$\sum_{F:\,v\cap F\ne\emptyset} w(F) \ge b(p,q).$$
        \label{admissible:b}
  \item Let $V$ be any set of nodes of type $(5,0,0)$, and let $A =\bigcup V$ be
        the set of darts in these nodes.
        If the cardinality of $V$ is $k\le 4$, then
        then
        $$\sum_{F:\,F\cap A\ne\emptyset} w(F) \ge 0.55 k.$$
  \item Let $V$ be any separated set of nodes, and let $A =\bigcup V$ be
        the set of darts in these nodes.
        Then
        $$\sum_{F:\,F\cap A\ne\emptyset} (w(F) -d(\card(F)))
            \ge \sum_{v\in V} a(p_v).$$
        \label{definition:admissible:excess}
\end{enumerate}
The sum $\sum_F w(F)$ is called the {\it total weight} of $w$.
\index{Index}{total weight}
\end{definition}





\subsection{hypermap property}
\label{sec:graphproperty}

We say that a hypermap is {\it tame\/} if it satisfies the following
conditions.
%
 \index{Index}{tame}

\begin{enumerate}
    \label{definition:tame}
    %1
    \item The hypermap is plain, planar, and connected.
    \item The edge map $e$ has no fixed points.
    \item The two darts of each edge lie in different nodes.
    \item The set of edges meeting any two given nodes has cardinality at most $1$.
    \item There are at least $2$ faces.
    \item Every face meets every node in at most one
        dart.
    \item There are never two nodes of type $(4,0,0)$ that are
    adjacent to each other.
    \label{definition:tame:40}
    \item The cardinality of each face is at least $3$ and at most $8$.
    \label{definition:tame:length}

    \item If $L$ is a contour loop with $3$ face steps, and if there exists a node in
    the exterior of $L$, then $L$ is a face of the hypermap.
    \label{definition:tame:3-circuit}

    \item If $L$ is a contour loop  $4$ face steps, and there are at least two nodes
    in the exterior of $L$, then the interior of $L$ takes one of the forms
    illustrated in Figure
    \ref{fig:fourcircuit}.\FIXX{Make this more precise.}
    \label{definition:tame:4-circuit}
    \begin{figure}[htb]
        \centering
        \myincludegraphics{\ps/tame4circuit.eps}
        \caption{Tame $4$-circuits}
        \label{fig:fourcircuit}
    \end{figure}

    \item The cardinality of every node is at least $2$ and at most
    $6$.
    \label{definition:tame:degree}

    \item If a node is incident with an exceptional face,
        then the cardinality of the node is at most $5$.
    \label{definition:tame:degreeE}

    \item $$\sum_F c(\card(F)) \ge 8,$$
    \label{definition:tame:score}


    \item There exists an admissible weight assignment
        of total weight less than the target, $\op{tgt}=14.8$.
    \label{definition:tame:squander}



\end{enumerate}
%
Property \ref{definition:tame:score} implies that the hypermap has
at least eight triangles.


\subsection{tame hypermap classification}
    \label{sec:proof-classification}

%\section{Statement of the Theorem}
\label{sec:classification}

A list of several thousand hypermaps appears at \cite{web}. The
following theorem is listed as one of the central claims in the
proof in Section~\ref{sec:logic}.

\begin{definition}[opposite] The opposite of a hypermap $(D,e,n,f)$ is the
hypermap $(D,f n,n^{-1},f^{-1})$.
\end{definition}

\begin{lemma} If a hypermap has properties\FIXX{Give reference}, 
then so does its opposite.
\end{lemma}

\begin{theorem}
\label{theorem:classification} Every tame hypermap is isomorphic to
a hypermap in this list, or is isomorphic to the opposite of a
hypermap in this list.
\end{theorem}

The results of this section are not needed except in the proof of
Theorem \ref{theorem:classification}.

\smallskip

Computers are used to generate a list of all hypermaps and to check
them against the archive of tame hypermaps.  The computer program is
based on the face-insertion construction of Lemma~\ref{XX}.  There it is
proved that all sufficiently nice hypermaps can be generated by an
elementary face-insertion process.  Tame hypermaps satisfy all the
hypotheses of that lemma.





\section{Contravention is Tame}
    \label{sec:contraproof}

Let $(\Lambda,v_0)$ be a centered packing with
aggregated fan $P=(v_0,V,E)$.  Let  hypermap $H=(D,e,n,f)$
be the planar hypermap attached to $P$.
The hypermap $H$ is connected (Lemma~\ref{XX}).  Each of its
faces is simple (Lemma~\ref{XX}).

The connected components of $Y(v_0,V,E)$ are in bijection with
faces of $H$.  
The fan gives a azimuth angle function
$$
\op{azim} : D \to (0,2\pi).
$$
For each face of $H$, the corresponding component $R$
is eventually radial with solid
angle
  $$
  2\pi + \sum_{x\in F} (\op{azim}(x) -\pi).
  $$
We write $\sol(F)$ for the solid angle of the connected component
of $Y(v_0,V,E)$ associated with a face $F$ of the hypermap.
We have
    $$\sum_{F} \sol(F) = 4\pi.$$


For each face, there is a
real number $\tau(\Lambda,v_0,F)$ such that
$$
  \sum_{F : \text{face}}\tau(\Lambda,v_0,F) = \tau(\Lambda,v_0).
$$
We define a weight function $w(F)$ on the faces of the hypermap
by $w(F) = \sigma(\Lambda,v_0,F)/pt$.  In this way, we attach
a pair $(H,w)$ to each contravening centered packing $(\Lambda,v_0)$.


Let $D_f\subset D$ be the set of darts 
   $x = (v_0,v,u,w)$
such that the face of $x$ is exceptional and $|u-w|<\sqrt8$.
In this case, $\{v_0,v,u,w\}$ are the vertices of a flat quarter,
which is not necessarily in the $Q$-system.

\begin{theorem} \label{theorem:contravene}
Let $(\Lambda,v_0)$ be a contravening centered packing.  Let $(H,w)$ be
the hypermap and function on its faces attached to $(\Lambda,v_0)$ as above.
Then $H$ is a tame hypermap with admissible weight function $w$.
\end{theorem}




\subsection{hypermap property}
    \label{sec:startame}


Recall that we say that a node $v$ has {\it type\/} $(p,q,r)$ if
there are exactly $p+q+r$ faces that meet the node, of which exactly
$p$ triangles and $q$ quadrilateral faces (see
Definition~\ref{definition:type}).  We write $(p_v,q_v,r_v)$ for the
type of a node $v$.

\begin{lemma} The hypermap $H$ satisfies Conditions~\ref{XX}-\ref{XX} 
of tameness.
Explicitly, it is a plain, planar, and connected. The edge map $e$
has no fixed points. There are at least two faces. Every face meets
every node in at most one dart.  There are never two nodes of type
$(4,0,0)$ that are adjacent to each other.  Every face has
cardinality at least $3$ and at most $8$.  If $L$ is a contour loop
with $3$ face steps, and if there exists a node in the exterior of
$L$, then $L$ is a face of the hypermap.
\end{lemma}


\begin{lemma}\dcg{Lemma~21.4}{223} 
Formally contravening hypermaps satisfy Property
\ref{definition:tame:degree} of tameness: The cardinality of every
node is at least $2$ and at most $6$.
\end{lemma}

\begin{proof}  There is no node of cardinality one by
Lemma~\ref{lemma:nondegen}.  There is no node of degree
greater than $6$ by Lemma~\ref{a:6}.
\end{proof}


\subsection{contravening hypermap}


\begin{lemma} \label{lemma:0.55:bis} %proclaim{Lemma 5.3}
Let $(H,\azim,\flat,\sigma)$ be a formally contravening hypermap.
Let $v_1,\ldots, v_k$, for some $k\le 4$, be distinct nodes of type
$(5,0,0)$.  Let $F_1,\ldots, F_r$ be all the triangles around the
nodes $v_i$, for $i\le k$. Then
    $$
    \sum_{i=1}^r \tau(F_i)> 0.55k\,\pt,
    $$
and
    $$\sum_{i=1}^r \sigma(F_i) < r\,\pt - 0.48k\,\pt.$$
\end{lemma}


\begin{lemma}\label{lemma:no-2}
Let $(H,\azim,\flat,\sigma)$ be a formally contravening hypermap.
Suppose that $L$ is a contour loop with at most four face steps.
Suppose that there are at least two nodes in the exterior of $L$.
Then there at most one node interior to $L$.
\end{lemma}


\begin{lemma} \label{lemma:0.8638}
Let $(H,\azim,\flat,\sigma)$ be a formally contravening
hypermap. For every dart $x$,
    $$0.8638\le \azim(x).$$
For every dart $x$ whose face is not a triangle, we have
    $$1.153\le\azim(x).$$
\end{lemma}
 %
 \index{Symbol}{ZZZZ1.153@$1.153$}
 \index{Symbol}{ZZZZ0.8638@$0.8638$}

\begin{lemma} \label{lemma:excess-1:bis}
Let $(H,\azim,\flat,\sigma)$ be a formally contravening hypermap.
Let $F$ be an exceptional face.  Let $V$ be a set of nodes of $F$.
Let $x(F,v)$ be the dart of $F$ at a node $v$.  Let $(p_v,q_v,r_v)$
be the type of $v\in V$.   Let $a:\ring{N}\to\ring{R}$ be the
function of Section~\ref{XX}. Assume that $V$ has the following
properties:
    \begin{enumerate}
        \item The set $V$ is separated.
        \item If $v\in V$, then there are exactly five faces at
        $v$.
        \item If $v\in V$, then $\flat(x(F,v))$.
        \item If $v\in V$, then $p_v\ge 3$.  That is, at least
        three of the five faces at $v$ are triangles.
        \item If there are two exceptional components $F$ and $F'$ at
        $v$, then
            $$\azim(x(F,v)) > 1.32 \Rightarrow \azim(x(F',v)) > 1.32.$$
        \item If $(p_v,q_v,r_v)=(3,1,0)$, then $\azim(x(F,v))\le 1.32$.
    \end{enumerate}
Let $A$ be the union of the singleton $\{F\}$, the set of all
triangles with a dart in some $v\in V$, and the set of all
quadrilaterals with a dart in some $v\in V$. Then
    $$\sum_{F\in A}\tau(F) > \sum_{v\in V} (p_v d(3) + q_v d(4) + a
    (p_v))\,\pt.$$
\end{lemma}


\begin{lemma}\label{lemma:nobad4}
Let $(H,\azim,\flat,\sigma)$ be a formally contravening hypermap.
Let $v$ be a node of type $(1,0,1)$ with precisely one triangle and
one pentagon, as show in Figure~\ref{fig:no4circuit}. Let $L$ be
the perimeter contour loop with four face steps having the node $v$
in its interior.  At each of the four nodes $w$ visited by $L$, let
$\azim(w)$ be the sum of the terms $\azim(x)$, with the sum running
over the darts $x$ at the node visited by $L$.  Then
    $\azim(w) > 1.32$
for each of the four nodes $w$ visited by $L$.
\end{lemma}

\begin{lemma} Let $(H,\azim,\flat,\sigma)$ be a formally contravening
hypermap.  Let $v$ be a node of $H$ of type $(1,0,1)$, such that the
exceptional component is a pentagon.  Let $W$ be the set of four nodes
of the pentagon other than $v$.  If there are four triangles
$F_1,\ldots,F_4$ at some node $W$ that do not meet $v$, then
    $$\sum_{i=1}^p \tau(F_i) > a(4)\,\pt.$$
\end{lemma}

\begin{lemma}
Let $(H,\azim,\flat,\sigma)$ be a formally contravening hypermap.
Let $X$ be the set of nodes $v$ with the following properties.
    \begin{enumerate}
    \item The node has type $(5,0,1)$.
    \item The exceptional face at the node is pentagonal.
    \item That pentagonal face has no nodes of type $(1,0,1)$.
    \end{enumerate}
Then $\card(X)\ne 1$.
\end{lemma}


\begin{lemma}  Let $(H,\azim,\flat,\sigma)$ be a formally contravening
hypermap. Assume that $v$ is a node of $H$ whose type is
$(p,q,r)=(3,0,2)$ or $(4,0,1)$.  Assume that $\neg\flat(x)$ for
every dart of $v$.  Let $\tau(F_1),\ldots,\tau(F_p)$ be the
triangles at the node $v$.  Then
    $$
    \sum_{i=1}^p \tau(F_i) > a(p)\,\pt.
    $$
\end{lemma}




\subsection{linear program} %subsection
\label{sec:2.2}  To continue with the proof that formally
contravening hypermaps are tame, we need to introduce some more
notation and methods.

\begin{lemma} \label{lemma:deg5}
Every formally contravening hypermap satisfies Property
\ref{definition:tame:degreeE} of tameness: If a node meets an
exceptional face, then the cardinality of the node is at most $5$.
\end{lemma}

\begin{proof} Every node of type $(5,0,1)$ meets a face that is a pentagon.
If there are two or more such nodes, then it must be that of Lemma~\ref{XX}.  
However, this has a node of type $(1,0,1)$, which has been
made an aggregate.  Thus, there is at most one node of type $(5,0,1)$.
This arrangement does not appear on a formally contravening hypermap
by Lemma~\ref{lemma:nobad4}.
\end{proof}

\subsection{four-circuit}

Every contour loop partitions the faces into the interior and
exterior.  Every contour loop partitions the nodes that do not meet
the loop into exterior and interior nodes.
%
 \index{Index}{interior node}

Lemma~\ref{lemma:no-2} asserts that either the interior or the
exterior has at most $1$ enclosed vertex.   When choosing which
aggregate is to be called the interior, we may make our choice so
that the interior has area at most $2\pi$, and hence contains at
most $1$ node. With this choice, we have the following lemma.

\begin{lemma}
Let $(H,\azim,\flat,\sigma)$ be a formally contravening hypermap. If
$L$ is a contour loop with $4$ face steps, and there are at least
two nodes in the exterior of $L$, then the interior of $L$ takes one
of the forms illustrated in Figure~\ref{XX} in Property
    \ref{definition:tame:4-circuit} of tameness.
\end{lemma}

\begin{proof}
By Lemma~\ref{XX}, the interior of $L$ contains at most one node.

$H$ is a connected plane planar map.  We form a normal family of
contour loops ${\cal L}$ by taking the contour loop $L^{-1}$
reversing $L$\FIXX{Explain} and all the faces in the interior of $L$.
(Check this is a normal family.)  The quotient $H' = H/{\cal L}$ is
a plane planar map.  There is a further quotient of $H'$ with normal
family $\{L,L^{-1}\}$, which is isomorphic to $P_4$ with the natural
flag coming from $H'$.  The niceness conditions of Lemma~\ref{XX} are
satisfied, so we can recover $H'$ from $P_4$ by a sequence of
face-insertions.  Since the interior of $L$ contains at most one
node, this gives restrictions on the partitions that can be used in
face-insertion.

If there are no enclosed vertices, then the only possibilities are
for it to be a single quadrilateral face or a pair of adjacent
triangles.

Assume there is one enclosed vertex $v$.  If $v$ is connected to $3$
or $4$ nodes of the quadrilateral, then that possibility is listed
as part of the conclusion.

If $v$ is connected to $2$ opposite nodes in the $4$-cycle, then the
node $v$ has type $(0,2,0)$ and the bounds of
Lemma~\ref{lemma:pq} show that the hypermap cannot be formally
contravening.

If $v$ is connected to $2$ adjacent nodes in the $4$-cycle, then we
appeal to Lemma~\ref{lemma:nobad4} to conclude that the hypermap
does not contravene.

If $v$ is connected to $0$ or $1$ nodes, then we appeal to
Lemma~\ref{lemma:enclosed:bis}.  This completes the proof.
\end{proof}

\subsection{weight assignment}
    \label{sec:weight}

The purpose of this section is to prove the existence of a good
admissible weight assignment for formally contravening hypermaps.
This will complete the proof that all formally contravening
hypermaps are tame.

\begin{theorem}  Every formally contravening hypermap has an admissible
weight assignment of total weight less than $\op{tgt}=14.8$.
\end{theorem}

Given a formally contravening hypermap $(H,\azim,\flat,\sigma)$, we
define a weight assignment $w$ by
    $$F \mapsto w(F) = \tau(F)/\pt.$$
Since the hypermap is formally contravening,
    $$
    \begin{array}{lll}
    \sum_F w(F) &= \sum_F \tau(F)/\pt \\
            &= \tau^*(H)/\pt\,\le\,\squander/\pt \\
        &< \op{tgt}=14.8.
    \end{array}
    $$
The challenge of the theorem will be to prove that $w$, when
defined by this formula, is admissible.

\subsection{admissibility}
\label{sec:admissibility}

The next three lemmas establish that this definition of $w(F)$ for
formally contravening hypermaps satisfies the first three defining
properties of an admissible weight assignment.

\begin{lemma}  Let $F$ be a face of cardinality $n$ in a formally contravening hypermap.
Define $w(F)$ as above. Then
        $w(F) \ge d(n)$.
\end{lemma}

\begin{proof} This is Lemma~\ref{XX}. %\ref{proposition:wttau}.
\end{proof}

\begin{lemma} Let $v$ be a node of type $(p,q,0)$ in a
formally contravening hypermap.  Define $w(F)$ as above. Then
        $$\sum_{v\in F} w(F) \ge b(p,q).$$
\end{lemma}


\begin{proof} This is Lemma~\ref{lemma:pq}.
\end{proof}

\begin{lemma} Let $V$ be any set of nodes of type $(5,0,0)$ in a
formally contravening hypermap.  Define $w(F)$ as above.
        If the cardinality of $V$ is $k\le 4$,
        then
        $$\sum_{V\cap F\ne\emptyset} w(F) \ge 0.55 k.$$
\end{lemma}

\begin{proof} This is Lemma~\ref{lemma:0.55:bis}.
\end{proof}

The following theorem establishes the final property that $w(F)$
must satisfy to make it admissible.  {\it Separated sets\/} are
defined in Section~\ref{sec:wtassign}.

\begin{theorem}
        \label{proposition:excess}
        Let $V$ be any separated set of nodes in a formally contravening hypermap.
        Define $w(F)$ as above.
        Then
        $$\sum_{V\cap F\ne\emptyset} (w(F) -d(\card(F)))
            \ge \sum_{v\in V} a(p_v),$$
        where $p_v$ denotes the number of triangles containing
        the node $v$.
\end{theorem}

The proof will occupy the rest of this chapter. Since the cardinality
of each node is five, and there is at least one face that is not a
triangle at the node, the only constants $p_v$ that arise are
    $$p_v \in\{0,\ldots,4\}$$
We will prove that in a formally contravening hypermap that the
Properties (1) and (4) of a separated set are incompatible with
$p_v\le 2$.  This will allows us to assume that
$$p_v\in\{3,4\},$$ for all $v\in V$.  These cases will be treated in
Section~\ref{sec:tri34}.

%\section{Proof that $p_v>2$}
\label{sec:tri2}
%%subsection
%\label{sec:2.4} 
%
%In this subsection $(H,\azim,\flat,\sigma)$ is a formally
%contravening hypermap.  Let $V$ be a separated set of nodes in $H$.
%
%\begin{lemma}  Under these conditions, for every $v\in V$,
%$p_v>1$.
%\end{lemma}
%
%\begin{proof}
%If there are $p$ triangles, $q$ quadrilaterals, and $r$ other
%faces, then
%    $$
%    \begin{array}{lll}
%    \tau^*(H) &\ge\sum_{v\in F}\tau(F)\\
%        &\ge r\, t_5 + \tauLP(p,q,2\pi-r(1.153)).
%    \end{array}
%    $$ If there is a node $w$ that is
%not on any of the faces containing $v$, then the sum of $\tau(F)$
%over the faces containing $w$ yield an additional $0.55\,\pt$ by
%Lemma~\ref{lemma:0.55:bis}. We calculate these constants for each
%$(p,q,r)$ and find that the bound is always greater than
%$\squander$. This implies that $H$ cannot be formally contravening.
%$$\begin{array}{llll}
%    (p,q,r)&\hbox{\it lower bound }&\hbox{\it justification}\\
%    &\\
%    (0,5,0)&22.27\,\pt&\text{Lemma~\ref{lemma:pq}}\\
%    (0,q,r\ge1)& t_5+4 t_4\approx 14.41\,\pt +0.55\,\pt& \\
%    (1,4,0) &17.62\,\pt &\text{Lemma~\ref{lemma:pq}}\\
%    (1,3,1) &t_5 + 12.58\,\pt &(\tauLP)\\
%    (1,2,2) &2t_5 + 7.53\,\pt &(\tauLP)\\
%    (1,q,r\ge3)& 3 t_5 + t_4& \\
%\end{array}
%$$
%\end{proof}
%
%
%\begin{lemma} Under these same conditions, for every $v\in V$,
%$p_v>2$.
%\end{lemma}
%
%\begin{proof}
%Assume that $p_v=2$.  We will show that this implies that $H$ does
%not contravene.  Let $r=r_v$ be the number of exceptional faces at
%$v$. We have $r+p_v\le5$.  We consider various cases, according to
%the value of $r$.
%
%The constants $0.55\,\pt$ and $0.48\,\pt$ used throughout the
%proof come from Lemma~\ref{lemma:0.55:bis}. The constants $t_n$
%comes from Lemma~\ref{thm:the-main-theorem}.
%
%($(p,q,r)=(2,0,3)$): First, assume that there are three exceptional
%faces around node $v$. They must all be pentagons
%($2t_5+t_6>\squander$). The aggregate of the five faces is an
%$m$-gon (some $m\le11$).  If there is a node not on this aggregate,
%use $3t_5+0.55\,\pt>\squander$. So there are at most nine triangles
%away from the aggregate, and the Euler relation gives
%    $$
%    \sigma^*(H) \le 9\,\pt + (3 s_5+2\,\pt) < 8\,\pt.
%    $$
%
%($(p,q,r)=(2,1,2)$): The argument if there is a quad, pentagon, and
%hexagon is the same $(t_4+t_6=2t_5,s_4+s_6=2s_5)$.
%
%Assume next that there are two pentagons and a quadrilateral around
%the node. The contour loop around the two pentagons, quadrilateral,
%and two triangles is has $m$ face steps (some $m\le10$). There must
%be a node exterior to this loop, for otherwise the Euler relation
%gives
%    $$
%    \sigma^*(H) \le 8\,\pt+(2s_5+2\,\pt)<8\,\pt.
%    $$
%
%The azimuth angle of one of the pentagons is at most $1.32$.  For
%otherwise, $\tauLP(2,1,2\pi-2(1.32))+2t_5+0.55\,\pt>\squander$.
%
%Lemma~\ref{lemma:1.47} shows that any pentagon $F$ with an azimuth
%angle less than $1.32$ yields $\tau(F)\ge t_5+ (1.47\,\pt)$. If both
%pentagons have an azimuth angle $<1.32$ the lemma follows easily
%from this calculation:
%    $2(t_5+1.47\,\pt)\,\pt+\tauLP(2,1,2\pi-2(1.153))+0.55\,\pt>\squander$.
%If there is one pentagon with angle $>1.32$, we then have
%    $t_5+(1.47\,\pt)+\tauLP(2,1,2\pi-1.153-1.32)+t_5+0.55\,\pt>\squander$.
%
%
%($(p,q,r)=(2,2,1)$): Assume finally that there is one exceptional
%face at the node. If it is a hexagon (or more), we are done
%$t_6+\tauLP(2,2,2\pi-1.153)>\squander$. Assume it is a pentagon. The
%contour loop around the five faces at the node has $m$ face steps
%(some $m\le9$). If there are no more than $9$ triangles exterior to
%the contour loop, then $\sigma^*(H)$ is at most
%$(9-2(0.48))\,\pt+s_5+\sLP(2,2,2\pi-1.153)<8\,\pt$
%(Lemma~\ref{lemma:0.55:bis}). So by the Euler relation, we may
%assume that there are at least three nodes exterior to the contour
%loop.
%
%If the azimuth angle of the dart on the pentagon is greater than
%$1.32$, we have
%  $$\tau^*(H)\ge\tauLP(2,2,2\pi-1.32) +3(0.55)\,\pt +t_5 > \squander;$$
%and if it is less than $1.32$, we have by Lemma~\ref{lemma:1.47}
%    $$
%    \begin{array}{lll}
%        \tau^*(H)\ge\tauLP(2,2,2\pi-1.153)&+3(0.55)\pt+1.47\,\pt+t_5 \\
%            &> \squander.
%    \end{array}
%    $$
%\end{proof}
%

\subsection{separation} %when p=3,4 %subsection
\label{sec:2.7} \label{sec:tri34}

In this subsection $(H,\azim,\flat,\sigma)$ is a formally
contravening hypermap.  Let $V$ be a separated set of nodes.  We
assume that there are three or four triangles meeting $v$, for every
$v\in V$.

To prove the Inequality \ref{definition:admissible:excess} in the
definition of admissible weight assignments, we will rely on the
following reductions. Define an equivalence relation on exceptional
faces by $F\sim F'$ if $F=F'$ or if there is a sequence
$F=F_0,\ldots, F_r=F'$ of exceptional faces such that consecutive
faces share a node of type $(3,0,2)$. Let ${\cal F}$ be an
equivalence class of faces.\FIXX{Give figure here with lots of exceptionals.}

\begin{lemma} Let $V$ be a separated set of nodes.  For every
equivalence class of exceptional faces $\cal F$, let $V({\cal F})$
be the subset of $V$ whose nodes meet a face in ${\cal F}$. Suppose
that for every equivalence class $\cal F$, the Inequality
\ref{definition:admissible:excess} (in the definition of admissible
weight assignments) holds for $V({\cal F})$. Then the Inequality
holds for $V$.
\end{lemma}

\begin{proof}
By construction, each node in $V$ lies in some $F$, for an
exceptional face.  Moreover, the separating property of $V$ insures
that the triangles and quadrilaterals in the inequality are
associated with a well-defined  ${\cal F}$. Thus, the inequality for
$V$ is a sum of the inequalities for each $V({\cal F})$.
\end{proof}


\begin{lemma}
\label{lemma:split}
 Let $v$ be a node of type $(p,q,r)$ in a separated set $V$.  Suppose that
for some $p'\le p$ and $q'\le q$, we have a lower bound of the form
    $$( p' d(3) + q' d(4) + a(p))\,\pt$$
for what is squandered by $p'$ triangles and $q'$ quadrilaterals at 
a vertex $v$.  Suppose further that the
Inequality~\ref{definition:admissible:excess}  holds for
the separated set $V' = V\setminus \{v\}$. Then the inequality holds
for $V$.
\end{lemma}

\begin{proof}  Let $F_1,\ldots,F_m$, $m={p'+q'}$, be faces corresponding
to the triangles and quadrilaterals in the lemma.  The hypotheses
of the lemma imply that
    $$\sum_{1}^{m} (w(F_i) - d(\card(F_i))) \ge a(p).$$
Clearly, the Inequality for $V$ is the sum of this inequality, the
inequality for $V'$, and $w(F)- d(F)\ge0$.
\end{proof}


\begin{lemma}  Property \ref{definition:admissible:excess}  of
admissibility holds.  That is, let $V$ be any separated set of
nodes. Then
        $$\sum_{F:\,V\cap F\ne\emptyset} (w(F) -d(\card(F)))
            \ge \sum_{v\in V} a(p_v).$$
\end{lemma}

\begin{proof}  Let $V$ be a separated set of nodes.
The results of Section~\ref{sec:tri2} reduce the lemma to the case
where $p_v\in\{3,4\}$ for every node $v\in V$.


One case is easy to deal with.  A node of type $(3,1,1)$ such
that the dart on the exceptional face is at least $1.32$ has a
bound of type Lemma~\ref{lemma:split} by Lemma~\ref{a:311}.
For the rest of the proof, assume that the azimuth angle on
the exceptional face $F$ is less than $1.32$ at nodes of type
$(p,q,r)=(3,1,1)$. This implies in particular by
Lemma~\ref{lemma:1.32} that the dart $x(F,v)$ is flat.

Another case is easy to deal with.  Lemma~\ref{a:no-ef}
shows that a node with no exceptional flat darts also
falls into the situation of Lemma~\ref{lemma:split}.
Thus, we may assume that at each $v\in V$, there is an exceptional
flat dart.

Pick a function $f$ from the set $V$ to the set of exceptional
standard components as follows. Let $X$ be the set of exceptional faces
$F$ at $v$ for which $x(F,v)$ is flat.  From $X$, let $f(v)$ be the
one with smallest $\azim(x(F,v))$.  We see by construction and
Lemma~\ref{lemma:1.32} that $F = f(v)$ has the properties:
    \begin{itemize}
        \item $\flat(x(F,v))$
        \item $\azim(x(F,v)) > 1.32\ \Rightarrow\ \azim(x(F',v)) >
        1.32$, for any exceptional face $F'$ meeting $v$.
    \end{itemize}

For each exceptional face $F$, let
    $$V_F = \{ v\in V : f(v) = F\}.$$  This set may be empty for
some $F$.  Let $A_F$ be the union of $\{F\}$, and the set of
triangles and quadrilaterals with a dart in some $v\in V_F$.  If
$V_F$ is empty, then $A_F =\{F\}$.  The indexing set $A$ of Property
\ref{definition:admissible:excess} of admissibility is the disjoint
union of $A_F$.  The set $V$ is the disjoint union of the $V_F$ (or
at least of the nonempty ones). So the result follows from
Lemma~\ref{XX} for all the faces.
\end{proof}



The proof that formally contravening hypermaps are tame is complete.

\subsection{more about tame hypermap}
%% CUT FROM TAME GOOD STUFF.

We have seen that a standard fan
can be associated with a centered packing $(\Lambda,v_0)$. 
This fan determines a standard hypermap.

The purpose of this section is to show that if the original
centered packing contravenes, then minor modifications can be made
to the standard hypermap to form what will be called the contravening
hypermap.

A natural number $n(R)$ is associated with each standard component. If
the boundary of that component is a simple polygon, then $n(R)$ is the
number of sides.   If the boundary consists of $k$ disjoint simple
polygons, with $n_1,\ldots,n_k$ sides then
    $$n(R) = n_1+\cdots+n_k + 2(k-1).$$


\begin{lemma}\label{lemma:enclosed:bis} % {Lemma 2.2}
A quadrilateral component does not enclose any vertices of height at
most $2t_0$.
\end{lemma}

%% Summation convention:

%If $F$ is a face of $H$, let
%    $$\sigma_F(D) = \sum \sigma(F),$$
%where the sum runs over the set of standard components associated with
%$F$.  This sum reduces to a single term unless $F$ is an aggregate
%in the sense of Remarks~\ref{remark:degree6} and
%\ref{remark:tri-pent}.


%% Here is stuff for after the definition of formally contravening hypermap.

%\begin{assumption}  $H$ is a planar hypermap.  $e$ is an
%involution that acts without fixed points.  Every face meets every
%node in at most one dart.  Every face has cardinality at least $3$
%and at most $8$.
%\end{assumption}


%\chapter{The Aggregate Cases}
%    \label{sec:aggregate}

\subsection{aggregate}
\label{sec:stargraph}

We display a number of examples of  hypermaps. 
Each of these hypermaps has a distinguished face $F$:
the ``unbounded face'' that surrounds the others in the figure.
We call each of these examples a {\it special summand.}
\index{Index}{special summand}

\begin{figure}[htb]
  \centering
  \myincludegraphics{noimage.eps}
  \caption{Examples of plain planar hypermaps that will be used
   in the connected sum operation.}
  \label{fig:aggregates}
\end{figure}

Each of these hypermaps is plain.
We
see by counting vertices, edges, and faces 
of each of these cases that each hypermap
is planar.  Therefore by Lemma~\ref{lemma:sum-planar},
if any of these hypermaps $A$
is used in a connected sum, then 
$B$ is planar if and only if $A\,\# B$ is.

We have a particular interest in hypermaps $H$ that have one of these
particular hypermaps as a quotient in a particular way.  Section~\ref{XX}
uses a contour loop $C$ to construct a complimentary loop $C'$, a set
of darts $D_{C'}$, which consists of a union of faces disjoint from $C$,
a normal family ${\cal L}$ consisting of $C$ and the faces of $D_{C'}$,
and a quotient $H/{\cal L}$.  For brevity, we write
$H/C$ for $H/{\cal L}$.  The quotient $H/C$ has a special face
$F_C$ coming from the contour loop $C$ in $\cal L$.
We have a particular interest
when $C$ can be chosen on $H$ in such a way that the corresponding
quotient $H/C$ is isomorphic to 
one of the examples of Figure~\ref{fig:aggregates},
with the face $F_C$ in correspondence with the unbounded face.

Section~\ref{XX} shows that the same construction can be applied
to $H$ starting from $C'$ to obtain a quotient $H/C'$ with face $F_{C'}$. 
Lemma~\ref{XX} affirms that there is a face-map reversing bijection
$\phi:F_C \to F_{C'}$ such that  $H$ is isomorphic to the connected
sum $$H/C \,\#_\phi H/C'.$$  We call $H/C$ the special summand.

Note that each aggregating contour loop has the property that
if it meets a dart of a face at a node, then it meets every dart
of that face at that node.

\begin{lemma} Let $(\Lambda,v_0)$ be a contravening centered packing.  There
is at most one contour loop in the standard hypermap that gives a
special summand as quotient.
\end{lemma}

\begin{proof} See Lemma~\ref{lemma:deg5}.
\end{proof}

\begin{definition}[aggregate]  Let $(\Lambda,v_0)$ be a contravening
centered packing with
standard fan $(v_0,V,E)$ and hypermap $H$. 
If there is a special contour loop, then define the aggregate hypermap
to be $H/C'$ as above.  Otherwise, define $H$ to be the aggregate.
\index{Index}{aggregate hypermap}
\end{definition}

\begin{lemma}\tlabel{lemma:agg-hyper}
The aggregating hypermap is connected, planar, plane,
and has no degenerate darts.   Every face of the aggregating hypermap
is simple. 
\end{lemma}

As in Lemma~\ref{XX}, aggregating hypermap is the hypermap
obtained from a fan (obtained by deleting edges and
vertices from the standard fan).


\subsection{aggregate weight assignment}

\begin{lemma} The bound $tri(v)>2$ holds if $v$ is a node
of an aggregate face.
\end{lemma}

\begin{proof}
The exceptional component enters into the preceding two proofs in a
purely formal way.  Pentagons enter through the bounds
    $$t_5,\ s_5,\ 1.47\,\pt$$
and angles $1.153$, $1.32$.  Hexagons enter through the bounds
    $$t_6,\ s_6$$
and so forth.  These bounds hold for the aggregate faces.  Hence the
proofs hold for aggregates as well.
\end{proof}

\begin{lemma}
Consider a separated set of nodes $V$ on an aggregated face $F$ as
in Remark~\ref{XX}.\FIXX{remark:tri-pent}.  The Inequality
\ref{definition:admissible:excess} holds (in the definition of
admissible weight assignments):
    $$\sum_{V\cap F\ne\emptyset} (w(F) -d(\card(F)))
            \ge \sum_{v\in V} a(tri(v)).$$
\end{lemma}

\begin{proof}
We may assume that $tri(v)\in\{3,4\}$.

First consider the aggregate of Remark~\ref{XX}.\FIXX{remark:tri-pent} of a
triangle and eight-sided component, with pentagonal hull $F$. There
is no other exceptional component in a contravening centered packing
with this aggregate:
    $$t_8 + t_5 > \squander.$$
A separated set of nodes $V$ on $F$ has cardinality at most $2$.
This gives the desired bound $$t_8 > t_5 + 2 (1.5)\,\pt.$$

Next, consider the aggregate of a hexagonal hull with an enclosed
node.  Again, there is no other exceptional face. If there are at
most $k\le 2$ nodes in a separated set, then the result follows from
    $$t_8 > t_6 + k (1.5)\,\pt.$$
There are at most three nodes in $V$ on a hexagon, by the
non-adjacency conditions defining $V$. A node $v$ can be removed
from $V$ if it is not the central node of a flat quarter (Lemma
\ref{lemma:split} and Inequalities~\ref{eqn:tau1.32} and
Lemma~\ref{a:no-ef}). If there is an enclosed node $w$, it is
impossible for there to be three nonadjacent nodes, each the central
node of a flat quarter.  In fact, by Lemma~\ref{tarski:node},
any enclosed node must have height greater than $2t_0$.



Finally consider the aggregate of a pentagonal hull with an enclosed
node.  There are at most $k\le2$ nodes in a separated set in $F$.
There is no other exceptional component:
    $$t_7 + t_5 > \squander.$$
The result follows from
    $$t_7 > t_5 + 2(1.5)\,\pt.$$
\end{proof}

\begin{lemma}
Consider a separated set of nodes $V$ on an aggregate face of a
contravening hypermap as in Remark~\ref{XX}\FIXX{remark:degree6}.  The
Inequality~\ref{definition:admissible:excess} holds in the
definition of admissible weight assignments.
\end{lemma}

\begin{proof}
There is at most one exceptional face in the hypermap:
    $$t_8 + t_5 > \squander.$$
Assume first that aggregate face is an octagon (Figure
\ref{XX}\FIXX{fig:degree6}). At each of the nodes of the face that lies on a
triangular standard component in the aggregate, we can remove the node
from $V$ using Lemma \ref {lemma:split} and the estimate
    $$\tauLP(4,0,2\pi-2 (0.8638)) > 1.5\,\pt.$$
This leaves at most one node in $V$, and it lies on a node of $F$
which is ``not aggregated,'' so that there are five standard
components of the associated centered packing at that node, and one
of those components is pentagonal.  The value $a(4)=1.5\,\pt$ can be
estimated at this node in the same way it is done for a
non-aggregated case in Section~\ref{sec:tri34}.

Now consider the case of an aggregate face that is a hexagon (Figure
\ref{XX}\FIXX{fig:degree6}).  The argument is the same: we reduce to $V$
containing a single node, and argue that this node can be treated as
in Section~\ref{sec:tri34}.  (Alternatively, use the fact that the
pentagon-triangle combination in this aggregate has been eliminated
by Lemma~\ref{lemma:nobad4}.)
\end{proof}


%% STUFF ABOUT CENTRAL VERTICES, QUARTERS AND SO FORTH.

Recall that the central vertex of a flat quarter is defined to be
the one that does not lie on the triangle formed by the origin and
the diagonal.
%
 \index{Index}{central}

%%

We will say that there is a flat quarter centered at $v$, if
the corner $v'$ over $v$ is the central node of a flat quarter and
that flat quarter lies in the cone over an exceptional component.\FIXX{??}

%%


%% Table simplified...  The entry (7,0) with 14.76 is relevant here.
%% It needs to be treated.

Define constants $\tlp(p,q)/\pt$ by Table~\ref{eqn:old5.1:bis}. The
entries marked with an asterisk will not be needed.
%
 \index{Index}{type (of a node)}
 \index{Greek}{ZZtauLP@$\tlp(p,q)$}

\begin{equation}
\vbox{\offinterlineskip \hrule
\halign{&\vrule#&\strut\ \hfil#\hfil\ \cr   % "\ " was quad
height 7pt&\omit&&\omit&&\omit&&\omit&&\omit&&\omit&&\omit&\cr
&\hfil $\tlp(p,q)/\pt$\hfil
        &&\hfil $q=0$\hfil
        &&\hfil1\hfil
        &&\hfil2\hfil
        &&\hfil3\hfil
        &&\hfil4\hfil
        &&\hfil5\hfil&
\cr height 7pt&\omit&&\omit&&\omit&&\omit&&\omit&&\omit&&\omit&\cr
\noalign{\hrule}
height7pt&\omit&&\omit&&\omit&&\omit&&\omit&&\omit&&\omit&\cr
&$p=0$&& *&& *&& 15.18&& 7.135&& 10.6497&& 22.27&\cr &1&&    *&& *&&
6.95&& 7.135&&17.62  && 32.3&\cr &2&&    *&&
8.5&&4.756&&12.9814&&*&&*&\cr &3&& *&& 3.6426&&8.334&&20.9&&*&&*&\cr
&4&&4.1396&&3.7812&&16.11&&*&&*&&*&\cr
&5&&0.55&&11.22&&*&&*&&*&&*&\cr &6&&6.339&&*&&*&&*&&*&&*&\cr
&7&&14.76&&*&&*&&*&&*&&*&\cr
height7pt&\omit&&\omit&&\omit&&\omit&&\omit&&\omit&&\omit&\cr}
\hrule }
    %oldtag 5.1
    \label{eqn:old5.1:bis}
\end{equation}


%%  (1,0,1)

\subsection{four-circuit}
\label{sec:impossible-circuit}

This subsection rules out the existence of a particular four-circuit
on a contravening hypermap.  The interior of the circuit consists of
two faces: a triangle and a pentagon.  The circuit and its interior
node are shown in Figure~\ref{fig:no4circuit} with nodes marked
$p_1,\ldots,p_5$. The node $p_1$ is the interior node, the triangle
is $(p_1,p_2,p_5)$ and the pentagon is $(p_1,\ldots,p_5)$.


Let $v_1,\ldots,v_4,v_5$ be the corresponding vertices of $\Lambda(v_0,2t_0)$.\FIXX{??}

The diagonals $\{v_5,v_3\}$ and $\{v_2,v_4\}$ have length at least
$2\sqrt2$ by Lemma~\ref{tarski:2t0-doesnt-pass-through}.  If an
azimuth angle of the  quadrilateral is less than $1.32$, then by
Lemma~\ref{lemma:1.32},  $|v_1-v_3|\le\sqrt{8}$.  Thus, we
assume in the following lemma, that all azimuth angles of the
quadrilateral aggregate are at least $1.32$.

%%

\begin{remark}
We have now fully justified the claim made in
Remark~\ref{XX}\FIXX{remark:degree6}: there is at most one node on six
standard components, and it is part of an aggregate in such a way that
it does not appear as the node of $H$.
\end{remark}

%%%%%%%%%%%%%%%%%%%%%%

%% AGGREGATE STUFF IN THE PROOF OF \ref{definition:tame:score}
%% Property of Tameness.

We consider three cases for Inequality~\ref{XX}\FIXX{eqn:sigma}. In the
first case, assume that the face $F$ corresponds to exactly one
standard component in the centered packing.\FIXX{??} In this case,
Inequality~\ref{XX}\FIXX{eqn:sigma} follows directly from the bounds of
Lemma~\ref{thm:the-main-theorem}:
    $$\sigma(F)\le s_n \le c(n)\,\pt.$$

In the second case, assume we are in the context of a pentagon $F$
formed in Remark~\ref{XX}\FIXX{remark:tri-pent}.  Then, again by
Theorem~\ref{thm:the-main-theorem}, we have
$$\sigma(F) \le s_3+s_8\le (c(3)+c(8))\,\pt \le c(5)\,\pt.$$
(Just examine the constants $c(k)$.)

In the third case, we consider the situation of 
Remark~\ref{XX}\FIXX{remark:degree6}.  The six faces give
$$\sigma(F)\le s_5+\sLP(5,0,2\pi-1.153)< c(8)\,\pt.$$
The constant $1.153$ comes from Lemma~\ref{lemma:0.8638}.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
