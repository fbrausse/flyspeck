% Flyspeck
% Thomas C. Hales
% Sep 3, Removed 2 enclosed in quad properties.


\chapter{Tame Hypermap}
\indy{Index}{hypermap!tame}%

\label{sec:tame}
\indy{Index}{tame}%

\begin{summary}
  This chapter is the second of the three core chapters that are devoted
  to the proof of the Kepler conjecture.  If $V$ is a finite set of
  vectors in $\ring{R}^3$, let
  \[ \CalL(V) = \sum_{\v\in V}
    L(\normo{\v}/2).\] 
Let $\BB$ be the
annulus $\bar B(\orz,2h_0)\setminus B(\orz,2)$, where
$\bar B(\orz,r)$ is the closed ball of radius $r$.
By Corollary~\ref{cor:CE}, if every packing $V$
contained in $\BB$
satisfies
\begin{equation}\label{eqn:CCE}
\CalL(V) \le 12,
\end{equation}
then the Kepler conjecture follows.

In this chapter, we assume that there exists a counterexample $V$ to this
inequality and reach a contradiction.  A subset of extremal
counterexamples  is selected that is particularly well-suited for
further analysis.  Every extremal counterexample gives rise to a fan
and a corresponding hypermap.  A detailed study of these hypermaps
leads to a long list of properties that all such hypermaps must
possess.  A \newterm{tame} hypermap is defined to be precisely the set
of hypermaps that have all of these properties.  Tameness is thus an
umbrella term that covers a long list of loosely related properties.

An earlier chapter on hypermaps gives an algorithm that generates all
restricted hypermaps with a given bound on the number of nodes.
Every tame hypermap is restricted and has at most fifteen nodes.  Hence, a
list of all tame hypermaps can be obtained by generating all
restricted hypermaps and filtering out those that are not tame.  This
algorithm has been implemented and executed in computer code.  The result
 is an explicit list that classifies tame hypermaps
up to isomorphism.  This classification solves a major step of the
packing problem.

Each tame hypermap $H$ gives rise to a nonlinear optimization problem to
maximize $\CalL(V)$ subject to the constraint that the hypermap
associated with $V$ is isomorphic to $H$.  This nonlinear optimization
problem has a relaxation in the form of a linear program with a maximum that
 is at least as large as the maximum of the nonlinear program.
Each linear program has been solved by computer.  In every case, its
maximum is less than $12$.  Hence, Inequality~\ref{eqn:CCE}
always holds, so that the Kepler conjecture is confirmed.
\end{summary}
\indy{Index}{hypermap!tame}%
\indy{Index}{tame!hypermap}%



\section{Definition}

This section gives the definition of a tame hypermap, which is object of study in
this chapter.    The definition depends on a large set of parameters, which have
been determined by computer experimentation.  On the one hand, the idea is to define a class
of hypermaps that is finite and small enough to classify without much trouble.
On the other hand, we have to prove that every counterexample $V$ of \eqref{eqn:CCE}
has a hypermap that is tame.  The smaller the class of hypermaps, the more difficult
it becomes to relate them to the counterexample $V$.  In the end, we seek a balance
between these contrary demands.


\begin{definition}[triangle,~quadrilateral]\guid{HZQSLXI}
  Faces of cardinality three in a hypermap are called
  \newterm{triangles} and those of cardinality four are called
  \newterm{quadrilaterals}.
%
\indy{Index}{triangle}%
\indy{Index}{quadrilateral}%
\indy{Notation}{pZ@$p_\v$}%
\end{definition}

\begin{definition}[type,~$(p,q,r)$]\guid{XOOBDFI}\label{definition:type}
\formaldef{}{set\_of\_triangles\_meeting\_node}
\formaldef{}{set\_of\_quadrilaterals\_meeting\_node}
\formaldef{}{set\_of\_exceptional\_meeting\_node}
\formaldef{$(p,q,r)$}{type\_of\_node}
The \newterm{type\/} of a node is defined to be a triple of
nonnegative integers $(p,q,r)$, where $p$ is the number of
triangles meeting the node, $q$ is the number of quadrilaterals
meeting it, and $r$ is the number of other faces meeting it, so that
$p+q+r$ is the total number of faces meeting the node.
%
\indy{Index}{node!type}%
\indy{Notation}{pqr@$(p,q,r)$}%
\end{definition}


\subsection{weight assignment}\label{sec:wtassign}
\indy{Index}{weight assignment}%

We call the constant $\op{tgt}=1.541$, which arises repeatedly in this
chapter, the \newterm{target}.  The constant's name comes from its
function as a measure of optimality. Below, in the definition of a tame
hypermap (Definition~\ref{def:tame}), any hypermap that overshoots the
target is not tame.  
\formaldef{$\op{tgt}$}{tgt}
%
\indy{Index}{target}%
\indy{Notation}{tgt@$\op{tgt}=1.541$}%


\begin{definition}[b]\guid{OOVCYPI}
\formaldef{$b$}{b\_tame}
Define $b:\ring{N}^2\to \ring{R}$ by $b(p,q)=\op{tgt}$,
except for the values in the following table:
{
\def\tx{\op{tgt}}
\[ \begin{matrix}  &q=0&1&2&3&4\\
p=0&\tx&\tx&\tx&0.618&0.97\\
1&\tx&\tx&0.656&0.618&\tx\\
2&\tx&0.797&0.412&1.2851&\tx\\
3&\tx&0.311&0.817&\tx&\tx\\
4&0.347&0.366&\tx&\tx&\tx\\
5&0.04&1.136&\tx&\tx&\tx\\
6&0.686&\tx&\tx&\tx&\tx\\
7&1.450&\tx&\tx&\tx&\tx
\end{matrix}
\] 
}
\indy{Notation}{b@$b$ (tame)}%
\end{definition}


\begin{definition}[d]\guid{BTDOPPJ}
\formaldef{$d$}{d\_tame}
Define $d:\ring{N}\to \ring{R}$ by
\[ d(k) = \begin{cases}
0 & k\le3, \\
0.206 & k=4, \\
0.4819 & k=5, \\
0.7578 & k=6, \\
%1.038 & k=7, \\
%1.315 & k=8,\\
\op{tgt}=1.541 & \text{otherwise}.
\end{cases}
\] 
\indy{Notation}{d@$d$ (tame)}%
\end{definition}




\begin{definition}[weight~assignment]\guid{DUSOAYQ}
\formaldef{admissible}{admissible\_weight}
\formaldef{total weight}{total\_weight}
%
  A \newterm{weight assignment\/} of a hypermap $H$ is a real-valued
  function $\tau$ on the set of faces of $H$. A weight assignment
  $\tau$ is \newterm{admissible} if the following properties hold:
%
\indy{Index}{weight assignment}%
\indy{Index}{weight assignment!admissible}%
\indy{Index}{cardinality}%
\indy{Index}{node}%
\indy{Notation}{ZZtau@$\tau$ (weight assignment)}%
\begin{enumerate}
\item \case{bound~a} 
\formaldef{$0.63$}{a\_tame}
\formaldef{}{adm\_3}
Let $v$ be any node of type $(5,0,1)$ and let
  $A$ be the set of triangles meeting that node.  Then
\[ \sum_{F\in A} \tau(F)
\ge  0.63.\] 
%   where $a=0.63$.
%        \label{definition:admissible:excess}
\item \case{bound~b}
\formaldef{}{adm\_2}
 If a node $v$ has type $(p,q,0)$, then
  \[ \sum_{F:\,v\cap F\ne\emptyset} \tau(F) \ge
    b(p,q).\] 
%        \label{admissible:b}
\item \case{bound~d}
\formaldef{}{adm\_1}
 If the face $F$ has cardinality $k$, then
$\tau(F) \ge d(k)$.
\end{enumerate}
\indy{Notation}{v@$v$ (node)}%
\indy{Notation}{A@$A$ (set of triangles)}%

The sum $\sum_F \tau(F)$ (over all faces) is called the \newterm{total weight}. 
% of $\tau$. %
\indy{Index}{weight!total}%
%\indy{Notation}{total@$\sum\tau$}%
\end{definition}





\subsection{hypermap property}
\label{sec:graphproperty}


\begin{definition}[tame]\label{def:tame}\guid{YOHGLNA}
\formaldef{tame}{tame\_hypermap}
A hypermap is \newterm{tame\/} if it satisfies the following conditions:
%
\indy{Index}{tame}%
\begin{enumerate}\wasitemize 
%\label{def:tame}
%1
\item \case{planar}  
\formaldef{}{tame\_1}
The hypermap is plain and planar.
\item \case{simple} 
\formaldef{}{tame\_2}
The hypermap is connected and simple.  In
  particular, each intersection of a face with a node contains at
  most one dart.
\item \case{nondegenerate} 
\formaldef{}{tame\_3}
The edge map $e$ has no fixed points.
\item \case{no loops} 
\formaldef{}{tame\_4}
The two darts of each edge lie in different nodes.
\item \case{no double joins} 
\formaldef{}{tame\_5a}
At most one edge meets any two (not necessarily distinct) nodes.
\item \case{face count} 
\formaldef{}{tame\_8}
  The hypermap has at least three faces.
\item \case{face size}
\formaldef{}{tame\_9a} 
The cardinality of each face is at least three  and at most six.
\item \case{node count} 
\formaldef{}{tame\_10}
There are  thirteen, fourteen, or fifteen nodes.
\item \case{node size} 
\formaldef{}{tame\_11a}
The cardinality of every node is at least three
  and at most seven.
%    \label{definition:tame:degree}
\item \case{node types} 
\formaldef{}{tame\_12o}
If a node has type $(p,q,r)$ with $p+q+r\ge 6$ and $r\ge 1$, then $(p,q,r)=(5,0,1)$. 
%    \label{definition:tame:degreeE}
\item \case{weights} 
\formaldef{}{tame\_13a}
There exists an admissible weight assignment
of total weight less than the target, $\op{tgt}=1.541$.
\end{enumerate}\wasitemize 
\end{definition}
%
\indy{Index}{planar}%
\indy{Index}{simple}%
\indy{Index}{nondegenerate}%
\indy{Index}{no loops}%
\indy{Index}{no double joins}%
\indy{Index}{face}%
\indy{Index}{weight}%

%    \label{definition:tame:40}
%    \item \case{blank}
% \item \case{triangles} If $L$ is a contour loop with three face
%   steps, and if there exists a node in the exterior of $L$, then $L$
%   is a face of the hypermap.
%    \label{definition:tame:3-circuit}
%\item \case{blank}
% \item \case{quadrilaterals} If $L$ is a contour loop with four face
%   steps, and there are at least two nodes in the exterior of $L$,
%   then the interior of $L$ takes one of the forms illustrated in
%   Figure \ref{fig:fourcircuit}.
%   \label{definition:tame:4-circuit}
%  \begin{figure}[htb]
%      \centering
%      \szincludegraphics[width=60mm]{\pdfp/fourcircuit.eps}
%      \caption{Tame $4$-circuits}
%      \label{fig:fourcircuit}
%  \end{figure}

\section{Classification}
\label{sec:proof-classification}

%\section{Statement of the Theorem}
\label{sec:classification}

The classification result in this section is one of the main results of this book.
The section is short because all of the work to prove the classification algorithm
has been completed in the chapter on hypermaps.


\begin{definition}[opposite]\guid{JABXMOS}
\formaldef{opposite}{opposite\_hypermap}
The \newterm{opposite} of a hypermap $(D,e,n,f)$ is the
hypermap $(D,f n,n^{-1},f^{-1})$.
\indy{Index}{hypermap!opposite}%
\end{definition}

\begin{lemma}[]\guid{PPHEUFG}
\formalauthor{Diep Trieu Thi} 
A hypermap is tame if and only if its opposite hypermap is tame as well.
\end{lemma}

\begin{lemma}[]\guid{RUNOQPQ}\cutrate{}
Every tame hypermap is a restricted hypermap.
\end{lemma}

\begin{proof}
  By definition, a tame hypermap is nonempty, connected, plain,
  planar, and simple.  The edge and node maps
  have no fixed points.  The cardinality of every face is at least
  three.  These are also precisely the defining properties of a restricted
  hypermap.
\end{proof}


A list of hypermaps appears at \cite{website:FlyspeckProject}.  The following
theorem has been established by executing a computer program that generates
tame hypermaps.  Further details about this program appear in
the Appendix~\ref{sec:hyper-gener}.

\indy{Index}{computer calculation}%

\begin{theorem}\guid{WTEMDTA}
  \label{theorem:classification} Every tame hypermap is isomorphic to
  a hypermap in the list~\cite{website:FlyspeckProject} or is
  isomorphic to the opposite of a hypermap in the list.
  \indy{Index}{isomorphic}%
\end{theorem}



%
%We have used computers to generate a list of all hypermaps and to check
%them against the archive of tame hypermaps.  The computer program is
%based on the hypermap generation construction of
%Section~\ref{sec:face-insert}.  According to the results of that
%section, every restricted hypermap can be generated by an elementary
%edge-insertion algorithm.  Every tame hypermap is a restricted
%hypermap.  The list of restricted hypermaps can be filtered to obtain
%a complete list of tame hypermaps.  
%

\section{Contravening Hypermap}

\subsection{standard fan}

Let
\formaldef{$E_{std}$}{ESTD}
\formaldef{$E_{ctc}$}{ECTC}
\begin{align}\label{eqn:fan-edge}
E_{std} &= \{\{\v,\w\}\subset V\mid 0 < \norm{\v}{\w}\le 2\hm \},\\
E_{ctc} &= \{ \{\v,\w\}\subset V\mid \norm{\v}{\w}= 2 \}\subset E_{std}.
\end{align}

\begin{lemma}[]\guid{UBHDEUU}\label{lemma:ctc-fan}
Let $V\subset \BB$ be a packing.  If $E=E_{std}$ or $E=E_{ctc}$, then
$(V,E)$ is a fan.
\end{lemma}

\begin{definition}\guid{SUZCOOW}
The fans $(V,E_{std})$ and $(V,E_{ctc})$ are called the \newterm{standard fan} and
the \newterm{contact fan}, respectively.  
\end{definition}
%Let $\op{hyp}(V,E)$ be the associated
%hypermap.  
\indy{Index}{fan!standard}%
\indy{Index}{fan!contact}%
\indy{Notation}{V@$V$ (packing)}%
\indy{Notation}{V@$(V,E)$ (fan)}%
\indy{Notation}{hyp@$\op{hyp}$ (hypermap)}%
\indy{Notation}{E@$E_{std}$}%
\indy{Notation}{E@$E_{ctc}$}%

\begin{proof} 
  $(V,E_{std})$ is a fan by Lemma~\ref{lemma:std-fan}.  Since
  $E_{ctc}\subset E_{std}$, it follows from
  Lemma~\ref{lemma:subset-fan} that $(V,E_{ctc})$ is a fan.
\end{proof}


\begin{lemma}[standard fan]\guid{CKQOWSA}\label{lemma:std-fan} 
\formalauthor{Alexey Solovyev}
%older harder proof w/o computers was 1800.
% rating includes the Tarski calculations.
%\formalauthor{Roland Zumkeller: \case{four points} by Bernstein polynomials}
Let $V\subset \BB$ be a packing.  
Then $(V,E_{std})$ is a fan.
\end{lemma}
\indy{Notation}{E@$E_{std}$}%

\begin{proof}
The properties \case{cardinality}, \case{origin}, and \case{nonparallel} follow
by the methods of Remark~\ref{remark:fan-verify}.

\case{intersection}: Some geometrical reasoning is required to
establish the intersection property.  The case
\[ 
C\{\u\}\cap C\{\v\} = \{\orz\}
\] 
follows from the strict triangle inequality 
\[ 
\normo{\u} \le 2\hm < 4 \le \normo{\v} + \norm{\u}{\v}.
\] 
The other cases of the proof are based on the following two facts from
Tarski arithmetic.  The second fact is a consequence of the theory of
Cayley-Menger determinants, as described in Remark~\ref{rem:CM5}.
%\footformal{Further details about these calculations
%  can be found in
%  \url{http://www.math.pitt.edu/~thales/papers/Lemmas_Elementary_Geometry.pdf}
%  Lemma 58 (UQQVJON) and Lemma 60 (ZHBBLXP).  An alternative approach
%  to the proof of \case{four points} proceeds as follows. Assume a
%  counterexample to \case{four points} exists. By symmetry we may
%  assume without loss of generality that a counterexample satisfies the further
%incidence relation
%$\op{conv}\{\v_1,\v_3\}$   meets  $\op{conv}\{\v_0,\v_4,\v_2\}$, where
%we set $\v_0=\orz$.
%  The set of all counterexamples $\{\v_1,\ldots,\v_4\}$ satisfying this further
%incidence relation
%is a nonempty compact set $X_0$ of $\ring{R}^{12}$, because all of the defining conditions are closed conditions and $\BB$ is bounded.  Among all countexamples, consider the
%nonempty subset $X_1$ of those configurations in $X_0$ that maximize the continuously differentiable function $\normo{\v_4}+\normo{\v_2}+\norm{\v_4}{\v_2}$.  For configurations in $X_1$,
%the maximum of this continuously differentiable function is the {\it boundary value} $\norm{\v_i}{\v_j}=2.52$, with $i\ne j\in\{0,2,4\}$ because otherwise we are not
%at a critical point of the function.  Let $X_2$ be the compact subset of $X_1$
%that minimizes the continuously differentiable function $\norm{\v_1}{\v_3}$.  
%Similar arguments show that there is no interior point critical point, and the
%minimum appears at the boundary when $\norm{\v_i}{\v_j}=2$ for $i=1,3$ and $j=0,2,4$.
%The function $\mu_V$ (from
%the {\it Lemmas in Elementary Geometry} collection Lemma PFDFWWV) computes the
%value of $\norm{\v_1}{\v_3}$, which is larger than $2.52$.  This contradicts
%what is assumed.
%}
\begin{enumerate}
\item \case{three points} Let $\{\v_1,\v_2,\v_3\}\subset \BB$ be a
  packing of three points.  Assume that $\norm{\v_1}{\v_3}\le 2\hm$.
  Then $\v_2\not\in C\{\v_1,\v_3\}$.
\item \case{four points} Let $\{\v_1,\v_2,\v_3,\v_4\}\subset \BB$ be a
  packing of four points.  Assume that $\norm{\v_1}{\v_3}\le 2\hm$ and
  $\norm{\v_4}{\v_2}\le 2\hm$.  Then $C\{\v_1,\v_3\}\cap
  C\{\v_4,\v_2\} = \{\orz\}$.
\end{enumerate}
We give a proof of \case{three points} by contradiction, assuming that
some configuration exists with $\v_2\in C\{\v_1,\v_3\}$.
%, and in the
%more general setting where the constraint $2\le \norm{\v_1}{\v_3}$ is
%dropped.  
We consider two cases, depending on whether $\v_2$ lies in 
the convex hull of $\{\v_0,\v_1,\v_3\}$, where $\v_0=\orz$.  
If it does lie in this triangle, 
then $\norm{\v_2}{\v_i}\le 2\hm$ for $i=1,3$ because every
side of the triangle has length at most $2\hm$.
The proof then
follows from a \cc{TVAWGDR} % old:{4717061266}
{A certain configuration of four points
cannot be coplanar.} that $\Delta(x_{ij})>0$ for  
$x_{ij}=\norm{\v_i}{\v_j}^2$, which contradicts Remark~\ref{rem:cayley},
asserting that the polynomial $\Delta$ vanishes on every planar arrangement of four
points $\{\v_0,\v_1,\v_3,\v_2\}$.

In the second case, the segment $\op{conv}\{\v_1,\v_3\}$ meets
$\op{conv}\{\v_0,\v_2\}$.
We drop the constraint $\norm{\v_1}{\v_3}\ge 2$
and continuously deform 
the configuration to contract the norm $\norm{\v_1}{\v_3}$ as much as possible.
%The contractions can be made along circles of intersection of pairs of spheres
%at v0 v2 v4.  The closest point of the circle creates coplanarity of four points.
When this norm is as small as possible, the four points $\{\v_0,\ldots,\v_3\}$
are the extreme points of 
a rhombus of side length $r=2$.  We reach a contradiction by calculating
the squares of the diagonals of the rhombus:
\[
16 = 4r^2 =  \norm{\v_0}{\v_2}^2 + \norm{\v_1}{\v_3}^2 
  \le (2\hm)^2 + (2\hm)^2 < 16.
  \]

  The proof of \case{four points} is also a proof by contradiction,
  assuming as we may by symmetry that $\op{conv}\{\v_1,\v_3\}$ meets
  $\op{conv}\{\v_0,\v_4,\v_2\}$, where $\v_0=\orz$.  Again, we drop
  the constraint $\norm{\v_1}{\v_3}\ge 2$ and continuously deform the
  configuration to contract the length $\norm{\v_1}{\v_3}$ as much as
  possible.  By \case{three points}, the continuous contraction does
  not pass through any configurations in which four of the points are
  coplanar.  When the norm is as small as possible the lengths satisfy
  $\norm{\v_i}{\v_j}=2$ for $i=0,2,4$ and $j=1,3$.  Let $\v_0^*$ be
  the reflection of $\v_0$ through the circumcenter of
  $\{\v_0,\v_2,\v_4\}$.  The four points $\{\v_1,\v_3,\v_0,\v_0^*\}$
  are the extreme points of a rhombus of side length $r=2$. We reach
  a contradiction by calculating the squares of the diagonals of the
  rhombus:
\[
16 = 4r^2 = \norm{\v_0}{\v_0^*}^2 + \norm{\v_1}{\v_3}^2 
  \le (2\eta(2\hm,2\hm,2\hm))^2 + (2\hm)^2 < 16.
\]
%A \c{3611774025}{A Cayley-Menger determinant is negative.} 
%now shows that under these additional
%constraints the Cayley-Menger determinant of the five points%
%$\{\v_0,\ldots,\v_4\}$ is negative.  This contradicts Remark~\ref{rem:CM5},
%which asserts that the Cayley-Menger determinant of any five points in
%$\ring{R}^3$ is zero.
\end{proof}

\subsection{surrounded and isolated nodes}

This section takes a counterexample to Inequality~\ref{eqn:CCE} and  sharpens it.
\indy{Index}{hypermap!contravening}%
% The aim is to prove conjecture~\ref{conj:L12}.  For a contradiction,
% assume a counterexample.
A counterexample to the Kepler conjecture leads to a finite packing
$V\subset \BB$ that violates Inequality~\eqref{eqn:CCE}.  The
purpose of this section is to select a special class of
counterexamples to this inequality. 

\begin{definition}[isolated,~surrounded]\guid{CWQEWTI}
  Let $(V,E)$ be a fan.  Say that $\v\in V$ is \newterm{isolated} in
  the fan if $E(\v)$ is empty.  Say that $\v\in V$ is
  \newterm{surrounded} in the fan if the azimuth angles of all darts
  at the node $\v$ are less than $\pi$.  (In particular, the
  cardinality of $E(\v)$ is at least three.)
\end{definition}
\indy{Index}{isolated}%
\indy{Index}{surrounded}%
\indy{Index}{angle!azimuth}%
\indy{Index}{azimuth}%
\indy{Index}{cardinality}%
\indy{Notation}{E@$E(\v)$ (fan)}%

The following lemma appears in Sch\"utte and van der
Waerden~\cite{vanderWaerden:1951}.

\begin{lemma}[]\guid{FATUGPD}
\formalauthor{Quyen}
\label{lemma:iso-surround}
Given any packing $V\subset \BB$,
there exists a bijection $\phi:V\to V'$ with a  packing $V'$ 
such that $\normo{\v} = \normo{\phi(\v)}$ and
such that every node $\v'$ in the contact fan of $V'$
is either isolated or surrounded.
\end{lemma}
\indy{Index}{packing!finite}%
\indy{Index}{fan!contact}%
\indy{Notation}{V@$V'$ (packing)}%

\begin{proof} Consider all finite packings in bijective correspondence
  with $V$ such that the bijection preserves distances to
  the origin.  Among these packings, pick one, $V'$, with the largest
  number of isolated points in the contact graph.  

We assume for a contradiction that  there is a point
  $\v\in V'$ that is not isolated and not surrounded.  It  has a
  dart in the contact fan with angle at least $\pi$.  Perturb $\v$ away from the
  contacts, making it isolated, while preserving its distance from
  $\orz$.  The perturbed packing $V''$ has at least one more isolated point
  than $V'$, in violation of the supposed maximality of $V'$.
  Hence, the conclusion of the lemma holds for $V'$.
\end{proof}

The following lemma shows that the corresponding result holds for the
standard fan.  Beware!  The set of isolated and surrounded
nodes depends on a choice of fan.  The next proof makes frequent use
of two different fans $(V,E_{std})$ and $(V,E_{ctc})$, which have
different sets of isolated and surrounded nodes, even though the
set $V$ is the same in both cases.



\begin{lemma}[]\guid{FNJLBXS} % typo FJLBXS
\label{lemma:surrounded}  % 
Given any packing $V\subset \BB$, there exists bijection $\phi:V\to
V'$ with some packing $V'$ such that $\normo{\v} = \normo{\phi(\v)}$
and such that every node $\v'$ in the standard fan of $V'$ is isolated
or surrounded.  \indy{Index}{packing!finite}%
\end{lemma}

\begin{proof} For any packing $V'\subset \BB$, let $V'_{\text{c-iso}},V'_{\text{c-sur}}$
  be the sets of isolated and surrounded nodes of $V'$
  respectively, in the \newterm{contact} fan.  By the previous lemma,
  assume without generality that every node $\v$ in the contact fan
  of $V$ is either isolated or surrounded:
\[ 
V = V_{\text{c-iso}} \cup V_{\text{c-sur}}.
\] 
Consider the set $\CalV$ of pairs $(V',\phi)$ consisting of a packing $V'$
and bijection $\phi:V\to V'$ with the following properties:
\begin{enumerate}\wasitemize 
\item The bijection $\phi$ preserves distances from the origin.
\item The surrounded nodes are the same $V_{\text{c-sur}}=V'_{\text{c-sur}}$.
\item The restriction of $\phi$ to $V_{\text{c-sur}}$ is the identity map $I$.
\end{enumerate}\wasitemize 
\indy{Notation}{V@$\CalV$ (family of packings)}%%
\indy{Notation}{V@$V_{\text{c-iso}}$ (contact isolated nodes)}%%
\indy{Notation}{V@$V_{\text{c-sur}}$ (contact surrounded nodes)}%%
\indy{Notation}{I@$I$ (identity map)}%

\claim{The set $\CalV$ is a nonempty compact topological space.}
Indeed, by fixing an enumeration $V = \{\v_0,\ldots,\v_r\}$, the set
$\CalV$ embeds into Euclidean space of dimension $3r$ under the map
that sends the pair $(V',\phi)$ to the point
$(\phi^{-1}\v_0,\ldots,\phi^{-1}\v_r)$.  Thus, $\CalV$ carries a
metric space topology as a subset of Euclidean space.  With a little
argument, it follows from the boundedness of $V\subset B(0,2\hm)$ that
$\CalV$ is compact.  Also, $(V,I)\in \CalV$, so $\CalV\ne\emptyset$.


For any pair $(V',\phi)$ in $\CalV$ and $\v'\in \phi(V_{\text{c-iso}})$, let
$c(V',\phi,\v')$ be the minimum distance from $\v'$ to a point in
$V'\setminus \{\v'\}$.  For $i=1,\ldots,n=\card(V_{\text{c-iso}})$ define
$c_i=c_i(V',\phi)$, by ordering the real numbers
$c(V',\phi,\v')$, $\v'\in\phi(V_{\text{c-iso}})$ in increasing order:
\[ 
c_0 \le c_1 \le c_2 \le \cdots \le c_n.
\] 
The functions $c_i:\CalV\to\ring{R}$ are  continuous on the
compact configuration space $\CalV$.  There is a nonempty compact
subset $\CalV_0$ of $\CalV$ on which $c_0$ attains its maximum
value. Continuing recursively, there is a nonempty compact subset
$\CalV_{i+1}$ of $\CalV_{i}$ on which $c_{i+1}$ attains its maximum value.
\indy{Notation}{c i@$c_i$ (constant)}%
\indy{Notation}{V@$\CalV_0$}%

For the configuration $(V,I)\in \CalV$, it follows that $c_0(V,I) >2$.
Hence, $c_0(V',\phi)>2$ for $(V',\phi)\in\CalV_0$.  It follows
that $V'_{\text{c-iso}}=\phi(V_{\text{c-iso}})$ is in bijective correspondence with
$V_{\text{c-iso}}$ for all $(V',\phi)\in \CalV_0$.

\claim{Any $(V',\phi)\in \CalV_n$ has the desired property.}
Otherwise, there exists some node $\v'\in V'_{\text{c-iso}}$ in contact
isolation that is neither isolated nor surrounded in the standard fan.
%Any such node satisfies $c(V',\phi,\v')=c_i(V',\phi)$ for some
%$i$.  We may assume $i$ minimal in the sense that 
There exist $i$ and $j$, with $i\le j$ such that
\[ 
\{k\mid c_k(V',\phi) = c(V',\phi,\v')\} = \{k\mid i\le k\le j\}.
\] 
%$c_j(V',\phi)=c_i(V',\phi)$ implies $j\ge i$.
%Write
%\[ 
%  c(V',\phi,\v') = c_i(V',\phi) = c_{i+1}(V',\phi) 
%=\cdots= c_j(V',\phi) < c_{j+1}(V',\phi),
%\] 
%for some $j\ge i$.  
As $\v'$ is not isolated in the standard fan, it
follows that $c(V',\phi,\v') \le 2\hm$.  As $\v'$ is not surrounded in the
standard fan in the cyclic order on
\[ 
\{\w'\in V' \mid \norm{\w'}{\v'} = c(V',\phi,\v')\},
\] 
some azimuth angle is at least $\pi$.
Thus, there is a direction in which $\v'$ can be perturbed
that  fixes $c_0,\ldots,c_{i-1}$, does not decrease $c_i,\ldots,c_{j-1}$, and increases $c_j$.
This is contrary to the defining property of
$(V',\phi)\in\CalV_n\subset\CalV_j\subset\CalV_i$.  This establishes the claim.
\end{proof}



\begin{lemma}[]\guid{FCDJDOT}\label{lemma:CE} 
  Assume that there exists a counterexample to
  Inequality~\ref{eqn:CCE}.  Then there also exists a counterexample
  $V$ to the inequality with the following properties:
\begin{enumerate}\wasitemize 
\item $V\subset \BB$ is a packing.
\item $\CalL(V) > 12$, and no finite packing in $\BB$ attains a value
  larger than $\CalL(V)$.
\item The cardinality of $V$ is thirteen, fourteen, or fifteen.
\item Every node $\v$ is surrounded in the standard fan $(V,E_{std})$.
\item Every node $\v$ that is not surrounded in the contact fan $(V,E_{ctc})$ satisfies $\normo{\v}=2$.
\end{enumerate}\wasitemize 
\end{lemma}

\begin{proof} Assume that a counterexample exists.  The set of
  counterexamples $V\subset\BB$ is a compact set.  The function
  $\CalL$ is a continuous function on this compact set.  Hence, there
  exists $V$ that maximizes $\CalL(V)$.

  The set $V$ has cardinality thirteen, fourteen,  or fifteen
  (Lemma~\ref{lemma:13-14}). Lemma~\ref{lemma:surrounded} gives the
  existence of a counterexample $V$ in which every node is
  surrounded or isolated in the standard fan.  By
  Lemma~\ref{lemma:D'}, if there are any isolated vertices in the
  standard fan, then it is not a counterexample.  In fact, every
  node is surrounded in the standard fan.

  \claim{A node $\v$ that is not surrounded in the contact fan
    satisfies $\normo{\v}=2$.}  Otherwise, the counterexample does not
  maximize $\CalL$.  In fact, the packing that replaces $\v$ with $(1-\epsilon)\v$ for sufficiently small $\epsilon>0$ does better.
\end{proof}


\begin{definition}[contravening]\guid{YXISOKH}
\formaldef{contravening}{contravening}
  A finite packing  $V$ is a \newterm{contravening} packing if it
  satisfies the properties of Lemma~\ref{lemma:CE}.  The
 hypermap $\op{hyp}(V,E_{std})$ is also said to be
  \newterm{contravening} when $V$ is contravening.
\end{definition}






\section{Contravention is Tame}
\indy{Index}{tame!contravention}%
\label{sec:contraproof}

This section and the next one prove that every contravening hypermap is tame.

Let $V$ be a contravening packing with standard fan
$(V,E)=(V,E_{std})$ and let $H=\op{hyp}(V,E)=(D,e,n,f)$ be the
hypermap attached to $(V,E)$.  The fan $(V,E)$ is fully surrounded and
a conforming fan by Lemma~\ref{lemma:face}.  We recall some of the
properties of conforming fans from Section~\ref{sec:conformance}.  The
hypermap $H$ is plain, planar, connected, and simple.  The set of
topological components of $Y(V,E)$ is in bijection with the set of
faces of $H$.  \indy{Notation}{H@$H$ (hypermap)}%
For each face of $H$, the corresponding component $U_F$ is eventually
radial with solid angle 
%
\indy{Notation}{UF@$U_F$ (topological component)}%
\indy{Index}{fully surrounded} \indy{Index}{conforming}
\[ 
\sol(U_F) = 2\pi + \sum_{x\in F} (\op{azim}(x) -\pi).
\] 
Recall that
\[ \sum_{F} \sol(U_F) = 4\pi.\] 
Recall the map $\nd:F\to V$ that maps each dart to its node:
\formaldef{$\nd$}{FST}
\[ 
x \mapsto \nd(x); \quad   x = (\nd(x),\ldots).
\] 
Set 
\[ h(x) = \normo{\nd(x)}/2.\] 
Define the weight function
\begin{align}
  \tau(V,E,F) &=\sum_{x\in F} \op{azim}(x)
  \left(1 + \dfrac{\sol_0}{\pi}(1- L(h(x)))\right) 
  + \left(\pi+{\sol_0}\right) (2- k(F))\qquad\phantom{t}\vspace{6pt}\nonumber\\
  &= \sol(U_F) + (2- k(F))\sol_0 - \dfrac{\sol_0}{\pi}
\sum_{x\in F}\op{azim}(x) (L(h(x)) - 1)\vspace{6pt}\nonumber\\
  &= \sol(U_F) \left( 1 + \dfrac{\sol_0}{\pi}\right) 
- \dfrac{\sol_0}{\pi} \sum_{x\in F} \op{azim}(x)(L(h(x))),\label{eqn:tau-sol}
\end{align}
where $\sol_0$ is the solid angle of a spherical equilateral triangle with a side of arclength $\pi/3$, and $k(F)$ is the cardinality of $F$.
% 
These formulas are equivalent.  The proof of equivalence rests on the
Euler formula for planar hypermaps and the solid angle formula for
topological components $U_F$.  The first expression for $\tau(V,E,F)$
is particularly convenient because it expresses $\tau$ as a sum of
local contributions from each dart.  \indy{Notation}{L@$L$}%
\indy{Notation}{ZZtau@$\tau$}%
\indy{Notation}{ZZDeltanaught@$\sol_0$}%
The main conjecture may be expressed in the following alternative
form:

\begin{lemma}[target]\guid{HRXEFDM}\label{lemma:4pi-sol}
Let $V$ be a contravening packing. % and let $(V,E_{std})=(V,E_{std})$ be the standard fan.
Then
\[ 
\sum_F \tau (V,E_{std},F) < 4\pi - 20\sol_0.
\] 
The sum runs over the faces $F$ of $\op{hyp}(V,E_{std})$.
%if and only if
%\[ 
%\CalL(V)\le 12.
%\] 
\end{lemma}

\begin{proof}
Use the formula \eqref{eqn:tau-sol}.
  The sum of the solid angles $U_F$ is $4\pi$, and the sum of the azimuth
  angles at each node is $2\pi$.
% The Euler relation for connected plain planar hypermaps gives
%\[ 
%\sum_F (2- k(F)) = 2\#f - 2\#e = 4 - 2\#n.
%\] 
Thus,
\begin{align}\label{eqn:delta0}
  \sum \tau (V,E_{std},F) 
  &= 4\pi (1 + \dfrac{\sol_0}{\pi}) 
- (\dfrac{\sol_0}{\pi}) 2\pi \sum_{V} L(\normo{\v}/2)\vspace{6pt}\\
&= (4\pi - 20\sol_0) + 2\sol_0 (12 - \CalL(V)).
\end{align}
In a contravening packing, $2\sol_0(12-\CalL(V))<0$.
The result follows.
\end{proof}

\begin{remark}\label{rem:tgt}
The significance of the constant $\op{tgt}=1.541$ is that it is a
convenient rational approximation to the constant $4\pi -
20\sol_0\approx 1.54065$, which appears in Lemma~\ref{lemma:4pi-sol}.
\indy{Notation}{tgt@$\op{tgt}=1.541$}%
\end{remark}

The theorem that follows is one of the main results of this chapter.  The subsequent
sections present the proof in a series of steps.

\begin{theorem}\guid{MQMSMAB} \label{theorem:contravene}
  Let $V$ be a contravening packing.  Then the weight assignment
  $F\mapsto\tau=\tau(V,E_{std},F)$ on $H=\op{hyp}(V,E_{std})$ is
  admissible.  Moreover, the hypermap $H$ is tame with weight
  assignment $\tau$.
\end{theorem}
\indy{Notation}{H@$(H, \tau)$}%
\indy{Notation}{H@$H$ (hypermap)}%
\indy{Notation}{ZZtau@$\tau$ (weight)}%



\subsection{general properties}
\label{sec:startame}


Many of the properties of tameness are trivial or have been
established in earlier sections.  The following lemma quickly disposes
of many of the properties of tameness.

\begin{lemma}[]\guid{JGTDEBU}\label{lemma:multi}
                                                           %%100=without
                                                           %(vi),
                                                           %%(deprecated:
                                                           %300=with
                                                           %(vi))
  A contravening hypermap $H$ satisfies properties \case{planar},
  \case{simple}, \case{nondegenerate}, \case{no loops}, \case{no
    double joins}, \case{face count}, \case{node count}, and the first
  part of \case{node size}
%~(i)--(\v),  % was (i)-(vi).
%(viii),  (x), and the first part of (xi).
of tameness.
\end{lemma}

\begin{proof}
  The hypermap is plain, planar, connected, and simple by the general
  results established in the chapter on fan.  That chapter also shows
  that the hypermap attached to a fan satisfies properties
  \case{nondegenerate}, \case{no loops}, and \case{no double joins}.

%The property~(vi) is established in \cite[Lemma~3.7]{sp1}.
  \claim{Properties~\case{face count} and the first half of
    property~\case{node size} hold}.  Indeed, every node is
  surrounded, meaning that the azimuth angles of the darts at the
  node are less than $\pi$.  As the angles around the node sum to
  $2\pi$, there are at least three darts in the node. Each of the
  darts in the node leads into a different face by
  property~\case{simple}.

%% 13 or 14 nodes.
  Finally, property~\case{node count} has already been established in
  Lemma~\ref{lemma:CE}.
\end{proof}

There remain properties \case{face size}
(Lemma~\ref{lemma:face-size}), %(vii), (ix), the second part of (xi),
                               %(xii), and (xiii).
\case{node types} (Lemma~\ref{lemma:degE}), \case{weights bound a}
(Lemma~\ref{lemma:degE}), \case{weights bound b}
(Lemma~\ref{lemma:weightB}), \case{weights bound d}
(Lemma~\ref{lemma:main}), and the second part of \case{node size}
(Lemma~\ref{lemma:node-upper}).


\subsection{properties of nodes}
\indy{Index}{node!properties}%



\begin{lemma}[]\guid{CDTETAT} \label{lemma:0.852}
Let $H$ be a contravening
hypermap. For every dart $x$ in a triangular face of $H$,
\[ 0.852\le \azim(x)\le 1.9.\] 
For every dart $x$ in a nontriangular face of $H$, 
\[ 1.15\le\azim(x)<\pi.\] 
\indy{Notation}{H@$H$ (hypermap)}%
\indy{Notation}{x@$x$ (dart)}%
Consequently, if a node $\v$ has type $(p,q,r)$, then $(p,q+r)$ must
be one of the following pairs:
\begin{align*}
  &(0,3),~(0,4),~(0,5),~(1,2),~(1,3),~(1,4),~(2,1),~(2,2),~(2,3),\\
  &(3,1),~(3,2),~(3,3),~(4,0),~(4,1),~(4,2),
  ~(5,0),~(5,1),~(6,0),~(6,1),~(7,0).
\end{align*}
\end{lemma}
%

\begin{proof}
The angle bounds are a calculation.  The sum of the azimuth angles
around a node satisfies:
\[ 
p (0.852) + (q+r) (1.15) \le 2\pi < p (1.9) + (q+r) \pi,
\] 
and the pairs satisfying these constraints are listed.
\end{proof}

\begin{lemma}[]\guid{SZIPOAS}\label{lemma:node-upper}
\formalauthor{Vu Thanh}
%dcg{Lemma~21.4}{223} 
Contravening hypermaps satisfy the second part of property \case{node
  size}
%\ref{definition:tame:degree} 
of tameness.  That is, the cardinality of every
node is at most seven.
\end{lemma}

\begin{proof}  For every pair in the list of Lemma~\ref{lemma:0.852},  $p+q+r\le 7$.
\end{proof}




\begin{lemma}[]\guid{KCBLRQC} \label{lemma:weightB}
  Let $\v$ be a node of type $(p,q,0)$ in a contravening hypermap.
  Then the property~\case{bound b} of a admissible weight assignment
  holds:
\[ 
\sum_{ F\in A} \tau(V,E,F) \ge  b(p,q),
\] 
where the sum runs over the set $A$ of faces that meet the node $\v$.
\end{lemma}
\indy{Notation}{A@$A$ (faces)}%
\indy{Notation}{pqr@$(p,q,r)$}%

% XX regularize citations to the website.
\begin{proof}   The archive
  \cite[FUSDSPJ]{website:FlyspeckProject} contains a list of nonlinear
  inequalities for $\tau(V,E,F)$ when $F$ is a triangle or
  quadrilateral. Each nonlinear inequality has the form
  \indy{Notation}{F@$F$ (polygon)}%
\[ \tau(V,E,F) \ge a~\op{azim}(x) + b\] 
for some $a,b\in\ring{R}$, where $x$ is the uniquely determined dart
at the node $\v$ in the face $F$.  These nonlinear inequalities admit
a linear relaxation as follows.  For each $a,b$, there is a corresponding
linear inequality \indy{Notation}{ZZtau@$\tau$}%
\indy{Notation}{x@$x$ (dart)}%
\[ 
t(F) \ge a~z(F) + b,
\] 
where $t(F)$ and $z(F)$ are variables indexed by $F\in A$.
\indy{Notation}{A@$A$ (index set)}%
\indy{Notation}{t@$t$ (variable)}%
\indy{Notation}{z@$z$ (variable)}%
The linear relaxation asks for the minimum of 
\[ \sum_{F\in A} t(F)\] 
subject to these linear inequalities and the constraint
\[ 
2\pi = \sum_{F\in A} z(F).
\] 
We have executed the linear program as a 
\cc{KCBLRQC}{}
%The inequalities are those with the flag {\tt Tablelp}.  
%The case $(p,q,r)=(5,0,0)$ is a separate calculation {4652969746}.
for each of the
types $(p,q,0)$ of Lemma~\ref{lemma:0.852}. The given constants are
obtained from the (downward rounded) solutions to these linear
programs.  The case $(p,q,r)=(0,2,0)$ is eliminated by convexity.
\end{proof}

\begin{lemma}[]\guid{BDJYFFB}\label{lemma:degE}
  Every contravening hypermap satisfies properties \case{node types}
  and \case{weight bound A}
%\ref{definition:tame:degreeE} 
of tameness: 
If a node has type $(p,q,r)$ with $p+q+r\ge 6$ and $r\ge 1$, then $(p,q,r)=(5,0,1)$. 
Furthermore, assume the type is $(5,0,1)$ and let $A$ be the set of five triangles at the
node $\v$.  Then
\indy{Notation}{A@$A$ (set of triangles)}%
\[ 
\sum_{F\in A} \tau(V,E,F) > a,
\] 
where $a=0.63$.
\end{lemma}



\begin{proof}  We have also checked these conclusions by computer.
  The same set of nonlinear inequalities is used, and the linear
  relaxation is constructed in the same way as the proof of 
Lemma~\ref{lemma:weightB}.  The linear programming
  bounds exceed the constant $\op{tgt}$ in the cases excluded in the
  conclusion of the lemma.  The constant $a$ is the downward rounding
  of the solution to the linear program for $(5,0,1)$.
\end{proof}
\indy{Notation}{tgt@$\op{tgt}=1.541$}%

\indy{Notation}{a@$a$ (constant)}%

\subsection{faces}



\begin{lemma}[]\guid{CRTTXAT}  \label{lemma:face-size}
  Property~\case{face size} holds.  That is, Every face of a
  contravening hypermap $\op{hyp}(V,E_{std})$ has cardinality at least
  three and at most six.
\end{lemma}

\begin{proof} The lower bound holds because the hypermap has no loops
  or double joins.  

For a contradiction, let $F$ be a face of the
  hypermap of cardinality $k$ at least seven.  The inequality $\CalL(V)\ge 12$
implies that
\begin{equation}\label{eqn:L7}
\sum_{v} L(\normo{v}/2) \ge 12+k-\op{card}(V),
\end{equation}
with the sum running over the nodes meeting $F$.
The perimeter of $F$ is at least the minimum of
\[
\sum_{i=1}^k \arc(2h_i,2h_i',2),
\]
where $h_i,h_i'\in \leftclosed 1,1.26\rightclosed$ and by \eqref{eqn:L7}
\[
\sum_{i} (2h_0 - (h_i+h_i')) \ge (12+k - \op{card}(V)) 2 (h_0-1).
\]
A calculation of the second derivative shows that the functions $\arc(2h_i,2h_i',2)$ are concave.
The minimum is thus achieved when the variables $h_i$ and $h_i'$ are extremal.  From
the upper bound $\op{card}(V)\le 15$, it follows that the perimeter
is at least
\begin{align*}
2 (\op{card}(V) -12) \arc(2h_0,2,2) + (k - 2(\op{card}(V)-12)) \arc(2,2,2) &\ge\\
6 \arc(2h_0,2,2) + \arc(2,2,2) &> 2\pi.
\end{align*}
This perimeter bound is contrary to the bound on
perimeter in Lemma~\ref{lemma:convex-hyp}.
\end{proof}


%Divide the proof into cases
% depending on whether the following inequality holds:
%\[ 
%\sum _{x\in F} (\normo{\nd(x)}-2) \ge 4(\hm-1).
%\] 
%If the inequality holds, then since $L$ is the linear interpolation
%between the points $(1,1)$ and $(\hm,0)$, and there are at most fourteen
%points in $V$, it follows that
%\[ 
%\CalL(V) = \sum_{\v\in V}L(\normo{\v}/2) \le 12 L(1) + 2 L(\hm) =12,
%\] 
%and the main inequality holds.
%
%Now assume that the inequality is false.
%The edge $\{\v,\w\}$ has arclength at least
%\[ 
%  \arc(\normo{\v},\normo{\w},\norm{\v}{\w}) 
%\ge \arc(\normo{\v},\normo{\w},2). 
%\] 
%
%A calculation~\cite[cc:arc]{website:FlyspeckProject} gives
%\begin{equation}
%\arc(\normo{\v},\normo{\w},2)
%\ge 1 - 0.6076 (\normo{\w}/2 - 1) - 0.6076 (\normo{\v}/2 - 1).
%\end{equation} %%CC:arc
%The sum over a face of size at least $7$ gives
%\[ 
%\begin{align}
%\sum \arc(\normo{\v_i},\normo{\v_{i+1}},\norm{\v_i}{\v_{i+1}})&\ge
%7 - 0.6076 \sum (\normo{\v_i}-2) \\
%&\ge 7 - 0.6076 (4)(h_0-1)\\
%&> 2\pi.
%\end{align}
%\] 
%The left-hand side is the perimeter of the localization of $(V,E)$
%along $F$.  This perimeter estimate is contrary to the upper bound on
%perimeter in Lemma~\ref{lemma:convex-hyp}.





\section{Admissibility}


%\begin{theorem}\guid{THPJDQA}  %points for OLNSWLK below.
%  The weight assignment $\tau$ on a contravening hypermap is
%  admissible, and the total weight of $\tau$ is less than
%  $\op{tgt}=1.541$.  \indy{Index}{weight assignment}%
%\end{theorem}
%\indy{Notation}{tgt@$\op{tgt}=1.541$}%
%\subsection{admissibility}
%\label{sec:admissibility}


The main result (Lemma~\ref{lemma:main}) of this section is a proof
that for every contravening hypermap $H=\op{hyp}(V,E)$, the function
$\tau(V,E,\wild)$ is an admissible weight assignment on $H$.



\begin{lemma}[]\guid{GBMLQWW}\cutrate{}  \label{lemma:tau-local}
  Let $V$ be a contravening packing.
  Let $F$ be any face of $\op{hyp}(V,E_{std})$.  Then
\[ 
\tau(V,E_{std},F) = \tau(V',E',F),
\] 
where $(V',E',F)$ is the localization of $(V,E_{std})$ along the face $F$.
\end{lemma}

\begin{proof} The value $\tau(V,E,F)$ is expressed entirely in terms
  of $\normo{\v}$ for $\v\in V'\subset V$ and in terms of
  $\op{azim}(x)$ for $x\in F$.  By Lemma~\ref{lemma:localization},
  the terms $\op{azim}(x)$ are the same, whether calculated in terms
  of the hypermap of $(V,E_{std})$ or in terms of that of $(V',E')$.
\end{proof}


\begin{lemma}[]\guid{RNSYJXM}\cutrate{} Let $(V,E)$ be any fan and
  let $F$ be a face of its hypermap.  Let $(V',E')$ be the
  localization of $(V,E)$ along $F$.  Assume that $(V,E)$ is fully surrounded.
  Then $(V',E',F)$ is a nonreflexive local fan.
\end{lemma}

\begin{proof}
  Lemma~\ref{lemma:localization} gives all the properties of a nonreflexive local fan except for property \case{wedge}: $V'\subset \bWdart(x)$ for
  every dart $x\in F$.  By Lemma~\ref{lemma:face}, $U_F \subset
  \Wdart(x)$.  The wedge $\bWdart(x)$ is closed and contains
  $\Wdart(x)$. Hence, the closure $\bar U_F$ is contained in
  $\bWdart(x)$.  Let $\v\in V'$ and choose $\w\in V$ such that
  $y=(\v,\w)\in F$.
  % There is a dart of $F$ of the form $y=(\v,\rho \v)$.  Since $y$
  % leads into
  Since the dart $y$ leads into $U_F$, every neighborhood of $\v$
  meets $U_F$.  Thus, $\v\in \bar U_F\subset \bWdart(x)$.  This
  completes the proof.
\end{proof}








%
%\begin{lemma}[]\guid{BGDPIZY}\cutrate{}
%Suppose that
%\[ 
%\tau(V,E,F) \ge d (r,s)
%\] 
%for every special fan $(V,E,F,S)$,
%where $(r,s)$ are the parameters of the special fan.
%Then Lemma~\ref{lemma:main} holds.
%\end{lemma}



%The proof adopts the following convention for
%configurations.  Let $v_0,\ldots,v_{n-1}$ be the nodes
%of the polygon, and write
%\[ 
%y_i = \normo{v_i},\quad y_{ij} = \norm{v_i}{ v_j}.
%\] 
%\indy{Notation}{v@$v$ (node)}%



\begin{lemma}[main estimate]\guid{OLNSWLK}\label{lemma:main} 
%including lemmas that lead up to it.    
%Interval    %ineq may    %be    %assumed.
Let $V_0$ be a contravening packing and let $F$ be a
face of $\op{hyp}(V_0,E_{std})$ of cardinality $k$.  Then
$\tau(V_0,E_{std},F) \ge d(k)$.
That is, property~\case{weight bound d} holds.  
\end{lemma}
\indy{Notation}{F@$F$ (face)}%
\indy{Notation}{k@$k$ (cardinality of a face)}%


\begin{remark}
  In the original 1998 proof, the corresponding result is called the
  ``Main Estimate.''  The proof of that theorem takes about thirty pages
  and relies on many long computer calculations.  The proof given here
  is substantially simpler than the proof of the original main
  estimate, but it is still nontrivial. In fact, nearly the entire
  chapter on local fans consists of a proof of the main estimate.
  The proof presented in this book has the advantage of various
  special features that were not present in the original proof:
  polygons are convex, the hypermap is simple, and each face has
  at most six sides.
\end{remark}




\begin{proof}
  Let $V_0$ be a contravening packing.  By
  Lemma~\ref{lemma:tau-local}, $\tau(V_0,E_{std},F)=\tau(V,E,F)$, where
  $(V,E,F)$ is the localization of $(V_0,E_{std})$ along $F$.

  \claim{The tuple $(V,E,F,\emptyset)$ is a special fan.}  Indeed,
  every property can be verified in turn.  The properties
  \case{packing} and \case{annulus} result from the assumption that
  $V$ is contravening packing.

\case{nonreflexive local fan}  The localization $(V,E,F)$ is indeed a nonreflexive local fan.

\case{diagonal} If $\norm{v}{w}<2\hm$ and $v\ne w$, then $\{v,w\}\in
E_{std}$.
% Assume that $v,w\in V$ and $C^0\{v,w\}\subset \Wdart(x)$ for all
% $x\in F$.  The intersection of the sets $\Wdart(x)$ is the
% topological component $U_F$ of $Y(V_0,E_{std})$.  Thus,
% $C^0\{v,w\}\subset Y(V_0,E_{std})$.  Assume for a contradiction that
% $\norm{v}{w}< 2\hm$. Then by the definition of $E_{std}$,
% $\{v,w\}\in E_{std}$.  Hence, $C^0\{v,w\}\subset
% X(V_0,E_{std})$. This leads to a contradiction because $C^0\{v,w\}$
% is nonempty, and $X(V_0,E_{std})\cap Y(V_0,E_{std})=\emptyset$.

\case{subset} \case{s norm} These properties are trivial because
$S=\emptyset$.

\case{e norm} If $\{v,w\}\in E$, then $\{v,w\}\in E$.  It follows from
the definition of standard fan that $2\le \norm{v}{w}\le 2\hm$.

\case{card} Let $s=\card(\emptyset) = 0$, and $r=\card(E)$.  Then
$0\le s\le 3$ is trivial. Also,
\[ 3-s \le 3\le r \le 6=6 - 2s\] 
follows from the defining property \case{face size} of a tame
hypermap.  This proves the claim that $(V,E,F,\emptyset)$ is a special fan with parameters $r=k$ and $s=0$.

%By Lemma~\ref{lemma:min-empty}, the set of minimal fans is empty.
By Lemma~\ref{lemma:empty-d}, 
\[ 
\tau(V,E,F) \ge d (r,s)
\] 
for every special fan $(V,E,F,S)$. 
Finally, 
\[ 
\tau(V_0,E_{std},F)=\tau(V,E,F) \ge d(r,s) = d(k,0) = d(k).
\]   
This completes the proof.
\end{proof}


\begin{remark}
  It is helpful to keep in mind the origin of the constants $d(k)$.
  Although the proof of Lemma~\ref{lemma:main} does not produce sharp
  lower bounds on $\tau(V,E,F)$, the statement of the lemma is
  motivated by the configurations that follow.  Consider a nonplanar
  polygon contained in a sphere of radius $2$, with $k$ sides all of
  length $y_{i,i+1}=2$, heights $y_i=2$, and $k-3$ diagonals of length
  $2\hm$: $y_{0,j}=2\hm$ for $j=2,\ldots,k-2$.  Let $V$ be the set of
  vertices of the polygon, let $(V,E_{ctc})$ be its contact fan, and
  let $F$ be the face of $\op{hyp}(V,E_{ctc})$ representing the
  ``interior'' of the polygon.  Evaluating $\tau$ on these rigid
  configurations gives
\[ 
\tau(V,E_{ctc},F) \approx
\begin{cases}
0.20612 & k=4\\
0.48356 & k=5\\
0.760993 &k=6
\end{cases}
\] 
These calculations suggested the values of constants $d(k)$.  The
constants $d(k)$ are slightly smaller than these calculated values.%
\footnote{Note $\tau(2.1028,2,2,2,2.52,2.52) \approx 0.275951 <
  0.277433 \approx \tau(2,2,2,2,2.52,2.52)$.}  \indy{Notation}{d@$d$
  ($\tau$ bound)}%
\indy{Notation}{ZZtau@$\tau$}%
\indy{Notation}{k@$k$ (face size)}%
\end{remark}


\section{Linear Programs}\label{sec:tsp}

This is a short section, but it represents a major part of the proof
of the Kepler conjecture.  It is short only because the calculations
are better expressed as computer code than as published text.  The
code appears at the project
website~\cite{website:FlyspeckProject}.  Appendix~\ref{sec:lp} gives
details about the computational methods that have been used.

We attach a linear program to each tame hypermap.  For each tame
hypermap $H$ there is a configuration space $D(H)$ of all finite
packings $V\subset \BB$,  the standard fan of which is isomorphic to $H$.
\indy{Notation}{H@$H$ (hypermap)}%
\indy{Notation}{D@$D(H)$ (configuration space)}%

A nonlinear optimization problem asks for the maximum of
\begin{equation}\label{eqn:L2}
\sum_{\v\in V} L(\normo{\v}/2)
\end{equation}
over all $V\in D(H)$.

The linear program comes as a linear relaxation of this nonlinear
optimization problem on $D(H)$. That is, the optimal solution of the
linear program has value at least as great as the corresponding
nonlinear problem.  By showing that the value of each linear program
is at most $12$, we conclude that the maximum of \eqref{eqn:L2} is at
most $12$.




