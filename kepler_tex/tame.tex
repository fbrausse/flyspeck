% Flyspeck
% Thomas C. Hales
% Starting with Chapter on Tame Hypermaps



\chapter{Tame Hypermap}

\label{sec:tame}


This chapter defines a class of hypermaps.  Hypermaps in this class
are said to be {\it tame}.  A complete
classification of all tame hypermaps has been carried out by computer.   This classification solves a
major step of the packing problem.\FIXX{Unresolved chapter issues: \begin{itemize}\item $A$ vs. $v$ for nodes
\end{itemize}}

\section{Definition and Classification}


\begin{definition}[triangle,~quadrilateral,~exceptional]
Let $H$ be a hypermap.
Faces of cardinality $3$ are called {\it triangles}, those of
cardinality $4$ are called {\it quadrilaterals}, and so forth. Let
$p_v$ be the number of triangles incident with a node $v$. A face of
cardinality at least $5$ is called an {\it exceptional\/} face.
 %
 \indy{Index}{triangle}
 \indy{Index}{exceptional}
 \indy{Index}{quadrilateral}
 \indy{Index}{exceptional!face}
 \indy{Index}{pZ@$p_v$}
\end{definition}

\begin{definition}[type,~$(p,q,r)$]\label{definition:type}
The {\it type\/} of a node is defined to be a triple of
non-negative integers $(p,q,r)$, where $p$ is the number of
triangles containing the node, $q$ is the number of quadrilaterals
containing it, and $r$ is the number of exceptional faces.
%
 \indy{Index}{type (of a node)}
\end{definition}


\subsection{weight assignment}\label{sec:wtassign}

We call the constant $\op{tgt}=1.541$, which arises repeatedly in
this chapter, the {\it target}. 
%
 \indy{Index}{target}\indy{Index}{tgt@$\op{tgt}=1.541$}
 \indy{Greek}{ZZdzeta@$\zeta= 1/(2\arctan(5,\sqrt{2}))$}

\begin{definition}[a]
  Define $a:\ring{N}\to \ring{R}$ by
  $$
  a(n) = \hbox{ if } (n=5) \hbox{ then } 0.63 \hbox{ else } \op{tgt}.
  $$
\end{definition}

\begin{definition}[b]
  Define $b:\ring{N}\times \ring{N}\to \ring{R}$ by $b\pqr{(p,q,0)}=1.541$,
  except for the values in the following table
  (with  $\op{tgt}=1.541$):
  {
  \def\tx{\op{tgt}}
  $$\begin{matrix}  &q=0&1&2&3&4\\
           p=0&\tx&\tx&1.296&0.618&1.0\\
           1&\tx&\tx&0.66&0.618&\tx\\
           2&\tx&0.8&0.412&1.2851&\tx\\
           3&\tx&0.315&0.83&\tx&\tx\\
           4&0.35&0.374&\tx&\tx&\tx\\
           5&0.04&1.144&\tx&\tx&\tx\\
           6&0.689&\tx&\tx&\tx&\tx\\
           7&1.450&\tx&\tx&\tx&\tx
   \end{matrix}
   $$
   }
\end{definition}


\begin{definition}[d]
    Define $d:\ring{N}\to \ring{R}$ by
  $$d(n) = \begin{cases}
    0 & n=3, \\
    0.206 & n=4, \\
    0.483 & n=5, \\
    0.760 & n=6, \\
    1.038 & n=7, \\
    1.315 & n=8,\\
    \op{tgt}=1.541 & \text{otherwise}.
  \end{cases}
  $$
\end{definition}


We write $\card(S)$ for the cardinality of a finite set $S$.\indy{Index}{card}
\indy{Index}{cardinality}


\begin{definition}[weight~assignment]
%
A {\it weight assignment\/} of a hypermap $H$ is a function $w$ on
the set of faces of $H$, taking values in the set of non-negative
real numbers. A weight assignment is {\it admissible} if the
following properties hold:
%
 \indy{Index}{weight assignment}
 \indy{Index}{admissible (weight assignment)}
\begin{enumerate}
  \item If the face $F$ has cardinality $n$, then
        $w(F) \ge d(n)$
  \item If a node $v$ has type $(p,q,0)$, then
        $$\sum_{F:\,v\cap F\ne\emptyset} w(F) \ge b{\pqr{(p,q,0)}}.$$
        \label{admissible:b}
  \item Let $v$ be any node of type $(5,0,1)$, and let $A$ be the set of
triangles meeting that node.
        Then
        $$\sum_{F\in A} w(F)
            \ge  a(5).$$
        \label{definition:admissible:excess}
\end{enumerate}
The sum $\sum_F w(F)$ is called the {\it total weight} of $w$.
\indy{Index}{total weight}
\end{definition}





\subsection{hypermap property}
\label{sec:graphproperty}

We say that a hypermap is {\it tame\/} if it satisfies the following
conditions.
%
 \indy{Index}{tame}

\begin{enumerate}
    \label{definition:tame}
    %1
    \item The hypermap is plain, planar,  connected, and biconnected.
    \item The edge map $e$ has no fixed points.
    \item The two darts of each edge lie in different nodes.
    \item The set of edges meeting any two given nodes has cardinality at most $1$.
    \item There are at least $2$ faces.
    \item There are either $13$ or $14$ vertices.
    \item Every face meets every node in at most one
        dart.
    \label{definition:tame:40}
    \item The cardinality of each face is at least $3$ and at most $8$.
    \label{definition:tame:length}

    \item If $L$ is a contour loop with $3$ face steps, and if there exists a node in
    the exterior of $L$, then $L$ is a face of the hypermap.
    \label{definition:tame:3-circuit}

    \item If $L$ is a contour loop  $4$ face steps, and there are at least two nodes
    in the exterior of $L$, then the interior of $L$ takes one of the forms
    illustrated in Figure
    \ref{fig:fourcircuit}.\FIXX{Make this more precise.}
    \label{definition:tame:4-circuit}
    \begin{figure}[htb]
        \centering
        \myincludegraphics{\ps/tame4circuit.eps}
        \caption{Tame $4$-circuits}
        \label{fig:fourcircuit}
    \end{figure}

    \item The cardinality of every node is at least $2$ and at most
    $7$.
    \label{definition:tame:degree}

    \item If a node is incident with an exceptional face,
        then the cardinality of the node is at most $6$.
    \label{definition:tame:degreeE}
    \item There exists an admissible weight assignment
        of total weight less than the target, $\op{tgt}=1.541$.
    \label{definition:tame:squander}
\end{enumerate}
%

\subsection{tame hypermap classification}
    \label{sec:proof-classification}

%\section{Statement of the Theorem}
\label{sec:classification}

A list of several thousand hypermaps appears at \cite{web}. The
following theorem is listed as one of the central claims in the
proof in Section~\ref{sec:logic}.

\begin{definition}[opposite] The opposite of a hypermap $(D,e,n,f)$ is the
hypermap $(D,f n,n^{-1},f^{-1})$.
\end{definition}

\begin{lemma}\guid{PPHEUFG} If a hypermap has properties\FIXX{Give reference}, 
then so does its opposite.
\end{lemma}

\begin{theorem}
\label{theorem:classification} Every tame hypermap is isomorphic to
a hypermap in this list, or is isomorphic to the opposite of a
hypermap in this list.
\end{theorem}

The results of this section are not needed except in the proof of
Theorem \ref{theorem:classification}.

\smallskip

Computers are used to generate a list of all hypermaps and to check
them against the archive of tame hypermaps.  The computer program is
based on the face-insertion construction of Lemma~\ref{XX}.  There it is
proved that all sufficiently nice hypermaps can be generated by an
elementary face-insertion process.  Tame hypermaps satisfy all the
hypotheses of that lemma.

\section{Contravening hypermap}

Our aim is to prove conjecture~(XX).  For that purpose, we assume that
we have a counterexample to inequality~(XX).  By Lemma~\ref{XX}, we
may assume it 
has $13$ or $14$ terms.  

We may assume that the center point of the packing $\Lambda$
is $\lambda_0=0$.
We attach a fan to the counterexample as follows.  
Let $\vartheta=0$.
Let $V$ be the set of $\lambda\in\Lambda$ such that
$|\lambda|\le 2h_-$.  Thus, the cardinality of $V$ is $13$ or $14$.
For each $v\in V$, let 
\begin{equation}\label{eqn:fan-edge}
 E = \{\{v,w\}\in V^2\mid |v-w|\le 2h_- \}
\end{equation}

\begin{lemma}
$(\vartheta,V,E)$ is a fan.
\end{lemma}

Let $\op{hyp}(\vartheta,V,E)$ be the associated hypermap.

We may assume that we have an extremal counterexample
in the sense that it maximizes the left-hand side of inequality~(\ref{XX}).
We may also assume that the counterexample is chosen among extremal
counterexamples in such a way to minimize the number of connected components
of the hypermap, and among those minimizing the number of connected components a counterexample that minimizes the number of articulation nodes.
(An articulation node is a node of the hypermap that if removed, increases
the number of components of
the hypermap.  That is, it is a node $n$ for which there exist darts $x$ $y$ not at that node, which are connected by a path, and such that every path connecting them passes through the node $n$.)   Fans and hypermaps with these
extremal properties are called {\it contravening fans} and {\it
contravening hypermaps}.

A single vertex $v\in V$ may be moved continuously to decrease $|v|$, hence
increase $L_2(|v|/2)$ unless either $|v|=2$ or it is held in place by at least three other vertices $v_i\in V$ with $|v-v_i|=2$.  Thus, in a contravening fan,  each vertex with $|v|>2$ has degree at least $3$. 

If the hypermap contains at least two components, let $W\subset V$ be the set of vertices of one of the components.  There is an axis $\ell$ such that the orthogonal transformations $T(\theta)$ around axis $\ell$ and small angle $\theta$  have the effect of rotating $W$ in the direction of the vertices of another component, until for some angle $\theta$, the condition~(\ref{eqn:fan-edge}) for
a new edge joining the components is met.  Thus, a contravening hypermap has a single connected component.

Similarly, if there is an articulation vertex $v$, choose the axis $\ell$ of an orthogonal transformation through that vertex.  Let $W\subset (V\setminus\{v\})$
be an component of the hypermap at $v$.  Rotate until
$W$ forms an edge with with another articulation component.  Repeating, we reduce to the case where there are no articulation vertices.  
It follows that a contravening hypermap $H=\op{hyp}(\vartheta,V,E)$ is connected and biconnected.

In the next section, we study further properties of contravening hypermaps $H$.





\section{Contravention is Tame}
    \label{sec:contraproof}

Let $(\Lambda,v_0)$ be a centered packing with
fan $(v_0,V,E)$.  Let  hypermap $H=(D,e,n,f)$
be the planar hypermap attached to $(v_0,V,E)$.
The hypermap $H$ is connected and biconnected.

The connected components of $Y(v_0,V,E)$ are in bijection with
faces of $H$.  
The fan gives a azimuth angle function
$$
\op{azim} : D \to (0,2\pi).
$$
For each face of $H$, the corresponding component $R$
is eventually radial with solid
angle
  $$
  2\pi + \sum_{x\in F} (\op{azim}(x) -\pi).
  $$
We write $\sol(F)$ for the solid angle of the connected component
of $Y(v_0,V,E)$ associated with a face $F$ of the hypermap.
We have
    $$\sum_{F} \sol(F) = 4\pi.$$


For each face, there is a
real number $\tau(F)=\tau(\Lambda,F)$ such that
$$
  \sum_{F : \text{face}}\tau(\Lambda,F)
$$
We define a weight function $w(F)$ on the faces of the hypermap
by $w(F) = \tau(F)$.  In this way, we attach
a pair $(H,w)$ to each contravening centered packing $(\Lambda,v_0)$.


\begin{theorem} \label{theorem:contravene}
Let $(\Lambda,v_0)$ be a contravening centered packing.  Let $(H,w)$ be
the hypermap and function on its faces attached to $(\Lambda,v_0)$ as above.
Then $H$ is a tame hypermap with admissible weight function $w$.
\end{theorem}




\subsection{hypermap property}
    \label{sec:startame}


Recall that we say that a node $v$ has {\it type\/} $(p,q,r)$ if
there are exactly $p+q+r$ faces that meet the node, of which exactly
$p$ triangles and $q$ quadrilateral faces (see
Definition~\ref{definition:type}).  We write $(p_v,q_v,r_v)$ for the
type of a node $v$.

\begin{lemma}\guid{JGTDEBU} The contravening hypermap $H$ satisfies Conditions~\ref{XX}-\ref{XX} 
of tameness.
Explicitly, it is a plain, planar, connected, and biconnected. 
The edge map $e$
has no fixed points. There are at least two faces. Every face meets
every node in at most one dart.  There are never two nodes of type
$(4,0,0)$ that are adjacent to each other.  Every face has
cardinality at least $3$ and at most $8$.  If $L$ is a contour loop
with $3$ face steps, and if there exists a node in the exterior of
$L$, then $L$ is a face of the hypermap.
\end{lemma}

\begin{proof}
It is connected and biconnected by properties of contravening hypermaps.
It is plain and planar by general properties that we have established
about the hypermaps associated with fans.
\end{proof}


\begin{lemma}\guid{SZIPOAS}\dcg{Lemma~21.4}{223} 
Formally contravening hypermaps satisfy Property
\ref{definition:tame:degree} of tameness: The cardinality of every
node is at least $2$ and at most $7$.
\end{lemma}

\begin{proof}  There is no node of cardinality one by
Lemma~\ref{lemma:nondegen}.  There is no node of degree
greater than $7$ by Lemma~\ref{a:6}.
\end{proof}


\subsection{contravening hypermap}





\begin{lemma}\guid{GNCEGFN}\label{lemma:no-2}
Let $(H,\azim,\flat,\sigma)$ be a formally contravening hypermap.
Suppose that $L$ is a contour loop with at most four face steps.
Suppose that there are at least two nodes in the exterior of $L$.
Then there at most one node interior to $L$.
\end{lemma}


\begin{lemma}\guid{CDTETAT} \label{lemma:0.852}
Let $(H,\azim,\flat,\sigma)$ be a formally contravening
hypermap. For every dart $x$,
    $$0.852\le \azim(x)\le 1.9.$$
For every dart $x$ whose face is not a triangle, we have
    $$1.15\le\azim(x)\le 3.27.$$
Consequently, if a vertex $v$ has type $(p,q,0)$, then $(p,q)$
must be one of the following pairs:
$$
\begin{array}{lll}
&(0,2),~(0,3),~(0,4),~(0,5),~(1,2),~(1,3),~(1,4),~(2,1),~(2,2),~(2,3),\\
&(3,1),~(3,2),~(3,3),~(4,0),~(4,1),~(4,2),~(5,0),~(5,1),~(6,0),~(6,1),~(7,0)
\end{array}
$$
\end{lemma}
 %
 \indy{Index}{ZZZZ1.15@$1.15$}
 \indy{Index}{ZZZZ0.852@$0.852$}
\begin{proof}
The angle bounds are a calculation.  The sum of the azimuth angles
around a vertex satisfies:
$$
  p (0.852) + q (1.15) \le 2\pi \le p (1.9) + q (3.27),
$$
and the pairs satisfying these constraints are listed.
\end{proof}



\begin{lemma}\guid{RTOIQJC}\label{lemma:nobad4}
Let $(H,\azim,\flat,\sigma)$ be a formally contravening hypermap.
There does not exist a node of 
type $(1,0,1)$ with precisely one triangle and
one pentagon, as show in Figure~\ref{fig:no4circuit}. 
\end{lemma}

\begin{proof}  The node has degree $2$.  It can be moved closer
to the origin, increasing the objective function, unless the
vertex already has height $2$.  But then geometric considerations
show that such a node does not exist.
\end{proof}




\subsection{linear program} %subsection
\label{sec:2.2}  To continue with the proof that formally
contravening hypermaps are tame, we need to introduce some more
notation and methods.

\begin{lemma}\guid{BDJYFFB} \label{lemma:deg5}
Every formally contravening hypermap satisfies Property
\ref{definition:tame:degreeE} of tameness: If a node meets an
exceptional face, then the cardinality of the node is at most $6$.
\end{lemma}


\subsection{four-circuit}

Every contour loop partitions the faces into the interior and
exterior.  Every contour loop partitions the nodes that do not meet
the loop into exterior and interior nodes.
%
 \indy{Index}{interior node}

Lemma~\ref{lemma:no-2} asserts that either the interior or the
exterior has at most $1$ enclosed vertex.   When choosing which
aggregate is to be called the interior, we may make our choice so
that the interior has area at most $2\pi$, and hence contains at
most $1$ node. With this choice, we have the following lemma.

\begin{lemma}\guid{CHOMXMX}
Let $(H,\azim,\flat,\sigma)$ be a formally contravening hypermap. If
$L$ is a contour loop with $4$ face steps, and there are at least
two nodes in the exterior of $L$, then the interior of $L$ takes one
of the forms illustrated in Figure~\ref{XX} in Property
    \ref{definition:tame:4-circuit} of tameness.
\end{lemma}

\begin{proof}
By Lemma~\ref{XX}, the interior of $L$ contains at most one node.

$H$ is a connected plane planar map.  We form a normal family of
contour loops ${\cal L}$ by taking the contour loop $L^{-1}$
reversing $L$\FIXX{Explain} and all the faces in the interior of $L$.
(Check this is a normal family.)  The quotient $H' = H/{\cal L}$ is
a plane planar map.  There is a further quotient of $H'$ with normal
family $\{L,L^{-1}\}$, which is isomorphic to $P_4$ with the natural
flag coming from $H'$.  The niceness conditions of Lemma~\ref{XX} are
satisfied, so we can recover $H'$ from $P_4$ by a sequence of
face-insertions.  Since the interior of $L$ contains at most one
node, this gives restrictions on the partitions that can be used in
face-insertion.

If there are no enclosed vertices, then the only possibilities are
for it to be a single quadrilateral face or a pair of adjacent
triangles.

Assume there is one enclosed vertex $v$.  If $v$ is connected to $3$
or $4$ nodes of the quadrilateral, then that possibility is listed
as part of the conclusion.

If $v$ is connected to $2$ opposite nodes in the $4$-cycle, then the
node $v$ has type $(0,2,0)$ and the bounds of
Lemma~\ref{lemma:pq} show that the hypermap cannot be formally
contravening.

If $v$ is connected to $2$ adjacent nodes in the $4$-cycle, then we
appeal to Lemma~\ref{lemma:nobad4} to conclude that the hypermap
does not contravene.

If $v$ is connected to $0$ or $1$ nodes, then we appeal to
Lemma~\ref{lemma:enclosed:bis}.  This completes the proof.
\end{proof}

\subsection{weight assignment}
    \label{sec:weight}

The purpose of this section is to prove the existence of a good
admissible weight assignment for formally contravening hypermaps.
This will complete the proof that all formally contravening
hypermaps are tame.

\begin{theorem}  Every formally contravening hypermap has an admissible
weight assignment of total weight less than $\op{tgt}=1.541$.
\end{theorem}

Given a formally contravening hypermap $(H,\azim,\flat,\sigma)$, we
define a weight assignment $w$ by
    $$F \mapsto w(F) = \tau(F).$$
The challenge of the theorem will be to prove that $w$, when
defined by this formula, is admissible.

\subsection{admissibility}
\label{sec:admissibility}

The next three lemmas establish that this definition of $w(F)$ for
formally contravening hypermaps satisfies the first three defining
properties of an admissible weight assignment.

\begin{lemma}\guid{OLNSWLK}  Let $F$ be a face of cardinality $n$ in a formally contravening hypermap.
Define $w(F)$ as above. Then
        $w(F) \ge d(n)$.
\end{lemma}

\begin{proof} This is Lemma~\ref{XX}. %\ref{proposition:wttau}.
\end{proof}

\begin{lemma}\guid{RVFTYCI} Let $v$ be a node of type $(p,q,0)$ in a
formally contravening hypermap.  Define $w(F)$ as above. Then
        $$\sum_{v\in F} w(F) \ge b{\pqr{(p,q,0)}}.$$
\end{lemma}


\begin{proof} This is Lemma~\ref{lemma:pq}.
\end{proof}



The proof that formally contravening hypermaps are tame is complete.




\begin{lemma}\guid{FUJCTEI}\label{lemma:enclosed:bis} % {Lemma 2.2}
A quadrilateral component does not enclose any vertices of height at
most $2t_0$.
\end{lemma}