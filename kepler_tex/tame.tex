% Flyspeck
% Thomas C. Hales
% Starting with Chapter on Tame Hypermaps

% Sep 3, Removed 2 enclosed in quad properties.


\chapter{Tame Hypermap}
\indy{Index}{hypermap!tame}%

\label{sec:tame}
\indy{Index}{tame}%

\begin{summary}
This chapter is the second of the two core chapters that are devoted to the proof of the Kepler Conjecture.  If $V$ is a finite set of vectors in $\ring{R}^3$, let
$$\CalL(V) = \sum_{v\in V} L(\normo{v}/2).$$
Let $\bar B(0,r)$ be the closed ball of radius $r$, and let $\BB$ be the
annulus $\bar B(0,2h_0)\setminus B(0,2)$.
By Corollary~\ref{cor:CE}, it suffices to show that every finite packing $V$
contained in $\BB$
satisfies
\begin{equation}\label{eqn:CCE}
\CalL(V) \le 12.
\end{equation}

This chapter assumes that there exists a counterexample $V$ to this inequality and reaches a contradiction.  A subset of extremal counterexamples will be selected that are particularly well-suited for further analysis.  Every extremal counterexample gives rise to a fan and a corresponding hypermap.  
A detailed study of these hypermaps leads to a long list of properties that all such hypermaps must
possess.   A {\it tame} hypermap is defined to be precisely the set of hypermaps that have all of these
properties.   Tameness is thus an umbrella term that covers a long list of loosely related properties.

An earlier chapter on hypermaps gives an algorithm that generates all restricted hypermaps (with a given bound on the number of nodes).   Every tame hypermap is restricted and has at most $14$ nodes.  Hence a list of all tame hypermaps can be obtained by generating all restricted hypermaps and filtering out those that are not tame.   This algorithm has been implemented in computer code and run.  The result is that there is an explicit complete list of all tame hypermaps (up to isomorphism).  
This list gives the classification of tame hypermaps up to isomorphism.   This classification solves a
major step of the packing problem.

Each tame hypermap $H$ gives rise to a nonlinear optimization problem.   Maximize $\CalL(V)$ subject to the constraint that the hypermap associated with  $V$ 
is isomorphic to $H$.  This nonlinear optimization problem has a linear relaxation.  This linear program has
a maximum that is at least as large as the maximum of the nonlinear program.  The linear programs
have been solved by computer.  In every case, the maximum is less than $12$.  This means
that inequality~\ref{eqn:CCE} always holds, so that the Kepler Conjecture is confirmed.
\end{summary}
\indy{Index}{hypermap!tame}%
\indy{Index}{tame!hypermap}%



\section{Definition}


\begin{definition}[triangle,~quadrilateral]
Faces of cardinality $3$ in a hypermap are called {\it triangles}, those of
cardinality $4$ are called {\it quadrilaterals}, and so forth.  
 %
 \indy{Index}{triangle}%
 \indy{Index}{quadrilateral}%
 \indy{Notation}{pZ@$p_v$}%
\end{definition}

\begin{definition}[type,~$(p,q,r)$]\label{definition:type}
The {\it type\/} of a node is defined to be a triple of
non-negative integers $(p,q,r)$, where $p$ is the number of
triangles meeting the node, $q$ is the number of quadrilaterals
meeting it, and $r$ is the number of other faces meeting it, so that
$p+q+r$ is the total number of faces meeting the node.
%
 \indy{Index}{node!type}%
\indy{Notation}{pqr@$(p,q,r)$}%
\end{definition}


\subsection{weight assignment}\label{sec:wtassign}
\indy{Index}{weight assignment}%

Call the constant $\op{tgt}=1.541$, which arises repeatedly in
this chapter, the {\it target}. 
%
 \indy{Index}{target}%
\indy{Notation}{tgt@$\op{tgt}=1.541$}%


\begin{definition}[b]
  Define $b:\ring{N}\times \ring{N}\to \ring{R}$ by $b(p,q)=\op{tgt}$,
  except for the values in the following table:
  {
  \def\tx{\op{tgt}}
  $$\begin{matrix}  &q=0&1&2&3&4\\
           p=0&\tx&\tx&\tx&0.618&1.0\\
           1&\tx&\tx&0.66&0.618&\tx\\
           2&\tx&0.8&0.412&1.2851&\tx\\
           3&\tx&0.315&0.83&\tx&\tx\\
           4&0.35&0.374&\tx&\tx&\tx\\
           5&0.04&1.144&\tx&\tx&\tx\\
           6&0.689&\tx&\tx&\tx&\tx\\
           7&1.450&\tx&\tx&\tx&\tx
   \end{matrix}
   $$
   }
\indy{Notation}{b@$b$ (tame)}%
\end{definition}


\begin{definition}[d]
    Define $d:\ring{N}\to \ring{R}$ by
  $$d(k) = \begin{cases}
    0 & k\le3, \\
    0.206 & k=4, \\
    0.4819 & k=5, \\
    0.7578 & k=6, \\
    %1.038 & k=7, \\
    %1.315 & k=8,\\
    \op{tgt}=1.541 & \text{otherwise}.
  \end{cases}
  $$
\indy{Notation}{d@$d$ (tame)}%
\end{definition}




\begin{definition}[weight~assignment]
%
A {\it weight assignment\/} of a hypermap $H$ is a real-valued function $\tau$ on
the set of faces of $H$. A weight assignment is {\it admissible} if the
following properties hold:
%
 \indy{Index}{weight assignment}%
 \indy{Index}{weight assignment!admissible}%
 \indy{Index}{cardinality}%
 \indy{Index}{node}%
 \indy{Notation}{ZZtau@$\tau$ (weight assignment)}%
\begin{nomerate}
 \item \case{bound~a} Let $v$ be any node of type $(5,0,1)$, and let $A$ be the set of
triangles meeting that node.
        Then
        $$\sum_{F\in A} \tau(F)
            \ge  0.63.$$
%   where $a=0.63$.
%        \label{definition:admissible:excess}
 \item \case{bound~b} If a node $v$ has type $(p,q,0)$, then
        $$\sum_{F:\,v\cap F\ne\emptyset} \tau(F) \ge b(p,q).$$
%        \label{admissible:b}
  \item \case{bound~d} If the face $F$ has cardinality $k$, then
        $\tau(F) \ge d(k)$.
\end{nomerate}
\indy{Notation}{v@$v$ (node)}%
\indy{Notation}{A@$A$ (set of triangles)}%

The sum $\sum_F \tau(F)$ (over all faces) is called the {\it total weight}. % of $\tau$.
\indy{Index}{weight!total}%
%\indy{Notation}{total@$\sum\tau$}%
\end{definition}





\subsection{hypermap property}
\label{sec:graphproperty}

A hypermap is {\it tame\/} if it satisfies the following conditions.
%
 \indy{Index}{tame}%

\begin{itemize}
    \label{definition:tame}
    %1
    \item \case{planar}  The hypermap is plain and planar.
    \item \case{simple} The hypermap is connected and simple.  In particular, every intersection of a face with a node contains at most one dart.
    \item \case{nondegenerate} The edge map $e$ has no fixed points.
    \item \case{no loops} The two darts of each edge lie in different nodes.
    \item \case{no double joins} At most one edge meets any two given nodes.
%    \label{definition:tame:40}
%    \item \case{blank}
\indy{Notation}{edgemapz@$e$ (edge map)}%
%    \item \case{triangles} If $L$ is a contour loop with three face steps, and if there exists a node in
%    the exterior of $L$, then $L$ is a face of the hypermap.
%    \label{definition:tame:3-circuit}
%\item \case{blank}
 %   \item \case{quadrilaterals} If $L$ is a contour loop with four face steps, and there are at least two nodes    in the exterior of $L$, then the interior of $L$ takes one of the forms     illustrated in Figure
 %   \ref{fig:fourcircuit}.
 %   \label{definition:tame:4-circuit}
  %  \begin{figure}[htb]
  %      \centering
  %      \myincludegraphics{\pdfp/fourcircuit.eps}
  %      \caption{Tame $4$-circuits}
  %      \label{fig:fourcircuit}
  %  \end{figure}
  \item \case{face count} The hypermap has at least three faces.
    \item \case{face size} The cardinality of each face is at least $3$ and at most $6$.
    \item \case{node count} There are either $13$ or $14$ nodes.
    \item \case{node size} The cardinality of every node is at least $3$ and at most
    $7$.
  %    \label{definition:tame:degree}
    \item \case{node types} If a node has cardinality $7$, then the type of the
       node is $(p,q,0)$ for some $p,q\ge0$.   If the
        cardinality of the node is exactly $6$, then the type of the node
        is $(5,0,1)$.
%    \label{definition:tame:degreeE}
    \item \case{weights} There exists an admissible weight assignment
        of total weight less than the target, $\op{tgt}=1.541$.
\end{itemize}
%
\indy{Index}{planar}%
\indy{Index}{simple}%
\indy{Index}{nondegenerate}%
\indy{Index}{no loops}%
\indy{Index}{no double joins}%
\indy{Index}{face}%
\indy{Index}{weight}%

\section{Classification}
    \label{sec:proof-classification}

%\section{Statement of the Theorem}
\label{sec:classification}




\begin{definition}[opposite] The opposite of a hypermap $(D,e,n,f)$ is the
hypermap $(D,f n,n^{-1},f^{-1})$.
\indy{Index}{hypermap!opposite}%
\end{definition}

\begin{lemma}\guid{PPHEUFG}
\oldrating{300}
\rating{0}
\formalauthor{Diep Trieu Thi} 
A hypermap is tame if and only if its opposite hypermap is tame as well.
\end{lemma}

A list of hypermaps appears at \cite{website:Hales:1998:Code}.

\begin{theorem}\guid{WTEMDTA}
\label{theorem:classification} Every tame hypermap is isomorphic to
a hypermap in the list~\cite{website:Hales:1998:Code}, or is isomorphic to the opposite of a
hypermap in the list.
\indy{Index}{isomorphic}%
\end{theorem}

\begin{note}%XX
The (java version of the) graph generator has been run with the new parameters described in this version of the book.  It produces finitely many graphs (about 25,000).  This new list will eventually replace the archive from 1998.  The Bauer-Nipkow formalization of the classification has not yet been adapted to this new definition of tameness.
\indy{Index}{Java}%
\end{note}


Computers are used to generate a list of all hypermaps and to check
them against the archive of tame hypermaps.  The computer program is
based on the hypermap generation construction of Section~\ref{sec:face-insert}.  According
to the results of that section, every restricted hypermap can be generated by an
elementary edge-insertion algorithm.  Every tame hypermap is a restricted hypermap.
The list of restricted hypermaps can be filtered to obtain a complete list of tame hypermaps.
\indy{Index}{computer calculation}%

\section{Contravening hypermap}

\indy{Index}{hypermap!contravening}%
%The aim is to prove Conjecture~\ref{conj:L12}.  For a contradiction, assume a counterexample. 
A counterexample to the Kepler conjecture leads to a finite packing $V\subset \BB$ that violates the inequality~(\ref{eqn:CCE}).
 The purpose of this section is to select a special class of counterexamples to this inequality.
Let
\begin{equation}\label{eqn:fan-edge}
\begin{array}{lll}
 E_{std} &= \{\{v,w\}\in V^2\mid 0 < \norm{v}{w}\le 2\hm \}\\
 E_{ctc} &= \{\{v,w\}\in V^2\mid \norm{v}{w}= 2 \}\subset E_{std}.
\end{array}
\end{equation}

\begin{lemma}\guid{UBHDEUU}\rating{140}
$(V,E)$ is a fan, if $E=E_{std}$ or $E=E_{ctc}$.
\end{lemma}
$(V,E_{std})$ and $(V,E_{ctc})$ are called the standard fan and contact fan, respectively.
Let $\op{hyp}(V,E)$ be the associated hypermap.
\indy{Index}{fan!standard}%
\indy{Index}{fan!contact}%
\indy{Notation}{V@$V$ (packing)}%
\indy{Notation}{V@$( V, E ) $ (fan)}%
\indy{Notation}{hyp@$\op{hyp}$ (hypermap)}%
\indy{Notation}{E@$E_{std}$}%
\indy{Notation}{E@$E_{ctc}$}%

\begin{definition}[isolated,~surrounded]
Let $(V,E)$ be a fan.
Say that $v\in V$ is {\it isolated} in the fan if $E(v)$ is empty.
(That is, the degree of the corresponding node in the hypermap is $0$.) Say that $v\in V$ is {\it surrounded} in the fan if the azimuth angles of all darts at the node $v$ are less than $\pi$.  (In particular, the cardinality of $E(v)$ is at least three.)
\end{definition}
\indy{Index}{isolated}%
\indy{Index}{surrounded}%
\indy{Index}{angle!azimuth}%
\indy{Index}{azimuth}%
\indy{Index}{cardinality}%
\indy{Notation}{E@$E(v)$ (fan)}%

The following lemma appears in Sch\"utte and van der Waerden~\cite{vanderWaerden:1951}.

\begin{lemma}\guid{FATUGPD}\rating{200}
Given any packing $V\subset \BB$,
there exists a  packing $V'$ 
in bijective correspondence with $V$:
$$
\phi:V\to V'
$$
such that $\normo{v} = \normo{\phi(v)}$ and
such that every vertex $v'$ in the contact fan of $V'$
is either isolated or surrounded.
\end{lemma}
\indy{Index}{packing!finite}%
\indy{Index}{fan!contact}%
\indy{Notation}{V@$V'$ (packing)}%

\begin{proof} Consider all finite packings in 
bijective correspondence with $V$, such that the
bijection preserves distances of points from the origin.
Among these packings, pick one $V'$ with the largest number
of isolated points in the contact graph.  If there is a point $v\in V'$ that
is not isolated and not surrounded, then it has a contact
dart with angle at least $\pi$.   Perturb $v$ away from the contacts, making it isolated, while preserving its distance to $\orz$.  The perturbed packing $V''$ has one more isolated point than $V'$, which is contrary to the supposed maximality of $V'$.  Hence, the conclusion of the 
lemma holds for $V'$.
\end{proof}

The following lemma shows that the corresponding result
holds for the standard fan.  Reader beware!  The set of isolated and surrounded vertices depends on a 
choice of fan.  The next proof makes heavy use of two different fans $(V,E_{std})$ and $(V,E_{ctc})$,
which have different sets of isolated and surrounded vertices, even though the set $V$ is
the same in both cases.



\begin{lemma}\guid{FJLBXS}\rating{1000}\label{lemma:surrounded}  % was rating{500}.
Given any packing $V\subset \BB$,
there exists a  packing $V'$ 
in bijective correspondence with $V$:
$$
\phi:V\to V'
$$
such that $\normo{v} = \normo{\phi(v)}$ and
such that every vertex $v'$ in the standard fan of $V'$
is isolated or surrounded.
\indy{Index}{packing!finite}%
\end{lemma}

\begin{proof}  For any packing $V'\subset \BB$, let $V'_{iso},V'_{sur}$ be the
sets of isolated and surrounded vertices of $V'$ respectively, in the {\bf contact}
fan.  
By the previous lemma,  assume
without generality that every vertex $v$ in the contact fan of $V$ is either isolated
or surrounded:
$$
V = V_{iso} \cup V_{sur}.
$$
Consider the set $\CalV$ of pairs $(V',\phi)$ consisting of a packing $V'$
and bijection $\phi:V\to V'$ such that
\begin{itemize}
\item $\phi$ preserves distances from the origin, 
\item $V_{sur}=V'_{sur}$, and 
\item the restriction of $\phi$ to $V_{sur}$ is the identity map $I$.
\end{itemize}
\indy{Notation}{V@$\CalV$ (family of packings)}%%
\indy{Notation}{V@$V_{iso}$ (contact isolated vertices)}%%
\indy{Notation}{V@$V_{sur}$ (contact surrounded vertices)}%%
\indy{Notation}{I@$I$ (identity map)}%

\claim{The set $\CalV$ is a nonempty compact topological space.}  Indeed, by fixing an enumeration
$V = \{v_0,\ldots,v_r\}$,  
the set $\CalV$ embeds into Euclidean space of dimension $3r$ under the map that sends
the pair $(V',\phi)$ to 
the point $(\phi^{-1}v_0,\ldots,\phi^{-1}v_r)$.
Thus, $\CalV$ carries a metric space topology as a subset of Euclidean space.  With a little
argument, it follows from the boundedness of $V\subset B(0,2\hm)$ that $\CalV$ is compact.
Also, $(V,I)\in \CalV$, so $\CalV\ne\emptyset$.


For any pair $(V',\phi)$ in $\CalV$ and $w\in \phi(V_{iso})$, let
$c(V',\phi,w)$, 
be the minimum distance of $w$ to a point
in $V'\setminus \{w\}$.   
For $i=1,\ldots,n=\card(V_{iso})$
define constants $c_i=c_i(V',\phi)$,
by ordering the real numbers $c(V',\phi,w)$, $w\in\phi(V_{iso})$, in increasing order:
$$
c_0 \le c_1 \le c_2 \le \cdots \le c_n.
$$
The constants $c_i:\CalV\to\ring{R}$ are continuous functions on the compact configuration space $\CalV$.
There is a nonempty 
compact subset $\CalV_0$ of $\CalV$ on which
$c_0$ attains its maximum value. Continuing recursively,
there is a nonempty compact subset $\CalV_{i+1}$ of
$\CalV_{i}$ on which $c_i$ attains its maximum value.
\indy{Notation}{c i@$c_i$ (constant)}%
\indy{Notation}{V@$\CalV_0$}%

For the configuration $(V,I)\in \CalV$, it follows that $c_0(V,I) >2$.
Hence, $c_0(V',\phi)>2$ for $(V',\phi)\in\CalV_0$.  It follows
that $V'_{iso}$ is in bijective correspondence with
$V_{iso}$, for all $(V',\phi)\in \CalV$.

\claim{Any $(V',\phi)\in \CalV_n$ has the desired property.} Otherwise,
there exists some vertex $v'\in V'_{iso}$ (in contact isolation)
is neither isolated nor surrounded in the standard fan.  
Any such vertex satisfies $c(V',\phi,\phi(v'))=c_i(V',\phi)$ for some $i$.
Among such vertices, pick the vertex with smallest index
$i$.  Write 
$$
c(V',\phi,\phi(v')) = c_i(V',\phi) = c_{i+1}(V',\phi) =\cdots= c_j(V',\phi) < c_{j+1}(V',\phi),
$$
for some $j\ge i$.  As $v'$ is not isolated in the
standard fan, it follows that $c_j(v') < 2\hm$.  As $v'$ is not surrounded in the standard fan,
in the cyclic order on
$$
\{(v',w')\in V'^2 \mid \norm{v'}{w'} = c_j(v')\},
$$
some azimuth angle is at least $\pi$.
Thus, there is a direction in which $v'$ can be perturbed
that increases $c_j$, while keeping $c_0,\ldots,c_{j-1}$
fixed.  This is contrary to the defining property of
$\CalV_n\subset\CalV_j$.  This establishes the claim.
\indy{Notation}{v@$v$ (vertex)}%
\end{proof}



\begin{lemma}\guid{FCDJDOT}\rating{100}\label{lemma:CE} 
Assume that there exists a counterexample to inequality~\ref{eqn:CCE}.  Then there also exists a counterexample $V$ with the following properties.
\begin{itemize}
\item $V\subset \BB$
\item $\CalL(V) > 12$, and no finite packing in $\BB$ attains a value larger than $\CalL(V)$.
\item The cardinality of $V$ is $13$ or $14$.
\item Every vertex $v$ is surrounded in the standard fan $(V,E_{std})$.
\item Every vertex $v$ that is not surrounded in the contact
fan $(V,E_{ctc})$ satisfies $\normo{v}=2$.
\end{itemize}
\end{lemma}

\begin{proof}  Assume that a counterexample exists.
The set of counterexamples $V\subset\BB$ is a compact set.  The function $\CalL$ is a continuous function on this compact set.  Hence, there exists $V$ that maximizes $\CalL(V)$.

The set $V$ has cardinality $13$ or $14$ (Lemma~\ref{lemma:13-14}). Lemma~\ref{lemma:surrounded} gives the existence of a counterexample $V$ in which every vertex is surrounded or isolated in the standard fan.  By Lemma~\ref{lemma:D'}, if there are any isolated verices in the standard fan, then it is not a counterexample.  Hence, in fact every vertex is surrounded in the standard fan.  

\claim{A vertex $v$ that is not surrounded in the contact fan satisfies $\normo{v}=2$.}  Otherwise, the counterexample does not maximize $\CalL$.
\indy{Notation}{V@$V$ (set of vertices)}%
\end{proof}


\begin{definition}[contravening]
A finite packing is $V$ a {\it contravening} packing if it satisfies the properties
of Lemma~\ref{lemma:CE}.  The fan $(V,E_{std})$ and the hypermap $\op{hyp}(V,E_{std})$ are said
to be {\it contravening} when $V$ is contravening.
\indy{Index}{packing!centered contravening}%
\indy{Index}{hypermap!contravening}%
\end{definition}



The next section studies further properties of contravening hypermaps $H$.



\section{Contravention is Tame}
\indy{Index}{tame!contravention}%
    \label{sec:contraproof}

Let $V$ be a centered packing with
standard fan $(V,E)$ and hypermap $H=\op{hyp}(V,E)=(D,e,n,f)$
be the hypermap attached to $(V,E)$.
The hypermap $H$ is plain, planar, connected, and simple.
The set of topological components of $Y(V,E)$ is in bijection with
the set of faces of $H$.  
\indy{Notation}{H@$H$ (hypermap)}%
For each face of $H$, the corresponding component $U_F$
is eventually radial with solid
angle
\indy{Notation}{U@$U_F$ (component)}%
  $$
  \sol(U_F) = 2\pi + \sum_{x\in F} (\op{azim}(x) -\pi).
  $$
Recall that
    $$\sum_{F} \sol(U_F) = 4\pi.$$
Recall the a map $v:D\to V$ that maps each dart to its vertex:
$$
v \mapsto v(x); \quad   x = (v(x),\ldots).
$$
Set 
$$h(x) = \normo{v(x)}/2.$$
Define the weight function
\begin{equation}
\begin{array}{lll}
\tau(V,E,F) &=\sum_{x\in F} \op{azim}(x)\left(1 + \dfrac{\sol_0}{\pi}(1- L(h(x)))\right) + \left(\pi+{\sol_0}\right) (2- k(F))\vspace{6pt}\\
  &= \sol(U_F) + (2- k(F))\sol_0 - \dfrac{\sol_0}{\pi}\sum_{x\in F}\op{azim}(x) (L(h(x)) - 1)\vspace{6pt}\\
&= \sol(U_F) \left( 1 + \dfrac{\sol_0}{\pi}\right) - \dfrac{\sol_0}{\pi} \sum_{x\in F} \op{azim}(x)(L(h(x))),\\
\end{array}
\end{equation}
where $\sol_0$ is the solid angle of a spherical equilateral triangle of side $\pi/3$, and $k(F)$ is the cardinality of $F$.
% 
These formulas are equivalent.  The proof of equivalence rests on the Euler formula for planar hypermaps and the solid angle formula for topological components $U_F$.
The first expression for $\tau(V,E,F)$ is particularly convenient, because it expresses $\tau$ as a sum of local contributions from each dart.
\indy{Notation}{L@$L$}%
\indy{Notation}{ZZtau@$\tau$}%
\indy{Notation}{ZZDeltanaught@$\sol_0$}%
The main conjecture may be expressed in the following alternative form:

\begin{lemma}\guid{HRXEFDM}\rating{80}
$$
\sum \tau (V,E,F) \ge 4\pi - 20\sol_0
$$
if and only if
$$
\sum L(h(x)) \le 12.
$$
\end{lemma}

\begin{proof}
The solid angles over the sphere sum to $4\pi$ and the azimuth angles at each vertex sum to $2\pi$. 
% The Euler relation for connected plain planar hypermaps gives
%$$
%\sum_F (2- k(F)) = 2\#f - 2\#e = 4 - 2\#n.
%$$
Thus,
\begin{equation}\label{eqn:delta0}
\begin{array}{lll}
\sum \tau (V,E,F) 
&= 4\pi (1 + \dfrac{\sol_0}{\pi}) - (\dfrac{\sol_0}{\pi}) 2\pi \sum_{V} L(h)\vspace{6pt}\\

&= (4\pi - 20\sol_0) + 2\sol_0 (12 - \sum_V L(h(v,\orz))).
\end{array}
\end{equation}
The result follows.
\end{proof}

The significance of the constant $\op{tgt}$ is that it is approximately equal to $4\pi - 20\sol_0$.
\indy{Notation}{tgt@$\op{tgt}=1.541$}%
The following theorem is one of the main results of this chapter.  The proof has been broken into
a series of steps in the sections that follow.

\begin{theorem}\guid{MQMSMAB} \label{theorem:contravene}
Let $V$ be a contravening  packing.  Then the weight assignment $\tau=\tau(V,E_{std},\cdot)$ on
$H=\op{hyp}(V,E_{std})$ is admissible.  Moreover, 
the hypermap $H$ is tame with weight assignment $\tau$.
\end{theorem}
\indy{Notation}{H@$(H, \tau)$}%
\indy{Notation}{H@$H$ (hypermap)}%
\indy{Notation}{ZZtau@$\tau$ (weight)}%



\subsection{general properties}
    \label{sec:startame}


Many of the properties of tameness are trivial or have been established in earlier sections.
The following lemma quickly disposes of many of the properties of tameness.

\begin{lemma}\guid{JGTDEBU}\rating{100}\label{lemma:multi} %100=without (vi), %(deprecated: 300=with (vi))
A contravening hypermap $H$ satisfies Properties
\case{planar}, \case{simple}, \case{nondegenerate}, \case{no loops}, \case{no double joins}, \case{face count}, 
\case{node count}, and the first part of \case{node size}
%~(i)--(v),  % was (i)-(vi).
%(viii),  (x), and the first part of (xi).
of tameness.
\end{lemma}

\begin{proof}
The hypermap is plain, planar, connected, and simple by the general results established in the chapter on fan.  That chapter also shows that the hypermap attached to a fan satisfies properties \case{nondegenerate}, \case{no loops}, and \case{no double joins}.

%The property~(vi) is established in \cite[Lemma~3.7]{sp1}.
\claim{Properties~\case{face count} and the first half of property~\case{node size} hold}.  Indeed, every vertex is surrounded, meaning that the azimuth angles of the darts at the vertex are less than $\pi$.  As the angles around the vertex sum to $2\pi$, there are at least three darts in the node. Each of the darts in the node leads into a different face by property~\case{simple}.

%% 13 or 14 nodes.
Finally, property~\case{node count} has already been established in Lemma~\ref{lemma:CE}.
\end{proof}

There remain properties \case{face size} (Lemma~\ref{lemma:face-size}), %(vii), (ix), the second part of (xi), (xii), and (xiii).
\case{node types} (Lemma~\ref{lemma:degE}),  \case{weights bound a} (Lemma~\ref{lemma:degE}), \case{weights bound b} (Lemma~\ref{lemma:weightB}), \case{weights bound d} (Lemma~\ref{lemma:main}), 
and the second part of \case{node size} (Lemma~\ref{lemma:node-upper}).


\subsection{properties of nodes}
\indy{Index}{node!properties}%



\begin{lemma}\guid{CDTETAT}\rating{140} \label{lemma:0.852}
Let $H$ be a contravening
hypermap. For every dart $x$ in a triangular face of $H$,
    $$0.852\le \azim(x)\le 1.9.$$
For every dart $x$ in a nontriangular face of $H$, 
    $$1.15\le\azim(x)\le 3.27.$$
\indy{Notation}{H@$H$ (hypermap)}%
\indy{Notation}{x@$x$ (dart)}%
\indy{Notation}{v@$v$ (vertex)}%
Consequently, if a vertex $v$ has type $(p,q,0)$, then $(p,q)$
must be one of the following pairs:
$$
\begin{array}{lll}
&(0,2),~(0,3),~(0,4),~(0,5),~(1,2),~(1,3),~(1,4),~(2,1),~(2,2),~(2,3),\\
&(3,1),~(3,2),~(3,3),~(4,0),~(4,1),~(4,2),~(5,0),~(5,1),~(6,0),~(6,1),~(7,0)
\end{array}
$$
\end{lemma}
 %
 
\begin{proof}
The angle bounds are a calculation.  The sum of the azimuth angles
around a vertex satisfies:
$$
  p (0.852) + q (1.15) \le 2\pi \le p (1.9) + q (3.27),
$$
and the pairs satisfying these constraints are listed.
\end{proof}

\begin{lemma}\guid{SZIPOAS}\oldrating{80}\label{lemma:node-upper}
\rating{0}
\formalauthor{Vu Thanh}
%dcg{Lemma~21.4}{223} 
Contravening hypermaps satisfy the second part of property \case{node size}
%\ref{definition:tame:degree} 
of tameness.  That is, the cardinality of every
node is at most $7$.
\end{lemma}

\begin{proof}  The azimuth angle bound
$$
 (p+q+r) 0.852 \le 2\pi
$$
implies $p+q+r < 8$.
\end{proof}




\begin{lemma}\guid{KCBLRQC}\rating{300} \label{lemma:weightB}
Let $v$ be a node of type $(p,q,0)$ in a contravening hypermap.    Then the property~\case{bound b} of a admissible weight assignment holds:
$$
\sum_{ F\cap v\ne \emptyset} \tau(V,E,F) \ge  b(p,q).
$$
\end{lemma}
\indy{Notation}{A@$A$ (faces)}%
\indy{Notation}{v@$v$ (node)}%
\indy{Notation}{pqr@$(p,q,r)$}%

\begin{proof} Let $A =\{F\mid F\cap v\ne\emptyset\}$.  The archive \cite[FUSDSPJ]{hales:2009:nonlinear} contains a list of nonlinear inequalities
for $\tau(V,E,F)$ when $F$ is a triangle or quadrilateral. Each nonlinear inequality has the form
\indy{Notation}{F@$F$ (polygon)}%
$$\tau(V,E,F) \ge a~\op{azim}(x) + b,$$
for some $a,b\in\ring{R}$, where $x$ is the uniquely determined dart at the node $v$ in the face $F$.  These nonlinear inequalities admit a linear relaxation as follows.  For each $a,b$,  write a corresponding linear inequality
\indy{Notation}{ZZtau@$\tau$}%
\indy{Notation}{x@$x$ (dart)}%
\indy{Notation}{v@$v$ (node)}%
$$
t(F) \ge a~z(F) + b,
$$
where $t(F)$ and $z(F)$ are variables indexed by $F\in A$.
\indy{Notation}{A@$A$ (index set)}%
\indy{Notation}{t@$t$ (variable)}%
\indy{Notation}{z@$z$ (variable)}%
Then  minimize 
$$\sum_{F\in A} t(F)$$
subject to these linear inequalities and the constraint
$$
2\pi = \sum_{F\in A} z(F).
$$
This linear program has been executed on a computer for each of the types $(p,q,0)$ of Lemma~\ref{lemma:0.852}. The given constants are obtained from the (downward rounded) solutions to these linear programs.
\end{proof}

\begin{lemma}\guid{BDJYFFB}\rating{200}\label{lemma:degE}
Every contravening hypermap satisfies Properties \case{node types} and \case{weight bound A}
%\ref{definition:tame:degreeE} 
of tameness: 
If a node has cardinality $7$, then the type of the
       node is $(p,q,0)$ for some $p,q\ge0$.   If the
        cardinality of the node is exactly $6$, then the type of the node
        is $(5,0,1)$.
If the type is $(5,0,1)$, let $A$ be the set of five triangles at the
node $v$.  Then
\indy{Notation}{A@$A$ (set of triangles)}%
\indy{Notation}{v@$v$ (node)}%
$$
\sum_{F\in A} \tau(V,E,F) > a,
$$
where $a=0.63$.
\end{lemma}



\begin{proof} These conclusions also come from linear programming.
The same set of nonlinear inequalities is used, and the linear
relaxation is constructed in the same way.  The linear programming
bounds exceed the constant $\op{tgt}$ in the cases excluded in the conclusion
of the lemma.  The constant $a$ is the downward rounding of the solution to the linear program for $(5,0,1)$.
\end{proof}
\indy{Notation}{tgt@$\op{tgt}=1.541$}%

\indy{Notation}{a@$a$ (constant)}%

\subsection{faces}



\begin{lemma}\guid{CRTTXAT}\rating{140}  \label{lemma:face-size}
Property~\case{face size} holds.  That is,
Every face of a contravening hypermap $\op{hyp}(V,E_{std})$ has cardinality at least $3$ and at most $6$.
\end{lemma}

\begin{proof} The lower bound holds because the hypermap has no loops or double joins.  For a contradiction, let $F$ be a face of the hypermap of cardinality at least $7$.  Divide the proof into cases depending on whether the
following inequality holds:
$$
\sum _{x\in F} (\normo{v(x)}-2) \ge 4(\hm-1).
$$
If the inequality holds, then since $L$ is the linear interpolation between the points $(1,1)$ and $(\hm,0)$, and there are at most $14$ points in $V$, it follows that
$$\sum_{v\in V}L(\normo{v}/2) \le 12 L(1) + 2 L(\hm) =12,$$
and the main inequality holds.

Now assume that the inequality is false.
The edge $\{v,w\}$ has arclength at least
$$
\arc(\normo{v},\normo{w},\norm{v}{w}) \ge \arc(\normo{v},\normo{w},2). 
$$

A calculation~\cite[cc:arc]{hales:2009:nonlinear} gives
$$\arc(\normo{v},\normo{w},2)\ge 1 - 0.6076 (\normo{w}/2 - 1) - 0.6076 (\normo{v}/2 - 1).$$ %%CC:arc
The sum over a face of size at least $7$ gives
$$
\begin{array}{lll}
\sum \arc(\normo{v_i},\normo{v_{i+1}},\norm{v_i}{v_{i+1}})&\ge
7 - 0.6076 \sum (\normo{v_i}-2) \\
   &\ge 7 - 0.6076 (2) (0.52) \\
   &> 2\pi.
\end{array}
$$
The left-hand side is the perimeter of the localization of $(V,E)$ along $F$.
This perimeter estimate is contrary to the upper bound on perimeter in Lemma~\ref{lemma:convex-hyp}.
\end{proof}

\begin{lemma}\guid{GBMLQWW}\rating{ZZ}  Let $V$ be a contravening packing with
standard fan $(V,E_{std})$.  Let $F$ be any face of $\op{hyp}(V,E_{std})$.  Then
$$
\tau(V,E_{std},F) = \tau(V',E',F),
$$
where $(V',E',F)$ is the localization of $(V,E_{std})$ along the face $F$.
\end{lemma}

\begin{proof}  The value $\tau(V,E,F)$ is expressed entirely in terms of $\normo{v}$ for $v\in V'\subset V$ and in terms of $\op{azim}(x)$, for $x\in F$.  By Lemma~\ref{lemma:localization}, the terms $\op{azim}(x)$ are the same, whether calculated in terms of the hypermap of $(V,E_{std})$ or in terms of that of $(V',E')$. 
\end{proof}


\section{Main Estimate}\label{sec:weight}  


The main result of this section is the following:

%\begin{theorem}\guid{THPJDQA}\rating{0}  %points for OLNSWLK below.
%The weight assignment $\tau$ on a contravening hypermap is admissible, and the  total weight of $\tau$ is less than $\op{tgt}=1.541$.
%\indy{Index}{weight assignment}%
%\end{theorem}
%\indy{Notation}{tgt@$\op{tgt}=1.541$}%
%\subsection{admissibility}
%\label{sec:admissibility}





\begin{lemma}\guid{OLNSWLK}\rating{3000}\label{lemma:main} %including lemmas that lead up to it.  Interval ineq may be assumed.  
Property~\case{weight bound d} holds.  That is,
let $V$ be a contravening packing, and  let $F$ be a
face of $\op{hyp}(V,E_{std})$ of cardinality $k$.  Then
        $\tau(V,E_{std},F) \ge d(k)$.
\end{lemma}
\indy{Notation}{F@$F$ (face)}%
\indy{Notation}{k@$k$ (cardinality)}%

\begin{remark}
In preparation for the proof, 
it is helpful to keep in mind the origin of the constants $d(k)$.
Although the proof of Lemma~\ref{lemma:main} does not produce sharp lower bounds on $\tau(V,E,F)$, the
statement of the lemma is motivated by the following configurations.
Consider a nonplanar polygon contained in a sphere of radius $2$, with $k$ sides all of length $y_{i,i+1}=2$, heights
$y_i=2$, and $k-3$ diagonals of length $2\hm$: $y_{0,j}=2\hm$, for
$j=2,\ldots,k-2$.  Let $V$ be the set of vertices of the polygon, let $(V,E_{ctc})$ be its contact fan, and let $F$ be the face of $\op{hyp}(V,E_{ctc})$ representing the ``interior'' of the polygon.  Evaluating $\tau$ on these rigid configurations gives
$$
\tau(V,E_{ctc},F) = \begin{cases}
0.20612\ldots & k=4\\
0.48356\ldots & k=5\\
0.760993\ldots &k=6
\end{cases}
$$
These calculations suggested the values of constants $d(k)$.  The constants $d(k)$ are slightly smaller than these calculated values.\footnote{Note $\tau(2.1028,2,2,2,2.52,2.52) = 0.275951\ldots < 0.277433\ldots = \tau(2,2,2,2,2.52,2.52)$.}
\indy{Notation}{d@$d$ ($\tau$ bound)}%
\indy{Notation}{ZZtau@$\tau$}%
\indy{Notation}{k@$k$ (face size)}%
\end{remark}

\begin{remark}
In the original 1998 proof, the corresponding result
is called the ``Main Estimate.''  The proof of that 
theorem takes about 30 pages and relies on many
long computer calculations.  The proof given here
is substantially simpler than the proof of the original
main estimate, but
it is still nontrivial.  In the proof presented below, we have the advantages
of knowing that the polygons are convex, the hypermap
is simple, and that each face has at most six sides.
\end{remark}

The proof adopts the following convention for
configurations.  Let $v_0,\ldots,v_{n-1}$ be the vertices
of the polygon, and write
$$
y_i = \normo{v_i},\quad y_{ij} = \norm{v_i}{ v_j}.
$$
\indy{Notation}{v@$v$ (vertex)}%




\begin{proof}  
The idea of the proof is simple.  The function $\tau$ is a continuous function on a search space of cyclic fans.  To minimize $\tau$, certain paths will be identified in the search space along which $\tau$ is decreasing.  By descending along these paths, the points along the boundary of the search space will be reached.  The boundary of the search space has much lower dimension than the full search space. Eventually, by descending along sufficiently many paths, the dimension becomes sufficiently small that a direct interval arithmetic calculation gives the desired bounds.
\indy{Notation}{V@$V$ (configuration)}%

The proof is so long that has been broken into several subsections.
\end{proof}


\subsection{special fans}
\indy{Index}{halting conditions}%

\begin{definition}[special~fan]
A special fan is a tuple $(V,E,F,G)$, where
\begin{nomerate}
\item \case{packing} $V$ is a packing.
\item \case{ball} $V\subset \BB$.
\item \case{cyclic fan} $(V,E,F)$ is a cyclic fan.
\item \case{subset} $G\subset E$.
\item \case{g norm} If $\{v,w\}\in G$, then $\norm{v}{w}=2\hm$.
\item \case{e norm} If $\{v,w\}\in E$, then $2\le \norm{v}{w}\le 2\hm$.
\item \case{diagonal} For all distinct elements $v,w\in E$, if
$\{v,w\}\not\in V$, then $$\norm{v}{w}\ge 2\hm.$$
\item \case{diagonal XX}  For all $v,w\in V$, if $C^0\{v,w\}\subset \Wdart(x)$ for all $x\in F$, then 
   $$\norm{v}{w}\ge 2\hm.$$
\item \case{card} %$k=\card(F)$,
 Let      $s=\card(G)$ and $r=\card(E) - s$.  Then
$$0\le s \le 3,\quad\text{and}\quad3-s \le r \le 6 - 2s,$$
%\item The angles $\angle(v)$, $v\in F$ are at most $\pi$.
%\item The distances satisfy , if $\{v,w\}$ is
%not an edge.  (Call these the diagonals.)
\end{nomerate}
The constants $r,s$ are called the {\it parameters} of the special fan.
\end{definition}
\indy{Index}{special fan}
\indy{Index}{parameters (of a special fan)}
\indy{Notation}{r (special fan parameter)}
\indy{Notation}{s (special fan parameter)}


The function $d$ can be extended to a function of two variables.  The definition is crafted in such a way that $d(k,0) = d(k)$, for $k\ge 3$.

\begin{definition}[d]
$$d(r,s) = \begin{cases}
    0.103 (2-s) + 0.2759 (r+2s-4), & r + 2s > 3\\
    0, & r + 2s \le 3.\\
    \end{cases}$$
\end{definition}
%d(3,0)=0, d(4,0)= 0.206; d(5,0)= 0.4819,   .7578


\begin{lemma}\guid{BGDPIZY}\rating{ZZ}
Suppose that
$$
\tau(V,E,F) \ge d (r,s)
$$
for every special fan $(V,E,F,G)$,
where $(r,s)$ are the parameters of the special fan.
Then Lemma~\ref{lemma:main} holds.
\end{lemma}

\begin{proof}
Let $V_0$ be a contravening packing.
By Lemma~\ref{XX}, $\tau(V_0,E_{std},F)=\tau(V,E,F)$  where $(V,E,F)$ is the
localization of
$(V_0,E_{std})$ along $F$. 

\claim{The tuple $(V,E,F,\emptyset)$ is a special fan.}  The properties \case{packing} and
\case{ball} result from the assumption that $V$ is contravening
packing.  

\case{cyclic fan}  The localization $(V,E,F)$ is indeed a cyclic fan.

\case{diagonal XX}  Assume that $v,w\in V$ and 
$C^0\{v,w\}\subset \Wdart(x)$ for all $x\in F$.
The intersection of the sets $\Wdart(x)$ is the topological component
$U_F$ of $Y(V_0,E_{std})$.  Thus, $C^0\{v,w\}\subset Y(V_0,E_{std})$.
Assume for a contradiction that $\norm{v}{w}< 2\hm$. Then by the definition of $E_{std}$, $\{v,w\}\in E_{std}$.
Hence $C^0\{v,w\}\subset X(V_0,E_{std})$. This leads to a contradiction, because
$C^0\{v,w\}$ is nonempty, and $X(V_0,E_{std})\cap Y(V_0,E_{std})=\emptyset$.

\case{subset} \case{g norm}  These properties are trivial, because $G=\emptyset$.

\case{e norm} If $\{v,w\}\in E$, then $\{v,w\}\in E$.  It follows from the definition of
standard fan that $2\le \norm{v}{w}\le 2\hm$.

\case{card} Let $s=\card(\emptyset) = 0$, and $r=\card(E)$.  Then $0\le s\le 3$ is trivial. Also, 
$$3-s \le 3\le r \le 6=6 - 2s$$
follows from the defining property \case{face size} of a tame hypermap.  This proves that clam that
$(V,E,F,\emptyset)$ is a special fan with parameters $r=k$ and $s=0$.

Finally, 
$$\tau(V_0,E_{std})=\tau(V,E,F) \ge d(r,s) = d(k,0) = d(k).$$  
This completes the proof.
\end{proof}

\claim{The set ${\mathcal S}$ of all special fans can be endowed with a 
topology.}
Indeed, for each $k\in\ring{N}$,  let ${\mathcal S}_k$ be the set of all pairs 
$$\{(u,j) \in\BB^k\times 2^k \mid (V(u),E(u),F(u),G(u,j)) \text{~~ is a special fan}\},$$
where $V:\BB^k\to \powerset(\BB)$ is the natural map, $E(u) = \{\{v_i,v_{i+1}\}\}$,
$F(u) = \{(v_i,v_{i+1})\}$, $G(u,j) = \{\{v_{j(i)},v_{j(i)+1}\}$ (all subscripts $i=0,\ldots,n-1$ modulo $k$).  Each ${\mathcal S}_k$ is
a topological space as a subset of $\ring{R}^k\times 2^k$ (with the discrete topology on $2^k$).  There are maps ${\mathcal S}_k\to{\mathcal S}$, given by
$(u,j)\mapsto (V(u),\ldots,G(u,j))$.
The special fan $(V,E,F,G)$ lies in the image of ${\mathcal S}_k$, when
$k = \card(V)$.  The images of ${\mathcal S}_k$ for different $k$ are disjoint
from one another.  Define the topology on ${\mathcal S}$ to be the weakest topology for which all of the maps ${\mathcal S}_k\to {\mathcal S}$ are
continuous.


\begin{lemma}\guid{}\rating{ZZ}
The space ${\mathcal S}$ of special fans is compact.
\end{lemma}

The function $\tau$ is defined on special fans by disregarding $G$:
$$
\tau(V,E,F,G) = \tau(V,E,F).
$$

\begin{lemma}\guid{}\rating{ZZ}
The function $\tau:{\mathcal S}\to \ring{R}$ is continuous.
\end{lemma}

\begin{lemma}\guid{}\rating{}\label{lemma:2hm-slice}
Let $(V,E,F,G)$ be a special fan.  Let $v,w\in V$ be distinct elements such that $\norm{v}{w}=2\hm$ and such that $\{v,w\}\not\in E$.
Then $C^0\{v,w\}\subset \Wdart(x)$, for all $x\in F$.
\end{lemma}


\subsection{slicing}


Section~\ref{sec:types} describes a procedure called slicing that starts with a cyclic fan $(V,E,F)$
and a blade $C^0\{v,w\} \subset U_F$ for some $v,w\in V$.  The procedure slices the fan $(V,E,F)$ along $\{v,w\}$  into two cyclic fans:
$$
\begin{array}{lll}
(V',E',F')&=(V[v,w],E[v,w],F[v,w]),\quad\text{and}\\
 (V'',E'',F'')&= (V[w,v],E[w,v],F[w,v]).
\end{array}
$$


The slicing procedure can also be applied to a special fan $(V,E,F,G)$.
Both edge sets $E'$ and $E''$ contain $\{v,w\}$.  The sets $G'$ and $G''$ can be defined
as 
$$
\begin{array}{lll}
G' &= \{\{v,w\}\} \cup (E'\cap G).\\
G'' &= \{\{v,w\}\} \cup (E''\cap G).\\
\end{array}
$$ 

Let $(r',s')$ and $(r'',s'')$ be the parameters for $(V',E',F',G')$ and $(V'',E'',F'',G'')$, respectively.
Set $k=r+s$, $k'=r'+s'$, and $k''=r''+s''$.

\begin{lemma}\guid{IXZYRSY}\rating{}  Let $(V,E,F,G)$ be a special fan (with parameters $s,r$).  
Pick distinct elements $v,w\in V$  such that $\{v,w\}\not\in E$.
Assume that $\norm{v}{w}=2\hm$.
For each $u\in \{v,w\}$, assume that $u$ is independent of all elements of $V\setminus\{u\}$.    
%Assume that $C^0\{v,w\}\subset \Wdart(x)$ for all darts $x\in F$. 
Then $(V',E',F',G')$ is a special fan.  Moreover,
the parameters satisfy the relations
$$
k'+k'' = k + 2,\quad s'+s'' = s + 2,\quad r'+r''=r.
$$
Finally,
$$
\tau(V,E,F)= \tau(V'',E'',F'') +\tau(V',E',F').
$$
\end{lemma}

By interchanging $v$ and $w$, the lemma also asserts that $(V'',E'',F'',G'')$ is a special fan.

\begin{proof}  Each of the defining properties of a special fan will be considered in turn.

The properties \case{packing}, \case{ball}, \case{diagonal XX}, \case{subset}, \case{g norm}, and \case{g norm} follow directly from definitions and the corresonding properties for $(V,E,F,G)$.
The property \case{cyclic fan} follows from Lemma~\ref{lemma:slice}.

The relations between the constants $k,s,r$ for the various fans follows directly from the construction.
For example, there are two darts more in $F''\cup F'$ than in $F$.  

\claim{Property~\case{card} holds.}  Recall that each face in the hypermap of a fan has at least three darts.  Hence $3\le k$, $3\le k'$, and $3\le k''$.
The sets $G'$ and $G''$ contain $\{v,w\}$.  Hence $1\le s'$ and $1\le s''$.
From $0\le r\le 6 - 2s$, it follows that $s\le 3$.  If $s=3$, then $r=0$, and $k=r+s=3$.  This means that $F$ is a triangle.  For some ordering of the pair, $x=(v,w)$ is a dart in $F$.
Hence  $C^0\{v,w\} \not\subset \Wdart(x)$.  This is contrary to hypothesis.  Therefore, $s\le 2$.

Now for the verifications.
$$0\le s' = s + 2 - s'' \le s+1\le 3.$$
$$3-s'\le k'-s' = r'.$$
$$k' = k + 2 - k'' \le k-1.$$
$$
r'= k'+s' - 2 s' \le (k-1) + (s+1) - 2s' =k+s - 2s' = r + 2s -2s' \le 6 - 2s'.
$$
This completes the proof of property~\case{card}.

The additivity of $\tau$ follows directly from the azimuth angle estimates in Lemma~\ref{lemma:slice}.
\end{proof}



\subsection{minimality}


\begin{definition}[minimal~fan,~$k_{min}$]
Let $k_{min}$ be the minimum of $r+s$ over
all special fans $(V,E,F,G)$ such that 
\begin{equation}\label{eqn:kmin}
\tau(V,E,F) < d (r,s),
\end{equation}
where $(r,s)$ are the parameters of the special fan.
If no special fan exists that satisfies the inequality, then set $k_{min}=0$.
Let $\tau_{min}$ be the infimum of $\tau(V,E,F)$ over all special fans
$(V,E,F,G)$ whose parameters $(r,s)$ satisfy $r+s=k_{min}$.
Any special fan $(V,E,F,G)$ with parameter $r+s=k_{min}$ such that
$$
\tau_{min}= \tau(V,E,F)
$$
is a {\it minimal}  fan.
\end{definition}

\begin{lemma}\guid{}\rating{ZZ}
The set of minimal fans is compact.
\end{lemma}

\begin{proof}  It is a closed subset of the compact space of special fans:
$$
\{(V,E,F,G)\in {\mathcal S} \mid \tau(V,E,F,G)=\tau_{min} \text{ and }
   r+s = k_{min}\}.
$$ 
\end{proof}

\begin{lemma}\guid{}\rating{ZZ}
If the set of minimal fans is empty, then
$$
\tau(V,E,F) \ge d (r,s)
$$
for every special fan $(V,E,F,G)$,
\end{lemma}

\begin{proof} Assume that negation of the conclusion.  
Then $k_{min}>0$, because it is the cardinality of some nonempty set $V$.
The set of special fans with parameters $(r,s)$, $r+s=k_{min}$ is a nonempty 
compact
set.  The function $\tau$ on that set is continuous.  Hence its minimum
$\tau_{min}$ is attained for some special fan $(V,E,F,G)$.  This is a minimal fan.
\end{proof}

\begin{lemma}\guid{}\rating{ZZ}
There is a constant $c>2\hm$ such that for every minimal fan $(V,E,F,G)$
and every distinct $v,w\in V$, either $\{v,w\}\in E$ or $\norm{v}{w}\ge c$.
\end{lemma}

\begin{proof} The function
$$
\min_{v\ne w\in V,~~\{v,w\}\not\in E} \norm{v}{w}
$$
is a continuous function on the compact set of minimal fans.
It attains a minimum $c$ for some minimal fan $(V,E,F,G)$.  By the property~\case{diagonal} of special fans, $c\ge 2\hm$.

Suppose for a contradiction that $c=2\hm$.  Then $\norm{v}{w}=2\hm$ for
some $\{v,w\}\not\in E$.  Then by Lemma~\ref{lemma:2hm-slice}, $C^0\{v,w\}\subset \Wdart(x)$, for all $x\in F$.
The fan can be split along the $\{v,w\}$.  By Lemma~\ref{XX}, one of the two resulting fans violates inequality~\ref{XX}.  This is contrary to the choice of $k_{min}$ in the definition of minimality.
\end{proof}

\begin{lemma}\guid{RRAJQBH}\rating{ZZ}
$$
\tau(V,E,F) \ge d (r,s)
$$
for every circular special fan $(V,E,F,G)$,
where $(r,s)$ are the parameters of the special fan.  In particular, no
circular fan is minimal.
\end{lemma}

\begin{proof}
$$d(r,s) =0.103 (2-s) + 0.2759 (r+2s-4) \le 0.103 (2) + 0.2759 (2) =0.7578.$$
If the special fan $(V,E,F)$ is circular, then $\op{azim}(x) =\pi$ for all $x\in F$.

$$
\begin{array}{lll}
\tau(V,E,F) &= \sol(U_F) \left( 1 + \dfrac{\sol_0}{\pi}\right) - \dfrac{\sol_0}{\pi} \sum_{x\in F} \op{azim}(x)(L(h(x)))\\
&= 2\pi \left( 1 + \dfrac{\sol_0}{\pi}\right) - \sol_0 \sum_{x\in F} L(h(x))\\
&\ge 2\pi \left( 1 + \dfrac{\sol_0}{\pi}\right) - 6 \sol_0\\
&> 0.7578\\ 
&\ge d(r,s)\\
\end{array}
$$
\end{proof}


Section~\ref{sec:deformation} develops a theory of deformations of cyclic fans $(V,E,F)$.  Recall that a deformation is  continuous function $\varphi:V\times I\to\ring{R}^3$.  A deformation determines sets $V(t)$, $E(t)$, $F(t)$, and $G(t)$ for each $t\in I$.

\begin{lemma}\guid{}\rating{ZZ}
Every minimal fan is generic.
\end{lemma}

\begin{proof}  There are no circular special fans by Lemma~\ref{XX}.

Suppose for a contradiction, that $(V,E,F)$ is lunar, special, and
minimal.  Let $v,w\in V$ be dependent.   Section~\ref{XX} describes a deformation of the cyclic fan $(V,E,F)$
over $I=\leftclosed0,1\rightopen$.  The deformation fixes $\normo{u}$
and is non-increasing in $\angle(u(t))$, for $u\in V$.
From the defining formula for $\tau$, it is clear that the function $\tau(V(t),E(t),F(t))$ is a decreasing function of $t$.

As $t\in I$ increases, $\angle(v(t))$ is tending to zero and the distance
$$
\norm{ \varphi(\rho v,t)}{\varphi(\rho^{-1} v,t)}
$$
is decreasing.
For sufficiently large $t\in I$, 
By Lemma~\ref{lemma:0.852} implies that this is no longer a special fan.

Pick the largest $a$ for which the property~\case{diagonal XX} holds on
$\leftclosed0,a\rightclosed$.
By Lemma~\ref{XX}, the special fan $(V(a),E(a),F(a),G(a))$ can be split.
This is contrary to minimality.
\end{proof}

\begin{lemma}\guid{}\rating{ZZ}
Let $(V,E,F,G)$ be a minimal fan.  Then for every $v\in V$,
$$
\min(\normo{v},\norm{v}{\rho^{-1}v},\norm{v}{\rho v}) = 2.
$$
\end{lemma}

\begin{proof} If the conclusion is false, then for sufficiently small positive $a$,  the deformation $\varphi$ over $[0,a]$ given by
$$
\varphi(u,t) =
\begin{cases}
u & u \ne v\\
(1-t) v & u = v\\
\end{cases}
$$
decreases $\tau$.  It is a deformation of special fans.  This shows that $(V,E,F,G)$ is not minimal.
\end{proof}

\begin{lemma}\guid{}\rating{ZZ}
Let $(V,E,F,G)$ be a minimal fan.  Then for every $\{v,w\}\in E$,
$$
\norm{v}{w} \in \{2,2\hm\}.
$$
\end{lemma}

\begin{proof}
\end{proof}


%\subsection{deformations}


%
%All deformations are required to remain within the set of minimal fans for all $t\in I$.  (The interval $I$ is shortened as necessary to ensure this.)
%The deformations are described in detail below.
%\indy{Index}{deformation}%
%


%There are the following $\tau$-nonincreasing deformations:
%\begin{itemize}
%\item {\bf (Vertex push)} Push one vertex radially toward $\orz$.  By the formula for $\tau$, this deformation decreases $\tau$.
%\item {\bf (Lexell)} Fix all the heights $\normo{v}$. Then $\tau$ depends only on the area of the convex spherical polygon.  Consider an {\it ear} of the polygon (a triangle formed by two adjacent edges and a diagonal).  By Lexell's theorem, as one increases the length of one of the edges of the polygon, the area of the ear has a unique local maximum and no local minimum.  Thus,  deform until each edge is as long or as short as possible.
%\indy{Index}{deformation}%
%\indy{Index}{vertex push}%
%\indy{Index}{Lexell's Theorem}%
%\end{itemize}
%
%
%\begin{note}
%These deformations are not exactly Lexell's theorem, but a slight modification that applies to the function $\tau$.  Lexell itself is not used.  This will be corrected in the text.  
%\end{note}

\subsection{flat vertices}


If $\angle(v)=\pi$, call the vertex {\it flat}. Recall that the vertices $V$ in a cyclic fan are ordered by a permutation $\rho:V\to V$.  If there are $i$ consecutive flat vertices, then there are  $i+1$ corresponding edges that lie in a plane $A$ through the origin.  
%When the vertex is flat, the deformations are required to be flat.   The next few lemmas use the triangle inequality to constrain configurations with flat vertices.
\indy{Index}{Lexell's triangle}%
\indy{Index}{vertex!flat}%

\begin{lemma}\guid{}\rating{}
Let $(V,E,F,G)$ be a minimal fan.
%For every edge $\{v,w\}\in E$ in a minimal fan $(V,E,F,G)$, 
%$$\norm{v}{w}\in\{2,2\hm\}.$$
If $v\in V$ is flat and $\{u,v\},\{w,v\}\in E$, then
$$
\norm{u}{v} = \norm{w}{v}.
$$
\end{lemma}

\begin{lemma}\guid{}\rating{ZZ}
For every vertex $v\in V$ in a minimal fan $(V,E,F,G)$,
if 
$$\norm{\rho^{-1} v}{v}=\norm{v}{\rho v} = 2\hm,$$
then $\normo{v}=2$.
\end{lemma}




\begin{lemma}\guid{SDCCMGA}\rating{}
If a minimal fan $(V,E,F,G)$ 
has two consecutive flat vertices $v$ and $\rho v$, then 
$$G\cap \{\{\rho^{-1}v,v\},\{v,\rho v\},\{\rho v,\rho^2 v\}\} = \emptyset.$$
\end{lemma}

\begin{proof}  Argue by contradiction.  From the constraints on $r$ and $s$, if $s>0$, then $r+s\le 5$. 

If $r+s\le 4$, then a plane $A$ contains the origin and $V = \{\rho^{-1}v,v,\rho v,\rho^2v\}$.  This is not generic.

Thus, $r+s=5$, forming a triangle with a linear series of three, and the two other edges.  If $y=\normo{\rho^{-1} v}$, then the perimeter from $\rho^{-1}v$ to $\rho^2 v$ is as least
$$
\arc(y,2\hm,2)+\arc(2\hm,2\hm,2) +\arc(2\hm,2\hm,2\hm)
$$
which is greater than the maximum sum of the other two lengths:
$$
\arc(y,2,2\hm)+\arc(2,2,2\hm).
$$
This violates the triangle inequality.
\end{proof}



\begin{lemma}\guid{CFJSRQH}  Let $(V,E,F,G)$ be a minimal fan. Assume that there are consecutive flat vertices $v,\rho v\in V$. 
%Assume that 
%$$
%\norm{u}{\rho u} = \norm{\rho^{-1} u}{u},
%$$
%for every flat vertex $u\in V$.
%Assume that  $\norm{u}{\rho u}\in\{2,2\hm\}$ for all $u\in V$.  
Then 
$$
\norm{v}{\rho v} = 2.
$$
\end{lemma}

\begin{proof} Write $v_i = \rho^{i-2} v$.  If the distances $\norm{v_i}{v_{i+1}}$ are $2\hm$, then the perimeter from $v_1$ to $v_4$ is at least
\begin{equation}\label{eqn:3side}
\arc(y_1,2,2\hm)+\arc(2,2,2\hm)+\arc(2,y_4,2\hm),
\end{equation}
where $\normo{v_i}=y_i$.
However, there are at most two other vertices and three other edges in the special fan.  By the triangle inequality, the sum of these three lengths is at most \eqn{eqn:3side}.
Thus, equality is obtained in the triangle inequality, and the polygon reduces to a linear segment.  This is not generic.
\end{proof}

\begin{lemma}\guid{OUCPLRI} Let $(V,E,F,G)$ be a minimal fan with consecutive flat vertices $v,w\in V$.  Then 
$$\normo{v}\in \{2,2\hm\}\quad\text{ or }\quad \normo{w}\in \{2,2\hm\}.$$
That is, one of them has extremal norm.
\indy{Index}{minimal height}%
\indy{Index}{maximal height}%
\end{lemma}

\begin{proof}
Assume there are two adjacent flat angles $v_2,v_3$, forming a linear series $v_1,v_2,v_3,v_4$.
Assume without loss of generality (by previous reductions) that
\indy{Index}{angle!flat}%
$\norm{v_i}{v_{i+1}}=2$, for $i=1,2,3$.
Let $y_i = \normo{v_i}$.
Pull one vertex $v_2$ away from $\orz$ and push the other $v_3$ in such a way that fixes $y_2+y_3$, while decreasing the arclength of the linear series.  This follows by concavity.
In fact, the arclength is given by a sum of three terms:
  $$
  \sum_{i=1}^3\arc(y_i,y_{i+1},2).
  $$
This follows from a calculation showing that the second derivative of $\arc(t,s,2)$ with respect to $t$ is negative, for $t,s\in[2,2\hm]$.  Thus, the
sum is also concave, so that arclength is decreased as much as possible when the heights are extremal.
\end{proof}

\begin{lemma}\guid{TESVAFW}
A minimal fan $(V,E,F,G)$ does not contain three consecutive flat vertices $\{v,\rho v,\rho^2 v\}\subset V$.
\end{lemma}

\begin{proof}  Three flat vertices produces an arc
$$
\arc_V(0,\{\rho^{-1} v,\rho^3 v\}) = \op{per}(V,E,F,\rho^{-1}v,\rho^3 v) \ge4\arc(2\hm,2\hm,2) > \pi,
$$
but the remaining edges  have combined length at most
$$
\arc_V(0,\{\rho^{-1} v,\rho^3 v\})\le 2\arc(2,2,2\hm) < \pi.
$$
\end{proof}

\begin{lemma}\guid{}\rating{ZZ}
Let $(V,E,F,G)$ be a  minimal fan.
\begin{itemize} 
\item If $v\in V$ is flat, then 
  $$\norm{v}{\rho v}=\norm{\rho^{-1}v}{v}\in \{2,2\hm\}.$$
  Moreover, if $\norm{v}{\rho v}=2\hm$, then $\normo{v}=2$.
\item If $v\in V$ and $\rho v$ are both flat, then
$$
\norm{\rho^{-1}v}{v} = \norm{v}{\rho v} = \norm{\rho v}{\rho^2 v} = 2
$$
Moreover,
  $$
\normo{v}\in \{2,2\hm\}\quad\text{or}\quad \normo{\rho v}\in \{2,2\hm\}.
$$
\item If $v$ and $\rho v$ are flat, then $\rho^2 v$ and $\rho^{-1}v$ are not flat.
\end{itemize}
\end{lemma}

\begin{proof} This is a summary of preceding lemmas.
\end{proof}
%
%In summary,  the following possible configurations of flat angles may occur:
%\begin{itemize}
%\item There are two consecutive flat angles contracted as much as possible.  They form a linear series $v_1,v_2,v_3,v_4$ where
%$$
%y_2\in\{2,2\hm\},\quad
%y_{i,i+1}=2,\quad i=1,2,3.
%$$
%\item There is a single flat angle contracted as much as possible.  There
%is a linear series $v_1,v_2,v_3$ where
%$$
%y_{i,i+1}=2,\quad i=1,2.
%$$
%\item There is a single flat angle stretched as much as possible.  There
%is a linear series $v_1,v_2,v_3$ where
%$$
%\normo{v_2}=2,\quad
%\norm{v_i}{v_{i+1}}=2\hm,\quad i=1,2.
%$$
%\indy{Index}{linear!series}%
%\end{itemize}


\subsection{more minimality}



%Assume $\norm{v}{u}$ and $\norm{v}{w}$ are already at their extremal value (either $2$ for  $2\hm$).  Then the function $\tau(V)$ may be considered as a function
%of the edges of the simplex $\orz,u,v,w$ as $v$ moves with the other points of $V$ fixed.  Fix $5$ edges of the simplex as parameters and vary $\normo{v}$, so that $\tau$ becomes a function of a single variable.
%\indy{Notation}{ZZtau@$\tau$}%


\begin{lemma}\guid{DFSLRHA} 
Let $(V,E,F,G)$ be a minimal fan and let $v\in V$.  Assume that $v$ is not flat.
%Fix three consecutive vertices $ (u,\rho u,\rho^2 u)$.
%\indy{Notation}{uvertex@$u$ (vertex)}%
%\indy{Notation}{v@$v$ (vertex)}%
%\indy{Notation}{wz@$w$ (vertex)}%
Consider the deformation $\varphi:V\times I\to V$ given by
$$
\varphi(u,t) =
\begin{cases}
v(t) & \text{if } u=v\\
u & \text{otherwise},\\
\end{cases}
$$
where $v(t)$ is the unique point in $\op{aff}_+(\{0,\rho^{-1}v,\rho v\},v)$ determined by the conditions:
$$
\norm{v(t)}{u} = \norm{v}{u}, \text{~when~} \{u,v\}\in E,\quad
\text{~and~}
\normo{v(t)} = (1-t)\normo{v}.
$$
Define the function
$g(t)=\tau(V(t),E(t),F(t))$.
Then 
 $g$ has no local minimum on $(-\epsilon,\epsilon)$ when $\epsilon$ is positive and sufficiently small.
\indy{Index}{derivative}%
\indy{Index}{local minimum}%
\end{lemma}


\begin{proof}
The proof is an interval arithmetic calculation over a four-dimensional space~\cite[cc:d2a]{hales:2009:nonlinear}.  %%cc:d2a
The calculation verifies  that the second derivative is negative whenever the derivative is zero.
\end{proof}


\begin{corollary}\guid{}\rating{ZZ}
Let $(V,E,F,G)$ be a minimal fan and let $v\in V$.  Assume that $\rho^{-1}v$, $v$, and $\rho v$ are not flat.
Then $\normo{v}\in \{2,2\hm\}$.
\end{corollary}



%The same can be done when there is one flat vertex forming a linear series of length $2$, with compressed edges:

\begin{lemma}  %\guid{DCEETTF}
Let $(V,E,F,G)$ be a minimal fan.
Assume that $v\in V$ is a flat vertex and that no $u\in\{\rho^{-1}v,\rho v,\rho^2 v\}$ is flat.
Then 
$$
\normo{v}\in \{2,2\hm\}\quad\text{ or }\quad\normo{\rho v}\in \{2,2\hm\}.
$$
\end{lemma}

\begin{proof}
As a function of $\normo{v}$
 $\tau$ has negative second derivative whenever the derivative is zero.  Thus, $\tau$ has no local minimum.

The proof is an interval arithmetic calculation over a five-dimensional space~\cite[cc:d2b]{hales:2009:nonlinear}. %%cc:d2b
\end{proof}


%Thus, if there a sequence of a flat vertex $u$, an acute vertex $v$, and another acute vertex, then  assume that $u$ or $v$ has extremal height $\in\{2,2\hm\}$.



\begin{lemma}\guid{CMBZAOZ}\rating{}
Let $(V,E,F,G)$ be a minimal fan.
Assume that $v,\rho v,\rho^2 v,\rho^3 v\in V$ are not flat.
Then $r+s=4$, and $\norm{v}{w}= 2$, for all $\{v,w\}\in E$.
\end{lemma}
\indy{Notation}{ZZtau@$\tau$}%

\begin{proof} 
Suppose that there are four consecutive vertices $v_1,v_2,v_3,v_4$ that are not flat, and consider the chain of four consecutive vertices $v_1,v_2,v_3,v_4$. By Lexell arguments, each edge $\norm{v_i}{v_{i+1}}$ is $2$ or $2\hm$. Set $y_i = \normo{v_i}$ and $y_{ij} = \norm{v_i}{v_j}$. After adjusting heights $y_i$ is $2$ or $2\hm$, for $i=2,3$. This leaves four degrees of freedom:
$$
y_1,y_4,y_{14},
$$
and a diagonal to the quadrilateral, say $y_{13}$. Assume without loss of generality that  $y_{14}\ge 2\hm$.  (If it is smaller, it is an uncut edge of the polygonal, of length $2$, so that the polygon is actually a convex quadrilateral.  This special case is most easily dealt with separately.)

In this context, the function $\tau$ as a function of $y_1,y_4,y_{14},y_{13}$ does not have an interior point local minimum.
This is an interval arithmetic calculation~\cite[cc:qua]{hales:2009:nonlinear} in four variables.%% cc:quad tau-estimate, deform a quadrilateral.
\end{proof}

%As a consequence, the minimum occurs when a new flat vertex forms.   Then eliminate any case with four consecutive vertices that are not flat (after treating the quadrilateral with four edges $y_{ij}=2$ as a special case).

\subsection{cases}

More than one of these can be combined in a single polygon.   Represent the sizes of the linear series in a polygon with $k$ sides as a partition of $k$.
The number of parts of the partition gives the number of sides of the polygon when each linear series is considered a single side. 
\indy{Index}{linear!series}%

Let us review the combinatorial possibilities.  In each case,  check that the inequality holds, to complete the proof of the main estimate.  Label each 
case by the partition.  If the partition is $(\mu_1,\mu_2,\ldots)$, 
index the vertices in the same order as the partition, with $v_0$
the vertex occurring just before the first flat vertex.  For example,
if the partition is $(3,1,1)$, the polygon is a pentagon, flattened into
an effective triangle, with vertices $v_0,\ldots,v_4$, where $v_1$ and $v_2$
are the flat vertices.
\indy{Notation}{ZZmu@$\mu$ (partition)}%

The following constraints hold on the partition: it is
a partition of $k$, where $3\le k\le 6$; there
are at least three parts; the largest part is at most $3$;  there are
at most two consecutive parts that equal $1$, unless it is a special triangular case $(1,1,1)$ or
quadrilateral case $(1,1,1,1)$, discussed below.  In only one case
does the order of the parts matter: $(2,1,2,1)$ versus $(2,2,1,1)$.

\begin{itemize}
\item {\bf (1,1,1)}  This is a triangle.  There are three degrees of
freedom $y_i$.  Since this is arising from a polygon that was not originally a triangle,  assume that for at least one of the edges: $y_{ij}=2\hm$.
\item {\bf (1,1,1,1)}  This is a convex quadrilateral with four sides $y_{ij}=2$ and four extremal heights $y_i$.  There is one degree of freedom given by the diagonal.
\item {\bf (2,1,1)} This is a quadrilateral, flattened into an effective triangle.  There are two degrees of freedom: one of the three variables $y_0,y_1,y_2$ is extremal.  All of the other variables are extremal.
\item {\bf (3,1,1)}  This is a pentagon, flattened into an effective triangle.  There are three degrees of freedom $y_0,y_{03},y_3$ along the flattened side, and no freedom in the rest of the figure.  It follows that $y_{01}=y_{12}=y_{23}=2$.
\item {\bf (2,2,1)} This is a pentagon, flattened into an effective triangle.  The edge lengths $y_{i,i+1}$ are all extremal.  Because of height adjustments, there are three degrees of freedom in the heights $y_i$.
\item {\bf (3,2,1)} This is a hexagon, flattened into an effective triangle.  There are four degrees of freedom.
\item {\bf (2,2,2)}  This is a hexagon, flattened into an effective triangle.  There are six degrees of freedom, given by all heights $y_i$.
\item {\bf (2,1,2,1)} This is a hexagon, flattened into an effective quadrilateral.  There are five degrees of freedom: a diagonal $y_{03}$ to the quadrilateral and four independent heights.
\item {\bf (2,2,1,1)}  This is a hexagon, flattened into an effective quadrilateral.  There are four degrees of freedom: a diagonal $y_{03}$ to the quadrilateral and three independent heights.
\indy{Index}{triangle}%
\indy{Index}{quadrilateral}%
\indy{Index}{pentagon}%
\indy{Index}{hexagon}%
\end{itemize}


Interval arithmetic calculations~\cite[cc:tau]{hales:2009:nonlinear} %% cc:par partition cases for tau[r,s]. 
for each of these cases completes the proof. The proof that contravening hypermaps are tame is complete.

\section{Linear Programs}

One can attach a linear program to each tame hypermap.
For each tame hypermap $H$ there is a configuration space $D(H)$ of all
finite packings $V\subset \BB$ whose standard fan is
isomorphic to $H$.
\indy{Notation}{H@$H$ (hypermap)}%
\indy{Notation}{D@$D(H)$ (configuration space)}%

A nonlinear optimization problem asks for the maximum of
\begin{equation}\label{eqn:L2}
\sum_{v\in V} L(\normo{v}/2)
\end{equation}
over all $V\in D(H)$.

The linear program comes as a linear relaxation of this nonlinear
optimization problem on $D(H)$. That is, the optimal solution of the
the linear program has value at least as great as the corresponding
nonlinear problem.  By showing that the value of each linear program
is at most $12$, one may conclude that the maximum of \eqn{eqn:L2}
is at most $12$.


\begin{note}%XX
The linear programming part of the proof has not been completed. There are six cases that remain.
\end{note}

