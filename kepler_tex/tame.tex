% Flyspeck
% Thomas C. Hales
% Starting with Chapter on Tame Hypermaps

% Sep 3, Removed 2 enclosed in quad properties.


\chapter{Tame Hypermap}
\indy{Index}{hypermap!tame}%

\label{sec:tame}
\indy{Index}{tame}%

\begin{summary}
This chapter is the second of the two core chapters that are devoted to the proof of the Kepler Conjecture.  If $V$ is a finite set of vectors in $\ring{R}^3$, let
$$\CalL(V) = \sum_{\v\in V} L(\normo{\v}/2).$$
Let $\BB$ be the
annulus $\bar B(\orz,2h_0)\setminus B(\orz,2)$, where
$\bar B(\orz,r)$ is the closed ball of radius $r$.
By Corollary~\ref{cor:CE}, if every packing $V$
contained in $\BB$
satisfies
\begin{equation}\label{eqn:CCE}
\CalL(V) \le 12,
\end{equation}
then the Kepler conjecture follows.

This chapter assumes that there exists a counterexample $V$ to this inequality and reaches a contradiction.  A subset of extremal counterexamples will be selected that are particularly well-suited for further analysis.  Every extremal counterexample gives rise to a fan and a corresponding hypermap.  
A detailed study of these hypermaps leads to a long list of properties that all such hypermaps must
possess.   A {\it tame} hypermap is defined to be precisely the set of hypermaps that have all of these
properties.   Tameness is thus an umbrella term that covers a long list of loosely related properties.

An earlier chapter on hypermaps gives an algorithm that generates all restricted hypermaps (with a given bound on the number of nodes).   Every tame hypermap is restricted and has at most $14$ nodes.  Hence a list of all tame hypermaps can be obtained by generating all restricted hypermaps and filtering out those that are not tame.   This algorithm has been implemented in computer code and run.  The result is that there is an explicit complete list of all tame hypermaps (up to isomorphism).  
This list gives the classification of tame hypermaps up to isomorphism.   This classification solves a
major step of the packing problem.

Each tame hypermap $H$ gives rise to a nonlinear optimization problem.   Maximize $\CalL(V)$ subject to the constraint that the hypermap associated with  $V$ 
is isomorphic to $H$.  This nonlinear optimization problem has a linear relaxation.  This linear program has
a maximum that is at least as large as the maximum of the nonlinear program.  The linear programs
have been solved by computer.  In every case, the maximum is less than $12$.  This means
that inequality~\ref{eqn:CCE} always holds, so that the Kepler Conjecture is confirmed.
\end{summary}
\indy{Index}{hypermap!tame}%
\indy{Index}{tame!hypermap}%



\section{Definition}


\begin{definition}[triangle,~quadrilateral]
Faces of cardinality $3$ in a hypermap are called {\it triangles}, those of
cardinality $4$ are called {\it quadrilaterals}, and so forth.  
 %
 \indy{Index}{triangle}%
 \indy{Index}{quadrilateral}%
 \indy{Notation}{pZ@$p_\v$}%
\end{definition}

\begin{definition}[type,~$(p,q,r)$]\label{definition:type}
The {\it type\/} of a node is defined to be a triple of
non-negative integers $(p,q,r)$, where $p$ is the number of
triangles meeting the node, $q$ is the number of quadrilaterals
meeting it, and $r$ is the number of other faces meeting it, so that
$p+q+r$ is the total number of faces meeting the node.
%
 \indy{Index}{node!type}%
\indy{Notation}{pqr@$(p,q,r)$}%
\end{definition}


\subsection{weight assignment}\label{sec:wtassign}
\indy{Index}{weight assignment}%

Call the constant $\op{tgt}=1.541$, which arises repeatedly in
this chapter, the {\it target}. 
%
 \indy{Index}{target}%
\indy{Notation}{tgt@$\op{tgt}=1.541$}%


\begin{definition}[b]
  Define $b:\ring{N}\times \ring{N}\to \ring{R}$ by $b(p,q)=\op{tgt}$,
  except for the values in the following table:
  {
  \def\tx{\op{tgt}}
  $$\begin{matrix}  &q=0&1&2&3&4\\
           p=0&\tx&\tx&\tx&0.618&1.0\\
           1&\tx&\tx&0.66&0.618&\tx\\
           2&\tx&0.8&0.412&1.2851&\tx\\
           3&\tx&0.315&0.83&\tx&\tx\\
           4&0.35&0.374&\tx&\tx&\tx\\
           5&0.04&1.144&\tx&\tx&\tx\\
           6&0.689&\tx&\tx&\tx&\tx\\
           7&1.450&\tx&\tx&\tx&\tx
   \end{matrix}
   $$
   }
\indy{Notation}{b@$b$ (tame)}%
\end{definition}


\begin{definition}[d]
    Define $d:\ring{N}\to \ring{R}$ by
  $$d(k) = \begin{cases}
    0 & k\le3, \\
    0.206 & k=4, \\
    0.4819 & k=5, \\
    0.7578 & k=6, \\
    %1.038 & k=7, \\
    %1.315 & k=8,\\
    \op{tgt}=1.541 & \text{otherwise}.
  \end{cases}
  $$
\indy{Notation}{d@$d$ (tame)}%
\end{definition}




\begin{definition}[weight~assignment]
%
A {\it weight assignment\/} of a hypermap $H$ is a real-valued function $\tau$ on
the set of faces of $H$. A weight assignment $\tau$ is {\it admissible} if the
following properties hold:
%
 \indy{Index}{weight assignment}%
 \indy{Index}{weight assignment!admissible}%
 \indy{Index}{cardinality}%
 \indy{Index}{node}%
 \indy{Notation}{ZZtau@$\tau$ (weight assignment)}%
\begin{nomerate}
 \item \case{bound~a} Let $v$ be any node of type $(5,0,1)$, and let $A$ be the set of
triangles meeting that node.
        Then
        $$\sum_{F\in A} \tau(F)
            \ge  0.63.$$
%   where $a=0.63$.
%        \label{definition:admissible:excess}
 \item \case{bound~b} If a node $v$ has type $(p,q,0)$, then
        $$\sum_{F:\,v\cap F\ne\emptyset} \tau(F) \ge b(p,q).$$
%        \label{admissible:b}
  \item \case{bound~d} If the face $F$ has cardinality $k$, then
        $\tau(F) \ge d(k)$.
\end{nomerate}
\indy{Notation}{v@$v$ (node)}%
\indy{Notation}{A@$A$ (set of triangles)}%

The sum $\sum_F \tau(F)$ (over all faces) is called the {\it total weight}. % of $\tau$.
\indy{Index}{weight!total}%
%\indy{Notation}{total@$\sum\tau$}%
\end{definition}





\subsection{hypermap property}
\label{sec:graphproperty}

A hypermap is {\it tame\/} if it satisfies the following conditions.
%
 \indy{Index}{tame}%

\begin{itemize}
    \label{definition:tame}
    %1
    \item \case{planar}  The hypermap is plain and planar.
    \item \case{simple} The hypermap is connected and simple.  In particular, every intersection of a face with a node contains at most one dart.
    \item \case{nondegenerate} The edge map $e$ has no fixed points.
    \item \case{no loops} The two darts of each edge lie in different nodes.
    \item \case{no double joins} At most one edge meets any two given nodes.
%    \label{definition:tame:40}
%    \item \case{blank}
\indy{Notation}{edgemapz@$e$ (edge map)}%
%    \item \case{triangles} If $L$ is a contour loop with three face steps, and if there exists a node in
%    the exterior of $L$, then $L$ is a face of the hypermap.
%    \label{definition:tame:3-circuit}
%\item \case{blank}
 %   \item \case{quadrilaterals} If $L$ is a contour loop with four face steps, and there are at least two nodes    in the exterior of $L$, then the interior of $L$ takes one of the forms     illustrated in Figure
 %   \ref{fig:fourcircuit}.
 %   \label{definition:tame:4-circuit}
  %  \begin{figure}[htb]
  %      \centering
  %      \myincludegraphics{\pdfp/fourcircuit.eps}
  %      \caption{Tame $4$-circuits}
  %      \label{fig:fourcircuit}
  %  \end{figure}
  \item \case{face count} The hypermap has at least three faces.
    \item \case{face size} The cardinality of each face is at least $3$ and at most $6$.
    \item \case{node count} There are either $13$ or $14$ nodes.
    \item \case{node size} The cardinality of every node is at least $3$ and at most
    $7$.
  %    \label{definition:tame:degree}
    \item \case{node types} If a node has cardinality $7$, then the type of the
       node is $(p,q,0)$ for some $p,q\ge0$.   If the
        cardinality of the node is exactly $6$, then the type of the node
        is $(6,0,0)$, $(5,1,0)$, or $(5,0,1)$.
%    \label{definition:tame:degreeE}
    \item \case{weights} There exists an admissible weight assignment
        of total weight less than the target, $\op{tgt}=1.541$.
\end{itemize}
%
\indy{Index}{planar}%
\indy{Index}{simple}%
\indy{Index}{nondegenerate}%
\indy{Index}{no loops}%
\indy{Index}{no double joins}%
\indy{Index}{face}%
\indy{Index}{weight}%

\section{Classification}
    \label{sec:proof-classification}

%\section{Statement of the Theorem}
\label{sec:classification}




\begin{definition}[opposite] The opposite of a hypermap $(D,e,n,f)$ is the
hypermap $(D,f n,n^{-1},f^{-1})$.
\indy{Index}{hypermap!opposite}%
\end{definition}

\begin{lemma}\guid{PPHEUFG}
\oldrating{300}
\rating{0}
\formalauthor{Diep Trieu Thi} 
A hypermap is tame if and only if its opposite hypermap is tame as well.
\end{lemma}

\begin{lemma}\guid{RUNOQPQ}\rating{ZZ}
Every tame hypermap is a restricted hypermap.
\end{lemma}

\begin{proof}
By definition, a tame hypermap is nonempty, connected, plain, planar, and simple.
The edge map has no fixed points.  The node map has no fixed points.  The cardinality of every face is at least three.  These are precisely the defining properties of a restricted hypermap.
\end{proof}


A list of hypermaps appears at \cite{website:Hales:1998:Code}.

\begin{theorem}\guid{WTEMDTA}
\label{theorem:classification} Every tame hypermap is isomorphic to
a hypermap in the list~\cite{website:Hales:1998:Code}, or is isomorphic to the opposite of a
hypermap in the list.
\indy{Index}{isomorphic}%
\end{theorem}

\begin{note}%XX
The (java version of the) graph generator has been run with the new parameters described in this version of the book.  It produces finitely many graphs (about 25,000).  This new list will eventually replace the archive from 1998.  The Bauer-Nipkow formalization of the classification has not yet been adapted to this new definition of tameness.
\indy{Index}{Java}%
\end{note}


Computers are used to generate a list of all hypermaps and to check
them against the archive of tame hypermaps.  The computer program is
based on the hypermap generation construction of Section~\ref{sec:face-insert}.  According
to the results of that section, every restricted hypermap can be generated by an
elementary edge-insertion algorithm.  Every tame hypermap is a restricted hypermap.
The list of restricted hypermaps can be filtered to obtain a complete list of tame hypermaps.
\indy{Index}{computer calculation}%

\section{Contravening Hypermap}

\indy{Index}{hypermap!contravening}%
%The aim is to prove Conjecture~\ref{conj:L12}.  For a contradiction, assume a counterexample. 
A counterexample to the Kepler conjecture leads to a finite packing $V\subset \BB$ that violates the inequality~(\ref{eqn:CCE}).
 The purpose of this section is to select a special class of counterexamples to this inequality.
Let
\begin{equation}\label{eqn:fan-edge}
\begin{array}{lll}
 E_{std} &= \{\{\v,\w\}\in V^2\mid 0 < \norm{\v}{\w}\le 2\hm \}\\
 E_{ctc} &= \{\{\v,\w\}\in V^2\mid \norm{\v}{\w}= 2 \}\subset E_{std}.
\end{array}
\end{equation}

\begin{lemma}\guid{UBHDEUU}\rating{140}
$(V,E)$ is a fan, if $E=E_{std}$ or $E=E_{ctc}$.
\end{lemma}
$(V,E_{std})$ and $(V,E_{ctc})$ are called the standard fan and contact fan, respectively.
Let $\op{hyp}(V,E)$ be the associated hypermap.
\indy{Index}{fan!standard}%
\indy{Index}{fan!contact}%
\indy{Notation}{V@$V$ (packing)}%
\indy{Notation}{V@$( V, E ) $ (fan)}%
\indy{Notation}{hyp@$\op{hyp}$ (hypermap)}%
\indy{Notation}{E@$E_{std}$}%
\indy{Notation}{E@$E_{ctc}$}%

\begin{proof} 
XX

Since $E_{ctc}\subset E_{std}$, it follows from Lemma~\ref{lemma:subset-fan} that
$(V,E_{ctc})$ is a fan.
\end{proof}

\begin{definition}[isolated,~surrounded]
Let $(V,E)$ be a fan.
Say that $\v\in V$ is {\it isolated} in the fan if $E(\v)$ is empty.
(That is, the degree of the corresponding node in the hypermap is $0$.) Say that $\v\in V$ is {\it surrounded} in the fan if the azimuth angles of all darts at the node $\v$ are less than $\pi$.  (In particular, the cardinality of $E(\v)$ is at least three.)
\end{definition}
\indy{Index}{isolated}%
\indy{Index}{surrounded}%
\indy{Index}{angle!azimuth}%
\indy{Index}{azimuth}%
\indy{Index}{cardinality}%
\indy{Notation}{E@$E(\v)$ (fan)}%

The following lemma appears in Sch\"utte and van der Waerden~\cite{vanderWaerden:1951}.

\begin{lemma}\guid{FATUGPD}\rating{200}
Given any packing $V\subset \BB$,
there exists a  packing $V'$ 
in bijective correspondence with $V$:
$$
\phi:V\to V'
$$
such that $\normo{\v} = \normo{\phi(\v)}$ and
such that every vertex $\v'$ in the contact fan of $V'$
is either isolated or surrounded.
\end{lemma}
\indy{Index}{packing!finite}%
\indy{Index}{fan!contact}%
\indy{Notation}{V@$V'$ (packing)}%

\begin{proof} Consider all finite packings in 
bijective correspondence with $V$, such that the
bijection preserves distances of points from the origin.
Among these packings, pick one $V'$ with the largest number
of isolated points in the contact graph.  If there is a point $\v\in V'$ that
is not isolated and not surrounded, then it has a contact
dart with angle at least $\pi$.   Perturb $\v$ away from the contacts, making it isolated, while preserving its distance to $\orz$.  The perturbed packing $V''$ has one more isolated point than $V'$, which is contrary to the supposed maximality of $V'$.  Hence, the conclusion of the 
lemma holds for $V'$.
\end{proof}

The following lemma shows that the corresponding result
holds for the standard fan.  Reader beware!  The set of isolated and surrounded vertices depends on a 
choice of fan.  The next proof makes heavy use of two different fans $(V,E_{std})$ and $(V,E_{ctc})$,
which have different sets of isolated and surrounded vertices, even though the set $V$ is
the same in both cases.



\begin{lemma}\guid{FJLBXS}\rating{1000}\label{lemma:surrounded}  % was rating{500}.
Given any packing $V\subset \BB$,
there exists a  packing $V'$ 
in bijective correspondence with $V$:
$$
\phi:V\to V'
$$
such that $\normo{\v} = \normo{\phi(\v)}$ and
such that every vertex $\v'$ in the standard fan of $V'$
is isolated or surrounded.
\indy{Index}{packing!finite}%
\end{lemma}

\begin{proof}  For any packing $V'\subset \BB$, let $V'_{iso},V'_{sur}$ be the
sets of isolated and surrounded vertices of $V'$ respectively, in the {\bf contact}
fan.  
By the previous lemma,  assume
without generality that every vertex $\v$ in the contact fan of $V$ is either isolated
or surrounded:
$$
V = V_{iso} \cup V_{sur}.
$$
Consider the set $\CalV$ of pairs $(V',\phi)$ consisting of a packing $V'$
and bijection $\phi:V\to V'$ such that
\begin{itemize}
\item $\phi$ preserves distances from the origin, 
\item $V_{sur}=V'_{sur}$, and 
\item the restriction of $\phi$ to $V_{sur}$ is the identity map $I$.
\end{itemize}
\indy{Notation}{V@$\CalV$ (family of packings)}%%
\indy{Notation}{V@$V_{iso}$ (contact isolated vertices)}%%
\indy{Notation}{V@$V_{sur}$ (contact surrounded vertices)}%%
\indy{Notation}{I@$I$ (identity map)}%

\claim{The set $\CalV$ is a nonempty compact topological space.}  Indeed, by fixing an enumeration
$V = \{\v_0,\ldots,\v_r\}$,  
the set $\CalV$ embeds into Euclidean space of dimension $3r$ under the map that sends
the pair $(V',\phi)$ to 
the point $(\phi^{-1}\v_0,\ldots,\phi^{-1}\v_r)$.
Thus, $\CalV$ carries a metric space topology as a subset of Euclidean space.  With a little
argument, it follows from the boundedness of $V\subset B(0,2\hm)$ that $\CalV$ is compact.
Also, $(V,I)\in \CalV$, so $\CalV\ne\emptyset$.


For any pair $(V',\phi)$ in $\CalV$ and $\w\in \phi(V_{iso})$, let
$c(V',\phi,\w)$, 
be the minimum distance of $\w$ to a point
in $V'\setminus \{\w\}$.   
For $i=1,\ldots,n=\card(V_{iso})$
define constants $c_i=c_i(V',\phi)$,
by ordering the real numbers $c(V',\phi,\w)$, $\w\in\phi(V_{iso})$, in increasing order:
$$
c_0 \le c_1 \le c_2 \le \cdots \le c_n.
$$
The constants $c_i:\CalV\to\ring{R}$ are continuous functions on the compact configuration space $\CalV$.
There is a nonempty 
compact subset $\CalV_0$ of $\CalV$ on which
$c_0$ attains its maximum value. Continuing recursively,
there is a nonempty compact subset $\CalV_{i+1}$ of
$\CalV_{i}$ on which $c_i$ attains its maximum value.
\indy{Notation}{c i@$c_i$ (constant)}%
\indy{Notation}{V@$\CalV_0$}%

For the configuration $(V,I)\in \CalV$, it follows that $c_0(V,I) >2$.
Hence, $c_0(V',\phi)>2$ for $(V',\phi)\in\CalV_0$.  It follows
that $V'_{iso}$ is in bijective correspondence with
$V_{iso}$, for all $(V',\phi)\in \CalV$.

\claim{Any $(V',\phi)\in \CalV_n$ has the desired property.} Otherwise,
there exists some vertex $\v'\in V'_{iso}$ (in contact isolation)
is neither isolated nor surrounded in the standard fan.  
Any such vertex satisfies $c(V',\phi,\phi(\v'))=c_i(V',\phi)$ for some $i$.
Among such vertices, pick the vertex with smallest index
$i$.  Write 
$$
c(V',\phi,\phi(\v')) = c_i(V',\phi) = c_{i+1}(V',\phi) =\cdots= c_j(V',\phi) < c_{j+1}(V',\phi),
$$
for some $j\ge i$.  As $\v'$ is not isolated in the
standard fan, it follows that $c_j(\v') < 2\hm$.  As $\v'$ is not surrounded in the standard fan,
in the cyclic order on
$$
\{(\v',\w')\in V'^2 \mid \norm{\v'}{\w'} = c_j(\v')\},
$$
some azimuth angle is at least $\pi$.
Thus, there is a direction in which $\v'$ can be perturbed
that increases $c_j$, while keeping $c_0,\ldots,c_{j-1}$
fixed.  This is contrary to the defining property of
$\CalV_n\subset\CalV_j$.  This establishes the claim.
\indy{Notation}{\v@$\v$ (vertex)}%
\end{proof}



\begin{lemma}\guid{FCDJDOT}\rating{100}\label{lemma:CE} 
Assume that there exists a counterexample to inequality~\ref{eqn:CCE}.  Then there also exists a counterexample $V$ with the following properties.
\begin{itemize}
\item $V\subset \BB$
\item $\CalL(V) > 12$, and no finite packing in $\BB$ attains a value larger than $\CalL(V)$.
\item The cardinality of $V$ is $13$ or $14$.
\item Every vertex $\v$ is surrounded in the standard fan $(V,E_{std})$.
\item Every vertex $\v$ that is not surrounded in the contact
fan $(V,E_{ctc})$ satisfies $\normo{\v}=2$.
\end{itemize}
\end{lemma}

\begin{proof}  Assume that a counterexample exists.
The set of counterexamples $V\subset\BB$ is a compact set.  The function $\CalL$ is a continuous function on this compact set.  Hence, there exists $V$ that maximizes $\CalL(V)$.

The set $V$ has cardinality $13$ or $14$ (Lemma~\ref{lemma:13-14}). Lemma~\ref{lemma:surrounded} gives the existence of a counterexample $V$ in which every vertex is surrounded or isolated in the standard fan.  By Lemma~\ref{lemma:D'}, if there are any isolated verices in the standard fan, then it is not a counterexample.  Hence, in fact every vertex is surrounded in the standard fan.  

\claim{A vertex $\v$ that is not surrounded in the contact fan satisfies $\normo{\v}=2$.}  Otherwise, the counterexample does not maximize $\CalL$.
\indy{Notation}{V@$V$ (set of vertices)}%
\end{proof}


\begin{definition}[contravening]
A finite packing is $V$ a {\it contravening} packing if it satisfies the properties
of Lemma~\ref{lemma:CE}.  The fan $(V,E_{std})$ and the hypermap $\op{hyp}(V,E_{std})$ are said
to be {\it contravening} when $V$ is contravening.
\indy{Index}{packing!centered contravening}%
\indy{Index}{hypermap!contravening}%
\end{definition}



The next section studies further properties of contravening hypermaps $H$.



\section{Contravention is Tame}
\indy{Index}{tame!contravention}%
    \label{sec:contraproof}

Let $V$ be a centered packing with
standard fan $(V,E)$ and hypermap $H=\op{hyp}(V,E)=(D,e,n,f)$
be the hypermap attached to $(V,E)$.
The hypermap $H$ is plain, planar, connected, and simple.
The set of topological components of $Y(V,E)$ is in bijection with
the set of faces of $H$.  
\indy{Notation}{H@$H$ (hypermap)}%
For each face of $H$, the corresponding component $U_F$
is eventually radial with solid
angle
\indy{Notation}{U@$U_F$ (component)}%
  $$
  \sol(U_F) = 2\pi + \sum_{x\in F} (\op{azim}(x) -\pi).
  $$
Recall that
    $$\sum_{F} \sol(U_F) = 4\pi.$$
Recall the a map $\v:D\to V$ that maps each dart to its vertex:
$$
\v \mapsto \v(x); \quad   x = (\v(x),\ldots).
$$
Set 
$$h(x) = \normo{\v(x)}/2.$$
Define the weight function
\begin{equation}
\begin{array}{lll}
\tau(V,E,F) &=\sum_{x\in F} \op{azim}(x)\left(1 + \dfrac{\sol_0}{\pi}(1- L(h(x)))\right) + \left(\pi+{\sol_0}\right) (2- k(F))\vspace{6pt}\\
  &= \sol(U_F) + (2- k(F))\sol_0 - \dfrac{\sol_0}{\pi}\sum_{x\in F}\op{azim}(x) (L(h(x)) - 1)\vspace{6pt}\\
&= \sol(U_F) \left( 1 + \dfrac{\sol_0}{\pi}\right) - \dfrac{\sol_0}{\pi} \sum_{x\in F} \op{azim}(x)(L(h(x))),\\
\end{array}
\end{equation}
where $\sol_0$ is the solid angle of a spherical equilateral triangle of side $\pi/3$, and $k(F)$ is the cardinality of $F$.
% 
These formulas are equivalent.  The proof of equivalence rests on the Euler formula for planar hypermaps and the solid angle formula for topological components $U_F$.
The first expression for $\tau(V,E,F)$ is particularly convenient, because it expresses $\tau$ as a sum of local contributions from each dart.
\indy{Notation}{L@$L$}%
\indy{Notation}{ZZtau@$\tau$}%
\indy{Notation}{ZZDeltanaught@$\sol_0$}%
The main conjecture may be expressed in the following alternative form:

\begin{lemma}\guid{HRXEFDM}\rating{80}
$$
\sum \tau (V,E,F) \ge 4\pi - 20\sol_0
$$
if and only if
$$
\sum L(h(x)) \le 12.
$$
\end{lemma}

\begin{proof}
The solid angles over the sphere sum to $4\pi$ and the azimuth angles at each vertex sum to $2\pi$. 
% The Euler relation for connected plain planar hypermaps gives
%$$
%\sum_F (2- k(F)) = 2\#f - 2\#e = 4 - 2\#n.
%$$
Thus,
\begin{equation}\label{eqn:delta0}
\begin{array}{lll}
\sum \tau (V,E,F) 
&= 4\pi (1 + \dfrac{\sol_0}{\pi}) - (\dfrac{\sol_0}{\pi}) 2\pi \sum_{V} L(h)\vspace{6pt}\\

&= (4\pi - 20\sol_0) + 2\sol_0 (12 - \sum_V L(h(\v,\orz))).
\end{array}
\end{equation}
The result follows.
\end{proof}

The significance of the constant $\op{tgt}$ is that it is approximately equal to $4\pi - 20\sol_0$.
\indy{Notation}{tgt@$\op{tgt}=1.541$}%
The following theorem is one of the main results of this chapter.  The proof has been broken into
a series of steps in the sections that follow.

\begin{theorem}\guid{MQMSMAB} \label{theorem:contravene}
Let $V$ be a contravening  packing.  Then the weight assignment $\tau=\tau(V,E_{std},\cdot)$ on
$H=\op{hyp}(V,E_{std})$ is admissible.  Moreover, 
the hypermap $H$ is tame with weight assignment $\tau$.
\end{theorem}
\indy{Notation}{H@$(H, \tau)$}%
\indy{Notation}{H@$H$ (hypermap)}%
\indy{Notation}{ZZtau@$\tau$ (weight)}%



\subsection{general properties}
    \label{sec:startame}


Many of the properties of tameness are trivial or have been established in earlier sections.
The following lemma quickly disposes of many of the properties of tameness.

\begin{lemma}\guid{JGTDEBU}\rating{100}\label{lemma:multi} %100=without (vi), %(deprecated: 300=with (vi))
A contravening hypermap $H$ satisfies Properties
\case{planar}, \case{simple}, \case{nondegenerate}, \case{no loops}, \case{no double joins}, \case{face count}, 
\case{node count}, and the first part of \case{node size}
%~(i)--(\v),  % was (i)-(vi).
%(viii),  (x), and the first part of (xi).
of tameness.
\end{lemma}

\begin{proof}
The hypermap is plain, planar, connected, and simple by the general results established in the chapter on fan.  That chapter also shows that the hypermap attached to a fan satisfies properties \case{nondegenerate}, \case{no loops}, and \case{no double joins}.

%The property~(vi) is established in \cite[Lemma~3.7]{sp1}.
\claim{Properties~\case{face count} and the first half of property~\case{node size} hold}.  Indeed, every vertex is surrounded, meaning that the azimuth angles of the darts at the vertex are less than $\pi$.  As the angles around the vertex sum to $2\pi$, there are at least three darts in the node. Each of the darts in the node leads into a different face by property~\case{simple}.

%% 13 or 14 nodes.
Finally, property~\case{node count} has already been established in Lemma~\ref{lemma:CE}.
\end{proof}

There remain properties \case{face size} (Lemma~\ref{lemma:face-size}), %(vii), (ix), the second part of (xi), (xii), and (xiii).
\case{node types} (Lemma~\ref{lemma:degE}),  \case{weights bound a} (Lemma~\ref{lemma:degE}), \case{weights bound b} (Lemma~\ref{lemma:weightB}), \case{weights bound d} (Lemma~\ref{lemma:main}), 
and the second part of \case{node size} (Lemma~\ref{lemma:node-upper}).


\subsection{properties of nodes}
\indy{Index}{node!properties}%



\begin{lemma}\guid{CDTETAT}\rating{140} \label{lemma:0.852}
Let $H$ be a contravening
hypermap. For every dart $x$ in a triangular face of $H$,
    $$0.852\le \azim(x)\le 1.9.$$
For every dart $x$ in a nontriangular face of $H$, 
    $$1.15\le\azim(x)\le 3.27.$$
\indy{Notation}{H@$H$ (hypermap)}%
\indy{Notation}{x@$x$ (dart)}%
\indy{Notation}{\v@$\v$ (vertex)}%
Consequently, if a vertex $\v$ has type $(p,q,0)$, then $(p,q)$
must be one of the following pairs:
$$
\begin{array}{lll}
&(0,2),~(0,3),~(0,4),~(0,5),~(1,2),~(1,3),~(1,4),~(2,1),~(2,2),~(2,3),\\
&(3,1),~(3,2),~(3,3),~(4,0),~(4,1),~(4,2),~(5,0),~(5,1),~(6,0),~(6,1),~(7,0)
\end{array}
$$
\end{lemma}
 %
 
\begin{proof}
The angle bounds are a calculation.  The sum of the azimuth angles
around a vertex satisfies:
$$
  p (0.852) + q (1.15) \le 2\pi \le p (1.9) + q (3.27),
$$
and the pairs satisfying these constraints are listed.
\end{proof}

\begin{lemma}\guid{SZIPOAS}\oldrating{80}\label{lemma:node-upper}
\rating{0}
\formalauthor{Vu Thanh}
%dcg{Lemma~21.4}{223} 
Contravening hypermaps satisfy the second part of property \case{node size}
%\ref{definition:tame:degree} 
of tameness.  That is, the cardinality of every
node is at most $7$.
\end{lemma}

\begin{proof}  The azimuth angle bound
$$
 (p+q+r) 0.852 \le 2\pi
$$
implies $p+q+r < 8$.
\end{proof}




\begin{lemma}\guid{KCBLRQC}\rating{300} \label{lemma:weightB}
Let $\v$ be a node of type $(p,q,0)$ in a contravening hypermap.    Then the property~\case{bound b} of a admissible weight assignment holds:
$$
\sum_{ F\cap \v\ne \emptyset} \tau(V,E,F) \ge  b(p,q).
$$
\end{lemma}
\indy{Notation}{A@$A$ (faces)}%
\indy{Notation}{\v@$\v$ (node)}%
\indy{Notation}{pqr@$(p,q,r)$}%

\begin{proof} Let $A =\{F\mid F\cap \v\ne\emptyset\}$.  The archive \cite[FUSDSPJ]{hales:2009:nonlinear} contains a list of nonlinear inequalities
for $\tau(V,E,F)$ when $F$ is a triangle or quadrilateral. Each nonlinear inequality has the form
\indy{Notation}{F@$F$ (polygon)}%
$$\tau(V,E,F) \ge a~\op{azim}(x) + b,$$
for some $a,b\in\ring{R}$, where $x$ is the uniquely determined dart at the node $\v$ in the face $F$.  These nonlinear inequalities admit a linear relaxation as follows.  For each $a,b$,  write a corresponding linear inequality
\indy{Notation}{ZZtau@$\tau$}%
\indy{Notation}{x@$x$ (dart)}%
\indy{Notation}{\v@$\v$ (node)}%
$$
t(F) \ge a~z(F) + b,
$$
where $t(F)$ and $z(F)$ are variables indexed by $F\in A$.
\indy{Notation}{A@$A$ (index set)}%
\indy{Notation}{t@$t$ (variable)}%
\indy{Notation}{z@$z$ (variable)}%
Then  minimize 
$$\sum_{F\in A} t(F)$$
subject to these linear inequalities and the constraint
$$
2\pi = \sum_{F\in A} z(F).
$$
This linear program has been executed on a computer for each of the types $(p,q,0)$ of Lemma~\ref{lemma:0.852}. The given constants are obtained from the (downward rounded) solutions to these linear programs.
\end{proof}

\begin{lemma}\guid{BDJYFFB}\rating{200}\label{lemma:degE}
Every contravening hypermap satisfies Properties \case{node types} and \case{weight bound A}
%\ref{definition:tame:degreeE} 
of tameness: 
If a node has cardinality $7$, then the type of the
       node is $(p,q,0)$ for some $p,q\ge0$.   If the
        cardinality of the node is exactly $6$, then the type of the node
        is $(6,0,0)$, $(5,0,1)$, or $(5,1,0)$.
If the type is $(5,0,1)$, let $A$ be the set of five triangles at the
node $\v$.  Then
\indy{Notation}{A@$A$ (set of triangles)}%
\indy{Notation}{\v@$\v$ (node)}%
$$
\sum_{F\in A} \tau(V,E,F) > a,
$$
where $a=0.63$.
\end{lemma}



\begin{proof} These conclusions also come from linear programming.
The same set of nonlinear inequalities is used, and the linear
relaxation is constructed in the same way.  The linear programming
bounds exceed the constant $\op{tgt}$ in the cases excluded in the conclusion
of the lemma.  The constant $a$ is the downward rounding of the solution to the linear program for $(5,0,1)$.
\end{proof}
\indy{Notation}{tgt@$\op{tgt}=1.541$}%

\indy{Notation}{a@$a$ (constant)}%

\subsection{faces}



\begin{lemma}\guid{CRTTXAT}\rating{140}  \label{lemma:face-size}
Property~\case{face size} holds.  That is,
Every face of a contravening hypermap $\op{hyp}(V,E_{std})$ has cardinality at least $3$ and at most $6$.
\end{lemma}

\begin{proof} The lower bound holds because the hypermap has no loops or double joins.  For a contradiction, let $F$ be a face of the hypermap of cardinality at least $7$.  Divide the proof into cases depending on whether the
following inequality holds:
$$
\sum _{x\in F} (\normo{\v(x)}-2) \ge 4(\hm-1).
$$
If the inequality holds, then since $L$ is the linear interpolation between the points $(1,1)$ and $(\hm,0)$, and there are at most $14$ points in $V$, it follows that
$$\CalL(V) = \sum_{\v\in V}L(\normo{\v}/2) \le 12 L(1) + 2 L(\hm) =12,$$
and the main inequality holds.

Now assume that the inequality is false.
The edge $\{\v,\w\}$ has arclength at least
$$
\arc(\normo{\v},\normo{\w},\norm{\v}{\w}) \ge \arc(\normo{\v},\normo{\w},2). 
$$

A calculation~\cite[cc:arc]{hales:2009:nonlinear} gives
$$\arc(\normo{\v},\normo{\w},2)\ge 1 - 0.6076 (\normo{\w}/2 - 1) - 0.6076 (\normo{\v}/2 - 1).$$ %%CC:arc
The sum over a face of size at least $7$ gives
$$
\begin{array}{lll}
\sum \arc(\normo{\v_i},\normo{\v_{i+1}},\norm{\v_i}{\v_{i+1}})&\ge
7 - 0.6076 \sum (\normo{\v_i}-2) \\
   &\ge 7 - 0.6076 (2) (0.52) \\
   &> 2\pi.
\end{array}
$$
The left-hand side is the perimeter of the localization of $(V,E)$ along $F$.
This perimeter estimate is contrary to the upper bound on perimeter in Lemma~\ref{lemma:convex-hyp}.
\end{proof}

\begin{lemma}\guid{GBMLQWW}\rating{ZZ}  \label{lemma:tau-local}
Let $V$ be a contravening packing with
standard fan $(V,E_{std})$.  Let $F$ be any face of $\op{hyp}(V,E_{std})$.  Then
$$
\tau(V,E_{std},F) = \tau(V',E',F),
$$
where $(V',E',F)$ is the localization of $(V,E_{std})$ along the face $F$.
\end{lemma}

\begin{proof}  The value $\tau(V,E,F)$ is expressed entirely in terms of $\normo{\v}$ for $\v\in V'\subset V$ and in terms of $\op{azim}(x)$, for $x\in F$.  By Lemma~\ref{lemma:localization}, the terms $\op{azim}(x)$ are the same, whether calculated in terms of the hypermap of $(V,E_{std})$ or in terms of that of $(V',E')$. 
\end{proof}



\section{admissibility}


%\begin{theorem}\guid{THPJDQA}\rating{0}  %points for OLNSWLK below.
%The weight assignment $\tau$ on a contravening hypermap is admissible, and the  total weight of $\tau$ is less than $\op{tgt}=1.541$.
%\indy{Index}{weight assignment}%
%\end{theorem}
%\indy{Notation}{tgt@$\op{tgt}=1.541$}%
%\subsection{admissibility}
%\label{sec:admissibility}


The main result (Lemma~\ref{lemma:main}) of this section is a proof that for every contravening hypermap $H=\op{hyp}(V,E)$, the function $\tau(V,E,\cdot)$
is an admissible weight assignment on $H$.



\begin{lemma}\guid{OLNSWLK}\rating{3000}\label{lemma:main} %including lemmas that lead up to it.  Interval ineq may be assumed.  
Property~\case{weight bound d} holds.  That is,
let $V_0$ be a contravening packing, and  let $F$ be a
face of $\op{hyp}(V_0,E_{std})$ of cardinality $k$.  Then
        $\tau(V_0,E_{std},F) \ge d(k)$.
\end{lemma}
\indy{Notation}{F@$F$ (face)}%
\indy{Notation}{k@$k$ (cardinality of a face)}%


\begin{remark}
In the original 1998 proof, the corresponding result
is called the ``Main Estimate.''  The proof of that 
theorem takes about 30 pages and relies on many
long computer calculations.  The proof given here
is substantially simpler than the proof of the original
main estimate, but
it is still nontrivial. The proof presented in this book has the advantage
of various special features that were not present in the original proof: 
polygons are convex, the hypermap
is simple, and that each face has at most six sides.
\end{remark}






\begin{lemma} \guid{RNSYJXM}\rating{ZZ}
Let $(V,E)$ be any fan, and let $F$ be a face of its hypermap.  Let $(V',E')$ be
the localization of $(V,E)$ along $F$.
Assume that $\op{azim}(x)<\pi$, for every dart $x$ in $\op{hyp}(V,E)$.
Then $(V',E',F)$ is a cyclic fan. 
\end{lemma}

\begin{proof}
Lemma~\ref{lemma:localization} gives all the properties of a cyclic fan except for property \case{wedge}:
$V'\subset \bWdart(x)$ for every dart
$x\in F$.    By Lemma~\ref{lemma:face},  $U_F \subset \Wdart(x)$. 
The wedge $\bWdart(x)$ is closed and contains $\Wdart(x)$. Hence, the
closure $\bar U_F$ is contained in $\bWdart(x)$.  Let $\v\in V'$ and choose
$\w\in V$ such that $y=(\v,\w)\in F$.
%There is a dart of $F$ of the form $y=(\v,\rho \v)$.  Since $y$ leads into 
Since the dart $y$ leads into
$U_F$, every neighborhood of
$\v$ meets $U_F$.  Thus, $\v\in \bar U_F\subset \bWdart(x)$.  This completes
the proof.
\end{proof}


%
%\begin{lemma}\guid{BGDPIZY}\rating{ZZ}
%Suppose that
%$$
%\tau(V,E,F) \ge d (r,s)
%$$
%for every special fan $(V,E,F,G)$,
%where $(r,s)$ are the parameters of the special fan.
%Then Lemma~\ref{lemma:main} holds.
%\end{lemma}



%The proof adopts the following convention for
%configurations.  Let $v_0,\ldots,v_{n-1}$ be the vertices
%of the polygon, and write
%$$
%y_i = \normo{v_i},\quad y_{ij} = \norm{v_i}{ v_j}.
%$$
%\indy{Notation}{v@$v$ (vertex)}%


\begin{note}%XX
This proof seems to be repeated twice.  Delete one.
\end{note}

\begin{proof}
Let $V_0$ be a contravening packing.
By Lemma~\ref{lemma:tau-local}, $\tau(V_0,E_{std},F)=\tau(V,E,F)$  where $(V,E,F)$ is the
localization of
$(V_0,E_{std})$ along $F$. 

\claim{The tuple $(V,E,F,\emptyset)$ is a special fan.}  Indeed, every property can be verified in turn.  The properties \case{packing} and
\case{annulus} result from the assumption that $V$ is contravening
packing.  

\case{cyclic fan}  The localization $(V,E,F)$ is indeed a cyclic fan.

\case{diagonal}  If $\norm{v}{w}<2\hm$ and $v\ne w$, then $\{v,w\}\in E_{std}$.
%Assume that $v,w\in V$ and 
%$C^0\{v,w\}\subset \Wdart(x)$ for all $x\in F$.
%The intersection of the sets $\Wdart(x)$ is the topological component
%$U_F$ of $Y(V_0,E_{std})$.  Thus, $C^0\{v,w\}\subset Y(V_0,E_{std})$.
%Assume for a contradiction that $\norm{v}{w}< 2\hm$. Then by the definition of $E_{std}$, $\{v,w\}\in E_{std}$.
%Hence $C^0\{v,w\}\subset X(V_0,E_{std})$. This leads to a contradiction, because
%$C^0\{v,w\}$ is nonempty, and $X(V_0,E_{std})\cap Y(V_0,E_{std})=\emptyset$.

\case{subset} \case{g norm}  These properties are trivial, because $G=\emptyset$.

\case{e norm} If $\{v,w\}\in E$, then $\{v,w\}\in E$.  It follows from the definition of
standard fan that $2\le \norm{v}{w}\le 2\hm$.

\case{card} Let $s=\card(\emptyset) = 0$, and $r=\card(E)$.  Then $0\le s\le 3$ is trivial. Also, 
$$3-s \le 3\le r \le 6=6 - 2s$$
follows from the defining property \case{face size} of a tame hypermap.  This proves that claim that
$(V,E,F,\emptyset)$ is a special fan with parameters $r=k$ and $s=0$.

By Lemma~\ref{lemma:min-empty}, the set of minimal fans is empty.
By Lemma~\ref{lemma:empty-d}, 
$$
\tau(V,E,F) \ge d (r,s)
$$
for every special fan $(V,E,F,G)$. 
Finally, 
$$\tau(V_0,E_{std},F)=\tau(V,E,F) \ge d(r,s) = d(k,0) = d(k).$$  
This completes the proof.  
\end{proof}

\begin{proof}
Let $V_0$ be a contravening packing.
By Lemma~\ref{XX}, $\tau(V_0,E_{std},F)=\tau(V,E,F)$  where $(V,E,F)$ is the
localization of
$(V_0,E_{std})$ along $F$. 

\claim{The tuple $(V,E,F,\emptyset)$ is a special fan.}  The properties \case{packing} and
\case{annulus} result from the assumption that $V$ is contravening
packing.  

\case{cyclic fan}  The localization $(V,E,F)$ is indeed a cyclic fan.

\case{diagonal XX}  Assume that $\v,\w\in V$ and 
$C^0\{\v,\w\}\subset \Wdart(x)$ for all $x\in F$.
The intersection of the sets $\Wdart(x)$ is the topological component
$U_F$ of $Y(V_0,E_{std})$.  Thus, $C^0\{\v,\w\}\subset Y(V_0,E_{std})$.
Assume for a contradiction that $\norm{\v}{\w}< 2\hm$. Then by the definition of $E_{std}$, $\{\v,\w\}\in E_{std}$.
Hence $C^0\{\v,\w\}\subset X(V_0,E_{std})$. This leads to a contradiction, because
$C^0\{\v,\w\}$ is nonempty, and $X(V_0,E_{std})\cap Y(V_0,E_{std})=\emptyset$.

\case{subset} \case{g norm}  These properties are trivial, because $G=\emptyset$.

\case{e norm} If $\{\v,\w\}\in E$, then $\{\v,\w\}\in E$.  It follows from the definition of
standard fan that $2\le \norm{\v}{\w}\le 2\hm$.

\case{card} Let $s=\card(\emptyset) = 0$, and $r=\card(E)$.  Then $0\le s\le 3$ is trivial. Also, 
$$3-s \le 3\le r \le 6=6 - 2s$$
follows from the defining property \case{face size} of a tame hypermap.  This proves that claim that
$(V,E,F,\emptyset)$ is a special fan with parameters $r=k$ and $s=0$.

Finally, 
$$\tau(V_0,E_{std})=\tau(V,E,F) \ge d(r,s) = d(k,0) = d(k).$$  
This completes the proof.
\end{proof}


\begin{remark}
It is helpful to keep in mind the origin of the constants $d(k)$.
Although the proof of Lemma~\ref{lemma:main} does not produce sharp lower bounds on $\tau(V,E,F)$, the
statement of the lemma is motivated by the following configurations.
Consider a nonplanar polygon contained in a sphere of radius $2$, with $k$ sides all of length $y_{i,i+1}=2$, heights
$y_i=2$, and $k-3$ diagonals of length $2\hm$: $y_{0,j}=2\hm$, for
$j=2,\ldots,k-2$.  Let $V$ be the set of vertices of the polygon, let $(V,E_{ctc})$ be its contact fan, and let $F$ be the face of $\op{hyp}(V,E_{ctc})$ representing the ``interior'' of the polygon.  Evaluating $\tau$ on these rigid configurations gives
$$
\tau(V,E_{ctc},F) = \begin{cases}
0.20612\ldots & k=4\\
0.48356\ldots & k=5\\
0.760993\ldots &k=6
\end{cases}
$$
These calculations suggested the values of constants $d(k)$.  The constants $d(k)$ are slightly smaller than these calculated values.\footnote{Note $\tau(2.1028,2,2,2,2.52,2.52) = 0.275951\ldots < 0.277433\ldots = \tau(2,2,2,2,2.52,2.52)$.}
\indy{Notation}{d@$d$ ($\tau$ bound)}%
\indy{Notation}{ZZtau@$\tau$}%
\indy{Notation}{k@$k$ (face size)}%
\end{remark}


\section{Linear Programs}

One can attach a linear program to each tame hypermap.
For each tame hypermap $H$ there is a configuration space $D(H)$ of all
finite packings $V\subset \BB$ whose standard fan is
isomorphic to $H$.
\indy{Notation}{H@$H$ (hypermap)}%
\indy{Notation}{D@$D(H)$ (configuration space)}%

A nonlinear optimization problem asks for the maximum of
\begin{equation}\label{eqn:L2}
\sum_{\v\in V} L(\normo{\v}/2)
\end{equation}
over all $V\in D(H)$.

The linear program comes as a linear relaxation of this nonlinear
optimization problem on $D(H)$. That is, the optimal solution of the
the linear program has value at least as great as the corresponding
nonlinear problem.  By showing that the value of each linear program
is at most $12$, one may conclude that the maximum of \eqn{eqn:L2}
is at most $12$.


\begin{note}%XX
The linear programming part of the proof has not been completed. There are two cases that remain.
\end{note}

