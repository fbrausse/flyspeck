% Flyspeck
% Thomas C. Hales
% Starting with Chapter on Tame Hypermaps

% Sep 3, Removed 2 enclosed in quad properties.

\chapter{Tame Hypermap}
\indy{Index}{Tame Hypermap}
\indy{Index}{Tame!Hypermap}

\label{sec:tame}
\indy{Index}{tame}


This chapter defines a class of hypermaps.  Hypermaps in this class
are said to be {\it tame}.  A complete
classification of all tame hypermaps has been carried out by computer.   This classification solves a
major step of the packing problem.
\indy{Index}{tame}
\indy{Index}{hypermap}


\section{Definition}


\begin{definition}[triangle,~quadrilateral,~exceptional]
Let $H$ be a hypermap.
Faces of cardinality $3$ are called {\it triangles}, those of
cardinality $4$ are called {\it quadrilaterals}, and so forth.  A face of
cardinality at least $5$ is called an {\it exceptional\/} face.
 %
 \indy{Index}{triangle}
 \indy{Index}{exceptional}
 \indy{Index}{quadrilateral}
 \indy{Index}{exceptional!face}
 \indy{Index}{pZ@$p_v$}
\end{definition}

\begin{definition}[type,~$(p,q,r)$]\label{definition:type}
The {\it type\/} of a node is defined to be a triple of
non-negative integers $(p,q,r)$, where $p$ is the number of
triangles meeting the node, $q$ is the number of quadrilaterals
meeting it, and $r$ is the number of exceptional faces meeting it.
%
 \indy{Index}{type (of a node)}
\end{definition}


\subsection{weight assignment}\label{sec:wtassign}
\indy{Index}{weight assignment}

We call the constant $\op{tgt}=1.541$, which arises repeatedly in
this chapter, the {\it target}. 
%
 \indy{Index}{target}\indy{Index}{tgt@$\op{tgt}=1.541$}


\begin{definition}[b]
  Define $b:\ring{N}\times \ring{N}\to \ring{R}$ by $b\pqr{(p,q,0)}=1.541$,
  except for the values in the following table
  (with  $\op{tgt}=1.541$):
  {
  \def\tx{\op{tgt}}
  $$\begin{matrix}  &q=0&1&2&3&4\\
           p=0&\tx&\tx&\tx&0.618&1.0\\
           1&\tx&\tx&0.66&0.618&\tx\\
           2&\tx&0.8&0.412&1.2851&\tx\\
           3&\tx&0.315&0.83&\tx&\tx\\
           4&0.35&0.374&\tx&\tx&\tx\\
           5&0.04&1.144&\tx&\tx&\tx\\
           6&0.689&\tx&\tx&\tx&\tx\\
           7&1.450&\tx&\tx&\tx&\tx
   \end{matrix}
   $$
   }
\indy{Notation}{b@$b$}
\end{definition}


\begin{definition}[d]
    Define $d:\ring{N}\to \ring{R}$ by
  $$d(n) = \begin{cases}
    0 & n=3, \\
    0.206 & n=4, \\
    0.4819 & n=5, \\
    0.7578 & n=6, \\
    %1.038 & n=7, \\
    %1.315 & n=8,\\
    \op{tgt}=1.541 & \text{otherwise}.
  \end{cases}
  $$
\indy{Notation}{d@$d$}
\end{definition}


We write $\card(S)$ for the cardinality of a finite set $S$.
\indy{Index}{card}
\indy{Index}{cardinality}


\begin{definition}[weight~assignment]
%
A {\it weight assignment\/} of a hypermap $H$ is a function $\tau$ on
the set of faces of $H$, taking values in the set of non-negative
real numbers. A weight assignment is {\it admissible} if the
following properties hold:
%
 \indy{Index}{weight assignment}
 \indy{Index}{admissible (weight assignment)}
 \indy{Index}{cardinality}
 \indy{Index}{node}
\begin{enumerate}
  \item If the face $F$ has cardinality $n$, then
        $\tau(F) \ge d(n)$
  \item If a node $v$ has type $(p,q,0)$, then
        $$\sum_{F:\,v\cap F\ne\emptyset} \tau(F) \ge b{\pqr{(p,q,0)}}.$$
        \label{admissible:b}
  \item Let $v$ be any node of type $(5,0,1)$, and let $A$ be the set of
triangles meeting that node.
        Then
        $$\sum_{F\in A} \tau(F)
            \ge  a,$$
   where $a=0.63$.
        \label{definition:admissible:excess}
\end{enumerate}
The sum $\sum_F \tau(F)$ is called the {\it total weight} of $\tau$.
\indy{Index}{total weight}
\end{definition}





\subsection{hypermap property}
\label{sec:graphproperty}
\indy{Index}{hypermap property}
\indy{Index}{property!hypermap}



We say that a hypermap is {\it tame\/} if it satisfies the following
conditions.
%
 \indy{Index}{tame}

\begin{enumerate}
    \label{definition:tame}
    %1
    \item {\bf (planar)} The hypermap is plain, planar.
    \item {\bf (simple)} The hypermap is connected and simple.  In particular, every face meets every node in at most one dart.
    \item {\bf (nondegenerate)} The edge map $e$ has no fixed points.
    \item {\bf (no loops)} The two darts of each edge lie in different nodes.
    \item {\bf (no double joins)} The set of edges meeting any two given nodes has cardinality at most $1$.
    \label{definition:tame:40}
    \item {(blank)}
%    \item {\bf (triangles)} If $L$ is a contour loop with three face steps, and if there exists a node in
%    the exterior of $L$, then $L$ is a face of the hypermap.
%    \label{definition:tame:3-circuit}
\item {\bf (blank)}
 %   \item {\bf (quadrilaterals)} If $L$ is a contour loop with four face steps, and there are at least two nodes    in the exterior of $L$, then the interior of $L$ takes one of the forms     illustrated in Figure
 %   \ref{fig:fourcircuit}.
 %   \label{definition:tame:4-circuit}
  %  \begin{figure}[htb]
  %      \centering
  %      \myincludegraphics{\pdfp/fourcircuit.eps}
  %      \caption{Tame $4$-circuits}
  %      \label{fig:fourcircuit}
  %  \end{figure}
  \item {\bf (face)} There are at least three faces.
    \item {\bf (face)} The cardinality of each face is at least $3$ and at most $6$.
    \label{definition:tame:length}
    \item {\bf (node)} There are either $13$ or $14$ nodes.
    \item {\bf (node)} The cardinality of every node is at least $3$ and at most
    $7$.
    \label{definition:tame:degree}
    \item {\bf (node)} If a node meets an exceptional face,
        then the cardinality of the node is at most $6$.  If the
        cardinality is exactly $6$, then the type of the node
        is $(5,0,1)$.
    \label{definition:tame:degreeE}
    \item {\bf (weights)} There exists an admissible weight assignment
        of total weight less than the target, $\op{tgt}=1.541$.
    \label{definition:tame:squander}
\end{enumerate}
%
\indy{Index}{planar}
\indy{Index}{simple}
\indy{Index}{nondegenerate}
\indy{Index}{no loops}
\indy{Index}{no double joins}
\indy{Index}{face}
\indy{Index}{weights}

\section{Classification}
    \label{sec:proof-classification}
\indy{Index}{Classification}

%\section{Statement of the Theorem}
\label{sec:classification}




\begin{definition}[opposite] The opposite of a hypermap $(D,e,n,f)$ is the
hypermap $(D,f n,n^{-1},f^{-1})$.
\indy{Index}{opposite}
\end{definition}

\begin{lemma}\guid{PPHEUFG}
\oldrating{300}
\rating{0}
\formalauthor{Diep Trieu Thi} 
A hypermap is tame if and only if its opposite hypermap is as well.
\end{lemma}

A list of hypermaps appears at \cite{website:Hales:1998:Code}.

\begin{theorem}\guid{WTEMDTA}
\label{theorem:classification} Every tame hypermap is isomorphic to
a hypermap in this list, or is isomorphic to the opposite of a
hypermap in this list.
\indy{Index}{isomorphic}
\end{theorem}

\begin{note}%XX
The (java version of the) graph generator has been run with the new parameters described in this version of the book.  It produces finitely many graphs (about 25,000).  This new list will eventually replace the archive from 1998.  The Bauer-Nipkow formalization of the classification has not yet been adapted to this new definition of tameness.
\indy{Index}{java}
\end{note}


Computers are used to generate a list of all hypermaps and to check
them against the archive of tame hypermaps.  The computer program is
based on the hypermap generation construction of Section~\ref{sec:face-insert}.  There it is
proved that all sufficiently nice hypermaps can be generated by an
elementary face-insertion process.  Tame hypermaps satisfy all the
hypotheses of that lemma.
\indy{Index}{computer calculation}

\section{Contravening hypermap}

\indy{Index}{contravening hypermap}
\indy{Index}{hypermap!contravening}
Our aim is to prove Conjecture~\ref{conj:L12}.  Arguing by contradiction, we assume that we have a counterexample.  The purpose of this section is to select a special class of counterexamples.

A counterexample to the Kepler conjecture leads to a finite packing $\Lambda$ with $0\in\Lambda$ that violates the inequality of Corollary~\ref{cor:CE}
If $\Lambda$ is such a packing, set
$$
V = \{v\in \Lambda\mid 0 < \normo{v}\le 2\hm\}.
$$
Let
\begin{equation}\label{eqn:fan-edge}
\begin{array}{lll}
 E_{std} &= \{\{v,w\}\in V^2\mid 0 < \norm{v}{w}\le 2\hm \}\\
 E_{cnt} &= \{\{v,w\}\in V^2\mid \norm{v}{w}= 2 \}\subset E_{std}.
\end{array}
\end{equation}

\begin{lemma}\guid{UBHDEUU}\rating{140}
$(V,E)$ is a fan, if $E=E_{std}$ or $E_{cnt}$.
\end{lemma}
They are called the standard fan and contact fan.
Let $\op{hyp}(V,E)$ be the associated hypermap.
\indy{Index}{standard fan}
\indy{Index}{contact fan}
\indy{Index}{fan!standard}
\indy{Index}{fan!contact}

\begin{definition}[isolated,~surrounded]
Let $(V,E)$ be a fan.
We say that $v\in V$ is isolated in the fan if $E(v)$ is empty.
(That is, the degree of the corresponding node in the hypermap is $0$.) We say that $v\in V$ is surrounded in the fan if the azimuth angles of all darts in the fan at $v$ are $<\pi$.  (In particular, the cardinality of $E(v)$ is at least three.)
\end{definition}
\indy{Index}{isolated}
\indy{Index}{surrounded}

The following lemma appears in Sch\"utte and van der Waerden~\cite{vanderWaerden:1951}.

\begin{lemma}\guid{FATUGPD}\rating{200}
Given any $V\subset \Lambda(\orz,2\hm)$,
there exists a finite packing $V'$ 
in bijective correspondence with $V$:
$$
\phi:V\to V'
$$
such that $\normo{v} = \normo{\phi(v)}$ and
such that every $v'\in V'$
is isolated or surrounded in the contact fan of $V'$.
\end{lemma}

\begin{proof} Consider all finite packings in 
bijective correspondence with $V$, such that the
bijection preserves distances to $\orz$.
Among these packings pick one $V'$ with the largest number
of isolated points in the contact graph.  If there is a point $v\in V'$ that
is not isolated and not surrounded, then it has a contact
dart with angle at least $\pi$.  We can then perturb $v$ away from the contacts, making it isolated, while preserving its distance to $\orz$.  The perturbed packing $V''$ has one more isolated point than $V'$, contrary to the supposed maximality of $V'$.  Hence, the conclusion of the 
lemma holds for $V'$.
\end{proof}

The following lemma shows that the corresponding result
holds for the standard fan.

\begin{lemma}\guid{FNJLBXS}\rating{500}\label{lemma:surrounded}  
Given any $V\subset \Lambda(\orz,2\hm)$,
there exists a finite packing $V'$ 
in bijective correspondence with $V$:
$$
\phi:V\to V'
$$
such that $\normo{v} = \normo{\phi(v)}$ and
such that every $v'\in V'$
is isolated or surrounded in the standard fan of $V'$.
\indy{Index}{finite packing}
\end{lemma}

\begin{proof}  
Let $V'_{iso},V'_{sur}$ be the
sets of isolated and surrounded vertices of $V'$ in the contact
fan.
By the previous lemma, we may assume
without generality that every $v\in V$ is isolated
or surrounded in the contact fan of $V$.    
We consider the set $\CalV$ finite
packings $V'$ in bijective correspondence with $V$:
$$
\phi:V\to V'
$$
preserving distances to $\orz$, with $V'_{sur}=V_{sur}$.
For any such packing, define constants $c_i=c_i(V')$,
for $i=1,\ldots,n=\op{card}(V_{iso})$ by letting 
$c(\phi(v))$, for $v\in V_{iso}$, 
be the minimum distance of $\phi(v)$ to a point
in $V'\setminus \{\phi(v)\}$, and then ordering the real numbers $c(\phi(v))$ in increasing order:
$$
c_0 \le c_1 \le c_2 \le \cdots \le c_n.
$$
The constants $c_i:\CalV\to\ring{R}$ are continuous functions on the compact configuration space $\CalV$.
We have $V\in \CalV$, so $\CalV\ne\emptyset$.
There is a nonempty 
compact subset $\CalV_0$ of $\CalV$ on which
$c_0$ attains its maximum value. Continuing recursively,
there is a nonempty compact subset $\CalV_{i+1}$ of
$\CalV_{i}$ on which $c_i$ attains its maximum value.

For the configuration $V\in \CalV$, we have $c_0 >2$.
Hence, $c_0(V')>2$ for $V'\in\CalV_0$.  It follows
that $V'_{iso}$ is in bijective correspondence with
$V_{iso}$.

We claim that any $V'\in \CalV_n$ has the desired property.
Suppose on the contrary, that some vertex $v'\in V'$
is neither isolated nor surrounded in the standard fan.  
Any such vertex satisfies $c(v')=c_i(V')$, for some $i$.
Among such vertices, pick the vertex with smallest index
$i$.  Write 
$$
c(v') = c_i(V') = c_{i+1}(V') =\cdots= c_j(V') < c_{j+1}(V'),
$$
for some $j\ge i$.  As $v'$ is not isolated in the
standard fan, we have $c_j(v') < 2\hm$.  It is not surrounded,
so the cyclic order on
$$
\{(v',w')\in V'^2 \mid \norm{v'}{w'} = c_j(v')\},
$$
has an azimuth angle that is at least $\pi$.
Thus, there is a direction in which $v'$ can be perturbed
that increases $c_j$, while keeping $c_0,\ldots,c_{j-1}$
fixed.  This is contrary to the defining property of
$\CalV_n\subset\CalV_j$.
\end{proof}


We may assume that we have an extremal counterexample in the sense that it maximizes the left-hand side of~(\ref{eqn:L12}).  We may assume that the set of vertices $V$ has cardinality $13$ or $14$ (Lemma~\ref{lemma:13-14}). We may assume that every vertex is surrounded or isolated in the standard fan (Lemma~\ref{lemma:surrounded}).  By Lemma~\ref{lemma:D'}, if there are any isolated verices in the standard fan, then it is not a counterexample.  Hence, we may in fact assume that every vertex is surrounded in the standard fan. By extremality and construction, we may assume that every vertex $v$ that is not surrounded in the contact fan satisfies $\normo{v}=2$.



In summary, we have constructed a counterexample with the following properties.

\begin{lemma}\guid{FCDJDOT}\rating{100}\label{lemma:CE} 
Assume that a counterexample exists to Conjecture~\ref{conj:L12}.  Then there also exists a counterexample with the following properties.
\begin{itemize}
\item It maximizes the sum~(\ref{eqn:L12}).
\item There are $13$ or $14$ vertices.
\item Every vertex is surrounded in the standard fan.
\item Every vertex $v$ that is not surrounded in the contact
fan satisfies $\normo{v}=2$.
\end{itemize}
\indy{Index}{counterexample}
\end{lemma}





\begin{definition}
We call such $(\Lambda,\orz)$ a contravening centered packing.  We
call the hypermap of its standard fan a contravening hypermap.
\indy{Index}{contravening centered packing}
\indy{Index}{contravening hypermap}
\end{definition}


In the next section, we study further properties of contravening hypermaps $H$.



\section{Contravention is Tame}
\indy{Index}{tame contravention}
\indy{Index}{tame!contravention}
    \label{sec:contraproof}

Let $(\Lambda,\orz)$ be a centered packing with
fan $(V,E)$.  Let  hypermap $H=(D,e,n,f)$
be the hypermap attached to $(V,E)$.
The hypermap $H$ is plain, planar, connected, and simple.
The connected components of $Y(V,E)$ are in bijection with
faces of $H$.  
The fan gives a azimuth angle function
$$
\op{azim} : D \to (0,2\pi).
$$
For each face of $H$, the corresponding component $U_F$
is eventually radial with solid
angle
  $$
  2\pi + \sum_{x\in F} (\op{azim}(x) -\pi).
  $$
We write $\sol(F)$ for the solid angle of the connected component
of $Y(V,E)$ associated with a face $F$ of the hypermap.
We have
    $$\sum_{F} \sol(F) = 4\pi.$$
There is a map $v:D\to V$ that maps each dart to the vertex:
$$
v \mapsto v_x; \quad   x = (v_x,\ldots).
$$
Set 
$$h(x) = \normo{v_x}/2.$$
Define
\begin{equation}
\begin{array}{lll}
\tau(F) &= \sol(F) + (2- n(F))\Delta_0 - \frac{\Delta_0}{\pi}\sum_{x\in F}\op{azim}(x) (L(h(x)) - 1),\\
  &= \sol(F) \left( 1 + \frac{\Delta_0}{\pi}\right) - \frac{\Delta_0}{\pi} \sum_{x\in F} \op{azim}(x)(L(h(x)))\\
  &=\sum_{x\in F} \op{azim}(x)\left(1 + \frac{\Delta_0}{\pi}(1- L(h(x)))\right) + \left(\pi+{\Delta_0}\right) (2- n(F)).
\end{array}
\end{equation}
where $\Delta_0$ is the solid angle of a spherical equilateral triangle of side $\pi/3$ and $n(F)$ is the cardinality of $F$.

We may express the main conjecture in the following alternative form:

\begin{lemma}\guid{HRXEFDM}\rating{80}
$$
\sum \tau (F) \ge 4\pi - 20\Delta_0
$$
if and only if
$$
\sum L(h(x)) \le 12.
$$
\end{lemma}

\begin{proof}
The solid angles over the sphere sum to $4\pi$ and the dihedral angles at each vertex sum to $2\pi$. 
% The Euler relation for connected plain planar hypermaps gives
%$$
%\sum_F (2- n(F)) = 2\#f - 2\#e = 4 - 2\#n.
%$$
Thus,
\begin{equation}\label{eqn:delta0}
\begin{array}{lll}
\sum \tau (F) 
&= 4\pi (1 + \Delta_0/\pi) - (\Delta_0/\pi) 2\pi \sum_{V} L(h)\\

&= (4\pi - 20\Delta_0) + 2\Delta_0 (12 - \sum_V L(h(v,\orz))).
\end{array}
\end{equation}
The result follows.
\end{proof}

The constant $\op{trgt}$ is approximately equal to $4\pi - 20\Delta_0$.
We have defined a weight function $\tau(F)$ on the faces of the hypermap.  In this way, we attach a pair $(H,\tau)$ to each contravening centered packing $(\Lambda,\orz)$.  The following result will be proved in the remaining sections of this chapter.


\begin{theorem}\guid{MQMSMAB} \label{theorem:contravene}
Let $(\Lambda,\orz)$ be a contravening centered packing.  Let $(H,\tau)$ be
the hypermap and function on its faces attached to $(\Lambda,\orz)$ as above.
Then $H$ is a tame hypermap with admissible weight function $\tau$.
\end{theorem}




\subsection{general properties}
    \label{sec:startame}



\begin{lemma}\guid{JGTDEBU}\rating{100} %100=without (vi), %(deprecated: 300=with (vi))
The contravening hypermap $H$ satisfies properties~(i)--(v),  % was (i)-(vi).
(viii),  (x), and the first part of (xi).
of tameness.
\end{lemma}

\begin{proof}
The hypermap is plain, planar, connected, and simple by the general results established in the chapter on fan.  That chapter also shows that the hypermap attached to a fan satisfies properties~(iii)--(v).  

%The property~(vi) is established in \cite[Lemma~3.7]{sp1}.
Turn to property~(viii). At the same time we establish the first half of property~(xi).  Every vertex is surrounded, meaning that the azimuth angles of the darts at the vertex are less than $\pi$.  As the angles around the vertex sum to $2\pi$, there are at least three darts in the node. Each of the darts in the node leads into a different face by property~(ii).

%% 13 or 14 nodes.
Finally, property~(x) has already been established in Lemma~\ref{lemma:CE}.
\end{proof}

There remain properties (vii), (ix), the second part of (xi), (xii), and (xiii).







\subsection{properties of nodes}
\indy{Index}{properties of nodes}
\indy{Index}{properties!nodes}



\begin{lemma}\guid{CDTETAT}\rating{140} \label{lemma:0.852}
Let $H$ be a contravening
hypermap. For every dart $x$,
    $$0.852\le \azim(x)\le 1.9.$$
For every dart $x$ whose face is not a triangle, we have
    $$1.15\le\azim(x)\le 3.27.$$
Consequently, if a vertex $v$ has type $(p,q,0)$, then $(p,q)$
must be one of the following pairs:
$$
\begin{array}{lll}
&(0,2),~(0,3),~(0,4),~(0,5),~(1,2),~(1,3),~(1,4),~(2,1),~(2,2),~(2,3),\\
&(3,1),~(3,2),~(3,3),~(4,0),~(4,1),~(4,2),~(5,0),~(5,1),~(6,0),~(6,1),~(7,0)
\end{array}
$$
\end{lemma}
 %
 \indy{Index}{ZZZZ1.15@$1.15$}
 \indy{Index}{ZZZZ0.852@$0.852$}
\begin{proof}
The angle bounds are a calculation.  The sum of the azimuth angles
around a vertex satisfies:
$$
  p (0.852) + q (1.15) \le 2\pi \le p (1.9) + q (3.27),
$$
and the pairs satisfying these constraints are listed.
\end{proof}

\begin{lemma}\guid{SZIPOAS}\oldrating{80}
\rating{0}
\formalauthor{Vu Thanh}
%dcg{Lemma~21.4}{223} 
Formally contravening hypermaps satisfy the second part of property
\ref{definition:tame:degree} of tameness: The cardinality of every
node is at most $7$.
\end{lemma}

\begin{proof}  The azimuth angle bound
$$
 (p+q+r) 0.852 \le 2\pi
$$
implies $p+q+r < 8$.
\end{proof}




\begin{lemma}\guid{KCBLRQC}\rating{300} 
Let $v$ be a node of type $(p,q,0)$.  Let $A$ be the set of faces meeting that node.  Then the property~(iii) of a admissible weight assignment holds:
$$
\sum_{F\in A} \tau(F) \ge  b(p,q,0).
$$
\end{lemma}

\begin{proof} There is a collection of nonlinear inequalities
for $\tau(F)$ when $F$ is a triangle or quadrilateral~\cite[FUSDSPJ]{hales:2009:nonlinear}. Each nonlinear inequality has the form
$$\tau(F) \ge a~\op{azim}(x) + b,$$
where $x$ is the uniquely determined dart at the node $v$ in the face $F$. We obtain a linear programming problem by relaxing these nonlinear inequalities as follows.  For each nonlinear inequality, we write a linear inequality
$$
t(F) \ge a~z(F) + b,
$$
where $t(F)$ and $z(F)$ are variables indexed by the set $A$.
Then we minimize 
$$\sum_{F\in A} t(F)$$
subject to these linear inequalities and the constraint
$$
2\pi = \sum_{F\in A} z(F).
$$
We run this linear program for each of the types $(p,q,0)$ of Lemma~\ref{lemma:0.852}. The given constants are obtained from the (downward rounded) solutions to these linear programs.
\end{proof}

\begin{lemma}\guid{BDJYFFB}\rating{200}\label{lemma:deg5}
Every contravening hypermap satisfies Property
\ref{definition:tame:degreeE} of tameness: If a node $v$ meets an
exceptional face, then the cardinality of the node is at most $6$.
If the cardinality is $6$, then its type is $(5,0,1)$.
If the type is $(5,0,1)$, let $A$ be the set of five triangles at the
node $v$.  Then
$$
\sum_F \tau(F) > a.
$$
\end{lemma}

\begin{proof} These facts also come from linear programming.
The same set of nonlinear inequalities is used, and the linear
relaxation is constructed in the same way.  The linear programming
bounds are over $\op{trgt}$ in the cases excluded in the conclusion
of the lemma.  The constant $a$ is the downward rounding of the solution to the linear program for $(5,0,1)$.
\end{proof}

\subsection{faces}
\indy{Index}{faces}


%Every contour loop partitions the faces into the interior and
%exterior.  Every contour loop partitions the nodes that do not meet
%the loop into exterior and interior nodes.
%%
% \indy{Index}{interior node}
%
%\begin{note}%
%In this book, we have been able to avoid the Jordan curve theorem by limiting our discussion to convex sets.  The convex hull of a set can be used instead of the {\it interior} of a polygon.  In the following lemma, we need to add a bit more justification if we are to avoid the Jordan curve theorem, because it is possible that the quadrilateral under discussion might fail to be convex.  However, even when it is not convex, following the approach of {\it Lemmas in Elementary Geometry}, we may define the interior without invoking any topological notions, simply by constructing an appropriate diagonal.  Details will be provided in a later draft.
%\end{note}
%\indy{Index}{Jordan curve}
%
%\begin{lemma}\guid{GNCEGFN}\rating{1000}\label{lemma:no-2}
%Let $H$ be a contravening hypermap.
%Suppose that $L$ is a contour loop with at most four face steps.
%Suppose that there are at least two nodes in the exterior of $L$.
%Then there at most one node interior to $L$.
%\end{lemma}
%
%\begin{proof}
%The result~\cite[Lemma~4.2]{sp1} asserts that either the interior or the
%exterior has at most $1$ enclosed vertex. (That proof uses the constant $2.51$ rather than $2\hm=2.52$, but the slightly different constant does not affect the proof.)   When choosing which
%aggregate is to be called the interior, we may make our choice so
%that the interior has area at most $2\pi$, and hence contains at
%most $1$ node. 
%\end{proof}
%
%With this choice of interior, we have the following lemma.
%
%\begin{lemma}\guid{CHOMXMX}\rating{200}
%Let $H$ be a contravening hypermap. Property~(vii) of tameness
%holds.
%\end{lemma}
%
%\begin{proof}
%If there are no enclosed vertices, then the only possibilities are
%for it to be a single quadrilateral face or a pair of adjacent
%triangles.
%
%Assume there is one enclosed vertex $v$.  It has degree $3$ or $4$.
%If it is connected by an edge to a vertex that is not one of the
%four vertices of the quadrilateral, a M\"obius contour is formed, contrary to planarity.
%If $v$ is connected to $3$
%or $4$ nodes of the quadrilateral, then that possibility is listed
%as part of the conclusion.
%\end{proof}
%

\begin{lemma}\guid{CRTTXAT}\rating{140}  
Every face has has cardinality at least $3$ and at most $6$.
\end{lemma}

\begin{proof} The lower bound holds, because the hypermap has no loops or double joins.  For a contradiction, let $F$ be a face of the hypermap of cardinality at least $7$.  We divide the proof into cases depending on whether the
following inequality holds:
$$
\sum _{x\in F} (\normo{v_x}-2) \ge 4(\hm-1).
$$
If the inequality holds, then since $L$ is the linear interpolation between the points $(1,1)$ and $(\hm,0)$, and there are at most $14$ points in $V$, we have
$$\sum_{v\in V}L(\normo{v}/2) \le 12 L(1) + 2 L(\hm) =12$$
and the main inequality holds.

Now assume that the inequality is false.
The edge $\{v,w\}$ has arclength at least
$$
\arc(\normo{v},\normo{w},\norm{v}{w}) \ge \arc(\normo{v},\normo{w},2). 
$$

A calculation~\cite[cc:arc]{hales:2009:nonlinear} gives
$$\arc(\normo{v},\normo{w},2)\ge 1 - 0.6076 (\normo{w}/2 - 1) - 0.6076 (\normo{v}/2 - 1).$$ %%CC:arc
Summing over a face of size at least $7$, we obtain:
$$
\begin{array}{lll}
\sum \arc(\normo{v_i},\normo{v_{i+1}},\norm{v_i}{v_{i+1}})&\ge
7 - 0.6076 \sum (\normo{v_i}-2) \\
   &\ge 7 - 0.6076 (2) (0.52) \\
   &> 2\pi,
\end{array}
$$
which is contrary to the upper bound on the edge length
sum in Lemma~\ref{lemma:convex-hyper}.
\end{proof}



\section{Main Estimate}\label{sec:weight}


The main result of this section is the following:

\begin{theorem}\guid{THJPDQA}\rating{0}  %points for OLNSWLK below.
The weight assignment $\tau$ on a contravening hypermap is admissible of  total weight less than $\op{tgt}=1.541$.
\indy{Index}{weight assignment}
\end{theorem}


%\subsection{admissibility}
\label{sec:admissibility}
\indy{Index}{admissibility}



\begin{lemma}\guid{OLNSWLK}\rating{3000} %including lemmas that lead up to it.  Interval ineq may be assumed.  
Let $F$ be a face of cardinality $n$ in a contravening hypermap.  Then
        $\tau(F) \ge d(n)$.
\end{lemma}

In the original 1998 proof, the corresponding result
is called the ``Main Theorem.''  The proof of that 
theorem takes about 30 pages and relies on many
long computer calculations.  The proof given here
is substantially simpler than the proof of the
Main Theorem, but
it is still nontrivial.  Here, we have the advantages
of knowing that the polygons are convex, the hypermap
is simple, and each face has at most six sides.

In the proof, we will adopt the following convention for
configurations.  We let $v_0,\ldots,v_{n-1}$ be the vertices
of the polygon, and write
$$
y_i = \normo{v_i},\quad y_{ij} = \norm{v_i}{ v_j}.
$$

It is helpful to keep in mind the origin of the constants $d(n)$.
Although, we do not produce sharp lower bounds on $\tau(F)$, the
statement of the lemma is motivated by the following configurations.
Consider a polygon with $n$ sides all of length $y_{i,i+1}=2$, heights
$y_i=2$, and $n-3$ diagonals of length $2\hm$: $y_{0,j}=2\hm$, for
$j=2,\ldots,n-2$.  Evaluating $\tau$ on these rigid configurations gives
$$
\tau(F) = \begin{cases}
0.20612\ldots & n=4\\
0.48356\ldots & n=5\\
0.760993\ldots &n=6
\end{cases}
$$
These constants $d(n)$ were chosen to be slightly smaller than these values.\footnote{Note $\tau(2.1028,2,2,2,2.52,2.52) = 0.275951\ldots < 0.277433\ldots = \tau(2,2,2,2,2.52,2.52)$.}


\begin{proof}  We consider the cycle in the fan
giving the face $F$.  For the purposes of this
estimate, we may discard all the vertices of $V$
that do not belong to the cycle as well as all edges
of $E_{std}$ that lie outside the cycle.
Write $\tau(V)$ for the value of $\tau(F)$ as a
function of the positions of the vertices in $V$,
keeping the set of edges of the cycle fixed.  The
azimuth angles associated with the face $F$ will be
call the interior angles.  

The idea of the proof is simple.  We may deform $V$ in a way to decrease $\tau(V)$.  We pick the deformations to lie in subspaces of small dimension to allow us to verify directly that the deformations are nonincreasing in $\tau(V)$.  As the deformations continue, the configuration $V$ moves into a subspace of smaller and smaller dimension.  Eventually, the dimension becomes sufficiently small that we can make a direct interval arithmetic calculation to see that $\tau(V)$ satisfies the desired bounds.

We break the proof into several parts in the following
subsections
\end{proof}


\subsection{halting conditions}
\indy{Index}{halting conditions}

The deformation is required to maintain the following
constraints:
\begin{itemize}
\item $V\cup\{\orz\}$ is a packing.
\item The interior angles are at most $\pi$.
\item The distances satisfy $\norm{v}{w}\ge 2\hm$, if $\{v,w\}$ is
not an edge.  (Call these the diagonals.)
\end{itemize}
If any of the constraints become binding, we freeze that
constraint, and continue the deformation along the remaining degrees of freedom of the configuration.  The deformations are described in detail below.
\indy{Index}{deformation}

\subsection{recursion}
\indy{Index}{recursion}

Initially, the diagonals satisfy $\norm{v}{w}>2\hm$.
If after deformation, equality holds; we stop the deformation, and cut the cycle into two smaller along the diagonal
and continue recursively with deformations for each smaller cycle.  A cut edge has length $\norm{v}{w}=2\hm$, and
we require that all further deformations must keep this distance fixed.  

On a smaller cycle, let $r$ be the number of original edges and $s$ be the number of edges produces by cuts along a diagonal fixed at $2\hm$.  (Call this second kind of edge a {\it cut} edge.  Let $\tau(V(r,s))$ be the functon $\tau$ on a configuration $V$ with parameters $r$ and $s$.  Starting from polygon with at most six sides, the values $(r,s)$ that might be obtained are
$$
(3,0),~(2,1),~(1,2),~(0,3),~
(4,0),~(3,1),~(2,2),~
(5,0),~(4,1),~
(6,0)
$$
That is, $0\le s\le 3$ and $3-s\le r\le 6-2s$.
The recursive bound we prove is
\begin{equation}\label{eqn:drs}
\tau(V(r,s)) \ge d(r,s) = 0.103 (2-s) + 0.2759 (r+2s-4) 
\end{equation}
Note that $d(n,0) = d(n)$. Also, note that if we cut
$V(r,s)$ along a new diagonal to produce $V(r_1,s_1)$
and $V(r_2,s_2)$, we have $r_1+r_2=r$ and $s_1+s_2 = 2+s$.
Also,
\begin{equation}\label{eqn:drs-add}
\begin{array}{lll}
d(r,s) &= d(r_1+r_2,s_1+s_2-2) \\
  &=0.103 (4-s_1-s_2) + 0.2759 (r_1+r_2+2s_1+2s_2-8) \\
  &=d(r_1,s_1) + d(r_2,s_2).\\
\tau(V(r,s)) &= \tau(r_1+r_2,s_1+s_2-2)\\
  &=\tau(V(r_1,s_1)) +\tau(V(r_2,s_2))\\
\end{array}
\end{equation}
So we see that the definition of $d(r,s)$ has been
chosen so that the recursive 
bound~(\ref{eqn:drs}) implies the
lemma.

In the proof that follows, we may assume for a contradiction that the
inequality~(\ref{eqn:drs}) fails, and that we have chosen a minimal counterexample in the sense that $r+s$ as small as possible.   Minimality allows us to assume that no diagonals develop as we deform.

\subsection{deformations}
\indy{Index}{deformations}

We have the following $\tau$-nonincreasing deformations:
\begin{itemize}
\item {\bf (Vertex push)} Push one vertex radially toward $\orz$.  By the formula for $\tau$, this deformation decreases $\tau$.
\item {\bf (Lexell)} Fix all the heights $\normo{v}$. Then $\tau$ depends only on the area of the convex spherical polygon.  Consider an {\it ear} of the polygon (a triangle formed by two adjacent edges and a diagonal).  By Lexell's theorem, as we increase the length of one of the edges of the polygon, the area of the ear has a unique local maximum and no local minimum.  Thus, we may always deform until each edge is as long or as short as possible.
\indy{Index}{deformation}
\indy{Index}{Vertex push}
\indy{Index}{Lexell}
\end{itemize}

\subsection{flat vertices}
\indy{Index}{flat vertices}

If the interior angle has increased to $\pi$, call the vertex {\it flat}. If there are $k$ consecutive flat vertices, there are  $k+1$ corresponding edges that form a linear series, all lying in a common plane through the origin $\orz$.  When the vertex is flat, we require the Lexell triangle deformations to preserve the flat vertex.  Thus, we deform along the linear series as a whole, until each is as long or as short as possible.  The next few lemmas use the triangle inequality to constrain configurations with flat vertices.
\indy{Index}{Lexell's triangle}

\begin{lemma}\guid{TESVAFW}
There cannot be three consecutive flat vertices.
\end{lemma}

\begin{proof} This is because of the triangle inequality.  Three flat vertices produces a linear series of length at least
$$
4\arc(2\hm,2\hm,2) > 3,
$$
but the remaining two edges (on a hexagon) have combined length at most
$$
2\arc(2,2,2\hm) < 3.
$$
\end{proof}

\begin{lemma}\guid{SDCCMGA}
If there are two consecutive flat vertices, there is no cut edge among the corresponding set of three edges.
\end{lemma}

\begin{proof}  Argue by contradiction.  From the constraints on $r$ and $s$ given above, if $s>0$, then $r+s\le 5$.  Thus, $r+s=5$, forming a triangle with a linear series of three, and the two other edges.  If $y=\normo{v}$ where $v$ is a vertex of the triangle formed by an end of the linear series, the linear series has length at least
$$
\arc(y,2\hm,2)+\arc(2\hm,2\hm,2) +\arc(2\hm,2\hm,2\hm)
$$
which is greater than the maximum sum of the other two lengths:
$$
\arc(y,2,2\hm)+\arc(2,2,2\hm).
$$
This violates the triangle inequality.
\end{proof}

\begin{lemma}\guid{CFJSRQH}  If there are two consecutive flat vertices, then (following the Lexell triangle deformations) the edges are as short as possible
\end{lemma}

\begin{proof} The Lexell argument either increases edges as much as possible or compresses them as much as possible.  If the vertices $v_1,v_2,v_3,v_4$ of the linear series are stretched, it has length at least
\begin{equation}\label{eqn:3side}
\arc(y_1,2,2\hm)+\arc(2,2,2\hm)+\arc(2,y_4,2\hm),
\end{equation}
where $\normo{v_i}=y_i$.
However, there are at most two other vertices and three other edges.  By the triangle inequality, the sum of these three lengths is at most (\ref{eqn:3side}).
Thus, equality is obtained in the triangle inequality, and the polygon reduces to a linear segment.  This forces the two other vertices to be precisely equal to $v_2$ and $v_3$, which is contrary to the assumption that we have a packing with distance separations at least $2$.
\end{proof}

\begin{lemma}\guid{OUCPLRI} If there are two consecutive flat vertices, then without loss of generality, we may assume that one of them has minimal or maximal height:
$$\normo{v}\in \{2,2\hm\}.$$
\indy{Index}{minimal height}
\indy{Index}{maximal height}
\end{lemma}

\begin{proof}
Assume there are two adjacent flat angles $v_2,v_3$, forming a linear series $v_1,v_2,v_3,v_4$.
Assume without loss of generality (by previous reductions) that
$\norm{v_i}{v_{i+1}}=2$, for $i=1,2,3$.
Let $y_i = \normo{v_i}$.
We may pull one vertex $v_2$ away from $\orz$ and push the other $v_3$ in such a way that fixes $y_2+y_3$, while decreasing the arclength of the linear series.  This follows by concavity.
In fact, the arclength is given by a sum of three terms:
  $$
  \sum_{i=1}^3\arc(y_i,y_{i+1},2).
  $$
This follows from a calculation showing that the second derivative of $\arc(t,s,2)$ with respect to $t$ is negative, for $t,s\in[2,2\hm]$.  Thus, the
sum is also concave, so that we shorten arclength as much as possible when the heights are extremal.
\end{proof}

In summary, we have the following possible configurations of flat angles:
\begin{itemize}
\item There are two consecutive flat angles contracted as much as possible.  They form a linear series $v_1,v_2,v_3,v_4$ where
$$
y_2\in\{2,2\hm\},\quad
y_{i,i+1}=2,\quad i=1,2,3.
$$
\item There is a single flat angle contracted as much as possible.  There
is a linear series $v_1,v_2,v_3$ where
$$
y_{i,i+1}=2,\quad i=1,2.
$$
\item There is a single flat angle stretched as much as possible.  There
is a linear series $v_1,v_2,v_3$ where
$$
\normo{v_2}=2,\quad
\norm{v_i}{v_{i+1}}=2\hm,\quad i=1,2.
$$
\indy{Index}{linear series}
\end{itemize}


\subsection{Adjusting heights}
\indy{Index}{Adjusting heights}

Fix three consecutive vertices $u,v,w$ of the cycle.
Assume $\norm{v}{u}$ and $\norm{v}{w}$ are already at their extremal value (either $2$ for  $2\hm$).  Then the function $\tau(V)$ may be considered as a function
of the edges of the simplex $\orz,u,v,w$ as $v$ moves with the other points of $V$ fixed.  Fix $5$ edges of the simplex as parameters and vary $\normo{v}$, so that $\tau$ becomes a function of a single variable.

\begin{lemma}\guid{DFSLRHA} As a function of $\normo{v}$
 $\tau$ has negative second derivative whenever the derivative is zero.  Thus, $\tau$ has no local minimum.
\indy{Index}{derivative}
\indy{Index}{local minimum}
\end{lemma}

Consequently, we may deform by either increasing or decreasing $\normo{v}$ as much as possible.  

\begin{proof}
The proof is an interval arithmetic calculation over a four-dimensional space~\cite[cc:d2a]{hales:2009:nonlinear}.  %%cc:d2a
\end{proof}


We can do the same when there is one flat vertex forming a linear series of length $2$, with compressed edges:

\begin{lemma}\guid{DCEETTF}
As a function of $\normo{v}$
 $\tau$ has negative second derivative whenever the derivative is zero.  Thus, $\tau$ has no local minimum.
\end{lemma}

\begin{proof}
The proof is an interval arithmetic calculation over a five-dimensional space~\cite[cc:d2b]{hales:2009:nonlinear}. %%cc:d2b
\end{proof}


Thus, if there a sequence of a flat vertex $u$, an acute vertex $v$, and another acute vertex, then we may assume that $u$ or $v$ has extremal height $\in\{2,2\hm\}$.



\subsection{Adjusting quadrilaterals}
\indy{Index}{adjusting quadrilaterals}

Suppose that there are four consecutive vertices $v_1,v_2,v_3,v_4$ that are not flat, and consider the chain of four consecutive vertices $v_1,v_2,v_3,v_4$. By Lexell arguments, each edge $\norm{v_i}{v_{i+1}}$ is $2$ or $2\hm$. Set $y_i = \normo{v_i}$ and $y_{ij} = \norm{v_i}{v_j}$. After adjusting heights $y_i$ is $2$ or $2\hm$, for $i=2,3$. This leaves four degrees of freedom:
$$
y_1,y_4,y_{14},
$$
and a diagonal to the quadrilateral, say $y_{13}$. We assume that  $y_{14}\ge 2\hm$.  (If it is smaller, it is an uncut edge of the polygonal, of length $2$, so that the polygon is actually a convex quadrilateral.  This special case is most easily dealt with separately.)

\begin{lemma}\guid{CMBZAOZ}
In this context, the function $\tau$ as a function of $y_1,y_4,y_{14},y_{13}$ does not have an interior point local minimum.
\end{lemma}

\begin{proof} This is an interval arithmetic calculation~\cite[cc:qua]{hales:2009:nonlinear} in four variables.%% cc:quad tau-estimate, deform a quadrilateral.
\end{proof}

As a consequence, the minimum occurs when a new flat vertex forms.  We may then eliminate any case with four consecutive vertices that are not flat (after treating the quadrilateral with four edges $y_{ij}=2$ as a special case).

\subsection{Cases}
\indy{Index}{cases}

More than one of these can be combined in a single polygon.  We represent the sizes of the linear series in a polygon with $n$ sides as a partition of $n$.
The number of parts of the partition gives the number of sides of the polygon when each linear series is considered a single side. 


We review the combinatorial possibilities.  In each case, we may check that the inequality holds, to complete the proof of the main estimate.  We label each 
case by the partition.  If the partition is $(\mu_1,\mu_2,\ldots)$, we
index the vertices in the same order as the partition, with $v_0$
the vertex occurring just before the first flat vertex.  For example,
if the partition is $(3,1,1)$, the polygon is a pentagon, flattened into
an effective triangle, with vertices $v_0,\ldots,v_4$, where $v_1$ and $v_2$
are the flat vertices.

We have established the following constraints on the partition: it is
a partition of $n$, where $3\le n\le 6$; there
are at least three parts; the largest part is at most $3$;  there are
at most two consecutive parts that equal $1$, unless it is a special triangle $(1,1,1)$ or
quadrilateral case $(1,1,1,1)$, discussed below.  In only one case
does the order of the parts matter: $(2,1,2,1)$ versus $(2,2,1,1)$.

\begin{itemize}
\item {\bf (1,1,1)}  This is a triangle.  There are three degrees of
freedom $y_i$.  Since this is arising from a polygon that was not originally a triangle, we may assume that for at least one of the edges: $y_{ij}=2\hm$.
\item {\bf (1,1,1,1)}  This is a convex quadrilateral with four sides $y_{ij}=2$ and four extremal heights $y_i$.  There is one degree of freedom given by the diagonal.
\item {\bf (2,1,1)} This is a quadrilateral, flattened into an effective triangle.  There are two degrees of freedom: one of the three variables $y_0,y_1,y_2$ is extremal.  All of the other variables are extremal.
\item {\bf (3,1,1)}  This is a pentagon, flattened into an effective triangle.  There are three degrees of freedom $y_0,y_{03},y_3$ along the flattened side, and no freedom in the rest of the figure.  We have $y_{01}=y_{12}=y_{23}=2$.
\item {\bf (2,2,1)} This is a pentagon, flattened into an effective triangle.  The edge lengths $y_{i,i+1}$ are all extremal.  Because of height adjustments, there are three degrees of freedom in the heights $y_i$.
\item {\bf (3,2,1)} This is a hexagon, flattened into an effective triangle.  There are four degrees of freedom.
\item {\bf (2,2,2)}  This is a hexagon, flattened into an effective triangle.  There are six degrees of freedom, given by all heights $y_i$.
\item {\bf (2,1,2,1)} This is a hexagon, flattened into an effective quadrilateral.  There are five degrees of freedom: a diagonal $y_{03}$ to the quadrilateral and four independent heights.
\item {\bf (2,2,1,1)}  This is a hexagon, flattened into an effective quadrilateral.  There are four degrees of freedom: a diagonal $y_{03}$ to the quadrilateral and three independent heights.
\indy{Index}{triangle}
\indy{Index}{quadrilateral}
\indy{Index}{pentagon}
\indy{Index}{hexagon}
\end{itemize}


Interval arithmetic calculations~\cite[cc:tau]{hales:2009:nonlinear} %% cc:par partition cases for tau[r,s]. 
for each of these cases completes the proof. The proof that contravening hypermaps are tame is complete.

\section{Linear Programs}
\indy{Index}{Linear Programs}

We can attach a linear program to each tame hypermap.
For each tame hypermap $H$ there is a configuration space $D(H)$ of all
finite packings $V\subset \Lambda(\orz,2\hm)$ whose standard fan is
isomorphic to $H$.

We have the nonlinear optimization problem of maximizing
\begin{equation}\label{eqn:L2}
\sum_{v\in V} L(\normo{v}/2)
\end{equation}
over all $V\in D(H)$.

The linear program comes as a linear relaxation of this nonlinear
optimization problem on $D(H)$. That is, the optimal solution of the
the linear program has value at least as great as the corresponding
nonlinear problem.  By showing that the value of each linear program
is at most $12$, we may conclude that the maximum of (\ref{eqn:L2})
is at most $12$.


\begin{note}%XX
The linear programming part of the proof has not been completed.  However, there are several reasons to believe that it will be substantially easier than the linear programming part of the 1998 proof of the Kepler conjecture.  For example, we do not have any troublesome $12$-sphere kissing arrangements; every vertex is surrounded; there are no {\it penalty terms}; there are no {\it upright quarters}; there are no {\it aggregate faces}; there are no {\it subregions}; the combinatorial structure of the graph does not change during the branch-and-bound; every face is convex.  The most difficult planar graph is expected to be the pentahedral prism.  In this case, there is still a substantial margin between the desired bound $2.52$ on the thirteenth sphere and the actual value $14/\sqrt{27}\approx 2.694\ldots$.  In every respect, the indications are that the linear programming part of the proof should be no more difficult than the linear programming part of the proof of the dodecahedral conjecture.
\end{note}

\newpage
\begin{verbatim}
/* MathProg model for the Kepler conjecture

[include code here]

*/
\end{verbatim}
