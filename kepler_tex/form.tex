% file started March 22, 2009




\chapter{Packings}


\section{Statement}



\begin{theorem}\guid{IJEKNGA}[Sphere Packing Problem (Kepler Conjecture)]
\label{theorem:kepler}   No packing of congruent balls in
Euclidean three space has density greater than that of the
face-centered cubic packing.
\end{theorem}

\begin{remark}
This density is $\pi/\sqrt{18}\approx 0.74.$  There are other
packings, such as the hexagonal close packing, that attain this
same density.
\end{remark}

The proof of this result is presented in this book. This section
describes the outline of the proof and gives references to
the sources of the details of the proof.

A {\it packing} is an arrangement of congruent balls that
are nonoverlapping in the sense that the interiors of the balls are
pairwise disjoint. Consider a 
packing of congruent
balls in Euclidean three space. Without loss of generality, units can be chosen so that each ball has radius $1$.
\indy{Index}{packing} %

The density of a packing does not
decrease when balls are added to the packing. Thus, to construct
packings of maximal density, one may add
nonoverlapping balls until there is no room to add further balls.
A packing in which no further balls can be added is said to be {\it saturated}.

\begin{definition}[saturated packing]
A packing $\Lam\subset \ring{R}^3$ is a set such that
$$\forall \lam,~\mu\in \Lam.~  \norm{\lam}{\mu} < 2 \Rightarrow (\lam=\mu).$$
The packing is saturated if for every $\p\in\ring{R}^3$,   there exists $\lam\in\Lam$
such that $\norm{\lam}{\p}< 2$.
\end{definition}
\indy{Index}{packing!saturated}%


Let $\Lambda$ be the set of centers of the balls in a
packing. The choice of unit radius for the
balls implies that any two points in $\Lambda$ have distance at
least $2$ from each other. Call the points of $\Lambda$ {\it
 vertices}.
\indy{Index}{vertex}%
\indy{Notation}{ZZLambda@$\Lambda$ (packing)}%

Let $B(\p,r)$ denote the open ball in
Euclidean three-space at center $\p$ and radius $r$.  The open ball
is measurable with measure $4\pi r^3/3$.
\indy{Index}{measure}%
\indy{Notation}{B@$B(\p,r)$}%

The density $\delta(\Lam,\p,r)$ of a packing $\Lam$ within a bounded
region of space is defined as a
ratio. The numerator is volume of $B(\Lambda,\p,r)$, defined as
the intersection with
$B(\p,r)$ of the union of all balls in the packing.
The denominator is the volume of $B(\p,r)$.
Set
$\Lambda(\p,r) = \Lambda \cap
B(\p,r)$. %and $\Lambda^*(\p,r) = \Lambda(\p,r)\setminus \{\p\}$.
An ordered pair $(\Lambda,\v)$ with $\v\in\Lambda$ is called a {\it centered packing}.
\indy{Index}{packing!centered}%
\indy{Notation}{ZZdelta@$\delta(\Lambda,\p,r)$}%
\indy{Notation}{ZZLambda@$\Lambda$ (packing)}%
%\indy{Notation}{ZZLambda@$\Lambda^*$(packing)}%

\begin{lemma}\guid{KIUMVTC}
\oldrating{80}
\formalauthor{Nguyen Tat Thang}
\rating{0}
\label{lemma:Lambda-finite}
Let $\Lambda$ be a packing and let $\p\in\ring{R}^3$.
Then the set $\Lambda(\p,r)$ is finite.
\end{lemma}

\begin{proof}  Let $\p = (p_1,p_2,p_3)$. The floor function gives the map
$$\v=(v_1,v_2,v_3)\mapsto (\lfloor 2(v_1-p_1)
\rfloor, \lfloor 2(v_2-p_2) \rfloor, \lfloor 2(v_3-p_3) \rfloor)$$
is a one-one map from $\Lambda(\p,r)$ into the set $\ring{Z}^3\cap B(\orz,2r + 1)$.  By Lemma~\ref{lemma:Zcount} the range of this one-to-one map is finite. 
Hence the domain $\Lambda(\p,r)$ of the map is also finite.
\end{proof}
\indy{Notation}{1@\floor\cdot\rfloor (floor)}%


\begin{definition}[Voronoi~cell,~$\Omega$]\label{def:voronoi}
\indy{Index}{Voronoi cell} For each $\v\in \Lam$, the Voronoi cell%
$\Omega(\v)=\Omega(\Lambda,\v)$
is the set of points at least as close to $\v$ as to
any other ball center. 
% Let $\Omega_t(\Lambda,\v) = \Omega(\Lambda,\v)
%\cap B(\v,t)$ be the truncated Voronoi cell at radius $t$.
\end{definition}
\indy{Notation}{ZZZomega@$\Omega$ (Voronoi cell)} %


\begin{lemma}\guid{DRUQUFE}
\formalauthor{Nguyen Tat Thang}
\oldrating{80} 
\rating{0}
Let $\Lambda$ be a saturated packing.  For every $\v\in \Lambda$, 
the Voronoi cell $\Omega(\Lambda,\v)$,  is
compact, convex, and measurable.
\end{lemma}

\begin{proof}  This is elementary.
\end{proof}

\begin{definition}[negligible,~fcc-compatible]\label{def:negligible}
Let $G:\Lambda\to\R$ be a function.  The function $G$
is {\it negligible\/}
if there is a constant $c_1$ such that for all $r\ge1$ and all
$\p\in\ring{R}^3$,
   $$\sum_{\v\in\Lambda(\p,r)} G(\v) \le c_1 r^2.$$
The function $G:\Lambda\to\R$ is
  {\it fcc-compatible\/}
if for all $\v\in\Lambda$, 
$$\sqrt{32}\le \op{vol}(\Omega(\v)) + G(\v).$$
\indy{Index}{negligible}%
\indy{Index}{fcc-compatible}%
\indy{Notation}{G (negligible function)}%
\end{definition}





\begin{remark}
The value $\op{vol}(\Omega(\v)) + G(\v)$ may be interpreted as a
{\it corrected\/} volume of the Voronoi
cell. The constant $\sqrt{32}$ that appears in the definition of fcc-compatibility is the volume of the Voronoi cell in the face-centered cubic and hexagonal-close packings.  The corrected volume is at least the volume of these
Voronoi cells when the correction term $G$ is fcc-compatible.
\indy{Index}{corrected volume}%
\end{remark}

%\begin{remark} In \cite{Hales:2006:DCG}, the full Voronoi cell $\Omega(\v)$
%is used, rather than $\Omega(\v)$.  The truncation at radius $2$
%is just a matter of convenience to guarantee the boundedness
%and hence the finite volume of the (truncated) Voronoi cell.
%In \cite{Hales:2006:DCG}, the same effect was achieved by requiring all packing%s
%to be saturated.  Drop the assumption of saturation
%on $\Lambda$.
%\end{remark}


\begin{lemma}\guid{JGXZYGW}
\oldrating{150}
\formalauthor{Nguyen Tat Thang}
\rating{0}
\label{lemma:deltabound} If there exists a \indy{Index}{negligible}%
negligible \indy{Index}{fcc-compatible} fcc-compatible function%
$G:\Lambda\to\R$ for a 
%saturated 
packing $\Lambda$, then there
exists a constant $c$ such that for all $r\ge1$ and all
$\p\in\ring{R}^3$,
    $$
    \delta(\Lambda,\p,r)
    \le \pi/\sqrt{18} + c/r.
    $$
%The constant $c$ depends on $\Lambda$ only through the constant
%$c_1$ of Definition~\ref{def:negligible}.
\end{lemma}

\begin{conjecture}\label{conj:fcc-neg}
For every saturated packing $\Lambda$, there exists a negligible fcc-compatible function
$G:\Lam\to R$.
\end{conjecture}



\begin{proof}
The volume of $B(\Lambda,\p,r)$ 
is at most the product of the volume $4\pi/3$ of a single ball $4\pi/3$ with the
number of centers in $B(\p,r+1)$.  
Hence
    \begin{equation}
    \op{vol}\, B(\Lambda,\p,r) \le \card(\Lambda(\p,r+1)) 4\pi/3.
    \label{eqn:Abound}
    \end{equation}

%In a %saturated packing 
Each truncated Voronoi cell is contained in a ball of
radius $2$ that is concentric with the unit ball in that cell.  The volume
of the large ball $B(\p,r+3)$ is at least the combined volume of 
all truncated Voronoi
cells centered in $B(\p,r+1)$. This observation,
combined with fcc-compatibility and negligibility, gives
    \begin{equation}
    \begin{split}
    \sqrt{32}\,\,\card(\Lambda(\p,r+1))
    &\le \sum_{\v\in\Lambda(\p,r+1)} (G(\v) +
    \op{vol}(\Omega(\v))) \\
    &\le c_1 (r+1)^2 + \op{vol}\,B(\p,r+3) \\
    &\le c_1 (r+1)^2 + (1+3/r)^3 \op{vol}\,B(\p,r)
    \label{eqn:Bbound}
    \end{split}.
    \end{equation}
\indy{Index}{fcc-compatible}%
Recall that $\delta(\Lambda,\p,r)=
\op{vol}\,B(\Lambda,\p,r)/\op{vol}\,B(\p,r)$. Divide Inequality
\ref{eqn:Abound} through by $\op{vol}\,B(\p,r)$.  Use
Inequality~\ref{eqn:Bbound} to eliminate $\card(\Lambda(\p,r+1))$ from the
resulting inequality.  This gives
    $$\delta(\Lambda,\p,r)
        \le \frac{\pi}{\sqrt{18}} (1+3/r)^3 + c_1 \frac{(r+1)^2}{r^3\sqrt{32}}.
    $$
The result follows for an appropriately chosen constant $c$ (depending on $c_1$).
\end{proof}

\begin{remark} \label{remark:precise}
The precise meaning of the sphere packing problem is to prove the bound
bound $\delta(\Lambda,\p,r) \le \pi/\sqrt{18} + c/r$ for every packing $\Lambda$.  Thus, by the preceding lemma, the existence of a negligible
fcc-compatible function provides the solution to the packing problem. 
The strategy will be to
define a negligible function and then to solve an optimization
problem in finitely many variables to establish that the function is also
fcc-compatible.
\end{remark}



\section{Rogers's partition}\label{sec:rogers}



%Think of $\Lam$ as the set of centers of a  packing of congruent balls of radius $1$. To be saturated means that there is no room for further balls to be added to the packing. There is no loss in generality in assuming that the packing is saturated, when searching for the greatest possible density of a packing.


Given a packing $\Lam$, Rogers gives a partition of Euclidean space into
simplices with vertices in $\Lam$ \cite{Rogers:1958:Packing}.   He used this partition
to give a bound on the density of sphere packings in Euclidean space of arbitrary dimension.
In two dimensions, the bound is sharp and gives a solution to the sphere packing problem.

Let $\Omega(\lam)$  be the Voronoi cell centered at $\lam$:
$$
  \Omega(\lam) = \{\p \mid  \norm{\p}{\lam} 
\le \norm{\p}{\mu},\ \lam\ne\mu\in\Lam\}.
$$
If $S\subset\Lam$ (or if $S$ is a tuple of elements of $\Lam$), 
then the intersection of the family is  $\Omega(S)$':
$$\Omega(S)  = \bigcap \{\Omega(\lam)\mid \lam\in S \}.$$
Call $\Omega(S)$ the $S$-face of $\Omega(\lam)$ when $\lambda\in S$.

For $X\subset\ring{R}^3$,  let $\dimaff(X)$ be the dimension of the affine hull
of $X$.

When $\bl=(\lam_0,\ldots,\lam_k)$ and $j\le k$, write $\bl[j] = (\lam_0,\ldots,\lam_j)$.
Let $\Lam(k)$ be the set of $(k\!+\!1)$-tuples $\bl=(\lam_0,\ldots,\lam_k)$, with
$\lambda_i\in\Lambda$ such
that 
\begin{equation}\label{eqn:omega-dim}
\dimaff(\Omega(\bl[j])) = 3-j
\end{equation}
for all $0<j\le k$.
In particular, $\Lam(0)=\Lam$,   and $\Lam(1)$ is the
set of all pairs $(\lam,\mu)$ such that the Voronoi cells at $\lam$ and $\mu$ meet along
a face of codimension $1$, and
so forth.


Define $\omega:\Lam(k)\to \ring{R}^3$ by recursion over $k$ as follows.
Let $$\omega(\lam[0]) = \lam[0],$$
and let $\omega(\lam[j+1])$ be the closest point on $\Omega(\lam[j+1])$ to $\omega(\lam[j])$.  The point is defined whenever $\Omega(\lam[j+1])$ is nonempty.
The set $\Omega(\lam[j+1])$ is convex and compact.  Thus, the point $\omega(\lam[j+1])$ exists
uniquely.
\indy{Notation}{zzomega@$\omega$ (vertices of Rogers's simplex)}%

For $\bl\in\Lam(k)$, let 
$$R(j,\bl) = \op{conv}\{\omega(\lam[j]), \omega(\lam[j+1]),\ldots,\omega(\lam[k])\}.$$  Set $R(\bl)=R(0,\bl)$.
\indy{Notation}{R@$R$ (Rogers's simplex)}%


\begin{lemma}\guid{GLTVHUM}\rating{200}
For any saturated packing $\Lambda$, 
$$\ring{R}^3 = \bigcup\, \{ R(\bl) \mid \bl\in \Lam(3)\}.$$
\end{lemma}

\begin{proof}
Partition Euclidean space into Voronoi cells. 
$$\ring{R}^3 = \bigcup\, \{\Omega(\lam)\mid \lam\in \Lam(0)\}.$$
It is enough to show that
$$\Omega(\bl[0]) = \bigcup\, \{ R(\bl') \mid \bl'\in \Lam(3),~\bl[0]=\bl'[0]\}.$$
By Lemma~\ref{lemma:webster}, the relative boundary of the bounded polyhedron $\Omega(\bl[0])$ is the union of its facets.   The polyhedron can be partition into the cones over these facets.
$$\Omega(\bl[0]) = \bigcup\, \op{conv}(\omega(\bl[0]),\{\Omega(\bl[1])\mid \bl[1]\in \Lam(1)\}).$$
It is enough to show that
$$\Omega(\bl[1]) = \bigcup\, \{ R(1,\bl') \mid \bl'[1]=\bl[1],~\bl'\in \Lam(3)\}.$$
After successively partitioning each facet into cones over facets of facets, it is enough to show that
$$\Omega(\bl[3]) = \bigcup\,\{R(3,\bl')\mid\bl'[3]=\bl[3],~\bl'\in\Lambda(3)\}.$$
The right-hand side is the singleton $\{\omega(\bl[3])\}$.  The left-hand side
contains this point and is contained in a properly decreasing chain of affine sets:
$\ring{R}^3$, the bisector of $\lam_0$ and $\lam_1$, and so forth.  This determines a unique point,
so the two sides are equal.
\end{proof}

\begin{lemma}\guid{DUUNHOR}\rating{140}  
The intersection of any two distinct $R(\bl)$ and $R(\bm)$ is contained in a plane 
and hence has measure zero.
\end{lemma}

This result and the previous lemma show that the simplices $R(\bl)$ partition Euclidean
three-space.

\begin{proof}  Let $\bl = (\lambda_0,\ldots)$ and $\bm = (\mu_0,\ldots)$.
If $\lambda_0\ne\mu_0$, the intersection $R(\bl)\cap R(\bm)$  lies in $\Omega(\lam_0,\mu_0)$
and the conclusion follows.  Let $k+1$ be the first index such that
$$\op{conv}(\omega(\lam_0),\ldots,\omega(\lam_0,\ldots,\lam_{k+1}))\ne
\op{conv}(\omega(\mu_0),\ldots,\omega(\mu_0,\ldots,\mu_{k+1})).
$$
By induction, $\Omega(\lam_0,\ldots,\lam_k) = \Omega(\mu_0,\ldots,\mu_k)$,
but
$$\Omega(\lam_0,\ldots,\lam_{k+1}) \ne \Omega(\mu_0,\ldots,\mu_{k+1}).$$
The intersection lies in the convex hull $C$ of
$\{\omega(\lam_0),\ldots,\omega(\lam_0,\ldots,\lam_k)\}$ and
$V=\Omega(\lam_0,\ldots,\lam_{k+1},\mu_{k+1})$.  The set $V$ lies in an affine set of 
codimension $k+2$
and $C$ has codimension $(k+2) - (k+1) = 1$.  The intersection is thus contained in a plane.
\end{proof}

\begin{definition}[h]
%Let $h(\bl[i]) = \norm{\omega(\bl[i])}{\lam_0}$.  
If $\bl=(\lam_0,\lam_0,\ldots,\lam_k)\in\Lam(k)$, 
let $h(\bl[j])$ be the circumradius of $\{\lam_0,\ldots,\lam_j\}$ for $j\le k$.
\end{definition}
\indy{Notation}{h@$h$ (circumradius)}%

\begin{lemma}\guid{XNHPWAB}\rating{500}\label{lemma:v2} Let $\bl=(\lam_0,\ldots,\lam_3)\in\Lambda(3)$ and fix $0\le j\le 3$.  Assume that $h(\bl[j])<\sqrt2$.
%$$
%\norm{\omega(\bl[j]) }{ \lam_0} < \sqrt2.
%$$
Then 
\begin{nomerate}
\item \case{circumcenter} $\omega(\bl[j])$ is the circumcenter of the set $S_j =\{\lam_0,\ldots,\lam_j\}$. 
\item \case{convex hull} The circumcenter of $S_j$  lies in the convex hull of $S_j$.  
\item \case{distinctness}  The points $\omega(\bl[j])$, for $j=0,1,2,3$, are all distinct.
\end{nomerate}
\end{lemma}
\indy{Index}{convex hull}%

\begin{proof} The three conclusions of the lemma will be proved separately.

\indy{Index}{circumcenter}%
\case{circumcenter} By definition, if $\bl\in\Lambda(3)$, then
$$\dimaff\Omega(\lam_0,\ldots,\lam_j) = 3-j.$$  The case $j=0$ of the lemma is trivially
satisfied.  Assume by induction the result holds for numbers less than $j$.

Now assume $j>0$.
The circumcenter $\p=\p_{j}$ of the set $S_{j}$ is the point on the plane $\op{aff}(\Omega(S_{j}))$
closest to $\p_{j-1}=\omega(\bl[j-1])$.  

\claim{The point $\p$ lies in $\Omega(S_{j})$.}   Otherwise
there is a point $\mu\in\Lambda\setminus S_j$ satisfying
\begin{equation}\label{eqn:closest}
\norm{\mu}{\p}\le \norm{\lambda}{\p}, \quad\text{for all } \lam\in S_j.
\end{equation}
The angles $\arc_V(\p,\{\mu,\lam_i\})$ are obtuse for $i\le j$ because
$$
\norm{\p}{\mu} < \sqrt2,\quad \norm{\p}{\lambda_i} <\sqrt2,\quad \norm{\mu}{\lambda_i} \ge 2.
$$ 
A case-by-case argument follows, for each $j$.

If $j=1$, the points $\p,\lam_0,\lam_1$ are collinear and cannot give two obtuse angles.

If $j=2$, let $\mu'$ be the projection of $\mu$ to the plane containing
$\p,\lam_0,\lam_1,\lam_2$. The four points $\mu',\lam_0,\lam_1,\lam_2$ can be arranged
cyclically around $\p$, each forming an obtuse angle with the next.  A circle around $\p$
cannot give four obtuse angles.


If $j=3$, assume that $\lam_0,\ldots,\lam_3$ are labeled in cyclic order around the line
$\op{aff}\{\p,\mu\}$.  Consider the dihedral angle 
  $$
  \gamma=\gamma_i=\dih(\{\p,\mu\},\{\lam_i,\lam_{i+1}\}).
  $$
The sphere $S^2(\p)$ of radius $1$ centered at $\p$ meets any ray
$\op{aff}_+(\p,\{\q\})$ at a point.   As $\q$ runs over $\{\mu,\lam_i,\lam_{i+1})$,  the three corresponding rays give three points on $S^2(\p)$, which are the vertices of a spherical triangle with sides $a,b,c$.  By the spherical law of cosines, the angle $\gamma$ of the spherical triangle is given in terms of the edges as
$$
  \cos c - \cos a \cos b = \sin a \sin b \cos \gamma.
$$
All the terms on the left-hand side are negative, so $\gamma =\gamma_i > \pi/2$.
This is impossible, as the sum of the four dihedral angles $\gamma_i$ is $2\pi$.
This completes the proof that $\omega(\bl[j])$ is the circumcenter.

\indy{Index}{hull!convex}%
\case{convex hull}  Next, it will be shown that $\p_j$ lies in the convex hull of $S_j$.
%If $j=0$, there is nothing to show.  If $j=1$, the point is the midpoint of the convex hull.
%If $j=2$, the point is the circumcenter of an acute triangle.  If $j=3$, the point is the
%circumcenter of a simplex such that every face has positive orientation.  Thus,
%in every case the point lies in the convex hull.
Suppose to the contrary that $\p=\p_j$ does not lie in the convex hull. Then there is $i<j$ such that $\op{aff}(S')$ separates $\p$ from $\lam_i$, where  $S'=S_j\setminus\{i\}$.  Let $\p'$ be the circumcenter of $S'$, and let $\mu=\lam_i$.  Then for $k\ne i$ and $0\le k\le j$, it follows that
$$
\begin{array}{lll}
\norm{\lam_k}{\p'} &= (\norm{\lam_k}{\p}^2 - \norm{\p}{\p'}^2)^{1/2} \\
  &\ge \norm{\lam_k}{\p} - \norm{\p}{\p'} \\
  &=\norm{\mu}{\p} - \norm{\p}{\p'}\\
  &=\norm{\mu}{\p'}.
\end{array}
$$
This is contrary to inequality~\ref{eqn:closest}.


\case{distinctness}  The distances $\norm{\omega(\bl[j])}{\omega(\bl[0])}$ are increasing, so it is enough to show
that $\omega(\bl[j])\ne \omega(\bl[j+1])$.  Otherwise,   equality holds, and the circumcenter $\omega(\bl[j])$
has an equally close packing point $\lambda_{j+1}\in\Lambda$, which is impossible by inequality~\ref{eqn:closest}.
\end{proof}


%The concept of {\it positive orientation} is used in the proof.  This is discussed in the 1998 proof and in {\it Lemmas in Geometry}.  If a face has circumradius less than $\sqrt2$ it has positive orientation.  If every face has positive orientation, then the circumcenter of the simplex is contained in its convex hull.



By the lemma, if $h(\bl[j])<\sqrt2$, then the numbers $h(\bl[i])$ are increasing in $i$, for $i\le j$.


\begin{lemma}\guid{YIFVQDV}\rating{140}   
Let $\bl\in\Lambda(k)$.  Assume that $h(\bl)<\sqrt2$. Let $\bm$ be any permutation of the components of $\bl$.  
Then $\bm\in\Lambda(k)$, $\norm{\omega(\bm)}{\mu_0}<\sqrt2$, and  $\omega(\bl) = \omega(\bm)$.
\end{lemma}

\begin{proof} 
Since the sets $\Omega(\bl[j])$ satisfy \eqn{eqn:omega-dim}, it follows that
$\Omega(\bl)\cap \op{conv}\{\lam_0,\ldots,\lam_k\}$ is the singleton $\{\omega(\bl)\}$, which contains the
circumcenter of the simplex with vertices $\{\lam_0,\ldots,\lam_k\}$.  This describes $\omega(\bl)$ in a way that does not depend on the ordering of $\lam_0,\ldots,\lam_k$.

The condition \eqn{eqn:omega-dim} can be shown to hold for $\mu$.
The proof of Lemma~\ref{lemma:v2} shows that the midpoint of $\mu_0$ and $\mu_1\}$
lies in $\Omega(\bm[1])$.  By the distinctness conclusion of the same lemma, some neighborhood
of this midpoint in the bisecting plane of $\{\mu_0,\mu_1\}$ lies in $\Omega(\bm[1])$.
Thus, $\dimaff(\Omega(\bm[1]))=2$.  Continue in this fashion to show that 
$$
\dimaff(\Omega(\bm[j]))=3-j.$$
\end{proof}

Let
$\op{Sym}(k+1)$ be the group of all permutations on $k+1$ letters.
Let $\bl = (\lam_0,\ldots,\lam_k)\in\Lambda(k)$.  
For any permutation $\pi\in\op{Sym}(k+1)$, let $\pi(\bl)\in\Lam(k)$ be given by
$$
\pi(\bl)_i = \lam_{\pi i}.
$$   

\begin{lemma}\guid{WQPRRDY}\rating{400}\label{lemma:Rconv}  Let $\pi\in\op{Sym}(k+1)$
and $\bl = (\lam_0,\ldots,\lam_k)\in\Lambda(k)$.  
Assume that $h(\bl)<\sqrt2$. Then
$$
\op{conv}\{\lam_0,\ldots,\lam_k\} = \bigcup \,\{ R(\pi(\bl)) : \pi\in \op{Sym}(k+1)\}.
$$
\end{lemma}
\indy{Notation}{Sym@$\op{Sym}$ (symmetric group)}%

\begin{proof} Let $L = \{\lam_0,\ldots,\lam_k\}$.  The proof is by induction on $k$.
When $k=0$, the result is trivial.  Now assume $k>0$.

The circumcenter $\omega(\bl)$ of $L$ lies in the convex hull of these
points.  (See the proof of Lemma~\ref{lemma:v2}.)  Thus, the left-hand side is the union
of cones:
$$
\op{conv}(S) = \bigcup\,\{ \op{conv}(\omega(\bl),L\setminus \{\lam_i\}\mid i=0,\ldots,k) \}.
$$
The sets $L\setminus \{\lam_i\}$ can be identified with  cosets of $\op{Sym}(k+1) /\op{Sym}(k)$.
By induction $L\setminus \{\lam_i\}$ is the union of $R(\bm)$ as $\bm$ runs
over all permutations $\op{Sym}(k)$ of $L\setminus \{\lam_i\}$.
The result follows by induction.
\end{proof}

By construction, the simplices $R(\bl)$ in Rogers's partition  are compatible with the Voronoi
decomposition of space.  Under
mild restrictions on the circumradius, they can also be reassembled into simplices
with vertices at the centers of the packing (the Delaunay simplices),  by Lemma~\ref{lemma:Rconv}.
\indy{Index}{simplex!Delaunay}%
\indy{Index}{partition!Rogers}%
\indy{Index}{decomposition!Voronoi}  %

\section{Marchal's partition}

C. Marchal has proposed a particular negligible fcc-compatible function that is manifestly superior to the one in~\cite{Hales:2006:DCG}.  The definition of $k$-cells, Conjecture~\ref{conj:m1}, Theorem~\ref{theorem:mk1}, and the method of Lemma~\ref{lemma:13-14} are all due to him.
\indy{Index}{Marchal, C.}%

%His articles claim to give a {\it demonstration} of the Kepler conjecture \cite{marchal:2007}, \cite{marchal:2008}.  However, the mathematically rigorous part of the article only gives a reduction of the problem to a difficult optimization problem in a finite number of variables.  The method of gradient descent is then used to explore the local minima of the optimization problem in finitely many variables. 

Marchal's partition of space is a variant of Rogers's partition into the simplices $R(\bl)$.  The main part of construction is  the decomposition obtained by truncating the Voronoi cells by a ball of radius $\sqrt2$.  In a few carefully chosen situations, he assembles the simplices $R(\bl)$ into larger convex cells, as suggested by Lemma~\ref{lemma:Rconv}.



\begin{definition} Consider $\bl=(\lam_0,\ldots,\lam_3)\in \Lambda(3)$.
\hfill\break\smallskip  
\case{The $0$-cell} of $\bl$ is
$$
\cell(\bl,0) = \{\p\in R(\bl) \mid \norm{\omega(\lam_0)}{\p} > \sqrt2\}.
$$
\bigskip
\case{The $1$-cell} of $\bl$ is 
$$
\cell(\bl,1) = \op{conv}(\omega(\lam_0),R_1),\hbox{ where } R_1 = \{\p \in R(\bl) \mid \norm{\omega(\lam_0)}{\p}= \sqrt2\}.
$$
\indy{Notation}{R@$R_1$}%
\indy{Notation}{R@$R_2$}%
\indy{Notation}{cell}%
\bigskip
\case{The $2$-cell} of $\bl$ is
$$
\begin{array}{rll}
\cell(\bl,2) &= \op{conv}(\lambda_0,\lambda_1,R_2),\quad \\
 \text{where } R_2 &= \{\p \in R(\bl)\cap \Omega(\bl[1]) \mid \norm{\lam_0}{\p}=\norm{\lam_1}{\p} =\sqrt2\}.
\end{array}
$$
\bigskip
\case{The $3$-cell} of $\bl$ is defined to be empty unless 
$$
h(\bl[2]) <\sqrt2 \le h(\bl[3]).
$$
When this inequality holds,
there is a a unique point $\xi(\bl[2])$ in
$\op{conv}(\omega(\bl[2]),\omega(\bl[3]))$ at distance exactly $\sqrt2$ from $\lam_0$.  
Define the $3$ cell to be
$$
\cell(\bl,3) = \op{conv}\{\lam_0,\lam_1,\lam_2,\xi(\bl[2])\}.
$$
\bigskip
\case{The $4$-cell} of $\bl$ is defined to be empty unless
$$
h(\bl[3]) <\sqrt2.
$$
When this inequality holds, define the $4$ cell to be
$$
\cell(\bl,4) = \op{conv}\{\lam_0,\lam_1,\lam_2,\lam_3\}.
$$
\end{definition}
\indy{Notation}{zzxi@$\xi(\cdot)$}%

Note the the $0$ and $1$-cells are always subsets of a single simplex $R$.  However, the $2$, $3$, and
$4$-cells lie in a union of  simplices.

\begin{lemma}\guid{RVFXXBU}\rating{400}  The $0,\ldots,4$-cells of the parameters $\bl\in \Lam(3)$
give a partition of $\ring{R}^3$.  An $i$-cell is never equal to a $j$-cell when $i\ne j$. For $k\ge 2$, 
two $k$-cells $\cell(\bl,k)=\cell(\bm,k)$ are equal exactly when $\bl[k-1]$
is a permutation of $\bm[k-1]$.
\end{lemma}

\begin{proof}  First, the proof establishes that cells are either disjoint (up to a null set) or equal.  At the same time, it determines exactly when two $k$-cells are equal to one another. 

By Lemma~\ref{lemma:Rconv}, the $4$-cell $\cell(\bl,4)$ is a union of the simplices $R(\bm)$, as $\bm$ runs over permutations of $\bl$.   Two $4$-cells that meet in a set of positive measure are equal.  Every $4$-cell is a union of simplices $R(\bl)$ with $h(\bl)<\sqrt2$.  This condition gives $\cell(\bl,i)=\emptyset$, for $i=0,1,2,3$.

Similarly, the $3$-cell is a union
of the convex hulls $\op{conv}(\xi(\bm[2]),R(\bm[2]))$ as $\bm[2]$ runs over permutations of $\bl[2]$.  Note that the point $\xi(\bm[2])=\xi(\bl[2])$ is independent of the permutation, since
it is determined as the point at distance $\sqrt2$ from $\lam_0$ along the line through
from $\omega(\bm[2])=\omega(\bl[2])$ perpendicular to the plane $\op{aff}\{\lam_0,\lam_1,\lam_2\}$
(in the half-space of $\bl[3]$). Two $3$-cells that meet in a set of positive measure are equal.  Their parameters are equal: $\bl[2]=\bm[2]$.    The intersection $\cell(\bl,3)$ cannot meet $\cell(\bl,i)$, for $i<3$, in a set of full dimension, because the plane $\op{aff}\{\lam_0,\lam_1,\p\}$ separates them.

The $2$-cell with parameter $\bl$ is contained in the right-circular cone
$$
\op{rcone}(\lam_0,\lam_1,\cos(\op{arc}(\norm{\lam_0}{\lam_1},\sqrt2,\sqrt2)))
$$
This cone separates the $2$-cell from the $0$ and $1$-cells with the same parameter $\bl$.
The $1$-cell is separated from $0$-cells by the sphere
of radius $\sqrt2$, centered at $\lam_0$.

\claim{Finally,  every point $\p\in\ring{R}^3$ belongs to a cell.}  Indeed, by Rogers's
partition, the point $\p$ belongs to a  simplex $R(\bl)$.  If $h(\bl)<\sqrt2$, then
$\p$ belongs to a $4$-cell.  Otherwise $\p\in R(\bl)$ belongs to $\cell(\bl,i)$ according to
which side of the separating plane, right-circular cone, and sphere  the point
lies, as described above.
\end{proof}


\section{Negligibility}

This section shows how the existence of a fcc-compatible negligible function (Conjecture~\ref{conj:fcc-neg}) will follow from an explicit estimate
related to the the distances $h(\bl)$, where $\bl\in\Lam(1)$.

\begin{note}%XX
Replace $\sol_0/\pi =\Delta_1$ to simplify formulas.
\end{note}

Define the following constants and functions: 
$$
\begin{array}{lll}
\sol_0 &= 3\arccos(1/3)-\pi\\
%\Delta_1 &= (3\arccos(1/3)-\pi)/\pi\\
\tau_0 &= 4\pi  - 20\sol_0\\
m_1 &= \sol_0 2\sqrt2/\tau_0 = 1.012\ldots \\ %% K 
m_2  &=  (6\sol_0- \pi)\sqrt2/(6 \tau_0) = 0.0254\ldots\\ %% M 
h_+ &= 1.3254 \hbox{~(exact rational value)}
\end{array}
$$
The constant $\sol_0$
is the area of a spherical triangle with sides $\pi/3$.
Let $M:\ring{R}\to\ring{R}$ 
be the following piecewise polynomial function (Figure~\ref{fig:M}):
$$
M(h) =
\begin{cases}
% (\sqrt2-h) (h-1.3254) (9h^2 - 17 h + 3)/(1.627 (\sqrt2-1))& h\le\sqrt2\\
\dfrac{\sqrt2-h}{\sqrt2-2}~ \dfrac{h_+-h}{h_+-1} ~\dfrac{17 h - 9 h^2 - 3}{5} & h \le \sqrt2.\vspace{3pt} \\
 0 & h >\sqrt2.
\end{cases}
\\
$$
\begin{figure}[htb]
  \centering
  \szincludegraphics[width=60mm]{\pdfp/Mfun.eps}
% Plot[Mfun[h], {h, 1, Sqrt[2]}]
% copied to Preview, then saved, then converted to eps via pdf2eps.
  \caption{The quartic polynomial $M$.}
  \label{fig:M}
\end{figure}

Simple calculations based on the definitions give
\begin{equation}\label{eqn:km}m_1 - 12m_2 = \sqrt{1/2}\end{equation}
and
\begin{equation}M(1) = 1,\quad M(h_+)=0,\quad M(\sqrt2) =0.\end{equation}


\begin{conjecture}[Marchal]\guid{PHNFUXP}\rating{ZZ}\label{conj:m1} For any packing $\Lam$, and
any $\lam_0\in\Lam$, 
$$
\sum_{\bl\in\Lam(1)} M(h(\bl)) \le 12.
$$
\end{conjecture}

Marchal's conjecture is still open.  This book proves a variant of Marchal's conjecture.

\begin{theorem}\guid{KIZHLTL}\rating{300}\label{theorem:mk1}
Marchal's Conjecture~\ref{conj:m1} implies Conjecture~\ref{conj:fcc-neg} on the existence of fcc-compatible negligible functions.
\end{theorem}

\begin{note}%XX
This book contains a number of nonlinear inequalities that have been established by interval-arithmetic calculations by computer.   Some of these interval arithmetic calculations are still in the process of being verified.  The approach to the proof of the Kepler conjecture described here is still work in progress.  A description of the inequalities and their current status can be found at~\cite{hales:2009:nonlinear}. 
\end{note}

\begin{proof} 
It is enough to show that $G(\lam_0)  = -\op{vol}(\Omega(\lam_0)) + 8 m_1 - \sum 8 m_2 M(h(\bl))$ is fcc-compatible and negligible.  
%The result then follows from Lemma~\ref{lemma:deltabound}.  
The function $G$ is fcc-compatible directly
by equation~\eqn{eqn:km}
and Conjecture~\ref{conj:m1}:
\indy{Index}{negligible}%
\indy{Index}{fcc-compatible}%
$$
\begin{array}{lll}
\sqrt{32} &= 8 m_1 - 8\cdot 12 m_2\\
  &\le 8 m_1 - 8 m_2 \sum M(h)
  &= \op{vol}(\Omega(\lam_0)) + G(\lam_0).
\end{array}
$$  
The issue is to prove it negligible.  More explicitly, one must find a constant  $c$ such that for all $r\ge 1$ and all $\p\in\ring{R}^3$:
\begin{equation}\label{eqn:neg}
  -\sum G(\lam) = \sum \op{vol}(\Omega(\lam)) -\sum 8m_1 + \sum \sum 8 m_2 M(h) \ge c r^2,
\end{equation}
where the outer nested sum runs over $\lam\in \Lam(\p,r)$.

Lemmas~\ref{lemma:Zr2} and \ref{lemma:Lambda-finite}  show that the number of points of $\Lambda$ near the boundary of $B(\p,r)$ is bounded by $c r^2$.

Let $V(X)$ be the intersection of $\Lam$ with the set of extremal points of the $k$-cell $X$.  Explicitly, $V(X)=\emptyset$ if $k=0$; and $V(X) = \{\lambda_0,\ldots,\lam_{k-1}\}$ in general.  Each $k$-cell is measurable and eventually
radial at each $\lam\in V(X)$.  Define the total solid angle of $X$ to be
$$
\op{tsol}(X) = \sum_{\lambda\in V(X)} \sol(X,\lambda).
$$
\indy{Index}{angle!total solid}%
\indy{Index}{extreme point}%
\indy{Notation}{tsol@$\op{tsol}$}%

Let $E(X)$ be the set of extremal edges of the $k$-cell $X$ in $\Lambda$.  More precisely, let 
$$E(X)=\{\{\lam_i,\lam_j\}\mid \lam_i\ne\lam_j\in V(X)\}.$$
In particular, $E(X)$ is empty for $0$ and $1$-cells, and contains
$\tbinom{k}{2}$ pairs when $k\ge 2$.
\indy{Notation}{1@\tbinom{n}{k}}%

The value
$\dih(X,e)$ of the dihedral angle indexed by an edge $e\in E(X)$ is defined to be the dihedral angle along that edge
of the boundary.  
The (single)   dihedral angle of a $2$-cell is
the same as the radian angle subtended by the arc $R_2$, which was defined in the construction of $2$-cells.
The dihedral angle of a $3$ or $4$-cell is the dihedral angle along the given edge of the simplex $X$. 
\index{Notation}{dih@$\dih$}
\index{Index}{angle!dihedral}
Each element $e=\{\lam_i,\lam_j\}\in E(X)$ also determines
the real number $h(e) = \norm{\lam_i}{\lam_j}/2$.

For any function $f:\ring{R}\to\ring{R}$ and any cell $X$, set
\begin{equation}\label{eqn:gamma-def}
\gamma(X,f) =  \op{vol}(X)
-\left(\frac{2m_1}{\pi}\right) \op{tsol}(X) + \left(\frac{8m_2}{\pi}\right)
\sum_{e\in E(X)} \dih(X,e)  f(h(e))
\indy{Notation}{ZZddgamma@$\gamma$ (fundamental estimate)}%
\end{equation}
Marchal's fundamental estimate\cite[]{hales:2009:nonlinear} holds for any cell $X$:  %% cc:mar are the k-cell estimates for non-cell clusters.
\begin{equation}\label{eqn:mfe}
\gamma(X,M)\ge 0.
\end{equation}
(Note that this is an inequality in at most six variables; the most difficult case to prove is that of a $4$-cell.)  Formulas for the volumes and solid angles appear in Chapter~\ref{sec:volume}.   An explicit formula for the dihedral angle appears in Chapter~\ref{part:trig}.

The sum of the inequality~\eqn{eqn:mfe} over all cells in a large ball $B(\p,r)$ gives an
inequality of the form $T_1 + T_2 + T_3\ge 0$ for three terms $T_i = T_i(r)$ of \eqn{eqn:gamma-def}.  The desired equation~\eqn{eqn:neg} consists of  three corresponding terms $T'_i(r)$.
It is enough to show that
$$
T_i'(r) \ge T_i(r) + c_i r^2,
$$
for some constants $c_i$.

The sum of the volumes of the Voronoi cells $\lam\in B(\p,r)$ is  not exactly the volume of $B(\p,r)$, because of the contribution at the boundary of $B(\p,r)$ of Voronoi cells that are only partly contained in $B(\p,r)$.  Similarly, the sum of the various $k$-cells, for $X\subset B(\p,r)$ is not exactly the volume of $B(\p,r)$, because of contribution from the boundary. The boundary contributions have order $r^2$. Thus,
$$
T_1'= \sum_{\lam\in \Lam(\p,r)} \op{vol}(\Omega(\lam)) \ge \sum_{X\subset B(\p,r)} \op{vol}(X) + c_1 r^2 = T_1 + c_1 r^2.
$$


The estimates on the other terms are similar.  The solid angles
around each vertex sum to $4\pi$.
In Landau big O notation, this gives
$$
\begin{array}{lll}
\sum_{X\subset B(\p,r)} \op{tsol}(X) &= 
\sum_{X\subset B(\p,r)} \sum_{\lam\in V(X)} \sol(X,\lam)\\
 &=\sum_{\lam\in \Lam(\p,r)} \sum_{X\mid \lam\in V(X)} \sol(X,\lam) + O(r^2)\\
 &=\sum_{\lam\in \Lam(\p,r)} 4\pi    + O(r^2).
\end{array}
$$
Hence
$$
T_2' = -\sum_{\Lam(\p,r)} 8 m_1 = -\sum_{X\subset B(\p,r)}\left(\frac{2m_1}\pi\right) \op{tsol(X)} + c_2 r^2 = T_2 + c_2 r^2.
$$
Similarly, the dihedral angles around each edge sum to $2\pi$.  A factor of $2$ enters the following calculation, because there are two ordered pairs for each unordered pairs $\{\lam_0,\lam_1\}$:
$$
\begin{array}{lll}
&\sum_{X\subset B(\p,r)} \sum_{e\in E(X)} \dih(X,e)  M(h(e)) \vspace{3pt}\\
&\qquad=\sum_{e\subset B(\p,r)} \sum_{X: e\in E(X)} \dih(X,e)  M(h(e)) +O(r^2)\vspace{3pt}\\
 &\qquad=\sum_{e\subset B(\p,r)} 2\pi M(h(e)) + O(r^2)\vspace{3pt} \\
 &\qquad=\sum_{\lam_0\in \Lam(\p,r)} \sum_{\lam_1\in \Lam(\p,r) } \pi M(h(\lam_0,\lam_1)) + O(r^2).\\
\end{array}
$$
Finally,
$$
T_3' = \sum\sum 8 m_2 M(h(\bl)) \ge \left(\frac{8m_2}\pi\right)
\sum_{X\subset B(\p,r)}\sum_{e\in E(X)}\dih(X,e) M(h(e)) + c_3 r^2 = T_3 + c_3 r^2.
$$
\end{proof}




\section{Clusters}

\begin{summary}  Marchal's Conjecture is still open.  This section gives another conjecture that is closely related to Marchal's Conjecture.  In this new conjecture, a piecewise linear function $L$ replaces the piecewise polynomial function $M$.   More crucially, the support of the function $L$ is contained in $\leftclosed2,2.52\rightclosed]$.  By contrast, the support of Marchal's function is much larger: $\leftclosed2,2.6508\rightclosed$.
This small difference in the support of the function creates an enormous difference in the difficulty of the conjectures.    

The conjecture formulated in this section also implies the existence of fcc-compatible negligible functions.  To prove this, it is helpful to group Marchal's cells together, into what are called {\it clusters}.  This section makes a detailed study of clusters in order to produce a negligible function.  

 The sections and chapters that follow this one give a proof of the conjecture in this section.  The  proof of this conjecture is the main intermediate result in the journey to prove the Kepler conjecture.
\end{summary}

%This section shows how to improve on the estimates of the previous section
%by combining various cells into {\it cell clusters}.
Recall $M(h_+) = 0$, where   $h_+ = 1.3254$.
\indy{Index}{cell cluster}%

\begin{definition}[$L$,~$h_0$,~$h_-$]
Set
$$
  h_0 = 1.26\\  %%\hm
$$
Let $L:\ring{R}\to\ring{R}$ be the piecewise linear function 
$$
L(h) = \begin{cases}
\dfrac{h_0-h}{h_0-1}, & h \le h_0 \\
0, & h\ge h_0. \\
\end{cases}
$$
It follows from the definition that
$$
L(1) = 1\quad L(\hm) = 0.
$$
Let $h_- = 1.23175\ldots$ be the unique root of the quartic polynomial
$M(h)-L(h)$ lying in the interval $[1.2,1.3]$.
\indy{Notation}{L@$L$ (linear function)}%
\indy{Notation}{h@$h_- = 1.23175\ldots$}%
\indy{Notation}{h@$h_0 = 1.26$}%
\end{definition}

%%
\begin{figure}[htb]
  \centering
  \szincludegraphics[width=60mm]{\pdfp/Lfun.eps}
% Plot[{Mfun[h],Lfun[h]}, {h, 1.2, 1.35}]
% copied to Preview, then saved, then converted to eps via pdf2eps.
%% WW very big .eps file!
  \caption{Detail of the quartic $M$ and linear function $L$.}
  \label{fig:L}
\end{figure}

The inequality $L(h)\ge M(h)$ holds except when $h\in [h_-,h_+]$.  The aim of this section is to prove a variant of Theorem~\ref{theorem:mk1} that uses the function $L$ rather than $M$.  For this, one needs to combine cells into groups called cell clusters.

\begin{definition}[critical edge,~$\op{EC}$,~$\op{wt}$]
Let $X$ be a $k$-cell, where $k\ge 2$.  Let $e\in E(X)$.
An edge is {\it critical} if $h(e)\in[h_-,h_+]$.
Let $\op{EC}(X)\subset E(X)$ be the set of critical edges of $X$.  If $X$ is any cell such that $\op{EC}(X)$ is nonempty, let the weight $\op{wt}(X)$ of $X$  
be $1/\card(\op{EC}(X))$.
\end{definition}
\indy{Index}{critical!edge}%
\indy{Notation}{E@$\op{EC}$ (critical edges)}%
\indy{Notation}{wt@$\op{wt}$ (weight)}%

\begin{definition}[$\beta$,~$\op{bump}$]  Set 
$$
\op{bump}(h) = 0.005 (1 - (h-h_0)^2/(h_+-h_0)^2).
$$
If $X$ is a $4$-cell with exactly two critical edges, then set
$$
\beta(e,X) = \op{bump}(h(e)) - \op{bump}(h(e')), \text{ where } \{e,e'\} = \op{EC}(X).  
$$
Otherwise, for all other edges in all other cells, set $\beta(e,X) = 0$.
\end{definition}
\indy{Notation}{bump@$\op{bump}$}%
\indy{Notation}{ZZbeta@$\beta$ (bump)}%

\begin{definition}[cell cluster,~$\Gamma$,~$\gamma_L$]
Let $e\in \op{EC}(X)$ be a critical edge of a $k$-cell for some $k\ge 1$.
A cell cluster is the set 
$$
\op{cluster}(e) = \{X\mid e\in E(X)\} 
$$
\indy{Notation}{cluster}%
of all cells around $e$. 
If $Z$ is a finite set of cells, define
\indy{Notation}{ZZddgamma@$\gamma_L$ (cell cluster)}%
$$
\Gamma(Z) = \sum_{X\in Z} \gamma_L(X) \op{wt}(X) +\beta(e,X),\quad\hbox{ where }\quad
\gamma_L(X) = \gamma(X,L).
$$
%and where $\op{wt}(X)$ is the weight of $X$.
\indy{Notation}{ZZddGamma@$\Gamma$}%
\indy{Notation}{ZZcamma@$\gamma_L$}%

\end{definition}
\indy{Index}{cell cluster}%

\begin{theorem}\guid{OXLZLEZ}[cell cluster estimate]\rating{1500}\label{lemma:cluster} 
Let $Z$ be any cell cluster.  Then $\Gamma(Z)\ge 0$.
\end{theorem}

The proof of this theorem occupies the rest of the section.  Before the proof, XXD.


\begin{conjecture}\guid{BJERBNU}\rating{ZZ}\label{conj:L12} For any packing $\Lam$, and
any $\lam_0\in\Lam$, 
\begin{equation}\label{eqn:L12}
\sum_{\lam_1\in\Lam\mid h(\lam_0,\lam_1)\le \hm} L(h(\lam_0,\lam_1)) \le 12.
\end{equation}
\end{conjecture}

\begin{theorem}\guid{UPFZBZM}\rating{300}\label{theorem:mk2}
Conjecture~\ref{conj:L12} implies the Kepler conjecture.
\end{theorem}

\begin{proof}  The proof imitates the proof of Theorem~\ref{theorem:mk1}.
It is enough to show that $G_L(\lam_0)  = -\op{vol}(\Omega(\lam_0)) + 8 m_1 - \sum 8 m_2 L(h(\bl))$ is fcc-compatible and negligible. 
The function $G_L$  is fcc-compatible directly
from equation~\eqn{eqn:km}
and Conjecture~\ref{conj:L12}.  

The theorem follows from a proof that $G_L$ is negligible.  More precisely, one needs
to show there exists a constant  $c$ such that for all $r\ge 1$ and all $\p\in\ring{R}^3$:
\begin{equation}\label{eqn:A2neg}
  \sum \op{vol}(\Omega(\lam)) -\sum 8m_1 + \sum \sum 8 m_2 L(h) \ge c r^2,
\end{equation}

For cells $X$ that do not belong to a cell cluster,
the proof is just as in the proof of Theorem~\ref{theorem:mk1}.
If $\op{EC}(X)=\emptyset$, then 
$L(h(e))\ge M(h(e))$ for each edge $e\in E(X)$, and
$$\gamma_L(X)\ge \gamma(X,M)\ge 0$$ 
by inequality \eqn{eqn:mfe}.

Note that the function $\beta(e,X)$ averages to zero for any $4$-cell $X$:
$$
\sum_{e\in \op{EC}(X)} \beta(e,X) = 0.
$$
Hence the terms involving $\beta$ in sums may be safely disregarded.  (The terms involving
$\beta$ may be disregarded here, but they are needed for the proof of Lemma~\ref{lemma:cluster}  in Section~\ref{sec:3or4}.)

Theorem~\ref{lemma:cluster} gives the required inequality for cell clusters.
Again, using big O notation, 
$$
\begin{array}{lll}
\sum_{X\subset B(\p,r)} \gamma_L(X) &= 
\sum_{X\subset B(\p,r)\mid \op{EC}(X)\ne\emptyset} \gamma_L(X) +
\sum_{X\subset B(\p,r)\mid \op{EC}(X)=\emptyset} \gamma_L(X) \vspace{6pt}\\
&\ge \sum_{X\subset B(\p,r)\mid \op{EC}(X)\ne\emptyset} \gamma_L(X)\vspace{6pt} \\
&=\sum_{X\subset B(\p,r)}\gamma_L(X)\sum_{e \in \op{EC}(X)}\op{wt}(X) + O(r^2)\vspace{6pt}\\
&=\sum_{e\subset B(\p,r)}\sum_{X\mid e \in \op{EC}(X)}\gamma_L(X)\op{wt}(X) + O(r^2)\vspace{6pt}\\
&=\sum_{e\subset B(\p,r)}\Gamma(\op{cluster}(e)) + O(r^2)\vspace{6pt}\\
&\ge O(r^2).
\end{array}
$$

From the definition of $\gamma_L$, the sum $\sum \gamma_L(X)$ may be expanded as the sum of three terms, $T_1+T_2+T_3$, and compared term by term with \eqn{eqn:A2neg}:
$$
T_i' \ge T_i + c_i r^2.
$$
This proceeds exactly as in the proof of Theorem~\ref{theorem:mk1}.
\end{proof}

\begin{corollary}\guid{RDWKARC}\rating{ZZ}\label{cor:CE} If the Kepler Conjecture is false,
there exists a finite packing $\Lambda$ with $\orz\in\Lambda$, such
that
\begin{equation}\label{eqn:CE}
\sum_{\lambda\in\Lambda \mid h(\orz,\lambda)\le h_0} L(h(\orz,\lambda)) > 12.
\end{equation}
\end{corollary}

\begin{proof} If the Kepler conjecture is false, inequality~\eqn{eqn:L12} is violated for some packing $\Lambda$ and some $\lambda_0\in\Lambda$.  After the replacement of $\Lambda$ with $\Lambda - \lambda_0$ and $\lambda_0$ with $\orz$, it follows without loss of generality that $\lambda_0=\orz\in\Lambda$.  After the replacement of $\Lambda$ with the finite subset
$$
\{\lambda\in\Lambda\mid h(\orz,\lambda)\le h_0\},
$$
it follows without loss of generality that the packing is finite.
\end{proof}


Turn to the proof of Lemma~\ref{lemma:cluster}.   Let $Z$ be a cell cluster and let $e$ be the  critical edge shared by the cells in the cluster.   Call this critical edge the {\it spine}.  Consider all the faces along the spine $\{\lambda_0,\lambda_1\}$, consisting of three vertices $\{\lambda_0,\lambda_1,\lambda_2\}$ with circumradius less than $\sqrt2$.  Call such faces {\it blades}.  (There is no relationship between the blades here and those of Chapter~\ref{sec:fan}.)
\indy{Index}{edge!spine}%
\indy{Index}{edge!critical}%
\indy{Index}{blade}%

Consecutive cells around the spine are {\it adjacent}.
A cell adjacent to a $4$-cell is a $3$-cell or another $4$-cell.  A cell adjacent to a $2$-cell is a $3$-cell.  There are no $0$ or $1$-cells along a critical edge.
\indy{Index}{adjacent}%
\indy{Index}{quarter}%

Call a $4$-cell a {\it quarter}, when it has exactly one critical edge and all other edges of the simplex have length at most $2 h_-$.  The weight of any quarter is $1$.





\subsection{two blades}

The proof will be divided into cases, according to the number of blades along the critical edge.

\claim{It
suffices to prove Lemma~\ref{lemma:cluster}
when the cluster contains at least one quarter and at least two blades.} Indeed,
by calculations~\cite[GLFVCVK]{hales:2009:nonlinear}, if $X$ is any cell, then % gammaL is nonneg on quarters. cc:qtr
$$
 \gamma_L(X) \op{wt}(X) + \beta(e,X)\ge 0
$$ 
when $X$ is not a quarter.  This is the desired inequality.  Also, a quarter is flanked by two blades.

Consider a cluster with exactly two blades.
Without loss of generality, the two blades flank a quarter
$X$. 
The azimuth angle of what remains outside the quarter
is greater than $\pi$.  Thus, there must be a $3$-cell
along each blade.  Let $Y$ be one of these $3$-cells.
The cell $Y$ has weight $1$.
Then 
\begin{equation}\label{eqn:34}
\Gamma(Z)\ge \gamma_L(X)+\gamma_L(Y)\ge 0,
\end{equation}
by a calculation~\cite[FHBVYXZ]{hales:2009:nonlinear}. % 2-blade calculation, gammaL(fourcell)+gammaL(threecell) >=0. % cc:2bl:
\indy{Index}{azimuth}%
\indy{Index}{angle!azimuth}%




\subsection{five or more blades}

The nonlinear inequalities for five or more blades along a spine are found at~\cite[ZTGIJCF]{hales:2009:nonlinear}.   % cc:5bl:
Let $B$ be the set of cells in the cluster that lie between any two consecutive blades.  $B$ is either a singleton set containing a $4$-cell, or a set of three cells: a $2$-cell and two adjacent $3$-cells.  Write $\op{azim}(B)$ for the azimuth angle formed by the two blades.   The cells between two consecutive blades satisfy an inequality:
$$
\sum_{X\in B} \gamma_L(X)\op{wt}(X) + \beta(e,X) \ge a + b\,\op{azim}(B),
$$
where
$$
a= 0.0560305, \quad\text{and}\quad  b= -0.0445813.
$$
It follows that
$$
\Gamma(Z) \ge 5 a + b\, (2\pi) > 0.
$$

\subsection{three or four blades}\label{sec:3or4}

In the case of three and four blades, the proof relies to an even greater extent on computer calculations.  The statement of Lemma~\ref{lemma:cluster} is a nonlinear inequality.   The inequality asserts that some continuous function $f$ is positive on a compact domain $D$ in Euclidean space.  Rigorous methods of global nonlinear optimization can be used to show that the function $f$ is indeed positive.  

Details about global nonlinear optimization appear in the appendix.   The method is linear relaxation, which can be briefly described as follows.\footnote{Linear relaxations appear again later in the solution of significantly more difficult nonlinear optimzation problems.}  The domain $D$ is partitioned into finitely many subsets $D_1,\ldots, D_r$.   The positivity of $f$ is
established on each subset $D_i$.    The graph $\{(f(x), x)\mid x\in D_i\}$ 
of $f$ on $D_i$ is a subset of a polyhedron $P_i$.  The inequalities defining the polyhedron can be determined explicitly.    A linear program computes the minimum of the first coordinate over $P_i$.  This
minimum is positive.  Since the graph is contained in $P_i$, the values of $f$ on $D_i$ must also be
positive.

This strategy has been implemented and gives the desired lower bound.  
The linear programming has been implemented as a  
{\tt MathProg} model.\footnote{{\tt MathProg} implements a subset of the {\it AMPL} modeling language.  The computer code giving the model appears in {\tt shorts.mod} and the computer code controlling the branching appears in {\tt shorts.ml}.}  This model contains a the number of blades, variables representing the edges and the azimuth angles between consecutive blades.

The proof that each graph is contained in a explicit polyhedron $P_i$ relies on nonlinear inequalities.
In fact, the proof requires over one hundred nonlinear inequalities that have been established by computer.    

A function on the set $D$ with finite range partitions $D$ into finitely many subsets, according to the image of a point.   Several simple boolean functions and functions with finite range were used to partition
 $D$ into subsets $D_i$: Are there three blades or four?  Is there a $2$-cell in the cluster?  Is the $4$-cell a quarter?   Is the    azimuth angle  of a given cell greater than $2.3$?  Is the value of $\gamma_L$ on a given quarter  negative? Does a particular blade have a nonspline edge of length greater than $2h_-$?  What is the weight of a given $4$-cell?  The inequalities that define the polyhedra $P_i$ have been designed specifically for the subdomains $D_i$, according to the answers to these questions.

These linear relaxations and are sufficient to prove the bound in all but one case.  This is the case of four blades, three quarters, and one $4$-cell that has two critical edges: the spine and the edge opposite the spine.  The other four edges of the $4$-cell have length at most $2h_-$.  In this case as well, the inequality is established by linear relaxation, but things are more involved.  

The method to prove this case by computer is as follows.  Number the four simplices $j=1,2,3,4$, with $j=1$ representing the $4$-cell of weight $1/2$.  Write $\gamma^j$ in abbreviation of $\gamma_L(X)\op{wt}(X) + \beta(e,X)$.   The desired inequality is
\begin{equation}\label{eqn:gpos}
\sum_{j=1}^4 \gamma^j > 0.
\end{equation}
The domain is a set of ordered four-tuples of simplices $X_1,\ldots,X_4$ that fit together into an octahedron (the dihedral angles along the spine sum to $2\pi$, the four simplices all have the same spline length $y_1(X_j)$, and the shared edges are the same length for the two simplices sharing the edge).
Instead of the single inequality asserted by Lemma~\ref{lemma:cluster},  many inequalities of the following form are established:
\begin{equation}\label{eqn:gpart}
\gamma^j + a_i \dih^j + b_i^j y_1 + c_i^j (y_2+y_3+y_5+y_6) + d_i^j > 0, 
\end{equation}
for all $X \in I_i^j$, \quad $i \in I$, and  $j\in \{1,2,3,4\}$.  Here, $\gamma^j$, $\dih^j$, and $y_i$ are
all functions of $X$.
The simplex $X$ has spine of length $y_1$ and other edges with lengths $y_k$.  Also,  $\dih^j$ is the dihedral angle of $X$ along the spine.
$I$ is a finite indexing set.  Each domain $I_i^j$ is a product of intervals in $\ring{R}^6$, under the parameterization of a simplex by the lengths of its six edges.  The union over $i$ of the sets
$$
\{(X_1,\ldots,X_4)\mid~ X_j \in I_i^j,\text{ for } j=1,2,3,4.\}
$$
covers the entire domain of the desired inequality~\eqn{eqn:gpos}.   

\claim{A subset of this union already covers the domain.}  Indeed, the dihedral angles of the four simplices along the spine sum to $2\pi$:
$$
\sum_{j=1}^4 \gamma^j = 2\pi.
$$
Furthermore, the spine lengths of the simplices must agree: $y_1(X_j) = y_1(X_k)$ for all $j,k\in\{1,2,3,4\}$.
Finally, each blade flanks two different simplices; the edge lengths of the blade must agree.  This gives
a collection of inequalities of the form $y_i(X_j) = y_{i'}(X_{j'})$.  These are the subset relations.

The coefficients of the inequalities~\eqn{eqn:gpart}
are chosen so that for each $i$, the following inequality holds:
\begin{equation}\label{eqn:glin}
0 > a_i 2\pi + \sum_{j=1}^4 (b_i^j y_1 +  c_i^j (y_2(X_j)+y_3(X_j)+y_5(X_j)+y_6(X_j)) + d_i^j).
\end{equation}
(Notice that this inequality is linear in the variables $y_k(X_j)$ and the domain is a product of intervals.  Hence this inequality is particularly easy to check.)
The sum of the inequality~\eqn{eqn:gpart} over $j$, the inequality~\ref{eqn:glin}, and the subset relation yield the desired inequality~\ref{eqn:gpos}.

A four-bladed cluster is an octahedron.  The set of octahedra is a $13$-dimensional object, parameterized by $12$ external edges and one diagonal (the spine).   By contrast, a simpliex in $\ring{R}^3$ is only a $6$-dimensional object, parameterized by $6$ edges.
The four-bladed cluster inequality is an inequality in $13$-dimensions.
The preceding arguments reduce the $13$-dimensional inequality into a series of $6$-dimensional inequalities.   The $6$-dimensional inequalities are within within the reach of  a computer.

The only question is how the magical coefficients $a_i,b_i^j,c_i^j,d_i^j$ are obtained.  Clearly, the inequalities~\eqn{eqn:glin} and \eqn{eqn:gpart} are linear in these coefficients.  Thus, a they can be found by linear programming.   It is somewhat troubling that there are infinitely many constraints, as each point $X_j$ in the domain gives one constraint.  In practice, the infinite number of constraints can be replaced by a finite collection.  Some information is lost in approximating the system with a finite number of constraints.  However, the coefficients, once they are guessed by approximations, can be checked independently by computer.  (An exact fit it not necessary; any coefficients that work will do.)  
It was necessary to partition the domain into smaller pieces to produce coefficients that work.  In other words, the indexing set $I$ contains more than one element.   After some experimentation, we found a set $I$ of cardinality $23$ that works.
Through these methods, coefficients were found.


\section{Counting spheres}

\begin{lemma}\guid{TARJJUW}\rating{ZZ}\label{lemma:poly-bounded} 
Fix $r$ and $r'$ such that $2\le r\le r'$.
Define a set $\Lam\subset\ring{R}^3$ to be weakly saturated if for every $\mu\in\ring{R}^3$
$$
\normo{\mu}> r'; \quad\text{ or there exists } \lam\in\Lam\setminus\{\orz\}.~\norm{\lam}{\mu}< r.
$$
Let $\Lambda$ be a weakly saturated finite packing such that $\orz\in \Lam$.
%where 
%   $\orz\in\Lam$, and
%   $\normo{\lam}\le r'$ for all $\lam\in\Lam$,
Set $\Lam^*=\Lam\setminus\{\orz\}$.
%Suppose the packing is weakly saturated in the sense that there does not exist $\mu\not\in\Lambda$ such that $\Lam'=\Lam\cup\{\mu\}$ satisfies these same properties
%and the additional property
% $$
%
 %$$
For any $g:\Lam^*\to\ring{R}$, let $P(\Lam,g)$ be the
polyhedron given by the intersection of half-spaces
$$
\{\p \mid \lam\cdot \p \le g(\lam)\}.
$$
Then $P(\Lam,g)$ is bounded.
\end{lemma}
\indy{Index}{polyhedron}%

\begin{proof}  Otherwise $P=P(\Lam,g)$ is unbounded, and there exists $\p\in P$ such that
$\normo{\p} > g(\lam) r'/2$ for all $\lam\in\Lam^*$.  Let $\mu =  r' \p/\normo{\p}$ so that $r'=\normo{\mu}$.  By the weak saturation of $\Lam$, there exists $\lam\in\Lam^*$ such that $\norm{\mu}{\lam}<r$.    Then,
$$
\begin{array}{lll}
\normo{\p} &> g(\lam) r'/2 \ge \lam\cdot (r' \p)/2 = \normo{\p} \lam\cdot \mu /2\\
  &= \normo{\p} (\normo{\lam}^2 + \normo{\mu}^2 - \norm{\lam}{\mu}^2)/4\\
  &> \normo{\p}(4+r'^2-r^2)/4\\
  &\ge \normo{\p}.
\end{array}
$$
This contradiction shows that $P$ is bounded.
\end{proof}




Since $L(h)\le 1$ when $h\ge1$, it is clear that a counerexample in the sense of Corollary~\ref{cor:CE} has more than $12$ nonzero terms.  The following variant of a lemma of Marchal gives an upper bound on the number of nonzero terms.


\begin{lemma}\guid{DLWCHEM}\rating{300}\label{lemma:13-14}  
If the Kepler conjecture is false, there exists a packing $\Lambda$ with $\orz\in\Lambda$, containing either $13$ or $14$ nonzero points for which inequality~\ref{eqn:CE} holds.
\end{lemma}


\begin{proof} If $\Lambda$ contains at most $12$ nonzero points then
the inequality~\ref{eqn:CE} cannot hold, because $L\le 1$.

Consider a finite packing $\Lambda=\{\orz,\lambda_1,\ldots,\lambda_N\}$ satisfying inequality~\ref{eqn:CE}.   Without loss of generality, by adding points as necessary, the packing becomes weakly saturated in the sense of Lemma~\ref{lemma:poly-bounded}, with $r=2$ and $r'=2\hm$.  Set $h_i = \normo{\lambda_i}/2$.  Then $h_i\le h_0=1.26$.  Set
$$
g(h) = \arccos(h/2) - \pi/6.
$$
On the unit sphere,  consider the disks $D_i$ of radii $g(h_i)$, centered at $\lambda_i/\normo{\lambda_i}$.  These disks do not overlap; this follows from the easy inequality~\cite[]{hales:2009:nonlinear} %% Marchal disks are disjoint.  % cc:disks
$$
g(h_i) + g(h_j) \le \op{arc}(2h_i,2h_j,2).
$$
\indy{Notation}{D@$D$ (spherical disks)}%
For each $i$, plane through the circular boundary of $D_i$ bounds a half-space containing the origin.  The intersection of these half-spaces is a polyhedron $P$.  The polyhedron is bounded by Lemma~\ref{lemma:poly-bounded}.   Lemma~\ref{lemma:polyhedron} associates a fan $(V_P,E_P)$ with $P$.    (The set $V_P$ is dual to $\Lam^*$; the set $V_P$ is in bijection with vertices of $P$, whereas $\Lam^*$ is in bijection with the faces of $P$.)  There are natural bijections between the following sets:
\begin{itemize}
\item $\Lam^* = \{\lam_1,\ldots,\lam_N\}$.
\item The  facets of $P$.
\item The set of  topological components of $Y(V_P,E_P)$.
\item The set of faces in the hypermaps $\op{hyp}(V_P,E_P)$.
\end{itemize}
The bijection of the first two sets follows from the first conclusion of Lemma~\ref{lemma:webster}.
Lemmas~\ref{WF} and ~\ref{lemma:facet-big} give the other two bijections bijection.

Let $k_i$ be the cadinality of the face in $\op{hyp}(V_P,E_P)$ corresponding to the facet $i$.   The solid angle of the topological component $W_i$ of $Y(V_P,E_P)$ is 
at least the area $\op{reg}(g(h_i),k_i)$ of the smallest $k_i$-gon containing $D_i$.  The smallest spherical $k$-gon containing a disk of radius $a$ has area at least (Lemma~\ref{lemma:ngon}, \ref{lemma:ngon-area})
\indy{Index}{half-plane}%
\indy{Index}{half-space}%
\indy{Notation}{reg (area of regular spherical polygon)}%
$$
\op{reg}(a,k) = 2\pi - 2 k (\arcsin(\cos(a)\sin(\pi/k))).
$$
One can verify directly that~\cite[]{hales:2009:nonlinear} %% Linear lower bound on regular polygon. % cc:alin
$$
\op{reg}(g(h),k) \ge c_0 + c_1 k + c_2 L(h),\quad
k = 3,4,\ldots,\quad 1\le h\le \hm,
$$
where
$$c_0 = 0.6327,\quad c_1 = -0.0333,\quad c_2 = 0.4754.$$
The sum $\sum_i k_i$ is the number of darts in $\op{hyp}(V_P,E_P)$ (Lemma~\ref{lemma:polyhedron}).  By the Lemma~\ref{lemma:dart-upper}, 
$\sum_i k_i \le (6N-12)$.
Summing over $i$,  an estimate on $N$ follows:
\indy{Index}{polyhedron!convex}%
\indy{Index}{hypermap!planar}%
$$
\begin{array}{lll}
4\pi &= \sum_i\op{sol}(W_i)\\
     &\ge \sum_i \op{reg}(g(h_i),k_i) \\
     &\ge c_0 N +c_1\sum_i k_i + c_2 \sum L(h_i)\\
     &\ge c_0 N +c_1 (6N-12) + c_2 12\\
\end{array}
$$
This gives
$$
14.93 \ge N.
$$
\end{proof} 


\begin{lemma}\guid{XULJEPR}\label{300}\label{lemma:D'}  
Let $\Lam$ be a finite packing containing the origin.
Assume that there exists $\lambda_1$ such that $\normo{\lambda_1}=2$ and
$\norm{\lambda_1}{\lambda}\ge 2\hm$ for all $\orz\ne\lambda\in\Lambda$,
Then  inequality~(\ref{eqn:CE}) does not hold on $\Lam$.
\end{lemma}

\begin{proof}  Assume for a contradiction that a packing exists that satisfies the assumptions and the inequality.  Without loss of generality, assume that $N\ge 13$, since the inequality is known to hold when $N\le 12$.   Create one large disk $D_1'$ centered at $\lambda_1/2$ and repeat the proof of the previous lemma.  By Lemma~\ref{lemma:poly-bounded} (with $r=r'=2\hm$), the polyhedron is bounded.  By the assumptions of the lemma, take 
$$a'=\arc(2,2,2\hm)-g(\hm) \approx 0.797$$
for the arcradius of this disk.  One can verify the following nonlinear inequality directly~\cite[]{hales:2009:nonlinear} %% Linear lower bound on regular polygon (large disk) % cc:alin2
$$\op{reg}(a',k) \ge c_0 + c_1 k + c_2 L(1) + c_3$$
where $c_3 = 0.85$.
Then 
$$
\begin{array}{lll}
4\pi &= \sum_i\op{sol}(W_i)\\
     &\ge \op{reg}(a',k_1)+\sum_{i>1} \op{reg}(g(h_i),k_i) \\
     &\ge  c_0 N +c_1\sum_i k + c_2 \sum L(h_i) + c_3\\
     &\ge c_0 N +c_1 (6N-12) + c_2 12 + c_3\\
\end{array}
$$
This gives a contradiction:
$$
12.97 \ge N \ge 13.
$$
\end{proof}
