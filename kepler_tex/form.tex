% file started March 22, 2009




\chapter{Formulation}

\section{Statement}



\begin{theorem}\guid{IJEKNGA}[Sphere Packing Problem (Kepler Conjecture)]
\label{theorem:kepler}   No packing of congruent balls in
Euclidean three space has density greater than that of the
face-centered cubic packing.
\end{theorem}

\begin{remark}
This density is $\pi/\sqrt{18}\approx 0.74.$  There are other
packings, such as the hexagonal close packing, that attain this
same density.
\end{remark}

The proof of this result is presented in this book. This section
describes the top-level outline of the proof and gives references to
the sources of the details of the proof.

A {\it packing} means an arrangement of congruent balls that
are nonoverlapping in the sense that the interiors of the balls are
pairwise disjoint. Consider a 
\indy{Index}{packing} packing of congruent
balls in Euclidean three space. There is no harm in assuming that
all the balls have unit radius. 

The density of a packing does not
decrease when balls are added to the packing. Thus, to answer a
question about the greatest possible density, one may add
nonoverlapping balls until there is no room to add further balls.
Such a packing will be said to be {\it saturated}.

 \indy{Index}{packing!saturated}

Let $\Lambda$ be the set of centers of the balls in a
packing. Our choice of radius for the
balls implies that any two points in $\Lambda$ have distance at
least $2$ from each other. Call the points of $\Lambda$ {\it
 vertices}.
\indy{Index}{vertex}

%A bijection
%$\varph:\ring{N}\to\Lambda$ is called an {\it enumerated\/}
%packing.

%\begin{lemma}\guid{DQLSGKR} A saturated packing $\Lambda$ is countably infinite.  Hence,
%there exists a bijection $\varphi:\ring{N}\to\Lambda$.
%\end{lemma}

%\begin{proof}  If $\Lambda$ is finite, there is room to add a ball
%far from the finite cluster $\Lambda$, so $\Lambda$ is not
%saturated.

%The map $\Lambda\to\ring{Z}^3$, $$(x,y,z)\mapsto (\lfloor 2x
%\rfloor, \lfloor 2y \rfloor, \lfloor 2z \rfloor)$$ is a one-one
%map from $\Lambda$ into a countable set.  Hence $\Lambda$ is
%countable.
%\end{proof}


  Let $B(p,r)$ denote the open ball in
Euclidean three space at center $p$ and radius $r$.  The open ball
is measurable, with measure $4\pi r^3/3$.
\indy{Index}{measure}
\indy{Notation}{openball@$B(p,r)$}


Let $\delta(\Lambda,p,r)$ be the finite density, defined as the
ratio of the volume of $B(\Lambda,p,r)$ to the volume of $B(p,r)$,
where $B(\Lambda,p,r)$ is defined as the intersection with
$B(p,r)$ of the union of all balls in the packing. Set
$\Lambda(p,r) = \Lambda \cap
B(p,r)$ and $\Lambda^*(p,r) = \Lambda(p,r)\setminus \{p\}$.
\indy{Notation}{ZZdelta@$\delta(\Lambda,p,r)$}
\indy{Notation}{ZZLamda@$\Lambda$ (packing)}
\indy{Notation}{ZZLamda@$\Lambda^*$(packing)}

\begin{lemma}\guid{KIUMVTC}
\oldrating{80}
\formalauthor{Nguyen Tat Thang}
\rating{0}
\label{lemma:Lambda-finite}
Let $\Lambda$ be a packing and let $p\in\ring{R}^3$.
Then the set $\Lambda(p,r)$ is finite.
\end{lemma}

\begin{proof}  Let $p = (p_x,p_y,p_z)$. The map
$$v=(v_x,v_y,v_z)\mapsto (\lfloor 2(v_x-p_x)
\rfloor, \lfloor 2(v_y-p_y) \rfloor, \lfloor 2(v_z-p_z) \rfloor)$$
is a one-one map from $\Lambda(p,r)$ into the set $\ring{Z}^3\cap B(0,2
r
 + 1)$.  By Lemma~\ref{lemma:Zcount}, this gives a one-to-one map
 into a finite set, hence $\Lambda(p,r)$ is finite.
\end{proof}


\begin{definition}[Voronoi~cell,~$\Omega$]\label{def:voronoi}
\indy{Index}{Voronoi cell} Voronoi cell
$\Omega(v)=\Omega(\Lambda,v)$
\indy{Notation}{ZZZomega@$\Omega$ (Voronoi cell)} around a
vertex $v\in \Lambda$ is the set of points at least as close to $v$ as to
any other ball center. 
% Let $\Omega_t(\Lambda,v) = \Omega(\Lambda,v)
%\cap B(v,t)$ be the truncated Voronoi cell at radius $t$.
\end{definition}

\begin{lemma}\guid{DRUQUFE}
\formalauthor{Nguyen Tat Thang}
\oldrating{80} 
\rating{0}
Let $\Lambda$ be a saturated packing.
Each Voronoi cell $\Omega(\Lambda,v)$, for $v\in\Lambda$, is
compact, convex, and measurable.
\end{lemma}

\begin{proof}  This is elementary.
\end{proof}

\begin{definition}[negligible]\label{def:negligible}
Let $A:\Lambda\to\R$ be a function.  Say that $A$
is {\it negligible\/}
\indy{Index}{negligible}
if there is a constant $C_1$ such that for all $r\ge1$ and all
$p\in\ring{R}^3$,
   $$\sum_{v\in\Lambda(p,r)} A(v) \le C_1 r^2.$$
Say that the function $A:\Lambda\to\R$ is
  {\it fcc-compatible\/}
\indy{Index}{fcc-compatible}
if for all $v\in\Lambda$, 
$$\sqrt{32}\le \op{vol}(\Omega(v)) + A(v).$$
\end{definition}





\begin{remark}
The value $\op{vol}(\Omega(v)) + A(v)$ may be interpreted as a
{\it corrected\/} volume\indy{Index}{corrected volume} of the Voronoi
cell. Fcc-compatibility asserts that the corrected volume of the
Voronoi cell is always at least the volume of the Voronoi cells in
the face-centered cubic and hexagonal-close packings.
\end{remark}

%\begin{remark} In \cite{Hales:2006:DCG}, the full Voronoi cell $\Omega(v)$
%is used, rather than $\Omega(v)$.  The truncation at radius $2$
%is just a matter of convenience to guarantee the boundedness
%and hence the finite volume of the (truncated) Voronoi cell.
%In \cite{Hales:2006:DCG}, the same effect was achieved by requiring all packing%s
%to be saturated.  Drop the assumption of saturation
%on $\Lambda$.
%\end{remark}


\begin{lemma}\guid{JGXZYGW}
\oldrating{150}
\formalauthor{Nguyen Tat Thang}
\rating{0}
\label{lemma:deltabound} If there exists a \indy{Index}{negligible}
negligible \indy{Index}{fcc-compatible} fcc-compatible function
$A:\Lambda\to\R$ for a 
%saturated 
packing $\Lambda$, then there
exists a constant $C$ such that for all $r\ge1$ and all
$p\in\ring{R}^3$,
    $$
    \delta(\Lambda,p,r)
    \le \pi/\sqrt{18} + C/r.
    $$
The constant $C$ depends on $\Lambda$ only through the constant
$C_1$ of Definition~\ref{def:negligible}.
\end{lemma}



\begin{proof}
The numerator $\op{vol}\, B(\Lambda,p,r)$ of $\delta(\Lambda,p,r)$
is at most the product of the volume of a ball $4\pi/3$ with the
number $\card(\Lambda(p,r+1))$ of balls intersecting $B(p,r)$.  Hence
    \begin{equation}
    \op{vol}\, B(\Lambda,p,r) \le \card(\Lambda(p,r+1)) 4\pi/3.
    \label{eqn:Abound}
    \end{equation}

%In a %saturated packing 
Each truncated Voronoi cell is contained in a ball of
radius $2$ centered at the {\it center} of the cell.  The volume
of the ball $B(p,r+3)$ is at least the combined volume of 
truncated Voronoi
cells whose center lies in the ball $B(p,r+1)$. This observation,
combined with fcc-compatibility and negligibility, gives
    \begin{equation}
    \begin{split}
    \sqrt{32}\card(\Lambda(p,r+1))
    &\le \sum_{v\in\Lambda(p,r+1)} (A(v) +
    \op{vol}(\Omega(v))) \\
    &\le C_1 (r+1)^2 + \op{vol}\,B(p,r+3) \\
    &\le C_1 (r+1)^2 + (1+3/r)^3 \op{vol}\,B(p,r)
    \label{eqn:Bbound}
    \end{split}.
    \end{equation}
\indy{Index}{fcc-compatible}
Recall that $\delta(\Lambda,p,r)=
\op{vol}\,B(\Lambda,p,r)/\op{vol}\,B(p,r)$. Divide Inequality
\ref{eqn:Abound} through by $\op{vol}\,B(p,r)$.  Use
Inequality~\ref{eqn:Bbound} to eliminate $\card(\Lambda(p,r+1))$ from the
resulting inequality.  This gives
    $$\delta(\Lambda,p,r)
        \le \frac{\pi}{\sqrt{18}} (1+3/r)^3 + C_1 \frac{(r+1)^2}{r^3\sqrt{32}}.
    $$
The result follows for an appropriately chosen constant $C$.
\end{proof}

\begin{remark} \label{remark:precise}
Take the precise meaning of the packing problem to be the
bound $\delta(\Lambda,p,r) \le \pi/\sqrt{18} + C/r$ of the lemma.
Thus, the solution to the packing problem follows, provided a negligible
fcc-compatible function can be found. The strategy will be to
define a negligible function, and then to solve an optimization
problem in finitely many variables to establish that it is
fcc-compatible.
\end{remark}

An ordered pair $(\Lambda,v)$ with $v\in\Lambda$ is called a {\it centered packing}.
\indy{Index}{packing!centered}


\section{Rogers's partition}\label{sec:rogers}

\begin{definition}[saturated packing]
A packing $\Lam\subset \ring{R}^3$ is a set such that
$$\forall \lam~\mu\in \Lam.~  \norm{\lam}{\mu} < 2 \Rightarrow (\lam=\mu).$$
The packing is saturated if for every $x\in\ring{R}^3$,   there exists $\lam\in\Lam$
such that $\norm{\lam}{x}\le 2$.
\end{definition}
\indy{Index}{packing!saturated}

%Think of $\Lam$ as the set of centers of a  packing of congruent balls of radius $1$. To be saturated means that there is no room for further balls to be added to the packing. There is no loss in generality in assuming that the packing is saturated, when searching for the greatest possible density of a packing.

Given a packing $\Lam$, Rogers gives a partition of Euclidean space into
simplices with vertices at $\Lam$ \cite{Rogers:1958:Packing}.   This section describes his partition.

Let $\Omega(\lam)$  be the Voronoi cell centered at $\lam$:
$$
  \Omega(\lam) = \{p \mid  \norm{p}{\lam} 
\le \norm{p}{\mu},\ \lam\ne\mu\in\Lam\}.
$$
If $S\subset\Lam$ (or if $S$ is a tuple of elements of $\Lam$), 
let $\Omega(S)$ be the intersection of the family:
$$\Omega(S)  = \bigcap \{\Omega(\lam)\mid \lam\in S \}.$$
Call $\Omega(S)$ the $S$-face of $\Omega(\lam)$, when $\lambda\in S$.

For $X\subset\ring{R}^3$,  let $\dimaff(X)$ be the dimension of the affine hull
of $X$.

If $\bl=(\lam_0,\ldots,\lam_k)$ and $j\le k$ write $\bl[j] = (\lam_0,\ldots,\lam_j)$.
Let $\Lam(k)$ be the set of $k+1$-tuples $\bl=(\lam_0,\ldots,\lam_k)$, with
$\lambda_i\in\Lambda$ such
that 
\begin{equation}\label{eqn:omega-dim}
\dimaff(\Omega(\bl[j])) = 3-j,
\end{equation}
for all $0<j\le k$.
In particular, $\Lam(0)=\Lam$.  Also, $\Lam(1)$ is the
set of all pairs $(\lam,\mu)$ such that the Voronoi cells at $\lam$ and $\mu$ meet along
a face of codimension $1$, and
so forth.


Define $v:\Lam(k)\to \ring{R}^3$ by recursion over $k$ as follows.
Set $$v(\lam[0]) = \lam[0]$$
and $v(\lam[j+1])$ is the closest point on $\Omega(\lam[j+1])$ to $v(\lam[j])$.  The point is defined whenever $\Omega(\lam[j+1])$ is nonempty.
The set $\Omega(\lam[j+1])$ is convex and compact.  Thus, the point $v(\lam[j+1])$ exists
uniquely.

For $\bl\in\Lam(k)$, let 
$$R(j,\bl) = \op{conv}\{v(\lam[j]), v(\lam[j+1]),\ldots,v(\lam[k])\}.$$  Set $R(\bl)=R(0,\bl)$.


\begin{lemma}\guid{GLTVHUM}\rating{200}
For any saturated packing $\Lambda$, 
$$\ring{R}^3 = \bigcup \{ R(\bl) \mid \bl\in \Lam(3)\}.$$
\end{lemma}

\begin{proof}
There is a partition $$\ring{R}^3 = \bigcup \{\Omega(\lam)\mid \lam\in \Lam(0)\}.$$
So it is enough to show that
$$\Omega(\bl[0]) = \bigcup \{ R(\bl') \mid \bl'\in \Lam(3),~\bl[0]=\bl'[0]\}.$$
The relative boundary of the bounded polyhedron $\Omega(\bl[0])$ is the union of its facets, by Lemma~\ref{lemma:webster}.  This gives the decomposition
$$\Omega(\bl[0]) = \bigcup \op{conv}(v(\bl[0]),\{\Omega(\bl[1])\mid \bl[1]\in \Lam(1)\}).$$
So it is enough to show that
$$\Omega(\bl[1]) = \bigcup \{ R(1,\bl') \mid \bl'[1]=\bl[1],~\bl'\in \Lam(3)\}.$$
Repeating, it is enough to show that
$$\Omega(\bl[3]) = \bigcup\{R(3,\bl')\mid\bl'[3]=\bl[3],~\bl'\in\Lambda(3)\}.$$
The right-hand side is the singleton $\{v(\bl[3])\}$.  The left-hand side
contains this point and is contained in a properly decreasing chain of affine spaces:
$\ring{R}^3$, the bisector of $\lam_0$ and $\lam_1$, and so forth.  This determines a point,
so the two sides are equal.
\end{proof}

\begin{lemma}\guid{DUUNHOR}\rating{140}  
The intersection of any two distinct $R(\bl)$ and $R(\bm)$ is contained in a plane (hence has measure zero).
\end{lemma}

This result and the previous lemma show that the simplices $R(\bl)$ partition Euclidean
space.

\begin{proof}  Let $\bl = (\lambda_0,\ldots)$ and $\mu = (\mu_0,\ldots)$.
If $\lambda_0\ne\mu_0$, the intersection of the simplices lies in $\Omega(\lam_0,\mu_0)$
and the lemma follows.  Let $k+1$ the first index such that
$$\op{conv}(v(\lam_0),\ldots,v(\lam_0,\ldots,\lam_{k+1}))\ne
\op{conv}(v(\mu_0),\ldots,v(\mu_0,\ldots,\mu_{k+1})).
$$
By induction $\Omega(\lam_0,\ldots,\lam_k) = \Omega(\mu_0,\ldots,\mu_k)$
but
$$\Omega(\lam_0,\ldots,\lam_{k+1}) \ne \Omega(\mu_0,\ldots,\mu_{k+1}).$$
The intersection lies in the convex hull $C$ of
$\{v(\lam_0),\ldots,v(\lam_0,\ldots,\lam_k)\}$ and
$V=\Omega(\lam_0,\ldots,\lam_{k+1},\mu_{k+1})$.  The set $V$ lies in an affine space of 
codimension $k+2$
and $C$ has codimension $(k+2) - (k+1) = 1$.
\end{proof}

\begin{definition}[h]
%Let $h(\bl[i]) = \norm{v(\bl[i])}{\lam_0}$.  
If $\bl=(\lam_0,\lam_0,\ldots,\lam_k)\in\Lam(k)$, 
let $h(\bl[j])$ be the circumradius of $\{\lam_0,\ldots,\lam_j\}$, for $j\le k$.
\end{definition}

\begin{lemma}\guid{XNHPWAB}\rating{500}\label{lemma:v2} Let $\bl=(\lam_0,\ldots,\lam_3)\in\Lambda(3)$ and fix $0\le j\le 3$.  Assume that $h(\bl[j])<\sqrt2$.
%$$
%\norm{v(\bl[j]) }{ \lam_0} < \sqrt2.
%$$
Then $v(\bl[j])$ is the circumcenter of the set $S_j =\{\lam_0,\ldots,\lam_j\}$ and lies in the convex hull of $S_j$.  The points $v(\bl[j])$, for $j=0,1,2,3$, are distinct.
\end{lemma}
\indy{Index}{hull!convex}

\begin{proof} The three different claims of the lemma will be proved by separate arguments.

\indy{Index}{circumcenter}
{\bf (circumcenter)} By definition, an element $\bl\in\Lambda(3)$ gives dimensions: 
$$\dimaff\Omega(\lam_0,\ldots,\lam_j) = 3-j.$$  The case $j=0$ of the lemma is trivially
satisfied.  Assume by induction the result holds for numbers less than $j$.

Now $j>0$.
The circumcenter $p=p_{j}$ of the set $S_{j}$ is the point on the plane $\op{aff}(\Omega(S_{j}))$
closest to $p_{j-1}=v(\bl[j-1])$.  Claim:  $p$ lies in $\Omega(S_{j})$.  Otherwise
there is a point $\mu\in\Lambda\setminus S_j$ satisfying
\begin{equation}\label{eqn:closest}
\norm{\mu}{p}\le \norm{\lambda}{p}, \quad\text{for all } \lam\in S_j.
\end{equation}
The angles $\arc_V(p,\{\mu,\lam_i\})$ are obtuse for $i\le j$ because
$$
\norm{p}{\mu} < \sqrt2,\quad \norm{p}{\lambda_i} <\sqrt2,\quad \norm{\mu}{\lambda_i} \ge 2.
$$ 
A case-by-case argument follows, for each $j$.

If $j=1$, the points $p,\lam_0,\lam_1$ are collinear and cannot give two obtuse angles.

If $j=2$, let $\mu'$ be the projection of $\mu$ to the plane containing
$p,\lam_0,\lam_1,\lam_2$. The four points $\mu',\lam_0,\lam_1,\lam_2$ can be arranged
cyclically around $p$, each forming an obtuse angle with the next.  A circle around $p$
cannot give four obtuse angles.


If $j=3$, assume that $\lam_0,\ldots,\lam_3$ are labeled in cyclic order around the line
$\op{aff}\{p,\mu\}$.  Consider the dihedral angle 
  $$
  \gamma=\gamma_i=\dih(\{p,\mu\},\{\lam_i,\lam_{i+1}\}).
  $$
The sphere of radius $1$ centered at $p$ meets each ray
$\op{aff}^+(p,\{v\})$ in a point, giving a spherical triangle with sides $a,b,c$.  By the spherical law of cosines, the angle $\gamma$ of the spherical triangle is given in terms of the edges as
$$
  \cos c - \cos a \cos b = \sin a \sin b \cos \gamma.
$$
All the terms on the left-hand side are negative, so $\gamma =\gamma_i > \pi/2$.
This is impossible, as the sum of the four dihedral angles $\gamma_i$ is $2\pi$.
This completes the proof that $v(\bl[j])$ is the circumcenter.

\indy{Index}{hull!convex}
{\bf (convex hull)}  Next, it will be shown that this point lies in the convex hull of $S_j$.
%If $j=0$, there is nothing to show.  If $j=1$, the point is the midpoint of the convex hull.
%If $j=2$, the point is the circumcenter of an acute triangle.  If $j=3$, the point is the
%circumcenter of a simplex such that every face has positive orientation.  Thus,
%in every case the point lies in the convex hull.
Suppose to the contrary that $p=p_j$ does not lie in the convex hull. Then there is $i<j$ such that $\op{aff}(S')$, with $S'=S_j\setminus\{i\}$ separates $p$ from $\lam_i$.  Let $p'$ be the circumcenter of $S'$, and let $\mu=\lam_i$.  Then for $k\ne i$ and $0\le k\le j$, it follows that
$$
\begin{array}{lll}
\norm{\lam_k}{p'} &= (\norm{\lam_k}{p}^2 - \norm{p}{p'}^2)^{1/2} \\
  &\ge \norm{\lam_k}{p} - \norm{p}{p'} \\
  &=\norm{\mu}{p} - \norm{p}{p'}\\
  &=\norm{\mu}{p'}.
\end{array}
$$
This is contrary to inequality~\ref{eqn:closest}.


{\bf (distinct)}  The distances $\norm{v(\bl[j])}{v(\bl[0])}$ are increasing, so it is enough to show
that $v(\bl[j])\ne v(\bl[j+1])$.  If  equality holds, then the circumcenter $v(\bl[j])$
would have an equally close packing point $\lambda_{j+1}\in\Lambda$, which is impossible by inequality~\ref{eqn:closest}.
\end{proof}


%The concept of {\it positive orientation} is used in the proof.  This is discussed in the 1998 proof and in {\it Lemmas in Geometry}.  If a face has circumradius less than $\sqrt2$ it has positive orientation.  If every face has positive orientation, then the circumcenter of the simplex is contained in its convex hull.



By the lemma, if $h(\bl[j])<\sqrt2$, then the numbers $h(\bl[i])$ are increasing in $i$, for $i\le j$.


\begin{lemma}\guid{YIFVQDV}\rating{140}   
Let $\bl\in\Lambda(k)$.  Assume that $h(\bl)<\sqrt2$. Let $\bm$ be any permutation of the components of $\bl$.  
Then $\bm\in\Lambda(k)$, $\norm{v(\bm)}{\mu_0}<\sqrt2$, and  $v(\bl) = v(\bm)$.
\end{lemma}

\begin{proof} 
Since the sets $\Omega(\bl[j])$ satisfy (\ref{eqn:omega-dim}), it follows that
$\Omega(\bl)\cap \op{conv}\{\lam_0,\ldots,\lam_k\}$ is a point consisting of the singleton $\{v(\bl)\}$, which is the
circumcenter of the simplex with vertices $\{\lam_0,\ldots,\lam_k\}$.  This describes
the point $v(\bl)$ in a way that is independent of the permutation.

The condition (\ref{eqn:omega-dim}) can be shown to hold for the permutation $\mu$.
The proof of Lemma~\ref{lemma:v2} shows that the midpoint of $\op{conv}(\mu_0,\mu_1)$
lies in $\Omega(\bm[1])$ and since the inequalities are strict, some neighborhood
of this midpoint in the bisecting plane of $\{\mu_0,\mu_1\}$ lies in $\Omega(\bm[1])$.
Thus, $\dimaff(\Omega(\bm[1]))=2$.  Continue in this fashion, showing that each dimension
$\dimaff(\Omega(\bm[j]))$ drops by exactly one.
\end{proof}

\begin{lemma}\guid{WQPRRDY}\rating{400}\label{lemma:Rconv} Let $\bl = (\lam_0,\ldots,\lam_k)\in\Lambda(k)$.  Assume that $h(\bl)<\sqrt2$.
For any permutation $\pi$, let $\pi(\bl)\in\Lam(k)$ be the permuted entry.  Let
$S(k+1)$ be the group of all permutations on $k+1$ letters.   Then
$$
\op{conv}\{\lam_0,\ldots,\lam_k\} = \bigcup \{ R(\pi(\bl)) : \pi\in S(k+1)\}.
$$
\end{lemma}

\begin{proof} Let $L = \{\lam_0,\ldots,\lam_k\}$.  The proof is by induction on $k$.
When $k=0$, the result is trivial.  Now assume $k>0$.

The circumcenter $v(\bl)$ of $L$ lies in the convex hull of these
point (see the proof of Lemma~\ref{lemma:v2}).  Thus, the left-hand side is the union
of the cones over the (k+1)-faces:
$$
\op{conv}(S) = \bigcup\{ \op{conv}(v(\bl),L\setminus \{\lam_i\}\mid i=0,\ldots,k) \}.
$$
The sets $L\setminus \{\lam_i\}$ can be identified with  cosets of $S(k+1) /S(k)$.
By induction $L\setminus \{\lam_i\}$ is the union of $R(\bm)$ as $\bm$ runs
over all permutations $S(k)$ of $L\setminus \{\lam_i\}$.
The result follows by induction.
\end{proof}

The Rogers's simplices $R(\bl)$ are compatible with the Voronoi
decomposition of space (by construction).  Also, by Lemma~\ref{lemma:Rconv}, under
mild restrictions on the circumradius, they can also be reassembled into simplices
with vertices at the centers of the packing (the Delaunay simplices).
\indy{Index}{simplice!Delaunay}
\indy{Index}{simplice!Rogers}
\indy{Index}{decomposition!Voronoi}  

\section{Marchal's partition}

C. Marchal has introduced a new approach to the Kepler conjecture that is manifestly superior to the one in~\cite{Hales:2006:DCG}.  The definition of $k$-cells, Conjecture~\ref{conj:m1}, Theorem~\ref{theorem:mk1}, and the method of Lemma~\ref{lemma:13-14} are all due to him.
\indy{Index}{Marchal!C.}

His articles claim to give
a {\it demonstration} of the Kepler conjecture \cite{marchal:2007}, \cite{marchal:2008}.  However, the
mathematically rigorous part of the article only gives a reduction
of the problem to a difficult optimization problem in a finite number of
variables.  The method of gradient descent is then used to explore
the local minima of the optimization problem in finitely many variables.

Marchal's partition of space is a variant of Rogers's partition into simplices
$R(\bl)$.  The main part of construction is 
the decomposition obtained by truncating the Voronoi cells
by a ball of radius $\sqrt2$.  In a few carefully chosen situations he assembles the simplices
into a larger convex hull along the lines of Lemma~\ref{lemma:Rconv}.



\begin{definition} Consider $\bl=(\lam_0,\ldots,\lam_3)\in \Lambda(3)$.
\hfill\break\smallskip  
{\bf The $0$-cell} of $\bl$ is
$$
\cell(\bl,0) = \{x\in R(\bl) \mid \norm{v(\lam_0)}{x} > \sqrt2\}.
$$
\bigskip
{\bf The $1$-cell} of $\bl$ is 
$$
\cell(\bl,1) = \op{conv}(v(\lam_0),T_1),\hbox{ where } T_1 = \{x \in R(\bl) \mid \norm{v(\lam_0)}{x}= \sqrt2\}.
$$
\bigskip
{\bf The $2$-cell} of $\bl$ is
$$
\begin{array}{rll}
\cell(\bl,2) &= \op{conv}(\lambda_0,\lambda_1,T_2),\quad \\
  T_2 &= \{x \in R(\bl)\cap \Omega(\bl[1]) \mid \norm{\lam_0}{x}=\norm{\lam_1}{x} =\sqrt2\}.
\end{array}
$$
\bigskip
{\bf The $3$-cell} of $\bl$ is defined to be empty unless 
$$
h(\bl[2]) <\sqrt2 \le h(\bl[3]).
$$
When this inequality holds,
there is a a unique point $p(\bl[2])$ in
$\op{conv}(v(\bl[2]),v(\bl[3]))$ at distance exactly $\sqrt2$ from $\lam_0$.  
Define the $3$ cell to be
$$
\cell(\bl,3) = \op{conv}\{\lam_0,\lam_1,\lam_2,p(\bl[2])\}.
$$
\bigskip
{\bf The $4$-cell} of $\bl$ is defined to be empty unless
$$
h(\bl[3]) <\sqrt2.
$$
When this inequality holds, define the $4$ cell to be
$$
\cell(\bl,4) = \op{conv}\{\lam_0,\lam_1,\lam_2,\lam_3\}.
$$
\end{definition}

Note the the $0$ and $1$-cells are always subsets of $R$.  However, the $2$, $3$, and
$4$-cells combine other Rogers simplices.

\begin{lemma}\guid{RVFXXBU}\rating{400}  The $0,\ldots,4$-cells of all Rogers simplices $R(\bl)$, for $\bl\in \Lam(3)$
give a partition of $\ring{R}^3$.  An $i$-cell is never equal to a $j$-cell when $i\ne j$. For $k\ge 2$, 
two $k$-cells $\cell(\bl,k)=\cell(\bm,k)$ are equal exactly when $\bl[k-1]$
is a permutation of $\bm[k-1]$.
\end{lemma}

\begin{proof}  First, the proof will establish that cells are either disjoint (up to a null set) or equal.  At the same time, it determines when two $k$-cells are equal to one another. By Lemma~\ref{lemma:Rconv}, the $4$-cell $\cell(\bl,4)$ is a union of the Rogers simplices $R(\bm)$, as $\bm$ runs over permutations of $\bl$.   Two $4$-cells that meet in a set of positive measure are equal.  Every $4$-cell is a union of simplices $R(\bl)$ with $h(\bl)<\sqrt2$.  This condition gives $\cell(\bl,i)=\emptyset$, for $i=0,1,2,3$.

Similarly, the $3$-cell is a union
of the convex hulls $\op{conv}(p(\bm[2]),R(\bm[2]))$ as $\bm[2]$ runs over permutations of $\bl[2]$.  Note that the point $p(\bm[2])=p(\bl[2])$ is independent of the permutation, since
it is determined as the point at distance $\sqrt2$ from $\lam_0$ along the line through
from $v(\bm[2])=v(\bl[2])$ perpendicular to the plane $\op{aff}\{\lam_0,\lam_1,\lam_2\}$
(in the half-space of $\bl[3]$). Two $3$-cells that meet in a set of positive measure are equal and come from parameters that are permutations of  one another as described.   The intersection $\cell(\bl,3)$ cannot meet $\cell(\bl,i)$, for $i<3$, in a set of full dimension, because the plane $P(\bl[2])=\op{aff}\{\lam_0,\lam_1,p\}$ separates them.

The $2$-cell $\cell(\bl,2)$ is separated from the $0$ and $1$-cells $\cell(\bl,i)$
by the cone $P(\bl[1])$ with apex $\lam_0$
passing through $T_2$. The $1$-cell is separated from $0$-cells the the sphere $P(\bl[0])$
of radius
$\sqrt2$, centered at $\lam_0$.

Finally,  every point $x$ in $\ring{R}^3$ belongs to a cell.  In fact, by the Rogers
partition, the point $x$ belongs to a Rogers simplex $R(\bl)$.  If $h(\bl)<\sqrt2$, then
$x$ belongs to a $4$-cell.  Otherwise $x\in R(\bl)$ belongs to $\cell(\bl,i)$ according to
which side of the plane $P(\bl[2])$, cone $P(\bl[1])$, and sphere $P(\bl[0])$ the point
lies, as described above.
\end{proof}


\section{Negligeability}

This section shows how Conjecture~\ref{conj:m1} would follow from an explicit estimate
related to the Gregory-Newton problem


Define the following constants and functions.  The first constant
is the area of a spherical triangle with sides $\pi/3$.
$$
\begin{array}{lll}
\Delta_0 &= 3\arccos(1/3)-\pi\\
\tau_0 &= 4\pi - 20\Delta_0\\
m_1 &= \Delta_0 2\sqrt2/\tau_0 = 1.012\ldots \\ %% K 
m_2  &= (6\Delta_0- \pi)\sqrt2/(6 \tau_0) = 0.0254\ldots\\ %% M 
h_+ &= 1.3254 \hbox{~(exact rational value)}
\end{array}
$$
Let $M:\ring{R}\to\ring{R}$ 
be the following piecewise polynomial function (Figure~\ref{fig:M}):
$$
M(h) =
\begin{cases}
% (\sqrt2-h) (h-1.3254) (9h^2 - 17 h + 3)/(1.627 (\sqrt2-1))& h\le\sqrt2\\
\frac{\sqrt2-h}{\sqrt2-2}~ \frac{h_+-h}{h_+-1} ~\frac{17 h - 9 h^2 - 3}{5} & h \le \sqrt2. \\
 0 & h >\sqrt2.
\end{cases}
\\
$$
\begin{figure}[htb]
  \centering
  \szincludegraphics[width=60mm]{\pdfp/Mfun.eps}
% Plot[Mfun[h], {h, 1, Sqrt[2]}]
% copied to Preview, then saved, then converted to eps via pdf2eps.
  \caption{The quartic polynomial $M$.}
  \label{fig:M}
\end{figure}

It follows from the definitions that
\begin{equation}\label{eqn:km}m_1 - 12m_2 = \sqrt{1/2}\end{equation}
and
\begin{equation}M(1) = 1,\quad M(h_+)=0,\quad M(\sqrt2) =0.\end{equation}


\begin{conjecture}[Marchal]\rating{600}\label{conj:m1} For any packing $\Lam$, and
any $\lam_0\in\Lam$, 
$$
\sum_{(\lam_0,\lam_1)\in\Lam(1)} M(h(\lam_0,\lam_1)) \le 12.
$$
\end{conjecture}

Marchal's conjecture is still open.  This book proves a variant of Marchal's conjecture.

\begin{theorem}\guid{KIZHLTL}\rating{300}\label{theorem:mk1}
Conjecture~\ref{conj:m1} implies the Kepler conjecture.
\end{theorem}

\begin{note}%XX
This book contains a number of nonlinear inequalities that have been established by interval-arithmetic calculations by computer.  The approach to the proof of the Kepler conjecture described here is still work in progress.  Some of these interval arithmetic calculations are still in the process of being verified.  A current description of the inequalities and their status can be found at~\cite{hales:2009:nonlinear}.
\end{note}

\begin{proof} 
It is enough to show that $A(\lam_0)  = -\op{vol}(\Omega(\lam_0)) + 8 m_1 - \sum 8 m_2 M(h(\bl))$ is fcc-compatible and negligeable.  The
result then follows from Lemma~\ref{lemma:deltabound}.  
This is fcc-compatible directly
by equation~(\ref{eqn:km})
and Conjecture~\ref{conj:m1}:
\indy{Index}{negligeable}
\indy{Index}{fcc-compatible}
$$
\begin{array}{lll}
\sqrt{32} &= 8 m_1 - 8\cdot 12 m_2\\
  &\le 8 m_1 - 8 m_2 \sum M(h)
  &= \op{vol}(\Omega(\lam_0)) + A(\lam_0).
\end{array}
$$  
The issue is to prove it negligeable.  Explicitly, one needs
to show there exists a constant  $C$ such that for all $r\ge 1$ and all $x\in\ring{R}^3$:
\begin{equation}\label{eqn:neg}
  -\sum A(\lam) = \sum \op{vol}(\Omega(\lam)) -\sum 8m_1 + \sum \sum 8 m_2 M(h) \ge C r^2,
\end{equation}
where the outer sum runs over $\lam\in \Lam(x,r)$.

Lemmas~\ref{lemma:Zr2} and \ref{lemma:Lambda-finite}  show that the number of points of $\Lambda$ near the boundary of $B(p,r)$ is bounded by $C r^2$.

Let $V(X)$ be the set of extremal vertices of the $k$-cell $X$ in $\Lambda$.  Explicitly, $V(X)=\emptyset$ if $k=0$; and $V(X) = \{\lambda_0,\ldots,\lam_{k-1}\}$ in general.  Each $k$-cell is measurable and eventually
radial at each $\lam\in V(X)$.  Define the total solid angle of $X$ to be
$$
\op{tsol}(X) = \sum_{\lambda\in V(X)} \sol(X,\lambda).
$$
\indy{Index}{angle!total solid}
\indy{Notation}{tsol@$\op{tsol$}

Let $E(X)$ be the set of extremal edges of the $k$-cell $X$ in $\Lambda$.  Explicitly, let 
$$E(X)=\{\{\lam_i,\lam_j\}\mid \lam_i\ne\lam_j\in V(X)\}.$$
In particular, the set is empty for $0$ and $1$-cells, and contains
$\tbinom{k}{2}$ pairs when $k\ge 2$.


The value
$\dih(X,e)$ of
of the basic dihedral angle indexed by $e\in E(X)$ is defined to be the dihedral angle along that edge
of the boundary.  
The (single) basic  dihedral angle of a $2$-cell is
the same as the radian angle subtended by the arc $T_2$ in the construction of $2$-cells.
The basic dihedral angles of a $3$ or $4$-cell are the dihedral angles along the given edge of the simplex $X$. 
\index{Notation}{dih@$\dih$}
\index{Index}{angle!dihedral}
Each element $e=\{\lam_i,\lam_j\}\in E(X)$ also determines
the real number $h(e) = \norm{\lam_i}{\lam_j}/2$.

For any function $f:\ring{R}\to\ring{R}$ and any cell $X$, set
\begin{equation}\label{eqn:gamma-def}
\gamma(X,f) =  \op{vol}(X)
-\left(\frac{2m_1}{\pi}\right) \op{tsol}(X) + \left(\frac{8m_2}{\pi}\right)
\sum_{e\in E(X)} \dih(X,e)  f(h(e))
\end{equation}
Marchal's fundamental estimate\cite[cc:mar]{hales:2009:nonlinear} holds for any cell $X$:  %% cc:mar are the k-cell estimates for non-supercells.
\begin{equation}\label{eqn:mfe}
\gamma(X,M)\ge 0.
\end{equation}
(Note that this is an inequality in at most six variables; the most difficult case to prove is that of a $4$-cell.)  The volumes and solid angles and so forth are given by the explicit formulas.

Sum the inequality~(\ref{eqn:mfe}) over all cells in a large ball $B(x,r)$ to get an
inequality of the form $T_1 + T_2 + T_3\ge 0$ for three terms $T_i = T_i(r)$ of (\ref{eqn:gamma-def}).  Compare this term-by-term
with the three terms $T'_i(r)$ of the desired equation~(\ref{eqn:neg}). 
It is enough to show that
$$
T_i'(r) \ge T_i(r) + C_i r^2,
$$
for some constants $C_i$.

Begin with the volume terms $T_1$, $T_1'$.  The sum of the volumes of the Voronoi cells $\lam\in B(p,r)$ is the volume of $B(p,r)$, up to a boundary term coming from Voronoi cells that are only partly contained in $B(p,r)$.  Similarly, the sum of the various $k$-cells, for $X\subset B(p,r)$ is the volume of $B(p,r)$, again up to a boundary term. The boundary effects have order $r^2$. Thus,
$$
T_1'= \sum_{\lam\in \Lam(p,r)} \op{vol}(\Omega(\lam)) \ge \sum_{X\subset B(p,r)} \op{vol}(X) + C_1 r^2 = T_1 + C_1 r^2.
$$
The estimates on the other terms are similar.  The solid angles
around each vertex sum to $4\pi$.
In Landau big O notation, this gives
$$
\begin{array}{lll}
\sum_{X\subset B(p,r)} \op{tsol}(X) &= 
\sum_{X\subset B(p,r)} \sum_{\lam\in V(X)} \sol(X,\lam)\\
 &=\sum_{\lam\in \Lam(p,r)} \sum_{X\mid \lam\in V(X)} \sol(X,\lam) + O(r^2)\\
 &=\sum_{\lam\in \Lam(p,r)} 4\pi    + O(r^2),
\end{array}
$$
hence
$$
T_2' = -\sum_{\Lam(p,r)} 8 m_1 = -\sum_{X\subset B(p,r)}\left(\frac{2m_1}\pi\right) \op{tsol(X)} + C_2 r^2 = T_2 + C_2 r^2.
$$
Similarly, the dihedral angles around each edge sum to $2\pi$.  There is a factor of $2$ that enters when switching from unordered pairs $\{\lam_0,\lam_1\}$ to ordered pairs $(\lam_0,\lam_1)$:
$$
\begin{array}{lll}
&\sum_{X\subset B(p,r)} \sum_{e\in E(X)} \dih(X,e)  M(h(e)) \\
&\qquad=\sum_{e\subset B(p,r)} \sum_{X: e\in E(X)} \dih(X,e)  M(h(e)) +O(r^2)\\
 &\qquad=\sum_{e\subset B(p,r)} 2\pi M(h(e)) + O(r^2) \\
 &\qquad=\sum_{\lam_0\in \Lam(p,r)} \sum_{\lam_1\in \Lam(p,r) } \pi M(h(\lam_0,\lam_1)) + O(r^2),\\
\end{array}
$$
and 
$$
T_3' = \sum\sum 8 m_2 M(h(\bl)) \ge \left(\frac{8m_2}\pi\right)
\sum_{X\subset B(p,r)}\sum_{e\in E(X)}\dih(X,e) M(h(e)) + C_3 r^2 = T_3 + C_3 r^2.
$$
\end{proof}




\section{Supercells}

This section shows how to improve on the estimates of the previous section
by combining various cells into {\it supercells}.
Recall $M(h_+) = 0$, where   $h_+ = 1.3254$.
\indy{Index}{supercell}

\begin{definition}
Set
$$
  h_0 = 1.26\\  %%\hm
$$
Let $L:\ring{R}\to\ring{R}$ be the piecewise linear function 
$$
L(h) = \begin{cases}
\frac{h_0-h}{h_0-1} & h \le h_0 \\
0 & h\ge h_0 \\
\end{cases}
$$
It follows from the definition that
$$
L(1) = 1\quad L(\hm) = 0.
$$
Let $h_- = 1.23175\ldots$ be the unique root of the quartic polynomial
$M(h)-L(h)$ lying in the interval $[1.2,1.3]$.
\end{definition}

%%
\begin{figure}[htb]
  \centering
  \szincludegraphics[width=60mm]{\pdfp/Lfun.eps}
% Plot[{Mfun[h],Lfun[h]}, {h, 1.2, 1.35}]
% copied to Preview, then saved, then converted to eps via pdf2eps.
%% WW very big .eps file!
  \caption{Detail of the quartic $M$ and linear function $L$.}
  \label{fig:L}
\end{figure}

The inequality $L(h)\ge M(h)$ holds except when $h\in [h_-,h_+]$.  The aim of this section is to prove a variant of Theorem~\ref{theorem:mk1} that uses the function $L$ rather than $M$.  For this, one needs to combine cells into larger groups, called supercells.

\begin{definition}
Let $X$ be a $k$-cell, with $k\ge 2$.  Let $e\in E(X)$.
An edge is {\it critical} if $h(e)\in[h_-,h_+]$.
Let $E_c(X)\subset E(X)$ be the set of critical edges of $X$.  If $X$ is any cell such that $E_c(X)$ is nonempty, let the weight $w(X)$ of $X$  
be $1/\op{card}(E_c(X))$.
\end{definition}
\indy{Index}{critical!edge}

\begin{definition}[$\beta$]  Set 
$$
\op{bump}(h) = 0.005 (1 - (h-h_0)^2/(h_+-h_0)^2).
$$
If $X$ is a $4$-cell with exactly two critical edges, then set
$$
\beta(e,X) = \op{bump}(h(e)) - \op{bump}(h(e')),
$$
if $\{e,e'\} = E_c(X)$.  Otherwise, set $\beta(e,X) = 0$.
\end{definition}
\indy{Notation}{bump@$\op{bump}$}
\indy{Notation}{beta@$\beta$ (bump)}

\begin{definition}[supercell,~$\Gamma$,~$\gamma_L$]
Let $e\in E_c(X)$ be a critical edge of a $k$-cell for some $k\ge 1$.
A supercell is the set 
$$
\op{super}(e) = \{X\mid e\in E(X)\} 
$$
of all cells around $e$. 
If $Z$ is a finite set of cells, define
$$
\begin{array}{lll}
\Gamma(Z) &= \sum_{X\in Z} \gamma_L(X) w(X) +\beta(e,X),\quad\hbox{ where }\\
\gamma_L(X) &= \gamma(X,L),
\end{array}
$$
and where $w(X)$ is the weight of $X$.

\end{definition}
\indy{Index}{supercell}

\begin{theorem}\guid{OXLZLEZ}[supercell estimate]\rating{1500}\label{lemma:superineq} 
Let $Z$ be any supercell.  Then $\Gamma(Z)\ge 0$.
\end{theorem}

The proof of this theorem will occupy the rest of the section.  Before the proof, consider its relation to the Kepler conjecture.


\begin{conjecture}\label{conj:L12} For any packing $\Lam$, and
any $\lam_0\in\Lam$, 
\begin{equation}\label{eqn:L12}
%\sum_{\bl=(\lam_0,\lam_1)\in\Lam(1)} L(h(\bl)) \le 12.
\sum_{\lam_1\in\Lam\mid h(\lam_0,\lam_1)\le \hm} L(h(\lam_0,\lam_1)) \le 12.
\end{equation}
\end{conjecture}


%\begin{conjecture} \label{conj:L12} 
%For any packing $\Lam$, and
%any $\lam_0\in\Lam$, 
%\begin{equation}\label{eqn:L12}
%\sum_{\lam_1\in\Lam\mid h(\lam_0,\lam_1)\le \hm} L(h(\lam_0,\lam_1)) \le 12,
%\end{equation}
%\end{conjecture}

%\begin{corollary}\guid{ECAMUNU}\rating{0} 
%Conjecture~\ref{conj:L12} implies the Kepler conjecture.
%\end{corollary}

\begin{theorem}\guid{UPFZBZM}\rating{300}\label{theorem:mk2}
Conjecture~\ref{conj:L12} implies the Kepler conjecture.
\end{theorem}

\begin{proof}  The proof imitates the proof of Theorem~\ref{theorem:mk1}.
It is enough to show that $A_L(\lam_0)  = -\op{vol}(\Omega(\lam_0)) + 8 m_1 - \sum 8 m_2 L(h(\bl))$ is fcc-compatible and negligeable. 
This is fcc-compatible directly
by equation~(\ref{eqn:km})
and Conjecture~\ref{conj:L12}.  The issue is to prove it negligeable.  Explicitly, one needs
to show there exists a constant  $C$ such that or all $r\ge 1$ and all $x\in\ring{R}^3$:
\begin{equation}\label{eqn:A2neg}
  \sum \op{vol}(\Omega(\lam)) -\sum 8m_1 + \sum \sum 8 m_2 L(h) \ge C r^2,
\end{equation}

For cells $X$ that do not belong to a supercell,
the proof is just as in the proof of Theorem~\ref{theorem:mk1}.
If $E_c(X)=\emptyset$, then 
$L(h(e))\ge M(h(e))$ for each edge $e\in E(X)$, and
$$\gamma_L(X)\ge \gamma(X,M)\ge 0$$ 
by inequality (\ref{eqn:mfe}).

Note that the function $\beta(e,X)$ averages to zero for any $4$-cell $X$:
$$
\sum_{e\in E_c(X)} \beta(e,X) = 0.
$$
Hence the terms involving $\beta$ in sums may be safely ignored.

Theorem~\ref{lemma:superineq} gives the required inequaity for supercells.
Again, using big O notation, 
$$
\begin{array}{lll}
\sum_{X\subset B(p,r)} \gamma_L(X) &= 
\sum_{X\subset B(p,r)\mid E_c(X)\ne\emptyset} \gamma_L(X) +
\sum_{X\subset B(p,r)\mid E_c(X)=\emptyset} \gamma_L(X) \\
&\ge \sum_{X\subset B(p,r)\mid E_c(X)\ne\emptyset} \gamma_L(X) \\
&=\sum_{X\subset B(p,r)}\gamma_L(X)\sum_{e \in E_c(X)}w(X) + O(r^2)\\
&=\sum_{e\subset B(p,r)}\sum_{X\mid e \in E_c(X)}\gamma_L(X)w(X) + O(r^2)\\
&=\sum_{e\subset B(p,r)}\Gamma(\op{super}(e)) + O(r^2)\\
&\ge O(r^2).
\end{array}
$$

From the definition of $\gamma_L$, the sum $\sum \gamma_L(X)$ may be expanded as the sum of three terms $T_1+T_2+T_3$, and compared term by term with (\ref{eqn:A2neg}):
$$
T_i' \ge T_i + C_i r^2.
$$
This proceeds exactly as in the proof of Theorem~\ref{theorem:mk1}.
\end{proof}

\begin{corollary}\label{cor:CE} If the Kepler conjecture is false,
there exists a finite packing $\Lambda$ with $0\in\Lambda$, such
that
\begin{equation}\label{eqn:CE}
\sum_{\lambda\in\Lambda \mid h(0,\lambda)\le h_0} L(h(0,\lambda)) > 12.
\end{equation}
\end{corollary}

\begin{proof} If the Kepler conjecture is false, inequality (\ref{eqn:L12}) is violated for some packing $\Lambda$ and some $\lambda_0\in\Lambda$.  After the replacement of $\Lambda$ with $\Lambda - \lambda_0$ and $\lambda_0$ with $0$, it follows without loss of generality that $\lambda_0=0\in\Lambda$.  After the replacement of $\Lambda$ with the finite subset
$$
\{\lambda\in\Lambda\mid h(0,\lambda)\le h_0\},
$$
it follows without loss of generality that the packing is finite.
\end{proof}


Turn to the proof of Theorem~\ref{lemma:superineq}. Fix one critical edge and consider the supercell of all cells around it.  Call this critical edge the {\it spine}.  Consider all the faces along the spine $\{\lambda_0,\lambda_1\}$, consisting of three vertices $\{\lambda_0,\lambda_1,\lambda_2\}$ with circumradius less than $\sqrt2$.  Call such faces {\it blades}.  The proof will be divided into cases, according to the number of blades along the critical edge.
\indy{Index}{edge!spine}
\indy{Index}{edge!critical}

Call a $4$-cell a {\it quarter}, when it has exactly one critical edge and all other edges of the simplex have length at most $2 h_-$. By calculations~\cite[cc:qtr:GLFVCVK]{hales:2009:nonlinear}, if $X$ is any cell, then % gammaL is nonneg on quarters.
$$
 \gamma_L(X) w(X) + \beta(e,X)\ge 0,
$$ 
when $X$ is not a quarter.  Thus, it
suffices to prove the theorem
when there is at least one quarter along the critical
edge.  The weight of any quarter is $1$.
Adjacent to a $4$-cell along a blade is always a $3$-cell or another $4$-cell. Adjacent to a $2$-cell is a $3$-cell.  There are no $0$ or $1$-cells along a critical edge.

\indy{Index}{quarter}

\subsection{two blades}

The assumption of a quarter gives at least two blades.  Consider
the case of exactly two blades.
Without loss of generality, the two blades are edges of a quarter
$X$. 
The azimuth angle of what remains outside the quarter
is greater than $\pi$.  Thus, there must be a $3$-cell
along each blade.  Let $Y$ be one of these $3$-cells.
It has weight $1$.
Then 
\begin{equation}\label{eqn:34}
\Gamma(Z)\ge \gamma_L(X)+\gamma_L(Y)\ge 0,
\end{equation}
by a calculation~\cite[cc:2bl:FHBVYXZ]{hales:2009:nonlinear}. % 2-blade calculation, gammaL(fourcell)+gammaL(threecell) >=0.
\indy{Index}{azimuth}
\indy{Index}{angle!azimuth}




\subsection{five or more blades}

The nonlinear inequalities for five or more blades along a spine are found at~\cite[cc:5bl:ZTGIJCF]{hales:2009:nonlinear}.   Let $B$ be the set of cells between two blades.  $B$ is either a singleton set containing a $4$-cell, or a set of three cells: a $2$-cell and two flanking $3$-cells.  Write $\op{azim}(B)$ for the azimuth angle formed by the two blades.   The cells between two consecutive blades satisfy an inequality:
$$
\sum_{X\in B} \gamma_L(X)w(X) + \beta(e,X) \ge a + b\,\op{azim}(B),
\quad a= 0.0560305, \quad b= -0.0445813.
$$
It follows that
$$
\Gamma(Z) \ge 5 a + b\, (2\pi) > 0.
$$

\subsection{three or four blades}

In the case of three and four blades, the proof relies to an even greater extent on computer calculations.
The proof uses over one hundred nonlinear inequalities that have been established by computer.  An {\tt MathProg} model\footnote{{\tt MathProg} implements a subset of the {\it AMPL} modeling language.  The computer code giving the model appears in {\tt shorts.mod} and the computer code controlling the branching appears in {\tt shorts.ml}.} describes the $p$-blades, the edges and azimuth angles between consecutive blades.  Various branches are followed according to whether between two consecutive blades there is a $4$-cell or a $2$-cell with two flanking $3$-cells.   Various other branches are considered: a $4$-cell may or may not be a quarter.  The azimuth angle may or may not be greater than $2.3$.  The value of $\gamma_L$ on a quarter may or may not be negative.  A blade may or may not have a nonspline edge of length greater than $2h_-$.  The weight of a $4$-cell breaks into various cases.   Various nonlinear inequalities have been designed specifically for these various case branches.  In each case, there is a linear program that results, following the methods of linear relaxation described in \cite{Hales:2006:DCG}.  

These linear relaxations and are sufficient to prove the bound in all but one case.  This is the case of four blades, three quarters, and one $4$-cell that has two critical edges: the spine and the edge opposite the spine.  The other four edges of the $4$-cell have length at most $2h_-$.  In this case as well, the inequality is established by branching and linear relaxation, but in this case things are more involved.  

The method to prove this case by computer is as follows.  Number the four simplices $j=1,2,3,4$, with $j=1$ representing the $4$-cell of weight $1/2$.  Let $\gamma^j$ abbreviate $\gamma_L(X)w(X) + \beta(e,X)$.   The desired inequality is
\begin{equation}\label{eqn:gpos}
\sum_{j=1}^4 \gamma^j > 0.
\end{equation}
The domain is ordered four-tuples of simplices $X_1,\ldots,X_4$ that fit together into an octahedron (the dihedral angles alongthe spine sum to $2\pi$, the four simplices all have the same spline length $y_1(X_j)$, and the shared edges are the same length for the two simplices sharing the edge).
Instead of this single inequality,  a collection of inequalities of the following form are established:
\begin{equation}\label{eqn:gpart}
\gamma^j + a_i \dih^j + b_i^j y_1 + c_i^j (y_2+y_3+y_5+y_6) + d_i^j > 0, \text{ for all } X \in D_i^j, \text{ and } i \in I. 
\end{equation}
The simplex $X$ has spine of length $y_1$ and other edges $y_k$.  Also, $\dih^j$ is the dihedral angle of $X$ along the spine.
$I$ is a finite indexing set.  Each domain $D_i^j$ is a product of intervals in $\ring{R}^6$.  The union 
$$
\{(X_1,\ldots,X_4)\mid \exists i.~ X_j \in D_i^j,\text{ for } j=1,2,3,4.\}
$$
covers the entire domain of the desired inequality~(\ref{eqn:gpos}).  The coefficients of the inequalities~(\ref{eqn:gpart})
are chosen so that for each $i$, the following inequality holds:
\begin{equation}\label{eqn:glin}
0 > a_i 2\pi + \sum_{j=1}^4 (b_i^j y_1 +  c_i^j (y_2(X_j)+y_3(X_j)+y_5(X_j)+y_6(X_j)) + d_i^j).
\end{equation}
(Notice that this inequality is linear in the variables $y_k(X_j)$ and the domain is a product of intervals.  Hence this inequality is particularly easy to check.)
Then, the sum of the inequality~(\ref{eqn:gpart}) over $j$ and combined with inequality~\ref{eqn:glin} yields the desired inequality~\ref{eqn:gpos}.

Once the high-dimensional problem has been replaced by inequalities over individual simplices in this way, the problem becomes six-dimensional (for the six edges of a simplex) and the verification is within the reach of  a computer.

The only question is how the magical coefficients $a_i,b_i^j,c_i^j,d_i^j$ are obtained.  Clearly, the inequalities~(\ref{eqn:glin}) and (\ref{eqn:gpart}) are linear in these coefficients.  Thus, a they can be found by linear programming.  (In fact, there are infinitely many constraints, as each point $X_j$ in the domain gives a constraint.  In practice, the infinite number of constraints can be replaced by a finite collection.  The coefficients, once they are guessed in this manner, can be checked independently by computer.)  Through these methods, coefficients were found for a partition $I$ of the domain into $23$ pieces.

\section{Counting spheres}

\begin{lemma}\label{lemma:poly-bounded} 
Fix $2\le r\le R$.
Let $\Lambda$ be a finite packing where 
\begin{itemize}
  \item $\Lam$ is a finite packing, 
  \item $0\in\Lam$,
  \item $\normo{\lam}\le R$ for all $\lam\in\Lam$,
\end{itemize}
Let $\Lam^*=\Lam\setminus\{0\}$.
Suppose the packing is weakly maximal in the sense that there does not exist $\mu\not\in\Lambda$ such that $\Lam'=\Lam\cup\{\mu\}$ satisfies these same properties
and the additional property
 $$
\norm{\lam}{\mu}\ge r \text{ for all } \lam\in\Lam^*
 $$
For any $c:\Lam^*\to\ring{R}$, let $P(\Lam,c)$ be the
polyhedron given by the intersection of half-spaces
$$
\{x \mid \lam\cdot x \le c(\lam)\}.
$$
Then $P(\Lam,c)$ is bounded.
\end{lemma}
\indy{Index}{polyhedron}

\begin{proof}  If $P=P(\Lam,c)$ is unbounded, pick $p\in P$ such that
$\normo{p} > c(\lam) R/2$ for all $\lam\in\Lam^*$.  Let $\mu =  R p/\normo{p}$ so that $R=\normo{\mu}$.  By weak maximality, there exists $\lam\in\Lam^*$ such that $\norm{\mu}{\lam}<r$.    Then,
$$
\begin{array}{lll}
\normo{p} &> c(\lam) R/2 \ge \lam\cdot (R p)/2 = \normo{p} \lam\cdot \mu /2\\
  &= \normo{p} (\normo{\lam}^2 + \normo{\mu}^2 - \norm{\lam}{\mu}^2)/4\\
  &> \normo{p}(4+R^2-r^2)/4\\
  &\ge \normo{p}.
\end{array}
$$
This contradiction shows that $P$ is bounded.
\end{proof}




Since $L(h)\le 1$, for $h\ge1$, it is clear that the conjectured inequality holds whenever the number of summands is at most $12$. The following is a variant of a lemma of Marchal.


\begin{lemma}\guid{DLWCHEM}\rating{300}\label{lemma:13-14}  
If the Kepler conjecture is false, there exists a packing $\Lambda$ with $0\in\Lambda$, containing either $13$ or $14$ nonzero points for which inequality~\ref{eqn:CE} holds.
\end{lemma}


\begin{proof} If $\Lambda$ contains at most $12$ nonzero points then
the inequality~\ref{eqn:CE} cannot hold, because $L\le 1$.

Consider a finite packing $\Lambda=\{0,\lambda_1,\ldots,\lambda_N\}$ satisfying inequality~\ref{eqn:CE}.   Without loss of generality, assume that it is saturated in the sense of Lemma~\ref{lemma:poly-bounded}, with $r=2$ and $R=2\hm$.  Set $h_i = \normo{\lambda_i}/2$.  Then $h_i\le h_0=1.26$.  Set
$$
a(h) = \arccos(h/2) - \pi/6.
$$
On the unit sphere,  consider the disks $D_i$ of radii $a(h_i)$, centered at $\lambda_i/\normo{\lambda_i}$.  These disks do not overlap; this follows from the easy inequality~\cite[cc:disks]{hales:2009:nonlinear} %% Marchal disks are disjoint.
$$
a(h_i) + a(h_j) \le \op{arc}(2h_i,2h_j,2).
$$
Let $P_i$ be the half-space containing the origin, bounded by the plane through the circular boundary of $D_i$.  The intersection of these half-spaces is a convex polyhedron with faces $F_i$.  It is bounded by Lemma~\ref{lemma:poly-bounded}.   The radial projection of $F_i$ to the unit sphere is a spherical polygon $R_i$ containing $D_i$.  Let $n_i$ be the number of sides to the polygon $R_i$.  The area of $R_i$ is at least the area $A(a(h_i),n_i)$ of the smallest $n_i$-gon containing $D_i$.  The smallest spherical $n$-gon containing a disk of radius $a$ has area at least (Lemma~\ref{lemma:ngon}, \ref{lemma:ngon-area})
\indy{Index}{half-plane}
\indy{Index}{half-space}
$$
A(a,n) = 2\pi - 2 n (\arcsin(\cos(a)\sin(\pi/n))).
$$
One can verify directly that~\cite[cc:alin]{hales:2009:nonlinear} %% Linear lower bound on regular polygon.
$$
A(a(h),n) \ge c_0 + c_1 n + c_2 L(h),\quad
n = 3,4,\ldots,\quad 1\le h\le \hm,
$$
where
$$c_0 = 0.6327,\quad c_1 = -0.0333,\quad c_2 = 0.4754.$$
The sum $\sum_i n_i$ is the number of darts in the planar hypermap of
the convex polyhedron (Lemma~\ref{lemma:polyhedron}).  By the Lemma~\ref{lemma:dart-upper}, 
$\sum_i n_i \le (6N-12)$.
Summing over $i$,  an estimate on $N$ follows:
\indy{Index}{polyhedron!convex}
\indy{Index}{hypermap!planar}
$$
\begin{array}{lll}
4\pi &= \sum_i\op{area}(R_i)\\
     &\ge \sum_i A(a(h_i),n_i) \\
     &\ge c_0 N +c_1\sum_i n_i + c_2 \sum L(h_i)\\
     &\ge c_0 N +c_1 (6N-12) + c_2 12\\
\end{array}
$$
This gives
$$
14.93 \ge N.
$$
\end{proof} 


\begin{lemma}\guid{XULJEPR}\label{300}\label{lemma:D'}  
If some $\lambda_1$ satisfies $\normo{\lambda_1}=2$ and
$\norm{\lambda_1}{\lambda'}\ge 2\hm$ for all $0\ne\lambda'\in\Lambda$,
then  inequality~\ref{eqn:CE} does not hold.
\end{lemma}

\begin{proof}  Assume that $N\ge 13$, since the inequality is known to hold when $n\le 12$.   Create a larger disk $D_1'$ centered at $\lambda_1/2$ and argue otherwise as in the previous proof.  The polyhedron is bounded by Lemma~\ref{lemma:poly-bounded} (with $r=R=2\hm$).  By the conditions of the lemma, take 
$$a'=\arc(2,2,2\hm)-a(\hm) \approx 0.797$$
for the arcradius of this disk.  One can verify directly that~\cite[cc:alin2]{hales:2009:nonlinear} %% Linear lower bound on regular polygon (large disk)
$$A(a',n) \ge c_0 + c_1 n + c_2 L(1) + c_3$$
where $c_3 = 0.85$.
Then 
$$
\begin{array}{lll}
4\pi &= \sum_i\op{area}(R_i)\\
     &\ge A(a',n_1)+\sum_{i>1} A(a(h_i),n_i) \\
     &\ge  c_0 N +c_1\sum_i n_i + c_2 \sum L(h_i) + c_3\\
     &\ge c_0 N +c_1 (6N-12) + c_2 12 + c_3\\
\end{array}
$$
This gives a contradiction:
$$
12.97 \ge N \ge 13.
$$
\end{proof}
