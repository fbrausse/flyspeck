% File added May 15, 2012

%\chapter{Supplementary Notes}\label{sec:supplement}

\newpage
\section{Appendix on the main estimate}\label{sec:sup-local-fan}

This appendix gives further details about the proof of the main estimate.
It contains numerous improvements over the published text of
{\it Dense Sphere Packings}.

The verification of the main estimate can now largely be
viewed as a combinatorial proof that $\smain\Ra \sterm$.  This
appendix documents the program \verb!check_completeness.hl!.


\subsection{statement of results}\label{sec:statement'}

This appendix largely replaces Section~\ref{sec:weight}.
For completeness, we repeat a few definitions and results.



\begin{definition}[$\hm$,~$\tau$]\guid{CUFCNHB}\label{def:tau}
\formaldef{$\rho_0$}{rho\_fun}
\formaldef{$\rho_0$}{rho}
\formaldef{$\tau$}{tau\_fun}
\formaldef{$\sol_0$}{sol0}
\formaldef{$\hm$}{h0}
\formaldef{$\azim$}{azim\_in\_fan}
Let $(V,E,F)$ be a nonreflexive local fan.  Recall that $\hm = 1.26$ and
$L(h) = ({h_0-h})/({h_0-1})$, when $h \le h_0$.
  Set
\begin{align*}
\rho_0(y) &= 1 + \dfrac{\sol_0}{\pi} \cdot
    \dfrac{y-2}{2\hm-2} = 1 + \dfrac{\sol_0}{\pi}(1 - L(y/2))\\
  \tau(V,E,F) &=\sum_{x\in F}^{\phantom{!}} \rho_0(\normo{\nd(x)})\op{azim}(x)
+ \left(\pi+{\sol_0}\right) (2- k(F))\\
 &= \sum_{\v\in V} \rho_0(\normo{\v}) \angle (\v) + \left(\pi+{\sol_0}\right) (2- \card(V)),
\end{align*}
where $\sol_0=3\arccos(1/3)-\pi\approx0.551$ is the solid angle of a
spherical equilateral triangle of side $\pi/3$, and $k(F)$ is the
cardinality of $F$.  
\end{definition}

\begin{definition}[$\tau_{tri}$,~$\tau_3$,~,~$\dih_i$]
\formaldef{$\tau_{tri}$}{taum}
  We define additional functions in the case $k=3$.
If $\op{card}(V) = 3$, then write $V =\{\v_1,\v_2,\v_3\}$.  Set
\[
\tau_3(V) = \sum_{i=1}^3 \rho_0(\normo{\v_i}) \dih_V\{\orz,\v_i\}\{\v_{i+1},\v_{i+2}\} - (\pi + \sol_0).
\]
Let 
\begin{equation}\label{eqn:tautri}
  \tau_{tri}(y_1,y_2,y_3,y_4,y_5,y_6) =
  \sum_{i=1}^3 \rho_0(y_i) \dih_i(y_1,\ldots,y_6)
- \left(\pi+{\sol_0}\right),
\end{equation}
where
\begin{align}\label{eqn:dihi}
\dih_1(y_1,y_2,y_3,y_4,y_5,y_6) &= \dih(y_1,y_2,y_3,y_4,y_5,y_6),\notag\\
\dih_2(y_1,y_2,y_3,y_4,y_5,y_6) &= \dih(y_2,y_3,y_1,y_5,y_6,y_4),\textand\notag \\
\dih_3(y_1,y_2,y_3,y_4,y_5,y_6) &= \dih(y_3,y_1,y_2,y_6,y_4,y_5).
\end{align}
\indy{Notation}{h@$h_0 = 1.26$}%
\indy{Notation}{zzt@$\tau_{tri}$}%
\indy{Notation}{zzt@$\tau$ (weight assignment)}%
\indy{Notation}{zzrho1@$\rho_0$ (real-valued function)}%
\indy{Notation}{sol0@$\sol_0 = 3\arccos(1/3)-\pi$}%
\indy{Notation}{dih@$\dih_i$}%
\indy{Notation}{L@$L$ (linear function)}%
\end{definition}


\begin{definition}[standard,~protracted,~diagonal]\guid{KRACSCQ} 
\formaldef{standard}{standard (deprecated)}
\formaldef{protracted}{protracted (deprecated)}
\formaldef{diagonal}{diagonal0 (deprecated)}
Let $(V,E)$ be a fan.  
We write $\normo{\ee}$ for $\norm{\v}{\w}$, when $\ee=\{\v,\w\}\subset V$.
We say that  $\ee$ is \newterm{standard} if
\[
2\le \normo{\ee}\le2\hm.
\]
We say that  $\ee$ is \newterm{protracted} if
\[
2\hm\le \normo{\ee}\le\sqrt{8}.
\]
If $\v,\w\in V$ are distinct, and $\ee=\{\v,\w\}$ is not an edge in $E$, then
we call $\ee$ a \newterm{diagonal} of the fan.
\end{definition}
%\indy{Notation}{4@$\norm{\wild}$ (norm of fan edge)}% % doesn't parse


\begin{theorem}[main~estimate]\guid{JEJTVGB}\label{lemma:main-estimate}
\formaldef{\case{annulus}}{ball\_annulus}
\formaldef{main estimate}{main\_estimate (deprecated)}
\formaldef{\case{diagonal}}{diagonal1 (deprecated)}
\formaldef{\wild}{check:quad\_std\_cs, pent\_std\_cs, hex\_st\_cs, pent\_diag\_cs, pent\_pro\_cs, }
%\label{theorem:main}
Let $(V,E,F)$ be a nonreflexive local fan (Definition~\ref{def:convex-local}).
We make the following additional
assumptions on $(V,E,F)$.
\begin{enumerate}
\item \case{packing} $V$ is a packing.  
\item \case{annulus} $V\subset \BB$.
\item \case{diagonal} If $\{\v,\w\}$ is a diagonal,  then 
\[ 
\norm{\v}{\w}\ge 2\hm.
\] 
\item \case{card} 
Let   $k=\card(E)=\card(F)$.  Then $3\le k \le 6$.
\end{enumerate}
In this context, we have the following conclusions.
\begin{enumerate}
\item Assume $k\ge 3$.  If  every edge of $E$ is standard, then
\[ 
\tau(V,E,F) \ge
\begin{cases}
  0.0,&\text{if }k=3,\\
  0.206,&\text{if }k=4,\\
  0.4819,&\text{if }k=5,\\
  0.712,&\text{if }k=6.
\end{cases}
\] 
\item Assume $k=5$.  Assume that every edge of $E$ is standard.
Assume that every diagonal $\ee$ of the fan satisfies $\normo{\ee}\ge\sqrt{8}$.
Then 
\begin{equation}
\tau(V,E,F)\ge 0.616. \tag{check:pent\_diag\_cs}
\end{equation}
\item Assume $k=5$.  Assume there exists some protracted edge in $E$ 
and that the other four edges are standard.  Then 
\begin{equation}
\tau(V,E,F)\ge 0.616. \tag{check:pent\_pro\_cs}
\end{equation}
\item Assume that $k=4$.  Assume that there exists some protracted
 edge in $E$ and that the other three edges are standard.  
Assume that both diagonals $\ee$ of the fan satisfy $\normo{\ee}\ge\sqrt{8}$.
Then
\begin{equation}
\tau(V,E,F)\ge 0.477. \tag{check:quad\_pro\_cs}
\end{equation}
%% XX condition on diags >= sqrt8 added 2012-5-20.
%% based on the semantics of glpk/tame_archive/head.mod.
%\item Assume $k=3$. Then
%\begin{equation}
%\tau(V,E,F)\ge 0.\tag{check:tri\_std\_cs}
%\end{equation}
\item Assume $k=4$.  Assume that every edge of $E$ is standard.
Assume that both diagonals $\ee$ of the fan satisfy $\normo{\ee}\ge3$.
Then
\begin{equation}
\tau(V,E,F)\ge 0.467.\tag{check:quad\_diag\_cs}
\end{equation}
%\item Assume $k=3$. Then
%\begin{equation}
%\tau(V,E,F)\ge 0.\tag{check:tri\_std\_cs}
%\end{equation}
\end{enumerate}
\end{theorem}

%% Merged with Main Estimate on 2013-03-01.
%There are two related inequalities that we will prove separately. For that reason,
%we state them as a separate lemma.
%
%\begin{lemma}\guid{HGDRXAN}\label{lemma:tau3}
%Let $(V,E,F)$ be a nonreflexive local fan.
%Under the same hypotheses on $(V,E,F)$ as in Theorem~\ref{lemma:main-estimate}, 
%\begin{enumerate}
%
%\end{enumerate}
%\end{lemma}


\subsection{definitions}


\begin{definition}[torsor,~adjacent]\guid{XCZLSVS}
%\formaldef{$\cstab$}{cstab}
\formaldef{torsor}{torsor}
  Let $k>1$ be an integer.  A \newterm{torsor} is a set $I$ with a
  given simply transitive action of $\ring{Z}/k\ring{Z}$ on $I$.  We
  write the application of $j\in\ring{Z}/k\ring{Z}$ to $i\in I$ as
  $j+i$ or $i+j$.  We also write $j+i$
  for the application of the image of $j\in\ring{Z}$ in $\ring{Z}/k\ring{Z}$ to
  $i\in I$.  Note that each choice of base point $i_0\in I$ gives a
  bijection $i\mapsto i+i_0$ between $\ring{Z}/k\ring{Z}$ and $I$.  
  We say that $i$ and $j$ are \newterm{adjacent} if $i= j+ 1$ or $j=i+1$.
  %If $i,j\in I$, write 
  %\[
  %|i-j|_0 = \min\left \{ |m-n| \mid m + i = n +j,\ m,n\in\ring{Z}\right \}.
  %\]
When $i$ and $j$ are adjacent, we call $\{i,j\}$ an edge of $I$.
 A \newterm{diagonal} is a pair $\{i,j\}\subset I$
such that $\{i,j\}$ is not a singleton and not an edge.
\indy{Notation}{I@$I$ (torsor)}%
\end{definition}

\begin{definition}\guid{TEQQCLX}
 The \newterm{opposite} $I'$ of a torsor $I$ is the torsor with the
same underlying set and the action is composed with the group automorphism
$\ring{Z}/k\ring{Z}\to\ring{Z}/k\ring{Z}$, sending $i\mapsto -i$.
  An
  \fullterm{isomorphism of torsors}{isomorphism!torsor} 
 is a bijection that respects the action.
Two torsors are \newterm{equivalent} if they are isomorphic or if 
one is isomorphic to the opposite of the other.
\end{definition}


\begin{example} If $H=(D,e,n,f)$ is a hypermap with face $F$,
then $F$ is a torsor under the action $x \mapsto f x$.  If $H$ is
isomorphic to $\op{Dih}_{2k}$ and has vertex set $V$, then $V$ is a torsor
under the action of $x\mapsto \rho x$, for some $\rho$ similar to
 $\rho_{(V,E,F)}$.  We may mostly restrict our attention to
these instances of torsors.
\end{example}

% XX stab. May 17, 2012.  Dropped the constraint a_{ij}\le \stab.
% It doesn't hold for one of the quad terminal SCSs:
% 1637868761 has diag at least 3.41.

% March 2013. Merged constraint system and SCS.
%(We merge the definitions of stable,  tri-stable, and augmented
%(augmented) from earlier versions.)
% renamed augmented -> substandard, then mreged with stable.

Recall that $\stab=3.01$.

\begin{definition}[stable~constraint~system]\guid{ZGFHNKX}
\formaldef{constraint system}{constraint\_system}
\formaldef{stable constraint system}{stable\_system}
\formaldef{$(k,a,b,d,I,J,+1)$}{(k\_sy,a\_sy,b\_sy,d\_sy,I\_sy,J\_sy,f\_sy)}
\formaldef{tri-stable}{tri\_stable}
\formaldef{$(a,b,d,k,I,J,+1)$}{$(a\_ts,b\_ts,d\_ts,k\_ts,I\_ts,J\_ts,f\_ts)$}
\formaldef{substandard (stable)}{augmented\_constraint\_system1}
\formaldef{substandard (tri-stable)}{augmented\_constraint\_system2}
%
A \newterm{stable constraint system} $s$ (or \newterm{SCS} for short)
consists of the following data subject
to conditions listed below.
\begin{enumerate}
\item a natural number $k\in \{3,4,5,6\}$,
\item a $\ring{Z}/k\ring{Z}$-torsor $I$,
\item a real number $d$,
\item real constants $a_{ij}$, $b_{ij}$, $\alpha_{ij}$, $\beta_{ij}$, for $i,j\in I$.
\item a set of edges $J\subset \{ \{i,1+i\} \mid i\in I\}$, 
\item subsets $I_{lo}$, $I_{str} \subset I$.
\end{enumerate}
The data is subject to the following conditions.
\begin{enumerate}
\item $d < 0.9$,
\item 
   $a_{ij} = a_{ji}$, $b_{ij}=b_{ji}$, $\alpha_{ij}=\alpha_{ji}$, $\beta_{ij}= \beta_{ji}$,   for $i,j\in I$.
\item 
$a_{ij}\le \alpha_{ij}\le \beta_{ij}\le b_{ij}$,
 for $i,j\in I$,
\item 
\[
0 = a_{ii}\text{ and } 2\le a_{ij} \text{ for all }  i,j\in I \text{ such that } i\ne j.
\]  
\item
  Also, 
\[
   ~\quad \begin{cases}
    b_{i,i+1} < 4, & \text{if } k = 3\\
    b_{i,i+1}\le \stab, & \text{if } k > 3.
    \end{cases}
\]  
\item
If $\{i,j\}\in J$, then $\leftclosed
  a_{ij},b_{ij}\rightclosed=\leftclosed\sqrt{8},\stab\rightclosed$.
\item  $m+k\le 6$, where 
$m$ is the number of edges $\{i,i+1\}\subset I$ such that
$b_{i ,i+1}> 2h_0$ or $a_{i ,i+1}>2$. In particular, $\card(J)+k\le 6$.
\end{enumerate}
\indy{Notation}{J@$J$}%
\indy{Notation}{m@$m(s)$ (number of nonstandard edges)}%
\end{definition}

For each SCS $s$, we write $k(s)$,
$d(s)$, $I(s)$, $a_{ij}(s)$, and so forth for the associated
parameters.   We simply write $k$, $d$, and so forth when there is a single
SCS $s$ in a given context.



%% Merged above.
%\begin{definition}\guid{ZBJCZHI} \guid{RIUGHVX} 
%We say that a constraint system $s$ is \newterm{stable} if the following
%additional properties hold.
%\begin{enumerate}
%\end{enumerate}
%
%\end{definition}

\begin{definition}[unadorned]\guid{SDJTENL}
We say that a SCS $s$ is \newterm{unadorned} if the following additional
properties hold (with established notation):
\begin{enumerate}
\item For all $i,j\in I(s)$,  $a_{ij}(s)=\alpha_{ij}(s)$ and $b_{ij}(s)=\beta_{ij}(s)$.
\item $I_{lo}(s)=I_{str}(s)=\emptyset$.
\end{enumerate}
\end{definition}

Intuitively, we think of the SCS as involving both {\it hard} and {\it
  soft} constraints.  The soft constraints are those that involve the
adornments $\alpha_{ij}$, $\beta_{ij}$, $I_{lo}$, $I_{str}$.

\begin{example}\label{ex:extend-cs} 
We may always transform a SCS $s$ into another $s'$ that is unadorned by
setting $\alpha_{ij}(s')=a_{ij}(s)$, $\beta_{ij}(s')=b_{ij}(s)$, $I_{lo}(s')=\emptyset$, $I_{str}(s')=\emptyset$, and
keeping the rest of the data the same.
\end{example}


\begin{definition}[ear] \guid{HVFQIBQ}
\formaldef{$a_{ij}$}{a\_ear0}
\formaldef{$b_{ij}$}{b\_ear0}
\formaldef{ear}{ear\_sy}
We have an unadorned SCS $s$ given by
$k=3$, $d=0.11$, $J$ a singleton, 
and
\[
\leftclosed a_{ij},b_{ij}\rightclosed=
\begin{cases}
 \leftclosed0,0\rightclosed,
 &\text{~~if } i=j,\\
 \leftclosed\sqrt8,\stab\rightclosed,
 &\text{~~if } \{i,j\} \in J,\\
 \leftclosed 2,2\hm\rightclosed,
 &\text{~~otherwise. }
\end{cases}
\]
We call $s$ an \newterm{ear} (by analogy with an ear
in a triangulation of a polygon, which is a triangle that has two of
its edges in common with the polygon).
\end{definition}


Next we associate a set $\BB_s$ with each SCS $s$.
\indy{Notation}{BBs@$\BB_s$}%


\begin{definition}[$\BB_s$]\guid{KTFVGXF}\label{def:BBs}
  For every SCS $s$, and every function
  $\v:I(s)\to \BB$, let $V_\v\subset \BB$ be the image of
  $\v$.  Let $E_\v$ be the image of $i\mapsto \{\v_i,\v_{i+1}\}$.  Let
   $F_\v$ be the image of $i\mapsto (\v_i,\v_{i+1})$.
 Let $\BB_s$ be
  the set of all functions $\v$ that have the following properties.
\begin{enumerate}
\item $a_{ij}(s)\le\norm{\v_i}{\v_j}\le b_{ij}(s)$, for all $i,j\in I(s)$.
\item if $k(s)>3$, then $(V_\v,E_\v,F_\v)$ is a nonreflexive local fan.
\end{enumerate}
\end{definition}





Note that $\BB_s$ does not depend on the data $\alpha_{ij}$, $\beta_{ij}$, $J$, $I_{str}$, $I_{lo}$, and $d$.
The set $J$ is used to make a small correction $d(s,\v)$ to the
constant $d(s)$.  

\begin{definition}[$d(s,\v)$]\guid{TPLCZFL}
\formaldef{$\sigma$}{sigma\_sy}
Let $s$ be a SCS.  
Set $\sigma(s) =1$ when $s$ is an ear;  $\sigma =
-1$, otherwise.  
Write
\begin{equation}
d(s,\v) = d(s) +  0.1\, \sigma(s)\,\sum_{\{i,j\}\in J(s)} (\stab - \norm{\v_i}{\v_j}).
\end{equation}
\end{definition}
\indy{Notation}{zzs@$\sigma=\pm1$}%
\indy{Notation}{d@$d(s,\v)$}%

This correction to $d(s)$  makes it a bit easier to prove inequalities when
$\sigma(s)=-1$, at the cost of slightly more difficult inequalities for ears.

When
$k(s)=3$ and $\v\in \BB_s$, 
the set $V_\v=\{\v_i\mid i\in I(s)\}$ may degenerate to planar
configurations, because the local fan constraint in Definition~\ref{def:BBs} is not imposed in this case.
Nevertheless, by the
constraint $b_{ij}(s)<4$, the tetrahedron $\{\orz,\v_1,\v_2,\v_3\}$ has well-defined
dihedral angles $\dih_V \{\orz,\v_i\} \{\v_{i+1},\v_{i+2}\}$,  so
that $\tau_3(V_\v)$ is defined.

\begin{definition}[$\tau^*$]\guid{BGCEUKP}\label{def:tau-star}
\indy{Notation}{zzt@$\tau^*$}%
Let $s$ be a SCS.  Define 
\[
\tau^*:\{(s,\v)\mid \ \v\in \BB_s\} \to \ring{R}
\] 
by
\[ 
\tau^*(s,\v) = \begin{cases}
  \tau(V_\v,E_\v,F_\v)-d(s,\v),  &\text{if } k(s) > 3\\
  \tau_3(V_\v)-d(s,\v), &\text{if } k(s) = 3.
\end{cases}
\] 
\indy{Notation}{zzt@$\tau^*$}%
\end{definition}



\begin{definition}[$\smain$]\label{ex:main} \guid{XOSFOMP}
The constants in the conclusions of the main estimate
  (Theorem~\ref{lemma:main-estimate}) can be packaged into unadorned SCSs.  
For example, the standard main estimate for $k=6$ gives
  the SCS data: $d=0.712$, $J=\emptyset$, $I$ an indexing set
  of cardinality six, and
\[
a_{ij} = \begin{cases} 0, & i=j,\\
  2, & j= i\pm1,\\
  2 \hm, & \text{otherwise},
  \end{cases}
\qquad
b_{ij}=\begin{cases}
 0, & i=j,\\
 2\hm, & j= i\pm1,\\
 4h_0^+, & otherwise,
  \end{cases}
\]
where $h_0^+$ is any constant greater than $\hm$.
The upper bound $4\hm$ on any diagonal comes from the triangle
inequality: $\norm{\v_i}{\v_j} \le \normo{\v_i}+\normo{\v_j} \le
4\hm$.   
% XX added $\hm^+$ May 26, 2012 to avoid binding constraints.
We write $\smain$ for the set of SCSs $s$, 
 for all cases of the main
estimate.
\end{definition}
\indy{Notation}{Smain@$\smain$ (main estimate SCSs)}%


\begin{lemma}\guid{ZITHLQN}\label{lemma:main-smain}  
The main estimate holds if and only if for every
$s\in\smain$ and for every $\v\in \BB_s$, we have $\tau^*(s,\v)\ge0$.
\end{lemma}

\begin{proof}  This follows by expanding the definition of $\smain$ and $\BB_s$.
Note that
the set $J(s)$ is empty for $s\in \smain$, so 
\[
d(s,\v) = d(s), \text{ for all } s \in \smain.
\]
\end{proof}



%\begin{definition}[$\smain$] \guid{BTKIQGE}
%For each of the cases of Theorem~\ref{lemma:main-estimate}, we fix an
%SCS that encodes its parameters, as described in Example~\ref{ex:main}. 
%Let $\smain$ be this set of  SCSs.
%\end{definition}




\subsection{minimization}




\begin{definition}[index,~$\iota$,~$\MM_s$]\guid{FNUEPJW}
Let $s$ be a SCS.
Let 
\[
\MM_{s}\subset \BB''_{s}\subset \BB'_s\subset \BB_{s}
\]
be defined as follows.
Let $\BB'_{s}$ be the set of all $\v\in \BB_{s}$ such that
\begin{enumerate}
\item $\tau^*(s,\v)$ is equal to the minimum of $\tau^*(s,\wild)$ over $\BB_{s}$.
\item $\tau^*(s,\v)< 0$.
\end{enumerate}
Define the \newterm{index} $\iota(s,\v)$ of $\v\in \BB_s$ to be the number of edges $\{i,j\}$ of $I(s)$
for which $a_{i j}(s)=\norm{\v_i}{\v_j}$.  Let $\iota(s)$ be the minimum
of the index of $\v$ as $\v$ runs over $\BB'_s$.  
We let $\BB''_{s}$  be the set of $\v\in \BB'_{s}$ that attain
the smallest possible index $\iota(s)$,
and let $\MM_s\subset \BB''_s$ be the subset of all $\v$ satisfying the additional soft
constraints.
\begin{enumerate}
\item If $i\in I_{str}$,  then $\v_i$ is straight.
\item If $i\in I_{lo}$,  then $\normo{\v_i}=2$.
%\item If $i\in I_{hi}$,  then $\normo{\v_i}=2h_0$.
\item $\alpha_{ij}(s)\le \norm{\v_i}{\v_j}\le \beta_{ij}(s)$ for all $i,j$.
\end{enumerate}
\end{definition}


Note that if $s$ is unadorned, then $\MM_s = \BB''_s$.
%(Obviously, if $I_{hi}\cap I_{lo}\ne \emptyset$, then $\MM_s=\emptyset$.)


%We have the following analogue of Lemma~\ref{lemma:esm}.

%\begin{lemma}\guid{PCRTTID} \label{lemma:aug-compact}
%\end{lemma}

%\begin{proof}  See DSP.
%\end{proof}

%\begin{lemma}[continuity]\guid{HDPLYGYv2}\label{lemma:hdpv2}
%Let $s$ be a SCS.  Then the function 
%\[
%\v\mapsto \tau^*(s,\v)
%\]
%is a continuous function on $\BB_s$.  Moreover, if $\BB_s$ is
%nonempty, then the function attains a minimum.
%\end{lemma}

%\begin{proof} 
%\end{proof}

\begin{lemma}\guid{XWITCCN}\label{lemma:init-bbs} 
Let $s\in \smain$, and assume that 
\[
\tau^*(s,\v)< 0.
\]
for some $\v\in \BB_s$.
Then $\BB'_s$ is nonempty.
\end{lemma}

\begin{proof} Let $s$ be a SCS. Then by DSP,
$\BB_s$ is compact (as a subset of
$\BB^k \subset \ring{R}^{3k}$). 

 The function 
\[
\v\mapsto \tau^*(s,\v)
\]
is a continuous function on $\BB_s$.  Moreover, if $\BB_s$ is
nonempty, then the function attains a minimum.  This follows from Lemma~\ref{lemma:compact-fan} and
Lemma~\ref{lemma:aug-compact}.  The set of minima is then nonempty.
\end{proof}

\begin{lemma}\guid{AYQJTMD}\label{lemma:init}
Let $s\in \smain$, and assume that 
\[
\tau^*(s,\v)< 0.
\]
for some $\v\in \BB_s$.
Then $\MM_s$ is nonempty.
\end{lemma}

\begin{proof}    By Lemma~\ref{lemma:init-bbs}, the set 
$\BB'_s$ of minimizers is nonempty.   
The subset $\BB''_s$ on which the index is as small as possible
is then also nonempty.  By the definition of $\smain$,  we see that $s\in \smain$ is unadorned, and
  $\BB''_s = \MM_s$.
\end{proof}


\begin{lemma}\guid{EAPGLEJ}  The main estimate holds if and only if $\MM_s=\emptyset$ for all $s\in\smain$.
\end{lemma}

\begin{proof} By Lemma~\ref{lemma:init} and Lemma~\ref{lemma:main-smain}.
\end{proof}

\begin{lemma}\guid{JKQEWGV}\label{lemma:not-circular}
Let $s$ be a SCS.  Let $\v\in \BB_s$.
Suppose that $\tau^*(s,\v)< 0$.  Then
$\sol(V_\v,E_\v,F_\v) < \pi$.
Furthermore, the local fan is not circular, and
the local fan can be lunar only when the pole has acute interior
angle.
\end{lemma}

\begin{proof} By the definition of SCS,
we have $d(s)< 0.9$. The proof of Lemma~\ref{lemma:09} extends readily
to this context. The solid angle of a lune is less than $\pi$ if and only
if the pole has acute interior angle.
\end{proof}





\subsection{operations}

This section describes some operations on SCSs.  
The first of these, a restriction,
 is a {\it hardening} of some of the soft constraints.


\begin{definition}[restriction]\guid{PFEOBSC}
Let $s$ be a SCS.
We say that $s'$ is a \newterm{restriction} of $s$ of the \newterm{first type} if $I(s)=I(s')$ and
\[
b_{ij}(s') =  \beta_{ij}(s), \quad i,j\in I(s).
\]
and all other parameters $k$, $d$, $J$, $a$, $\alpha$, $\beta$, etc. are
the same for $s$ and $s'$.

We say that $s'$ is a \newterm{restriction} of $s$ of the \newterm{second type} if 
\begin{enumerate}
\item $I(s)=I(s')$,
\item $\alpha_{ij}(s)=\beta_{ij}(s)$ for all $i,j\in I(s)$,
\item
$a_{ij}(s') = b_{ij}(s') = \alpha_{i j} (s)$,
and 
\item all other parameters $k$, $d$, etc.
are
the same for $s$ and $s'$.
\end{enumerate}
We say that $s'$ is a restriction of $s$ if it is a restriction of
the first or second type.
\end{definition}


\begin{definition}[subdivision]\guid{YYKMEWW} 
Let $s$ be a SCS,
and let $i,j\in  I(s)$, with $i\ne j$.  Select $c$ such that $a_{ij}(s)\le c\le b_{ij}(s)$.
The \newterm{subdivision} of $s$ along $\{i,j\}$ is the pair $\{s_1,s_2\}$ 
of SCSs, where all the parameters for $s_1$ and $s_2$
are the same as those of $s$, except that
\[
a_{ij}(s_1)=a_{ji}(s_1) = c,  \quad  b_{ij}(s_2) = b_{ji}(s_2)=c.
\]
and
\begin{equation}\label{eqn:ab-alpha-beta}
\leftclosed\alpha_{ij}(s_\ell),\beta_{ij}(s_\ell)\rightclosed =
\leftclosed\alpha_{ij}(s),\beta_{ij}(s)\rightclosed\cap
\leftclosed a_{ij}(s_\ell),b_{ij}(s_\ell)\rightclosed, \text{ for } \ell=1,2.
\end{equation}
(If one one of these intersections is empty, for $\ell=1$ or $2$,  then we set $s_1=s_2$ and
let the subdivision be the singleton $\{s_1\}$ consisting of the single SCS  with nonempty intersection
in \eqref{eqn:ab-alpha-beta}.)
\end{definition}
The subdivision thus corresponds to splitting an interval 
$\leftclosed a_{ij},b_{ij}\rightclosed$ into
\[
\leftclosed a_{ij},c\rightclosed \cup \leftclosed c,b_{ij}\rightclosed.
\]



\begin{definition}\guid{LCTBALA}  
We say that a SCS $s$
\newterm{transfers} to a SCS $s'$ if
\begin{enumerate}
\item If $s$ is an ear, then $s=s'$.
\item $s'$ is unadorned.
\item $I(s) = I(s')$.
\item $d(s)\le d(s')$.
\item For all $i,j$, we have $a_{ij}(s')\le a_{ij}(s)\le b_{ij}(s)\le b_{ij}(s')$.
\item $J(s')\subset J(s)$.
\end{enumerate}
\end{definition}

\begin{definition}[equivalent~SCS]
If $s$ is a SCS with torsor $I(s)$, and if
$I'$ is any equivalent torsor, then we can use the bijection between $I(s)$ and $I'$
to obtain a SCS $s'$ with $I' = I(s')$.  An
SCS $s'$ related in this way to $s$ is said
to be \newterm{equivalent} to $s$.  An \newterm{equi-transfer} of $s$
to $s'$ is a transfer from $s$ to a SCS that
is equivalent to $s'$.
\end{definition}

\begin{definition}[torsor slice] \guid{ZTBHGMO}
Let $I$ be a $\ring{Z}/k\ring{Z}$-torsor, with action given by $(j,i)\mapsto j+i$,
for $i\in I$.  Let $p,q\in I$ be non-adjacent.  Set
\[
I[p,q] = \{p,1+p,2+p,\ldots,q\} \subset I.
\]
Note that the cardinality of $I[p,q]$ is
\[
m = 1 + \min \{j\in \ring{N} \mid j + p = q\}.
\]
We make $I[p,q]$ into a $\ring{Z}/m\ring{Z}$-torsor with action $(j,i)\mapsto j+' i$,
given by the iterates of
\[
1 +' i = 
\begin{cases}
  1 + i &\text{if } i\ne q,\\
  p &\text{if } i = q.
\end{cases}
\]
The $\ring{Z}/m\ring{Z}$-torsor $I[p,q]$ is called the
\fullterm{slice\/}{slice!torsor} of $I$ along $(p,q)$.
\indy{Notation}{Ipq@$I[p,q]$ slice (of a torsor)}%
\end{definition}

\figWKUYEXM % fig:slice-torsor


\begin{definition}[SCS slice]\guid{CJMHFAT}
 Let $s$ be a SCS and let $\{p,q\}\subset I(s)$ be a diagonal.
  (In particular, $k(s)>3$.)  We
  say that a pair $\{s',s''\}$ is a
\newterm{slice} along  the
  diagonal $\{p,q\}$ of $s$, if the following conditions hold.
\begin{enumerate}
\item $s'$ and $s''$ are unadorned SCSs.
\item $I(s')=I[p,q]$ and $I(s'') = I[q,p]$.
\item $d(s) \le d(s') + d(s'')$.
\item $J(t) \subset J(s) \cup \{\{p,q\}\}$, for $t = s',s''$.  
\item $\{p,q\}\in J(s')$ iff $\{p,q\}\in J(s'')$.
\item $\{p,q\}\in J(s')$ iff $s'$ or $s''$ is an ear.
\item 
\[
a_{ij}(t) = a_{ij}(s), \text{ and } b_{ij}(t) = b_{ij}(s),
\]
for  $t=s',s''$ and all $i,j\in I(t)$ except the given diagonal $\{i,j\} = \{p,q\}$.
%\item For $t=s',s''$,
%\[
%b_{pq}(s) \in \leftclosed a_{pq}(t),b_{pq}(t)\rightclosed.
%\]
%%!! Removed b_{pq}(s) in cover def on Jan 23, 2012. Restored here!
%% XX May 17, 2012 restored there.
\item $a_{pq}(t) = \alpha_{pq}(s),\quad b_{pq}(t)=\beta_{pq}(s)$,\quad $t = s',s''$.
\end{enumerate}
\end{definition}


The word {\it slice} is used for related operations on the indexing
set, the local fan, and the SCS.  A slice of a
SCS is used in parallel with the slice a fan of
cardinality $k(s)$ into two smaller fans with cardinalities $k(s')$ and
$k(s'')$.  
All of the edge length constraints are to be preserved
under slicing.  

If $\{s',s''\}$ is an slice of a diagonal $\{p,q\}$, then we can use
the inclusions of sets $I(s')\subset I(s)$ and $I(s'')\subset I(s)$ to
restrict an element $\v:I(s)\to\BB$ to $\v':I(s')\to \BB$ and
$\v'':I(s'')\to \BB$.  

\begin{lemma}\guid{QKNVMLB}\label{lemma:cover2}
Let $s$ be a SCS with diagonal $\{p,q\}$ and slice
 $\{s',s''\}$ along $\{p,q\}$.
Let $\v\in \BB_s$ and let $\v'$ and $\v''$ be constructed from $\v$ as above.
Then  $\v'\in \BB_{s'}$ and $\v''\in \BB_{s''}$.
Moreover,
\begin{equation}
d(s,\v) \le d(s',\v') + d(s'',\v'')
\end{equation}
and
\begin{equation}
\tau^*(s,\v)\ge \tau^*(s,\v')+\tau^*(s,\v'').
\end{equation}
\end{lemma}

\begin{proof} See Lemma~\ref{lemma:cover}.
\end{proof}

\subsection{propagation}

The proof of the main lemma consists in showing that the nonemptiness
of $\MM_s$ propagates in an orderly way under the operations of
restriction, slicing, equivalence, subdivision, and deformation.

\begin{definition}[$\Ra$] \guid{AZGJNZO}
Let $\SCS$ be the set of SCSs
and let $P(\SCS)$ be the powerset of $\SCS$. 
% We define a relation $(\ra)$ on $\SCS\times P(\SCS)$.
%We write $s\ra T$ if the following condition holds.
%\begin{enumerate}
%\item $k=1$ and $s$ transfers to a SCS equivalent to $s_1$.
%\item $k=2$ and $\{s_1,s_2\}$ is an slice along some diagonal of $s$.
%\item $k=2$ and $\{s_1,s_2\}$ is a subdivision of $s$.
%\item If $\MM_s\ne\emptyset$, then 
%$\MM_t\ne\emptyset$ for some $t\in T$.
%\end{enumerate}
We define a binary relation $(\Ra)$ on $P(\SCS)$.  We write
$S\Ra T$ to mean  either that $\MM_s=\emptyset$ for all $s\in S$,
or that there exists $t\in T$ such that $\MM_t\ne\emptyset$.
%\begin{enumerate}
%\end{  $s\in S_1$, we have $s\ra S_2$.
%$s\ra S''$.  We define a binary relation $\Ra^*$ on $P(S)$ as the reflexive
%transitive closure of $\Ra$.
\end{definition}

\begin{lemma}\guid{FZIOTEF}
The relation $(\Ra)$  is reflexive and transitive.
\end{lemma}

\begin{proof}  Clearly, $\{s \}\Ra \{s\}$, and this implies reflexivity.
Transitivity is a simple matter.  Assume
$S_1\Ra S_2$ and $S_2\Ra S_3$.  Assume $s_1\in S_1$, with $\MM_{s_1}\ne \emptyset$.
Then select
$s_2\in S_2$ such that $\MM_{s_2}\ne\emptyset$, and $s_3\in S_3$ such
that $\MM_{s_3}\ne\emptyset$.  Then $\{s_1\}\Ra\{s_3\}$.  So $S_1\Ra S_3$.
\end{proof}

%\begin{lemma}\guid{IEWZAVH}\label{lemma:propagate}
%Let $S$  and $T$ be finite sets of SCSs such that
%$S\Ra T$.  Assume that $\MM_s\ne\emptyset$ for some $s\in S$.
%Then $\MM_t\ne\emptyset$ for some $t\in T$.
%\end{lemma}

%\begin{proof} This follows directly from the definitions. 
%\end{proof}

\begin{lemma}[restriction]\guid{EQTTNZI}
Let $s$ be a SCS.
If $t$ is a restriction of $s$, then $\{s\}\Ra \{t\}$.
\end{lemma}

\begin{proof}
$\BB_t\subset \BB_s$. Assume
 $\w\in \MM_s$. Then $\w\in \BB_t$.

Assume the restriction has the first type.  Then a global minimizer $\w$ also
minimizes on a subset,  and the index does not change.  Hence $\w\in \MM_t$ and $\{s\}\Ra\{t\}$.

Assume that the restriction has the second type. Then 
 $\alpha_{ij}(s)=\beta_{ij}(s)$.    We have $\BB_t\subset \BB_s$.
For every $\v\in \BB'_t$, the index of $\v$ is $k$: every edge is fixed at its lower bound.
Hence $\BB'_t = \BB''_t$, and $\w\in \MM_t$.
\end{proof}


\begin{lemma}[subdivision]\guid{UAGHHBM}
Let $s$ be a SCS and let
Let $\{s_1,s_2\}$ be a subdivision of $s$ along $\{i,j\}\subset I(s)$.
Then $\{s\}\Ra\{s_1,s_2\}$.
\end{lemma}

\begin{proof}
Let $c$ denote the constant used for the subdivision.
We have $\BB_s =
\BB_{s_1}\cup \BB_{s_2}$.  If $\w\in \MM_s$, then
$\w\in \BB'_{s_1}\cup\BB'_{s_2}$.

Assume first that there exists $\w\in \MM_s$ such that $c < \norm{\w_i}{\w_j}$.
We claim that $\iota(s) \le \iota(s_2)$.  In fact,
\begin{align*}
\iota(s) &=\min_{\v\in \BB'_s} \iota(s,\v)\\
&\le \min_{\v\in \BB'_{s_2}} \iota(s,\v) \\
&\le \min_{\v\in \BB'_{s_2}} \iota(s_2,\v) \\
&=\iota(s_2).
\end{align*}

We have $\w\in\BB'_{s_2}$ and $\BB'_{s_2} = \BB'_s \cap \BB_{s_2}$.
Also,
\[
\iota(s_2)\ge \iota(s) = \iota(s,\w) = \iota(s_2,\w) \ge \iota(s_2)
\]
so that $\w\in \BB''_{s_2}$ and $\w\in \MM_{s_2}$.

Finally, assume that every $\w\in\MM_s$ has $\norm{\w_i}{\w_j}\le c$.  This
means $\MM_s\subset \BB_{s_1}$. Let $\w\in\MM_s$.
We claim that $\iota(s) = \iota(s_1)$.  In fact,
\begin{align*}
\iota(s) &= \min_{\v\in \BB'_s} \iota(s,\v) \\
   &\le \min_{\v\in\BB'_{s_1}}\iota(s,\v)\\
   &=\min_{\v\in \BB'_{s_1}}\iota(s_1,\v)\\
   &=\iota(s_1).
\end{align*}
Also, 
\[
\iota(s) = \iota(s,\w) = \iota(s_1,\w) \ge \iota(s_1).
\]

We have $\w\in\MM_s\subset \BB'_s\cap \BB_{s_1} = \BB'_{s_1}$.
Since $\iota(s)=\iota(s_1)$, we also have $\w\in \BB''_{s_1}$.
So $\w\in \MM_{s_1}$.
\end{proof}

\begin{lemma}[transfer, equivalence]\guid{YXIONXL}  
Let $s$ be a SCS and let
 $t$ be a transfer or equivalent of $s$.  
Then  $\{s\}\Ra\{t\}$.
\end{lemma}

\begin{proof}
Assume that $\w\in \MM_s$.
We have $\w\in \BB_s\subset\BB_t$, and $d(t,\w) \ge d(s,\w)$,
as well as $\tau^*(t,\w)\le\tau^*(t,\w)< 0$.   By Lemma~\ref{lemma:init-bbs}, there
exists a global minimizer of smallest index
$\v\in\BB''_t\ne\emptyset$.  It satisfies
$\tau^*(t,\v)\le\tau^*(t,\w)< 0$.  By the definition of transfer,
$t$
is unadorned, so that $\BB''_t=\MM_t$.  (Note that $\MM_s$ and
$\MM_t$
might not be directly related.)  This shows that
$\MM_t\ne\emptyset$.
Hence $\{s\}\Ra\{t\}$.  Similarly, if $t$ is equivalent to $s$,
then we again have $\{s\}\Ra\{t\}$.
\end{proof}

\begin{lemma}[slice]\guid{LKGRQUI}  Let $\{s',s''\}$ be a slice of
a SCS $s$ along
a diagonal $\{p,q\}$.  
Then   $\{s\}\Ra\{s',s''\}$.
\end{lemma}

\begin{proof}
Assume that $\w\in\MM_s$.
Let $\w'\in \BB_{s'}$ and $\w''\in \BB_{s''}$ be obtained
by restriction of parameters.  From Lemma~\ref{lemma:cover2},
we have $\tau^*(s',\w')< 0$ or $\tau^*(s'',\w'')<0$.  To be
concrete, say $\tau^*(s',\w')< 0$.  A global minimizer $\v'\in\BB_{s'}$ of smallest index
then also satisfies $\tau^*(s',\v')< 0$.  By the definition of
slice, $s'$ is unadorned, so that $\BB''_{s'}=\MM_{s'}$ and
$\v'\in \MM_{s'}$.  Hence $\{s\}\Ra\{s',s''\}$.
\end{proof}

%\begin{remark}[non-generic fans]\guid{KEOMGHK}
%We have seen that a set $\MM_s$ does not contain any circular fans.
%Assume that $\MM_s$ contains a lunar fan.
%By a process of subdivision and Lemma~\ref{lemma:bjo}, we may assume
%that it has some diagonal $\norm{\w_i}{\w_j}\le\stab$.  By slicing
%along
%the diagonal $\{i,j\}$, we obtain $\{s_1,s_2\}$ that are generic, with
%$\{s\}\Ra\{s_1,s_2\}$.  In this way, we may easily dispose of non-generic
%fans.  In what follows, we may assume that every member of $\MM_s$ is
%generic.
%\end{remark}

\subsection{deformation}

This section proves some deformation results and implements them
as arrows $\{s\}\Ra T$.

\begin{lemma}\guid{HXHYTIJ} 
Let $s$ be a SCS, and let $\v\in\BB''_s$.  For
Let $\w:I(s)\to\ring{R}^3$.
Then  one of the following holds:
\begin{enumerate}
\item $\w\not\in \BB_s$.
\item $\tau^*(s,\w)> \tau^*(s,\v)$.
\item $\tau^*(s,\w)=\tau^*(s,\v)$ and the index of $\w$ is at least that of $\v$.
\end{enumerate}
\end{lemma}

\begin{proof}
If the first two conclusions fail, then $\w\in \BB'_s$.  Since $\v\in\BB''_s$,
it must minimize the index over $\BB'_s$.  Hence the third conclusion holds.
\end{proof}


\begin{lemma}\guid{ODXLSTCv2}\label{lemma:odx2} 
Let $s$ be a SCS and let $\w\in \MM_s$.  Fix $\ell\in I(s)$.
Assume  that $\w_\ell$ is not the pole of a lunar local fan $(V_\w,E_\w,F_\w)$.
Assume that $4h_0 < b_{\ell i}(s)$ for every diagonal $\{\ell,i\}$ at $\ell$.
Then one of the following hard  constraints hold at index $\ell$.
\begin{enumerate}
\item $\norm{\w_\ell}{\w_i}$ attains its lower bound $a_{\ell i}(s)$, for
  some $i\ne \ell$.
\item $\normo{\w_\ell}$ attains its lower bound $2$.
\item There exists $i$ adjacent to $\ell$ such that $\{\ell,i\}\in J(s)$.
\end{enumerate}
\end{lemma}

\begin{proof} 
For a contradiction, assume that none of the enumerated constraints hold.
By Lemma~\ref{lemma:not-circular}, the fan is not circular.
The hypotheses
allow us to use Lemmas~\ref{lemma:fan-open-lunar} and
\ref{lemma:fan-open-generic} to deform $\w$ at $\w_\ell$.

The function $\tau^*$ is decreasing along
the curve of the form \eqref{eqn:move1} such that
$\w_\ell(t)=(1-t) \w_\ell$.
That is, we push the point $\w_\ell$ radially towards the origin.
Explicitly, 
\[
\tau^*(s,w) = c_1 + c_2 \normo{\w_\ell(t)}
\]
for some $c_2>0$ and $c_1$.
We have
$\w(t)\in \BB_s$ for all $t$ positive and sufficiently
small.  This contradicts the minimality properties of $\MM_s$.
\end{proof}

\begin{lemma}\guid{IMJXPHRv2}\label{lemma:imj2}
Let $s$ be a SCS, $\w\in \MM_s$, and $\ell\in I_{str}(s)$.  
Assume  that $\w_\ell$ is not the pole of a lunar local fan $(V_\w,E_\w,F_\w)$.
Assume that $4h_0 < b_{\ell i}(s)$ for every diagonal $\{\ell,i\}$ at $\ell$.
Then one of the following hard constraints holds at $\ell$.
\begin{enumerate}
\item $\norm{\w_\ell}{\w_{\ell+1}}$ attains its lower bound $a_{\ell,\ell+1}(s)$, and
 $\norm{\w_\ell}{\w_{\ell-1}}$ attains its lower bound $a_{\ell,\ell-1}(s)$.
\item $\normo{\w_\ell}$ attains its lower bound $2$.
\item There exists $i$ adjacent to $\ell$ such that $\{\ell,i\}\in J(s)$.
\item Some diagonal $\{\ell,i\}\subset I(s)$ at $\ell$ satisfies
$\norm{\w_\ell}{\w_i}=a_{\ell i}(s)$.
\end{enumerate}
\end{lemma}

\begin{proof} 
For a contradiction, assume that none of the enumerated constraints hold.
By Lemma~\ref{lemma:not-circular}, the fan is not circular.
The hypotheses
allow us to use Lemmas~\ref{lemma:fan-open-lunar} and
\ref{lemma:fan-open-generic} to deform $\w$ at $\w_\ell$.

The set $\{\orz,\w_{\ell-1},\w_\ell,\w_{\ell+1}\}$ lies in a plane $A$.
By the previous
lemma one of the norm constraints is satisfied, say
\[
\norm{\w_\ell}{\w_{\ell+1}}=a_{\ell,\ell+1}(s).
\]
We consider a  deformation of $\w$ that moves
 $\w_\ell(t)$ along a circle through
 $\w_\ell$ with center $\w_{\ell+1}$ in the plane $A$.  Parameterize the curve
so that as $t$ increases, the norm $\normo{\w_\ell(t)}$ decreases.
The function $\tau^*(s,\w)$ is decreasing in $t$.  Explicitly, the
function again depends linearly on $\normo{\w_\ell(t)}$, because
the angle at $\ell$ remains straight.  This contradicts the minimality of
$\MM_s$. 
The result ensues.
\end{proof}

\begin{lemma}\guid{NUXCOEAv2}\label{lemma:nux2}
Let $s$ be a SCS and let $\w\in \MM_s$.   Fix $\ell\in I_{str}(s)$
Assume $j$ is an index adjacent to $\ell$ such  that $\norm{\w_\ell}{\w_j}=a_{\ell j}(s)$.
Assume  that $\w_\ell$ is not the pole of a lunar local fan $(V_\w,E_\w,F_\w)$.
Assume that $4h_0 < b_{\ell i}(s)$ for every diagonal $\{\ell,i\}$ at $\ell$.
Then
one of the following hard conditions holds at index $\ell$.
\begin{enumerate}
\item We have $\norm{\w_\ell}{\w_i}=a_{\ell k}(s)$
for both choices of $i\in I(s)$ adjacent to $\ell$.
\item There exists $i$ adjacent to $\ell$ such that $\{\ell,i\}\in J(s)$.
\item Some diagonal $\{\ell,i\}\subset I(s)$ at $\ell$ satisfies
$\norm{\w_\ell}{\w_i}=a_{\ell i}(s)$.
\end{enumerate}
\end{lemma}

\begin{proof} 
The lemma is a special
case of the previous lemma, unless $\normo{\w_\ell}=2$, which we assume.
Let $i\ne j$ be the other index adjacent to $\ell$.
Assume that the three enumerated parts of the conclusion fail.

We consider a deformation of $\w$ that only moves $\w_\ell$.  We take
the motion of $\w_\ell$ to be
in a circular arc with center $\orz$ through the point $\w_\ell$ and in
the fixed plane determined by $\{\orz,\w_\ell,\w_j,\w_{i}\}$.  
The function $\tau^*(s,\wild)$ is
constant along this curve.  We orient the curve to be increasing
in $\norm{\w_\ell}{\w_{j}}$.  For sufficiently, small $t$, we find that
$\w(t)\in\BB'_s$ has smaller index than $\w$.  This is contrary to the minimizing
properties of $\w\in\MM_s$.

As in the proofs of the previous lemmas, the fan is not circular, and 
the constraints on generic and local fans
allow us to use Lemmas~\ref{lemma:fan-open-lunar} and
\ref{lemma:fan-open-generic}, showing that fan conditions are preserved.
\end{proof}

In the preceding three lemmas, we specifically allow the deformations
$\v(t)$ to occur within a lunar fan, moving a single node that is not a pole
of the lunar fan, as given by Lemma~\ref{lemma:fan-open-lunar}.

The deformation lemmas can be expresed relational
arrows $\{s\}\Ra T$.  The code {\tt check\_completeness.hl} implements
numerous arrows $\{s\}\Ra T$, based on deformations.%
\footnote{\tt deform\_ODXLSTC\_cs,
deform\_IMJXPHR\_cs,
deform\_NUXCOEA\_cs,
deform\_2065952723\_A1\_single,
deform\_2065952723\_A1\_double,
deform\_4828966562,
deform\_4828966562A,
deform\_4828966562B,
deform\_4828966562\_obtuse,
deform\_4828966562A\_obtuse,
deform\_4828966562B\_obtuse,
deform\_6843920790,
deform\_6843920790\_quad,
deform\_6843920790\_tri,
deform\_684\_quadA,
deform\_684\_quadB}
The following lemma shows how this goes
for the first deformation lemma, Lemma~\ref{lemma:odx2}, implemented as
{\tt deform\_ODXLSTC\_cs}.

\begin{lemma}[deform\_ODXLSTC\_cs] \guid{KESHTYS} 
Let $s$ be a SCS, with $\MM_s\ne\emptyset$.  Let $\ell\in I(s)$.
We make the following assumptions.
\begin{enumerate}
\item Assume that for both indices $j$ adjacent to $\ell$, we have $\{\ell,j\}\not\in
J(s)$.
\item Assume that $\ell\not\in I_{lo}(s)$.
\item Assume that  $a_{\ell j}(s)<\beta_{\ell j}(s)$ for all $j\ne \ell$.
\item
Assume that $4h_0 < b_{\ell j}(s)$ for every diagonal $\{\ell,j\}$ at
$\ell$.  
\end{enumerate}
Let $s'$ be a SCS with all parameters
the same as $s$, except that $I_{lo}(s') = \{\ell\}\cup I_{lo}(s)$.
Keeping $\ell$ fixed, we
let $I_\ell\subset I(s)$ be the set of $j\ne \ell$ such that 
$\alpha_{\ell j}(s)=a_{\ell j}(s)$. 
Let $S$ be the set of SCSs indexed by $j\in
I_\ell$,
obtained by
modifying $s$, setting $\beta_{\ell j}(s)=a_{\ell j}(s)$, with other
parameters unchanged.
Then there is an arrow $\{s\}\Ra \{s'\}\cup S$.  
\end{lemma}

\begin{proof}
Indeed, let
$\w\in \MM_s$.  For it to be minimal, there must be a constraint
that blocks the  deformation described in the proof of
Lemma~\ref{lemma:odx2}.
According to the lemma, this forces $\normo{\w_\ell}=2$ or
$\norm{\w_\ell}{\w_j}=a_{\ell j}(s)$ for some $j\ne \ell$.  This latter
condition
is incompatible with $\w\in \MM_s$, unless $j\in I_\ell$.  The result
follows.
\end{proof}


In a similar way, we implement Lemmas~\ref{lemma:imj2} and \ref{lemma:nux2} 
in terms of arrows $\{s\}\Ra T$, as well as the others appearing in the footnote.
We state the results without proof.

\begin{lemma}[deform\_IMJXPHR\_cs]
Let $s$ be a SCS, and $p_0$, $p=p_1=1+p_0$, $p_2 = 2+p_0\in I(s)$.
Assume $p_1\in I_{str}(s)$, $\{p_0,p_1\}\not\in J(s)$, $\{p_1,p_2\}\not\in J(s)$,
$p_1\not\in I_{lo}(s)$.
Assume that for each diagonal of the form $\{p_1,j\}$ we have
$4 h_0 <  b_{p_1 j}$.
Assume that for each diagonal of the form $\{p_1,j\}$ we have
$a_{p_1 j} \ne \beta_{p_1 j}$.  Assume that exactly one $j\in\{p_0,p_2\}$ satisfies
$a_{p_1 j} = \beta_{p_1 j}$.  
Let $s_1$ be the SCS obtained by modifying $I_{lo}(s_1) = \{p\}\cup I_{lo}(s)$ and
keeping the other fields the same as $s$.  
Let $I' = \{j \in I(s) \mid \alpha_{p j}(s) = a_{p j}(s)\}$.
For $j\in I'$, let  $s'_j$ be the the SCS obtained
by modifying $\beta_{p j}(s'_j) = a_{p j}(s)$ and leaving the other fields alone.
Then $\{s\} \Ra \{s_1\} \cup \{s'_j \mid j\in I'\}$.
\end{lemma}

\begin{lemma}[deform\_NUXCOEA\_cs]
Let $s$ be a SCS, and $p_0$, $p=p_1=1+p_0$, $p_2 = 2+p_0\in I(s)$.
Assume $p_1\in I_{str}(s)$, $\{p_0,p_1\}\not\in J(s)$, $\{p_1,p_2\}\not\in J(s)$,
Assume that for each diagonal of the form $\{p_1,j\}$ we have
$4 h_0 <  b_{p_1 j}$.
Assume that for each diagonal of the form $\{p_1,j\}$ we have
$a_{p_1 j} \ne \beta_{p_1 j}$. 
 Assume that exactly one $j\in\{p_0,p_2\}$ satisfies
$a_{p_1 j} = \beta_{p_1 j}$.  Let $p'\in\{p_0,p_2\}$ denote the one that satisfies this.
Let $I' = \{j\in I(s)\mid j\ne p,p',\ a_{p j} = \alpha_{p j}\}$.
Then $\{s\}\Ra \{s'_j \mid j\in I'\}$, where
$s'_j$ is the SCS obtained by modifying $\beta_{p j}(s'_j) = a_{p j}(s)$ and leaving the other fields alone.
\end{lemma}



\subsection{proof outline}

\begin{remark}\guid{YYUNZBF}
We have specified a set $\smain$ of initial SCSs.
We specify a second set $\sterm=\{s_{(6)},s_{(5)},\ldots\}$ 
of terminal SCSs, where
 $s_{(k)}$, for $k=5,6$,  are given by
\[
I=\ring{Z}/k\ring{Z},\quad J=I_{lo}=I_{str}=\emptyset,\quad d(s_{(5)})=0.616,\quad d(s_{(6)})=0.712,
\]
and $a_{ij}=b_{ij}=2$ for all edges, 
and $a_{ij}=\stab$, $b_{ij}=6$ for all diagonals.

We do not list all of the elements of $\sterm$.  There are about twenty
elements of $\sterm$ with $k=3$ and four elements with $k=4$.  The elements
$s_{(5)}$ and $s_{(6)}$ are the only two with $k\ge 5$.
They are list explicitly
in the computer code (\verb!check_completeness.hl!).
\end{remark}



\begin{lemma}
\begin{equation}\label{eqn:init-term}
\smain\Ra \sterm.
\end{equation}
\end{lemma}

\begin{proof}
We prove this lemma by computer search.
   By the definition of this
relation in terms of minimization problems over the compact sets
$\BB_s$,
it appears that some analysis might be required in the proof
of \eqref{eqn:init-term}.  However, this is not the case.  The
preceding
examples show how to construct many relational arrows $S_1\Ra S_2$
from operations of transfer, equivalence, subdivision, slicing, and deformation.
We know that the relation is symmetric and transitive.   The computer
program makes a purely combinatorial search for the arrow
\eqref{eqn:init-term}
as a transitive composition of these operations.  
Hence no further nonlinear optimization is required
beyond
what has already been presented in this text.

There is a trivial amount of real arithmetic in the code that comes
from the triangle inequality.   (If
the constraints $\alpha_{ij},\beta_{ij}$ are such that the triangle
inequality cannot hold, we can conclude that $\MM_s=\emptyset$.)
Similarly, we use the spherical triangle inequality and the inequality
$\Delta\ge0$ in a few places to conlude that $\MM_s=\emptyset$.
But we insist that the proof of \eqref{eqn:init-term} is essentially
a combinatorial search.  The computer code makes no reference
to local fans, working consistently at the level of abstraction of SCSs.
\end{proof}

\begin{lemma}\label{lemma:sterm-empty}\guid{OCBICBY}
\[
\MM_s=\emptyset,
\]
for all $s\in\sterm$.
\end{lemma}

\begin{proof}
When $s\in \sterm$
with $k(s)\le 4$, by a \cc{various inequalities}{}, we show
that $\tau^*(s,\v) \ge0$ for all $\v\in \BB_s$.  This implies for such $s$
that $\MM_s=\emptyset$.  The two cases $s_{(5)}$ and $s_{(6)}$ remain.
They are treated in Secton~\ref{sec:computer-main}, where it is shown
that $\MM_s=\emptyset$ for $ s=s_{(5)}$ and $s_{(6)}$.  This
contradiction shows that $\MM_s=\emptyset$ for all $s\in \smain$,
so that $\tau^*(s,\v)\ge0$. 
\end{proof}

\begin{remark}[Proof outline of main estimate]
The verification of 
Theorem~\ref{lemma:main-estimate}  can now be
carried out as follows.  We assume for a contradiction that
one of the cases of these theorems is false.  By Lemma~\ref{lemma:init}, we have
$\MM_s\ne\emptyset$ for some $s\in \smain$.  
\end{remark}

The main point is that $\BB_s$, for $s\in\smain$ are spaces of relatively large
dimension, but $\BB_s$, for $s\in\sterm$ have relatively small dimension and
can be treated directly by computer.

By Lemma~\ref{lemma:propagate}, and \eqref{eqn:init-term}, we have
$\MM_s\ne\emptyset$ for some $s\in \sterm$. 
This contradicts Lemma~\ref{lemma:sterm-empty}.
  This proves the main estimate.


We remark that the verifications of  different cases in $\smain$ become
highly intertwined through the relation $(\Ra)$.  Each SCS
 in $\sterm$ contributes to the proof of many different cases
of the main estimate.




\subsection{geometric lemmas}

\begin{lemma}\guid{SYNQIWN}\label{lemma:scs-obtuse}
Let $\{\w_0,\w_1,\w_2,\w_3\}$ be a packing of cardinality four.
Assume that $d(\w_0,\w_2)=2$ or $d(\w_2,\w_1)=2$.
Assume that $d(\w_0,\w_3)=2$ or $d(\w_3,\w_1)=2$.
Assume that $\stab\le \norm{\w_2}{\w_3}$.  Then
$\pi/2 \le \dih_V \{\w_0,\w_1 \} \{\w_2,\w_3 \}$.
\end{lemma}

\begin{proof} This is a \cc{1117202051~4559601669}{}.
\end{proof}

The following lemma does not need to be formalized.  Something
equivalent
to this is accomplished by the computer code.


\begin{lemma}\guid{BJOQBJU}\label{lemma:bjo} 
Let $s$ be a SCS.
Assume that $k(s)>3$.
If $k(s)=6$, then assume additionally that
$\stab\le a_{i j}(s)$ and $4\hm < b_{i j}$, 
for every diagonal $\{i,j\}\subset I(s)$.
Then for every  $\w\in\MM_s$,  the local fan $(V_\w,E_\w,F_\w)$ is generic.
\end{lemma}

\begin{proof}
By the definition of SCS, $4\le k(s)$ implies
that  for every edge $\{i,j\}\subset I$, we have
$b_{i j}(s) \le\stab$.

Let $\w\in \MM_s$.  By Lemma~\ref{lemma:09}, the local fan of $\w$  is not circular.
To show that the local fan is generic, it is enough to show that it is not lunar.
We assume for a contradiction that $\{\w_i,\w_j\}$ is the pole of a lunar fan.

We first treat the case  $4\le k(s)\le 5$,
and afterward we will return to the case $k(s)=6$. 
Assuming that  $k(s)\le 5$, the indices $i,j$ differ by at most two.
Also, the definition of SCS gives $m\le 6-k(s)\le 2$, so there is a path from
$i$ to $j$ involving at most one edge with $b_{i j}(s)>2h_0$.
Then by the spherical triangle inequality (Lemma~\ref{lemma:sph-tri-ineq}),
\begin{equation}\label{eqn:pole}
\op{arc}_V(\orz,\w_i,\w_j) \le \op{arc}(2,2,2h_0) + \op{arc}(2,2,\stab) < \pi,
\end{equation}
showing that $\{\w_i,\w_j\}$ is not parallel and not a pole.

Now consider the case $k(s)=6$.  Here, $m=0$, so that $b_{\ell,\ell+1}(s)\le 2h_0$
and $a_{\ell,\ell+1}(s)=2$
for every edge. By the definition of SCS, we have $J(s)=\emptyset$.
Equation~\ref{eqn:pole} shows that the indices $i$ and $j$
must be opposite in the hexagon: $j = i+3$.  By the structure of lunar fans
(Lemma~\ref{lemma:lunar}), $\w_\ell$ is straight for $\ell\ne i,j$.  Without
loss of generality, we may
modify the soft constraints to pass to a stricter SCS $s'$ such that
$\MM_s = \MM_{s'}$ and
$\ell\in I_{str}(s')$, for $\ell\ne i,j$.  We then have $\w\in \MM_{s'}$.

Recall that $i$ is fixed at a pole. 
\claim{We claim that for any edge $\{i,\ell\}$, 
 if  $\norm{\w_{\ell}}{\w_i}>a_{ik}(s)=2$, then
$\normo{\w_\ell}=2$.}  Indeed, this follows directly from the preceding deformation
lemmas.  The conditions of Lemma~\ref{lemma:scs-obtuse} are met.
Hence, the azimuth angle at the pole $i$ is at least $\pi/2$, and
 the solid angle of the lune is at least $\pi$.  By Lemma~\ref{lemma:09},
we have $\tau^*(s',\w)\ge0$, which contradicts $\w\in \MM_{s'}$.
\end{proof}

\begin{lemma}[]\guid{TECOXBM}\label{lemma:2hm-slice1}
\formalauthor{Hoang Le Truong}
Let $s$ be a SCS, and let $\v\in \BB_s$.
Let $\u,\w\in V_\v$ satisfy $2\le\norm{\u}{\w}\le \stab$ where
$\{\u,\w\}\not\in E_\v$.  Then $\u$ and $\w$ are nonparallel.
Moreover,
$C^0\{\u,\w\}\subset \Wdarto(x)$ for all $x\in F$.
\end{lemma}


\begin{proof}  This is a repetition of Lemma~\ref{lemma:2hm-slice}.
\end{proof}


\subsection{$\sterm$}


Here are a few issues that still need to be developed.
\begin{itemize}
\item The treatment of lunes in the code should not be done
as a separate case, but included with the deformation lemmas.
What terminal SCSs correspond to lunes, if any?  $s_{(6)}$?
\end{itemize}
