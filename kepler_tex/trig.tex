



In this chapter, trigonometry is developed analytically.  The basic
trigonometric functions are defined by their power series
representations, and calculus of a single real variable is used to
develop the basic properties of these functions.  We give a brief
review of the definitions and properties.


\subsection{sine and cosine}

The cosine and sine functions are defined by their infinite series:
    \begin{equation}\label{eqn:cos-def}\cos(x) = 1 - x^2/2! + x^4/4! \cdots,\qquad
  \sin(x) = x - x^3/3! + x^5/5! \cdots.
    \index{cos}\index{cosine}\index{sin}\index{sine}
    \end{equation}
Convergence is absolute for every real number $x$.
The series can be evaluated at $0$:
    \begin{equation}\label{eqn:cos0}
    \cos(0) = 1,\qquad \sin(0) = 0.
    \end{equation}

These series may be differentiated term-by-term to establish the identities:
    \begin{equation}\label{eqn:cos'}
    \frac{d \cos(x)}{dx} = -\sin(x),\qquad \frac{ \sin(x)}{dx} = \cos(x).
    \end{equation}

The powers $(\cos(x))^n$ and $(\sin(x))^n$ are conventionally written
$\cos^n(x)$ and $\sin^n(x)$.

Trigonometric identities follow easily from these definitions.  We
give a couple of examples.

\begin{lemma}\label{lemma:circle}\rating{1}
   $$\cos^2(x) + \sin^2(x) = 1.$$
\end{lemma}

\begin{proof}
By basic properties of derivatives and Equation~\ref{eqn:cos'},
the derivative of the function $f(x) = \cos^2(x) +\sin^2(x)$ is
identically zero.   So the function is constant.  From
Equation~\ref{eqn:cos0}, it follows that $f(x)=f(0)=1$.
\end{proof}

\begin{lemma}\rating{1}\label{lemma:sin-add}
  $$\begin{array}{lll}
  \sin(x+y) &= \sin(x)\cos(y) + \cos(x)\sin(y)\\
  \cos(x+y)  &= \cos(x)\cos(y) - \sin(x)\sin(y).
  \end{array}$$
\end{lemma}

\begin{proof}
Fix $y$.  Let
    $$\begin{array}{lll}
    f(x) = &(\cos(x+y) - \cos(x)\cos(y) +
    \sin(x)\sin(y))^2 +\\ & (\sin(x+y) -\sin(x)\cos(y) -
    \cos(x)\sin(y))^2.
    \end{array}$$
The derivative of $f$ is identically zero.  The function is
therefore constant. Also, $f(0)=0$.  Thus, $f$ is identically zero.
If a sum of real squares is zero, the individual terms are zero. The
identities follow.
\end{proof}

\begin{lemma}\rating{1}\label{lemma:cos-even}
The cosine is an even function.  The sine is an odd
function.
    $$\cos(-x) = \cos(x),\quad\sin(-x) = -\sin(x).$$
\end{lemma}

\begin{proof}
The derivative of
    $$(\cos(-x) - \cos(x))^2 + (\sin(-x) +\sin(x))^2$$
is identically zero.  Argue as in the previous lemmas.
\end{proof}

\subsection{periodicity}
\label{sec:pi}

It is known that the cosine function has a unique root between $0$
and $2$. The constant $\pi$ is defined as twice that root.  Thus, by
definition $\cos(\pi/2) = 0$, and the cosine has no root greater
than $0$ and less than $\pi/2$. The $\cos$ function is in fact
positive on the interval $\leftclosed 0,\pi/2\rightopen$.


\begin{lemma}\rating{1}\label{lemma:sin-pi2}
    $\sin (\pi/2) = 1.$
\end{lemma}

\begin{proof}
The derivative of $\sin$ is non-negative between $0$ and $\pi/2$.
Its value at $0$ is $0$.  Thus, $\sin$ is non-negative on
$[0,\pi/2]$.  We can check the identity of the lemma by checking
that the squares of the two sides are equal. Then $\sin^2(\pi/2) =
{1-\cos^2(\pi/2)} = 1$.
\end{proof}

\begin{lemma}\rating{1}\label{lemma:sin-cos}
    $$\sin(\pi/2 - x) = \cos(x).$$
\end{lemma}

\begin{proof}
    Apply the addition law for the sine function,
    $$\sin(\pi/2 - x) = \sin(\pi/2)\cos(-x) + \cos(\pi/2)\sin(-x)$$
    and use
    $\sin(\pi/2) = 1$, $\cos(\pi/2) = 0$.  Then use that $\cos$ is
    an even function.
\end{proof}

Similarly, $\cos(\pi/2 - x) = \sin(x)$ or $\cos(\pi/2 + x) =
-\sin(x)$, $\sin(\pi/2 + x) = \cos(x)$.  Further,
    $$\begin{array}{lll}
      \sin(\pi + x) &= \phantom{-}\cos(\pi/2 + x) &= -\sin(x),\\
      \cos(\pi + x) &= -\sin(\pi/2 + x) &= -\cos(x),\\
      \sin(2\pi + x) &= -\sin(\pi + x) &= \phantom{-}\sin(x),\\
      \cos(2\pi + x) &= -\cos(\pi + x) &= \phantom{-}\cos(x).
      \end{array}$$


\subsection{tangent}
\label{sec:tangent}

\begin{definition}[tangent]\label{def:tan}
Let $\tan(x) = \sin(x)/\cos(x)$, defined when $\cos(x)\ne0$.
\index{tangent}
\end{definition}


\begin{lemma}\rating{1}\label{lemma:tan-add}
    If $\cos(x)\ne 0$, $\cos(y)\ne 0$, and $\cos(x+y)\ne0$ then
    $$\tan(x+y) = \frac{\tan(x) + \tan(y) }{ 1 - \tan(x)\tan(y)}$$
\end{lemma}

\begin{proof}
  Divide the first line of Lemma~\ref{lemma:sin-add} by the second
  line of the same lemma.
\end{proof}

\begin{lemma}\rating{1}\label{lemma:tan-pi4}
    $$\tan(\pi/4) = 1.$$
\end{lemma}

\begin{proof}
    $$\tan(\pi/4) = \sin(\pi/2-\pi/4)/\cos(\pi/4) =
    \cos(\pi/4)/\cos(\pi/4) = 1.$$
\end{proof}


\subsection{arctangent}

We review the properties of the arctangent function.

\begin{definition}[arctangent]\label{definition:arctan}
There is a unique function $\arctan:\ring{R}\to\ring{R}$ with
image $(-\pi/2,\pi/2)$ such that
    $$\tan(\arctan x) =x.$$
\index{arctangent}
\end{definition}

If $-\pi/2 < x < \pi/2$, then also $\arctan(\tan(x)) = x$. In
particular,
    $$\arctan(1) = \arctan(\tan(\pi/4)) = \pi/4.$$


The function $\arctan$ is differentiable with derivative
    $$\frac{d \arctan(x)}{dx} = \frac{1}{1 + x^2}.$$
The derivative is everywhere positive, and the function $\arctan$ is
strictly increasing.


It will often be necessary to use $\arctan(y/x)$ when $x$ is near $0$.
For that reason we introduce the following variant of $\arctan$:
$$
\atn: \ring{R}^2\setminus\{(0,0)\} \to (-\pi,\pi].
$$
$$
\atn(x,y) = \begin{cases}
   \arctan(y/x) & x > 0\\
   \pi/2- \arctan(x/y) & y > 0 \\
   \pi + \arctan(y/x) & x< 0,\  y\ge 0\\
   -\pi/2- \arctan(x/y) & y< 0 \\
\end{cases}
\index{arctan}
$$
There is some overlap between cases. Nevertheless, 
this function is well-defined.  
This function is the {\it arctan2} function of ANSI C.  It gives the
angular argument of $(x,y)$ (with the branch cut along the negative axis).
That is, $x = r\cos\phi$, $y=r\sin\phi$, with $\phi=\atn(x,y)$.


\subsection{inverse trig}

Other inverse trigonometric functions will generally be reduced to
the arctangent.

\begin{definition}[arccos]\label{definition:arccos}
$\arccos y$ is the function on the interval $[-1,1]$
taking values in $[0,\pi]$ that is the inverse function of $\cos$:
    $$\begin{array}{lll}
        y\in [-1,1] &\Rightarrow \cos(\arccos y) = y\\
        x\in[0,\pi] &\Rightarrow \arccos(\cos x) = x
    \end{array}$$
\index{arccos}
\end{definition}

\begin{lemma}\rating{2}\label{lemma:sin-arccos} If $y\in[-1,1]$, then
    $$\sin(\arccos(y)) = \sqrt{1-y^2}.$$
\end{lemma}

\begin{proof}
    The range of $\arccos(y)$ is $[0,\pi]$.  On this interval, $\sin$
    is nonnegative.  Thus, we can check the identity by squaring
    both sides.  It then follows from the circle identity
    (Lemma~\ref{lemma:circle}).
\end{proof}


Our preference is to remove the $\arccos$ function whenever
possible, by replacing it with the $\atn$ function through the
following identity.  
%We will occasionally be forced to revert to
%$\arccos$ when we are near the endpoints $-1$ and $1$ of its domain.

\begin{lemma}\rating{1}\label{lemma:arccos-arctan}  If $y\in [-1,1]$, then
    $$\arccos(y) = \pi/2 - \atn({ \sqrt{1-y^2}},{y}).$$
\end{lemma}

\begin{proof} The endpoints $y=\pm1$ can be checked directly.
If $y\in (-1,1)$,  $x = \arccos(y)$, 
$z = \arctan(y/\sqrt{1-y^2})$, then
    $-\pi/2 < \pi/2 - x < \pi/2$, and $-\pi/2 < z < \pi/2$.  It is
    therefore enough to check that
        $\tan(\pi/2 - x) = \tan(z)$.
    But
        $$\tan(\pi/2-x) = \frac{\cos(x)}{\sin(x)} = \frac{y}{
        \sin(\arccos(y))} = \frac{y}{ \sqrt{1-y^2}} = \tan(z).$$
\end{proof}

\begin{definition}[arcsine]\label{def:arcsin}
$\arcsin y$ is the function on the interval $\leftclosed
-1,1\rightclosed$ taking values in $[-\pi/2,\pi/2]$ that is the
inverse function of $\sin$:
    $$\begin{array}{lll}
        y\in [-1,1] &\Rightarrow \sin(\arcsin y) = y\\
        x\in[-\pi/2,\pi/2] &\Rightarrow \arcsin(\sin x) = x
    \end{array}$$
\index{arcsine}
\end{definition}

As we do not have need for the arcsine function, we do not develop
any of its properties.





\section{Triangle Inequality}

The set $\ring{R}^n$ is defined as the set of functions
$f:\ring{N}\to\ring{R}$ such that $f(i) = 0$ when $n\le i$. Defined
this way, there are natural inclusions
    $$\ring{R}^0 \subset \ring{R}^1 \subset \ring{R}^2 \cdots$$

We let $\ring{R}^\infty$ be the union of all $\ring{R}^n$.  It is
the set of function $f:\ring{N}\to\ring{R}$ that have finite
support.  We write $v_i$ for the value of the function $v$ at $i$.
We call elements of $\ring{R}^\infty$ {\it vectors}.  There is a
zero vector $0$, defined as the function that is identically zero.

There is an addition and scalar multiplication on $\ring{R}^\infty$
defined by addition and multiplication of functions.
    $$\begin{array}{lll}
    (u + v)_i &= u_i + v_i.\\
    (s u)_i & s u_i,\quad s\in\ring{R}.\\
    \end{array}
    $$
The addition is commutative and associative, and gives
$\ring{R}^\infty$ the properties of a vector space. If $u$ and
$v$ both lie in some $\ring{R}^n$, then so do $u+v$ and $s u$.
We define the difference of two vectors as $u - v = u + (-1) v$.

%\begin{definition}[collinear]
%A set of vectors $V$ is collinear, if there is vector $u$ such that
%for every $v,v'\in V$ there exists $t$ such that $v - v' = t u$.
%\end{definition}

There is a dot product
$$(\cdot):\ring{R}^\infty\to\ring{R}^\infty\to\ring{R}$$ defined by
    $$u\cdot v = \sum_{i=0}^\infty u_i v_i.$$
Only finitely many terms in the sum are nonzero, so it is actually a
finite sum.  The dot product satisfies the following
properties:
    $$\begin{array}{lll}
        u \cdot (v + w) &= u \cdot v + u \cdot w\\
        (u + v)\cdot w &= u \cdot w + v \cdot w\\
        (s u)\cdot w &= s(u \cdot w) = u \cdot (s w)\\
        0 &\le u\cdot u\\
    \end{array}$$


There is a norm\index{norm}
$$|u| = \sqrt{u\cdot u}.$$
It satisfies $| s u | = |s| \, |u|$.  We have $|u|=0$  if and
only if $u=0$, the zero function.

\begin{lemma}[Cauchy-Schwartz inequality]\rating{5}
    $$|u \cdot v| \le |u|\,|v|.$$
Equality holds exactly when $|v|u = \pm |u|v$.  Furthermore,
$u\cdot v = |u|\,|v|$ holds exactly when $|v| u = |u| v$.
\index{Cauchy-Schwartz inequality}
\end{lemma}

\begin{proof}
   Let $w = |v| u \pm |u| v$.  Then expanding $w\cdot w$ we get
    $$0\le w\cdot w = 2|u|^2|v|^2 \pm 2|u|\, |v| (u\cdot v) =
    2|u|\,
    |v| (|u|\, |v| \pm (u \cdot v)).$$
    If $2|u| \,|v| = 0$, then $u$ or $v$ is zero, and the result
    easily follows.  Otherwise divide both sides of the inequality
    by the positive quantity $2 |u| \,|v|$ to get the result.
\end{proof}

\begin{lemma}[triangle inequality]\rating{5}
  $$
  |u + v| \le |u| + |v |.
  $$
Equality holds exactly when $|v|u = |u|v$.
\end{lemma}

\begin{proof}
Both sides are nonnegative; it is enough to compare the squares of
both sides.  By the Cauchy-Schwartz inequality,
    $$|u + v|^2 = u\cdot u + 2 u\cdot v + v\cdot v \le
      u\cdot u + 2 | u|\,|v| + v\cdot v = (|u|+|v|)^2.
    $$
The case of equality follows from the case of equality in the
Cauchy-Schwartz inequality.
\end{proof}

There is a distance function $d(u,v) = | u - v|$ that makes
$\ring{R}^\infty$ into a metric space.  The subsets $\ring{R}^n$ are
metric subspaces.
\index{metric space}






\subsection{coordinate}

Let $\{v_1,v_2,v_3,v_4\}$ be a set of vectors of cardinality four.
There are $6$ (four choose two) different pairs of vectors. We let
$y_{ij} = |v_i-v_j|$ and $x_{ij}=y_{ij}^2$.


%% WW repeated DEF.
\begin{definition}[$\Delta$]\label{def:delta}  Let 
$$
\begin{array}{lll}
\Delta(x_1,\ldots,x_6) &= x_1 x_4 (- x_1+x_2+x_3- x_4+x_5+x_6)+\\&
            x_2 x_5 (x_1- x_2+x_3+x_4- x_5+x_6)
            +x_3 x_6 (x_1+x_2- x_3+x_4+x_5- x_6)
            - \\&x_2 x_3 x_4- x_1 x_3 x_5- x_1 x_2 x_6- x_4 x_5 x_6
\end{array}
$$
\end{definition}

We write $\Delta_j$ for the $j$th partial derivative of $\Delta$. 
Let $D = \det(v_2-v_1,v_3-v_1,v_4-v_1)$.
Lemma~\ref{tarski:cm4} asserts that 
  $$
  4 D^2 = \Delta(x_{12},x_{13},x_{14},x_{34},x_{24},x_{23}).
  $$
In particular, the polynomial $\Delta$ is positive on values $x_{ij}$
that come from vectors $\{v_1,\ldots,v_4\}$ of positive determinant.
\index{determinant}





\subsection{affine geometry}

We write $\card(S)$ for the cardinality of a finite set $S$.\index{card}
\index{cardinality}

%% WW This section is repeated verbatim in tarski.tex

\begin{definition}[affine]\label{def:aff} 
 If $S = \{v_1,v_2,\ldots,v_k\}$ 
and $S'=\{v_{k+1},\ldots,v_n\}$ are  finite sets, then
set
	$$\begin{array}{lll}
      \op{aff}\, S &= \{t_1 v_1 +\cdots t_k v_k \mid
	t_1 +\cdots+t_k = 1\}.\\
        \op{aff}_{\pm} (S,S') &= \{t_1 v_1 +\cdots t_n v_n \mid
	t_1 +\cdots+t_n = 1, \pm t_j \ge 0, \text{ for } j>k.\}.\\
        \op{aff}^0_{\pm} (S,S') &= \{t_1 v_1 +\cdots t_n v_n \mid
	t_1 +\cdots+t_n = 1, \pm t_j > 0, \text{ for } j>k.\}.\\
		\end{array}
        $$
\index{aff}\index{affine}
\end{definition}

\begin{definition}[convex hull]  If $S = \{v_1,v_2,\ldots,v_n\}$ is a finite set
of points in $\ring{R}^3$, then
set
	$$
        \begin{array}{lll}
          \op{conv}\, S &= \op{aff}_+\, (\emptyset,S)\\
	   \op{conv}^0 S &= \op{aff}^0_+\, (\emptyset,S).\\
           \end{array}
        $$
\index{conv}\index{convex hull}
\end{definition}


\begin{definition}[cone]
Let $S=\{v_1,\ldots,v_n\}$ be a finite set of points in 
$\ring{R}^3$.  Let $v\in\ring{R}^3$. Set
  $$\begin{array}{lll}
  \op{cone}(v,S) &= \op{aff}_+(\{v\},S)\\
  \op{cone}^0(v,S) &= \op{aff}^0_+(\{v\},S)\\
  \end{array}
  $$
\index{cone}
\end{definition}

\begin{definition}[Voronoi cell $\Omega$] 
Let $S$ be a finite set of points in 
$\ring{R}^3$.  Let $v\in\ring{R}^3$. Set
  $$
  \Omega(v,S) = \{x \mid |v-x| < |w-x|, \forall w\in S\setminus\{v\}\}
  $$
\end{definition}
	
\begin{definition}[line]	
Any set of the form $\op{aff}\{v,w\}$ for some $v\ne w$ is called a 
 {\it line.}
\end{definition}

\begin{definition}[collinear]  A set $S$ is collinear if there exists
a line that contains every point of $S$.
\index{collinear}
\end{definition}

\begin{definition}[plane, half plane]	
If $A=\op{aff}\{u,v,w\}$ for some set $\{u,v,w\}$ that is not collinear,
then $A$ is a {\it plane.}  Sets $\op{aff}(\{u,v\},\{w\})$, with
$\{u,v,w\}$ not collinear, are called half-planes.
\end{definition}

\begin{definition}[coplanar] A set $S$ is  coplanar if there exists
a plane that contains every point of $S$.
\index{coplanar}
\end{definition}

\begin{definition}[half space] A set $\op{aff}_{\pm}(\{u,v,w\},\{v'\})$,
with $\{u,v,w,v'\}$ not coplanar, is called a half-space.  If
we replace $\op{aff}_{\pm}$ with $\op{aff}_{\pm}^0$, the set is an
{\it open half-space}.
\end{definition}

\section{Angle}



If $u,v$ are given vectors with $u$ and $v$ nonzero, then by the
Cauchy-Schwartz inequality,
    $$-1 \le \frac{u\cdot v}{|u|\,|v|} \le 1.$$

\begin{definition}[angle]\label{def:angle}
There is a unique $\gamma$ with $0\le\gamma\le\pi$ such that
    $$\cos\gamma = \frac{u\cdot v}{|u|\,|v|}.$$
It is the {\it angle} formed by $u$ and $v$ at the origin. More
generally, the angle formed by $u$, and $v$ at $w$ is defined to be
the angle formed by $u-w$ and $v-w$ at the origin.
\index{angle}
\end{definition}

By the relation between $\arccos$ and $\atn$
(Lemma~\ref{lemma:arccos-arctan}), %if $|u\cdot v|\ne |u|\,|v|$,
%then 
the angle $\gamma$ formed by $u$ and $v$ at the origin is
    \begin{equation}\label{eqn:angle}
    \gamma = \frac{\pi}2 - \atn\left ({\sqrt{(|u|^2|v|^2 -
    (u\cdot v)^2)}}, {u\cdot v}\right).
    \end{equation}

Let $\ups$ (the symbol is a greek upsilon, which is written with a
wider stroke than a roman vee) be the polynomial
    $$\ups(x,y,z) = -x^2 - y^2 - z^2 + 2 x y + 2 y z + 2 z x.$$
%% WW Repeated def (tarski.tex)
This polynomial factors
    $$\ups(a^2,b^2,c^2) = (-a + b + c) (a - b + c) (a + b - c) (a + b +
    c).$$
If there are vectors $v_a$, $v_b$, and $v_c$ such that $a = |v_b
- v_c|$, $b = |v_a - v_c|$, $c = |v_a - v_b|$, then $0\le
\ups(a^2,b^2,c^2)$ follows from the triangle inequality applied to
each factor.  By the case of equality in Cauchy-Schwartz
inequality, the polynomial is strictly positive unless $v_a$,
$v_b$, and $v_c$ are collinear.



\begin{lemma}[law of cosines]\rating{5}
Let $v_a,v_b,v_c$ be vectors with $v_a\ne v_c$, $v_b\ne v_c$.
    Let $\gamma$ be the angle formed by vectors $v_a$ and $v_b$ at $v_c$.  Let $a
    = |v_b - v_c|$, $b = |v_a - v_c|$, and $c = |v_a - v_b|$.  Then
        $$c^2 = a^2 + b^2 - 2 a b \cos\gamma.$$
Or in terms of $\gamma$,
    \begin{equation}\label{eqn:arc}
    \gamma = \arccos(\frac{a^2 + b^2 - c^2}{2 a b}).
    \end{equation}
Moreover, 
%if $v_a$, $v_b$, and $v_c$ are not collinear then
    $$\gamma=
    \pi/2 - \atn({\sqrt{\ups(a^2,b^2,c^2)}},{ a^2 + b^2 - c^2}).
    $$
\end{lemma}\index{arc}\index{law of cosines} 

\begin{proof}
    $$\begin{array}{lll}c^2 &= |v_b - v_a|^2 = ((v_b - v_c) - (v_a - v_c))\cdot ((v_b - v_c) - (v_a -
    v_c)) \\ &= a^2 + b^2 - 2 (v_b - v_c)\cdot (v_a - v_c) = a^2 +b ^2 - 2 a b
    \cos\gamma.
    \end{array}$$
    Solve this equation for $\gamma$.  The final formula
    comes by the $\arccos$-$\atn$ relation Lemma~\ref{lemma:arccos-arctan}.      
   We must exclude collinear vectors in the final formula to avoid
    a zero in the denominator.
\end{proof}


\begin{definition}[$\arc$]
We write $\arc(a,b,c)$ for the right-hand side of Equation~\ref{eqn:arc},
that is, the angle $\gamma$ expressed as a function
of the lengths $a,b,c$.  Set 
  $$\arc_V(u,v,w) = \arc(|u-v|,|u-w|,|v-w|) = 
    \arccos\left(\frac{(v-u)\cdot (w-u)}{|v-u| |w-u|}\right).$$
\index{arc}
\end{definition}


\begin{lemma}[law of sines]\rating{20}
   Let $\gamma$ be the angle formed by $v_a$ and $v_b$ at $v_c$.  Let $a
    = |v_b - v_c|$, $b = |v_a - v_c|$, and $c = |v_a - v_b|$.  Then
        $$2 a b \sin\gamma = \sqrt{\ups(a^2,b^2,c^2)}.$$
\end{lemma}

\begin{proof}  Both sides are non-negative.  It is enough to check
that their squares are equal.  By the law of cosines:
      $$4 a^2 b^2 \sin^2\gamma = 4 a^2 b^2 (1-\cos^2\gamma) = (4 a^2 b^2 - (a^2 + b^2 -
      c^2)^2) = \ups(a^2,b^2,c^2).$$
\end{proof}

\begin{remark}  Although we have not yet discussed area, we remark
that $(a b \sin\gamma)/2$ can be interpreted as the area of the
triangle with vertices $v_a$, $v_b$, and $v_c$.  The lemma then
computes the area of a triangle.
\end{remark}





\subsection{cross product}% uses angle.

\begin{definition}[cross product]   Let $u =(x,y,z)$ and $u' = (x',y',z')$.  
Let the cross product be defined
by
    $$
    u \times u' = (y z' - y' z, z x' - x z', x y' - y x').
    $$
\index{cross product}
\end{definition}

\begin{lemma}\rating{20}  
Suppose that $u$ and $v$ form angle $\gamma$ at the origin, then
    $$|u \times v| = |u|\,|v|\sin\gamma.$$
\end{lemma}

\begin{proof}
   Both sides are non-negative, so it is enough to compare the
   squares of both sides.  The square of the left-hand side is
   $$
   \begin{array}{lll}
   (y z'- y'z)^2 + (z x' - x z')^2 + (x y' - y x')^2 &=
   (x^2 + y^2 + z^2)(x'^2 + y'^2 + z'^2) - (x x' + y y' + z z')^2
   \\&= |u|^2|v|^2 - (u\cdot v)^2 = |u|^2|v|^2 \sin^2\gamma.
   \end{array}
   $$
\end{proof}


\begin{lemma}\rating{20}
    $$
    u\times v = -v\times u,\quad
    (u\times v)\cdot w = (v\times w)\cdot u.
    $$
\end{lemma}

\begin{proof} These are elementary calculations.
\end{proof}



\subsection{dihedral angle}


\begin{definition}[dihedral angle]\label{def:dih} Assume that $w_0\ne w_1$.
We write $\dih_V(\{w_0,w_1\},\{w_2,w_3\})$ for the angle $\gamma\in[0,\pi]$
formed
by 
    $$
    v'_a = (v_c\cdot v_c) v_a - (v_c\cdot v_a) v_c\quad\text{and }v'_b =
            (v_c\cdot v_c) v_b - (v_c\cdot v_b) v_c,
    $$
where $v_a = w_2-w_0$, $v_b=w_3-w_0$ and $v_c=w_1-w_0$.  We call it
the dihedral angle formed by $w_2$ and $w_3$ along $\{w_0,w_1\}$.
\index{dih}
\index{dihedral angle}
\end{definition}

Up to positive scalars, $v'_a$ and $v'_b$ are the projections of
$v_a$ and $v_b$ to a plane perpendicular to $v_c$.  The
dihedral angle is the angle between the projections.

The dihedral angle is unchanged if $v_c$ is replaced by $s v_c$ with
$s\ne0$. The dihedral angle is unchanged if $v_a$ is replaced with
$s v_a + t v_c$ with $0 < s$ and $t$ arbitrary.  It is unchanged if
$v_b$ is replaced with $s v_b + t v_c$ with $0 < s$ and $t$
arbitrary.  In particular, the dihedral angle formed by $v_a$ and
$v_b$ along $v_c$ is the same as that formed by $v_a/|v_a|$ and
$v_b/|v_b|$ along $v_c/|v_c|$.

The dihedral angle is degenerate and will not be used when $v_c =
0$, $v'_a = 0$, or $v'_b = 0$.



\begin{lemma}[spherical law of cosines]\label{lemma:sloc}\rating{100}
Let $\gamma$ be the dihedral angle formed by $v_a$ and $v_b$ along
$\{v_0,v_c\}$.  Let $a$, $b$, and $c$ be the
angle between $v_b$ and $v_c$, $v_a$ and $v_c$, and $v_a$ and
$v_b$, respectively. %Assume $v_c\ne v_0$.  
Assume that $\{v_0,v_a,v_c\}$ is not
collinear. Assume that $\{v_0,v_b,v_c\}$ is not collinear.
Then
    $$\cos\gamma = \frac{\cos c - \cos a \cos b}{\sin a\sin b}.$$
\end{lemma}

\begin{remark}  Although we have not yet discussed spherical
triangles, we remark that $a$, $b$, and $c$ may be interpreted as
the arclengths of the sides of a spherical triangle with
vertices $v'_a/|v'_a|$, $v'_b/|v'_b|$, and $v'_c/|v'_c|$,
where $v'_i = (v_i-v_0)$.  Also,
$\gamma$ measures the angle of the spherical triangle opposite the
side $c$.
\end{remark}

\begin{proof}  Let $v'_i = v_i - v_0$, for $i=a,b,c$.  Having
made this change, we drop the primes from the notation.
By examining the formula giving the dihedral angle, we see that the
dihedral angle is unchanged if $v_a$, $v_b$, and $v_c$ are replaced
by $v_a/|v_a|$, $v_b/|v_b|$, $v_c/|v_c|$, respectively.  Hence
may now assume that $|v_a|=|v_b|=|v_c|=1$.

Let $v'_a$ and $v'_b$ be the vectors in Definition~\ref{def:dih}.
By the law of cosines, we have
        $$\cos\gamma = \frac{v'_a\cdot v'_b}{|v'_a|\,|v'_b|}.$$
We compute the length of $v'_a$ (keeping in mind that $v_a$, $v_b$,
and $v_c$ all have unit length):
        $$
        |v'_a|^2 = v'_a\cdot v'_a =
        (v_a - (v_c\cdot v_a)v_c)\cdot (v_a - (v_c\cdot v_a) v_c) =
        1 - (v_c\cdot v_a)^2 = \sin^2 b.
        $$
So $|v'_a| =\sin b$. Similarly, $|v'_b| = \sin a$.  This gives
the denominator in the spherical law of cosines. To compute the
numerator, we expand the dot product:
    $$
    v'_a\cdot v'_b = (v_a - (v_c\cdot v_a) v_c)\cdot (v_b - (v_c\cdot v_b) v_c)
    = (v_a\cdot v_b) - (v_c\cdot v_a) (v_c\cdot v_b) = \cos c - \cos
    a \cos b.
    $$
The identity follows.
\end{proof}

\begin{lemma}[spherical law of cosines - second form]\rating{80}
Let $v_a,v_b,v_c$ be three points in $\ring{R}^3$.
Let $\alpha,\beta,\gamma$ be the dihedral angles: 
   $$
   \begin{array}{lll}
     \alpha &= \dih_V(\{v_0,v_a\},\{v_b,v_c\})\\
     \beta &= \dih_V(\{v_0,v_b\},\{v_a,v_c\})\\
     \gamma&= \dih_V(\{v_0,v_c\},\{v_b,v_a\})\\
     \end{array}
   $$
Let $c$ be the
angle between $v_a$ and $v_b$ at $v_0$. 
Assume that $\{v_0,v_a,v_b,v_c\}$ is not coplanar.
Then
    $$
    \cos c = \frac{\cos \gamma + \cos \alpha \cos \beta}
     {\sin \alpha\sin \beta}.
    $$
\end{lemma}

\begin{proof}
Let $a$ be the angle between $v_b$ and $v_c$, and let $b$ be the angle
between $v_a$ and $v_c$ at $v_0$.
Let $A=\cos a$, $B=\cos b$, $C=\cos c$,
$A'=\sin a$, $B'=\sin b$, $C'=\sin c$.  By the
spherical law of cosines, we have
   $$\sin^2\beta = 1-\left(\frac{B-A C}{A' C'}\right)^2
     = \frac{p}{A'^2 C'^2},$$
where $p=1-A^2 - B^2 - C^2 + 2 A B C$.
In particular, $p\ge 0$.
Computing $\sin^2\alpha$ and the remaining terms in the same way, we get
   $$
   \begin{array}{lll}
     \sin\alpha\sin\beta &= \frac{p}{A' B' C'^2}\\ 
      \\
     \cos\gamma + \cos\alpha \cos\beta &=
         \frac{C - A B}{A' B'} + \frac{A - B C}{B' C'} \frac{B - A C}{A' C'}
         = \frac{p C}{A' B' C'^2}.\\
    % C &= \frac{\cos\gamma + \cos\alpha \cos\beta}{\sin\alpha \sin\beta}\\
   \end{array}
   $$
The result follows.
\end{proof}




\begin{lemma} \label{lemma:dihform}\rating{80} Let $v_0,v_1,v_2,v_3$ 
be vectors with $v_3\ne0$, $v'_1\ne 0$, and $v'_2 \ne 0$ (where $v_1'$ and
$v_2'$ are computed as in Definition~\ref{def:dih}).  
Let $\gamma$ be the dihedral angle formed
by $v_2$ and $v_3$ along $\{v_0,v_1\}$. Let
    $$(x_1,\ldots,x_6) = 
    (x_{01},x_{02},x_{03},x_{23},x_{13},x_{12}),
    \text{ where } x_{ij}=|v_i-v_j|^2.$$
Let $\Delta_4$ be the partial derivative of $\Delta(x_1,\ldots,x_6)$ with
respect to $x_4$.
The dihedral angle $\gamma=\dih_V(\{v_0,v_1\},\{v_2,v_3\}$
is given by
    $$
    \gamma=\arccos(\frac{\Delta_4(x_1,\ldots,x_6)}{\sqrt{
    \ups(x_1,x_2,x_6)\ups(x_1,x_3,x_5)}}).
    $$
%Assuming that $\gamma\ne 0,\pi$, 
It is also given by
    $$
    \gamma=\frac{\pi}{2} - \atn
     ({\sqrt{4 x_1 \Delta(x_1,\ldots,x_6)}},{\Delta_4(x_1,\ldots,x_6)}).
    $$
\end{lemma}
%% pi/ 2. -  arctan(  deltax4/ (sqrt (4. * x1 * delta)))

\begin{proof}
Let $\beta$ be the angle between $v_1$ and $v_2$ at $0$.
    By expanding definitions and dot products
    $$
    v'_2\cdot v'_2 = (v_1\cdot v_1) ((v_1\cdot v_1)(v_2\cdot v_2) -
    (v_1\cdot v_2)^2) =  x_1^2 x_2 \sin^2 \beta = \frac{1}{4}
    x_1
    \ups(x_1,x_2,x_6).
    $$
    Similarly,
    $$v'_3 \cdot v'_3 = \frac{1}{4} x_1 \ups(x_1,x_3,x_5).$$

Let $y_i = \sqrt{x_i}$. Then
    $$\begin{array}{lll}
    v'_2\cdot v'_3 &= (v_1\cdot v_1)((v_1\cdot v_1)(v_2\cdot v_3) -
    (v_1\cdot v_2)(v_1\cdot v_3) ) \vspace{6pt} \\  &
    = x_1 \left(\frac{ x_1 (x_2 + x_3 -
    x_1)}{2} - \frac{(x_1 + x_2 - x_6)(x_1 + x_3 -
    x_5)}{4} \right)\vspace{6pt}\\&
    %= \frac{x_1}{4} (2 x_1 (x_2+x_3-x_4) -
    %(x_1+x_2-x_6)(x_1+x_3-x_5)) \vspace{6pt}\\&
    = {x_1\Delta_4(x_1,\ldots,x_6)}/{4}.
    \end{array}
    $$
The result follows in terms of $\arccos$.

To translate to the $\atn$, 
we use the $\arccos$-$\atn$ identity
and the following polynomial identity
    $$
    \frac{16}{x_1^2}(|v'_2|^2 |v'_3|^2 - (v'_2\cdot v'_3)^2) =
    \ups(x_1,x_2,x_6)\ups(x_1,x_3,x_5) - \Delta_4(x_1,\ldots,x_6)^2
    = 4 x_1 \Delta(x_1,\ldots,x_6).
    $$
\end{proof}


\subsection{beta cone}

\begin{definition}[arc length]  The arclength of a geodesic arc on a unit sphere
centered at $v_0$ from point $v_1$ to $v_2$ is the angle formed by
$v_1$ and $v_2$ at $v_0$.
\index{arclength}
\end{definition}


\begin{lemma}\label{lemma:beta-cone}\rating{100}
Let $v_0$, $v_1$, $v_2$, $v_3$ be points in $\ring{R}^3$.   
Assume that $v_0\ne v_1,v_2,v_3$.  Assume
that $\dih_V(\{v_0,v_3\},\{v_1,v_2\})=\pi/2$.  Let
$\psi = \arc_V(v_0,v_2,v_3)$ and $\theta=\arc_V(v_0,v_1,v_2)$. 
Then $\dih_V(\{v_0,v_1\},\{v_2,v_3\}) = \beta_\psi(\theta)\in[0,\pi/2]$,
where
  $$
      \cos^2\beta_\psi = (\cos^2\psi-\cos^2\theta)/(1-\cos^2\theta).
  $$
\end{lemma}

\begin{proof}  On the unit sphere centered at $v_0$, we see that
$\dih$ is the angle on a spherical right triangle,
with opposite side of arclength $\psi$ and adjacent sides $\alpha$
and $\theta$, for some $\alpha$. 
 Since this is a spherical right triangle with hypotenuse
$\theta$, by the spherical law of cosines, we have
   \begin{equation}\label{eqn:rt}
     \cos\theta = \cos\alpha \cos\psi.
     \end{equation}
By the spherical law of cosines again, we have
    $$
    \cos\beta = \frac{\cos\psi - \cos\alpha\cos\theta}{\sin\alpha\sin\theta}.
    $$
Square this equation and eliminate $\alpha$ with Equation~\ref{eqn:rt}.
The result follows.
\end{proof}




\subsection{Euler angle sum}
\begin{lemma}[Euler triangle]\label{lemma:euler}\rating{300}
Let $v_0,v_1,v_2,v_3$ be points in $\ring{R}^3$. 
Let 
  $$(y_1,\ldots,y_6) =(y_{01},y_{02},y_{03},y_{23},y_{13},y_{12}),
   \text{ where } y_{ij}=|v_i-v_j|.$$
Set
$x_i = y_i^2$.   
and
    $$
    p = y_1 y_2 y_3 + y_1 (w_2\cdot w_3) + y_2 (w_1\cdot w_3) + y_3
    (w_1\cdot w_2).
    $$
where $w_i = v_i- v_0$.
Let $$\alpha_i =\dih_V(\{v_0,v_i\},\{v_j,v_k\})$$
where $\{i,j,k\}=\{1,2,3\}$.
Assume that $\Delta(x_1,\ldots,x_6)>0$. 
Then
    $$
    \alpha_1+\alpha_2+\alpha_3 - \pi
     = {\pi} - 2\atn({\Delta(x_1,\ldots,x_6)^{1/2}},{2 p}),
    $$
for three given dihedral angles $\alpha_i$.
\end{lemma}

\begin{proof}
%% I checked all the details of this proof in 
%% Math'ca on May12,2007
The angles are unchanged if the vectors $w_i$ are rescaled so that
$|w_i|=1$.  The given formula is also unchanged under rescalings:
the factor $a$ is homogeneous of degree $3$ under a change $w_i
\mapsto t w_i$ for $t>0$, and so is $\sqrt{\Delta}$ by the
formula for $\Delta$.  Thus, we may assume that $|w_i|=1$, for
$i=1,2,3$. We have $y_1=y_2=y_3=1$.  It is convenient to use
different notation $a=x_4$, $b=x_5$, $c=x_6$ for the other
variables. Expanding the dot products in $p$ by the law of cosines
we have
    $$2 p = 8 - (a+b+c).$$

We have $$\Delta(x_1,\ldots,x_6) = \Delta(1,1,1,a,b,c) =
    \ups(a,b,c) - a b c.$$
Since $0 <\Delta$, the arctangent formula
in Lemma~\ref{lemma:dihform} 
applies for the dihedral angles $\alpha_i$. Making
this substitution and clearing the $3$ from the denominator, the
desired identity now takes the form $f(a,b,c)=0$, where
    $$
    f(a,b,c)= -\pi/2 - \sum_{i=1}^3\arctan(u_i/\sqrt{\Delta}) +
    2\arctan(2 p/\sqrt{\Delta}),
    $$
for some rational functions $u_i$ of $a,b,c$.  We prove that this
trig identity holds whenever $\Delta>0$.

Fix $b,c$ and differentiate $f$ with respect
to $a$.  The partial derivative $\partial f/\partial a$ has the form
$g(a,b,c)/\sqrt{\Delta}$ for some rational function of $a,b,c$ (with
nonzero denominator).  By brute force, we see that $g(a,b,c)$ is
identically $0$.  (Euler himself did not shun brute force.  See
\cite{Euler}.)

By symmetry, the partial derivatives with respect to $b$ and $c$ are
also identically zero.  The function $f(a,b,c)$  is continuously
differentiable whenever $\Delta>0$.  Thus, its directional
derivatives are zero.  Thus, $f(a,b,c)$ is constant on connected
sets of the domain of $\Delta>0$.  Without loss of generality,
assume that $a\le b\le c$.  We have, for $a\le t\le b$ that
$d\Delta(1,1,1,t,b,c)/dt\ge 0$. Hence $f(a,b,c)=f(b,b,c)$. 
Similarly,
 $f(b,b,c)=f(c,c,c)$. 
To complete the lemma, we evaluate the constant $f(c,c,c)$
by taking $c$ small.
$\Delta=3c^2-c^3$, $2p= 8-3c$,  $u_1=u_2=u_3 = c -c^2/2$. With this,
we compute
    $$f(a,b,c)= f(c,c,c) = \lim_{c\mapsto0} f(c,c,c) = 
    3 \arctan(1/\sqrt3)-\pi/2 =0.$$
\end{proof}






\subsection{polar coordinates}
\label{sec:polar}

For every pair of real numbers $x$ and $y$,  there are real numbers
$r$ and $\theta$ such that
    \begin{equation}\label{eqn:polar}
    x = r\cos\theta,\quad y = r\sin\theta.
    \end{equation}
If $x$ and $y$ are both zero, then we take $r=0$, and the
Equations~\ref{eqn:polar} hold for all choices of $\theta$. If $x$
and $y$ are not both zero, then we can take $0<r$, and $\theta$ is
uniquely determined (up to multiples of $2\pi$).  We can choose
$0\le\theta < 2\pi$.

Let $W=\{p_1,\ldots,p_k\}$ be a finite set of
nonzero points in the plane, with
polar coordinates $p_i = (r_i\cos\theta_i,r_i\sin\theta_i)$.
We can order the points with the lexicographic order on their
polar coordinates.  Write $p_i \prec p_j$ if
$\theta_i < \theta_j$ or ($\theta_i=\theta_j$ and $r_i<r_j$).
This is a total order on the points.
We have a cyclic permutation $\sigma:W\to W$ which sends
$p\in W$ to the next larger element with respect to this order,
or back to the first element if $p$ is the largest.
We will call $\sigma$ the {\it polar cycle}
of the set $W$.
\index{lexicographic order}
\index{polar cycle}
\index{permutation}




For $\psi\in\ring{R}$, let $T:\ring{R}^2\to\ring{R}^2$ be the
rotation of the plane:
   \begin{equation}
   \label{eqn:rotate}
   (x,y) \mapsto  (x\cos\psi + y\sin\psi,-x\sin\psi+y\cos\psi).
   \index{rotation}
   \end{equation}
Let $\sigma'$ be the polar cycle for $T(W)$.  Then it is easily
checked that
$$
   \sigma'(T p) = T (\sigma p),\quad \text{ for } p\in W. 
$$

\begin{lemma}\label{lemma:polar2}\rating{50}
Let $\theta_i$ be real numbers such that $0\le \theta_i < 2\pi$, for $i=1,2$.
Let $$\theta_{ji} = \theta_i - \theta_j + 2\pi k_{ij},$$
where we pick integers $k_{ij}$ so that $0\le \theta_{ji}< 2\pi$.
Then 
$$
  \theta_{12} + \theta_{21} = \begin{cases}
    2\pi, & \text{ if }\theta_i\ne\theta_j\\
    0,    & \text{ if }\theta_i=\theta_j.
    \end{cases}
$$
\end{lemma}

\begin{proof} This is elementary.
\end{proof}


\begin{lemma}\label{lemma:polar-sum}\rating{100}
Let $W\subset\ring{R}^2$ be a finite set,
of cardinality $n$. Suppose each point in $W$ is nonzero.
Let $\sigma$ be the polar cycle on $W$.  
Let $p=(r(p)\cos\theta(p),r(p)\sin\theta(p))$, for $p\in W$, with
$0\le\theta(p)<2\pi$.
Write
   $$
   \theta(p,q) = \theta(q) - \theta(p) + 2\pi k_{pq},
   $$
where we choose integers $k_{pq}$ so that $0\le \theta(p,q) < 2\pi$.
Then have for all $p\in W$,
and all $0\le i \le j < n$,
   $$
   \theta(p,\sigma^i(p)) +\theta(\sigma^i(p),\sigma^j(p)) =
   \theta(p,\sigma^j(p)).
   $$
Moreover, if there exists $p,q\in W$ such that $\theta(p)\ne\theta(q)$,
we have 
  $$
  \sum_{i=0}^{n-1} \theta(\sigma^{i}p,\sigma^{i+1} p) = 2\pi.
  $$
(If $\theta(p)=\theta(q)$ for all $p,q\in W$, then all the
summands are zero.)
\end{lemma}

\begin{proof}
Fix $p\in W$.
For $0\le i<n$, define $\theta_i$ by
   $\theta_0=\theta(p)$ and 
   $$\theta_i = \theta(\sigma^i(p)) + 2\pi \ell_i,$$
where we choose $\ell_i$ so that $\theta_0\le \theta_i < \theta_0+2\pi$.
It follows from the definition of the polar cycle that
$\theta_i \le \theta_j$ for $0\le i\le j < n$. We find that
$\theta(\sigma^i p ,\sigma^j p) = \theta_j - \theta_i$.
The first identity becomes
  $$
  (\theta_i-\theta_0) + (\theta_j-\theta_i) = (\theta_j-\theta_0),
  $$
which is certainly true.
The second identity becomes
  $$
  \sum_{i=0}^{n-2} (\theta_{i+1}-\theta_i) + \theta(\sigma^{n-1}p,p)
  = \theta(p,\sigma^{n-1}p) + \theta(\sigma^{n-1}p,p).
  $$
This is $0$ or $2\pi$, by the previous lemma.
\end{proof}

\subsection{spherical coordinates}
\label{sec:spherical}


\begin{definition}[spherical coordinate]
Let $x,y,z$ be any real numbers.  A
triple $(r,\theta,\phi)$ such that
    \begin{equation}
    \label{eqn:spherical}
    x = r\cos\theta\sin\phi,\quad y = r\sin\theta\sin\phi,\quad
    z = r\cos\phi
    \end{equation}
with $0\le r$, $0\le\theta<2\pi$, and $0\le\phi\le\pi$ are called
polar coordinates of $(x,y,z)$.  (We follow the variable
naming conventions of American calculus textbooks, which differ
from the international scientific notation.)
\end{definition}

Polar coordinates of any $(x,y,z)$ exist.
We have $r = \sqrt{x^2+y^2+z^2}$.  In the degenerate case $r=0$,
the Equations~\ref{eqn:spherical} become independent of $\theta$
and $\phi$. In the degenerate case when $\phi = 0$ or $\phi =
\pi$, the equations become independent of $\theta$. If $0<r =
\sqrt{x^2+y^2+z^2}$, and $\phi\ne 0,\pi$,  then $\phi$ is uniquely
determined by $x,y,z$. Also, $\theta$ is uniquely determined.


\begin{definition}[azimuth]\label{def:azimuth}
We call $\theta$ the {\it azimuth angle\/} and $\phi$ the {\it
zenith angle\/} of $(x,y,z)$.  The azimuth angle is also known as
the longitude.  The zenith angle is also known as the latitude. The
azimuth angle is a polar coordinate of $(x,y)$:
    $$
    (x,y) = (r'\cos\theta,r'\sin\theta), \quad r' = r\sin\phi.
    $$
\index{azimuth}\index{azim}\index{zenith}\index{latitude}
\index{longitude}
\end{definition}

\subsection{zenith angle}

We generalize zenith angles to a general orthogonal frame.
\index{frame}\index{orthogonal frame}

\begin{definition}[zenith]
Let $(v,w)$ be an ordered pair of points in $\ring{R}^3$, with $v\ne w$.
Let $e_1$, $e_2$, $e_3$ be orthonormal vectors such that
$e_i\cdot (v-w)=0$, for $i=1,2$; $e_3\cdot (w-v)>0$,
and $\det(e_1,e_2,e_3)=1$.  Every
$u\in\ring{R}^3$ 
can be expressed in the form
   $$
   u = v + r\cos\theta\sin\phi\,e_1 + r\sin\theta\sin\phi\,e_2 +
   r\cos\phi\, e_3
   $$
If $u\ne v$, then $\phi$ is uniquely determined by $u$.
(In particular, it is independent of the choice of $e_1$ and $e_2$.)
We call $\phi$ the zenith angle of $u$ with respect to $(v,w)$.
\index{zenith}\index{orthonormal}
\end{definition}

\subsection{general frame}

We generalize azimuth angle and polar coordinates to a general orthonormal frame.

\begin{definition}[cylindrical coordinate, azim] Let $(v,w)$ be an ordered pair of points in
$\ring{R}^3$, with $v\ne w$.  Let $e_1$ and $e_2$ be orthonormal
vectors
such that $e_i\cdot (v-w)=0$ and $\det(e_1,e_2,w-v)>0$.  Every
$u\in\ring{R}^3$ that is not in the line $\op{aff}(v,w)$
can then be uniquely expressed as
   $$
   u = r\cos\theta\, e_1 + r\sin\theta\, e_2 + h (w-v),
   $$
for some $0< r$, $0\le \theta < 2\pi$, $h\in\ring{R}$.
(These are cylindrical coordinates.)  Assume that $w_1$ and $w_2$ do
not lie in the line $\op{aff}(v,w)$.
We define $\op{azim}(v,w,w_1,w_2)$ to be the unique $\theta$ such
that $0\le\theta < 2\pi$ and
  $$
  \begin{array}{lll}
    w_1 &= r_1\cos\psi\, e_1 + r_1\sin\psi\, e_2 + h_1(w-v),\\
    w_2 &=  r_2\cos(\psi+\theta)\, e_1 + r_2\sin(\psi+\theta)\, e_2 
     + h_2(w-v),\\
\end{array}
  $$
\index{cylindrical coordinates}
\end{definition}

\begin{lemma}\label{lemma:sph}\rating{60}
Let $\{v,w,u\}$ be a set of three points in $\ring{R}^3$.
Assume that the set is not collinear.  
Let $e_1,e_2,e_3$ be orthonormal vectors such that $e_i \cdot (v-w)=0$, for $i=1,2$;
$e_3\cdot (w-v)>0$; $e_1\in\op{aff}_+^0(\{v,w\},u)$; $\det(e_1,e_2,e_3)=1$.
Then vectors $e_1,e_2,e_3$ satisfying these properties exist uniquely.
Furthermore, let $u'$ be a point that does not
lie in the line $\op{aff}\{v,w\}$.
Let $r = |v - u'|$, let
$\phi$ be the zenith angle of $u'$ with respect ot $(v,w)$, and let
$\theta$ be the azimuth angle $\op{azim}(v,w,u,u')$.  Then
   \begin{equation}
   u' = v + r \cos\theta \sin\phi\, e_1 + r \sin\theta\sin\phi\, e_2 +
   r\cos\phi\,e_3.
   \label{eqn:sph}
   \end{equation}
\end{lemma}

\begin{definition}[spherical coordinate, frame]\label{def:sph}
Equation~\ref{eqn:sph} for
$u'$ is called the spherical coordinate representation of
$u'$ with respect to $(v,w,u)$.  The set $E=\{e_1,e_2,e_3\}$ is called
the orthonormal frame for $(v,w,u)$.  
%We write 
%  $$u' = P(E,r,\theta,\phi)$$
%for Equation~\ref{eqn:sph}.
\end{definition}

\begin{lemma}\label{lemma:polar-gen}\rating{60}
Let $\{v,w,u\}$ be a set of three points in $\ring{R}^3$.
Assume that the set is not collinear.
Let $w'$ be a vector such that 
  $$(w-v)\cdot (w'-v) = (u-v)\cdot (w-v) = 0,\text{ and }
     \det(w-v,u-v,w'-v)>0.$$
Then for all $u'$ in the plane $\op{aff}\{v,w,u\}$, the spherical coordinates
representation of $u'$ with respect to $(v,w',w)$ 
has the form of Equation~\ref{eqn:sph}, with $\phi=\pi/2$.
The values $r,\theta$ are in this representation are independent of the choice of $w'$. 
\end{lemma}

\begin{definition}[polar coordinate]\label{def:polar}
We call  $(r,\theta)$ the polar coordinates of $u'\in\op{aff}\{v,w,u\}$ with
respect to $(v,w,u)$.
\end{definition}

In the special case that $\op{aff}\{v,w,u\}=\ring{R}^2\subset \ring{R}^3$, this
construction agrees with the previously defined polar coordinates of a point in
the plane.

\begin{definition}[cyclic set] Let $(v,w)$ be an ordered pair of points in
$\ring{R}^3$, with $v\ne w$.
Let $W$ be a finite set of points in $\ring{R}^3$.
We say that $W$ is cyclic with respect to $(v,w)$ if
the following two conditions hold.
First, $p = q + h (w-v)$, with $p,q\in W$ and $h\in \ring{R}$
implies that $p=q$.  Second, 
  $p\ne h(w-v)$ for $p\in W$, $h\in\ring{R}$.
\end{definition}

Cyclicity is precisely the condition we need for the
set $W$ to map injectively to the nonzero points of the 
plane under the projection
onto the first two cylindrical coordinates.

\begin{definition}[azimuth cycle]
Let $(v,w)$ be an ordered pair of points in
$\ring{R}^3$, with $v\ne w$.
Let $W$ be a finite set of points in $\ring{R}^3$ that is
cyclic  with respect to $(v,w)$.
Pick $e_1$ and $e_2$ as in the definition
of $\op{azim}$.  Map 
$W$ bijectively to $W'\subset\ring{R}^2$ by the following map $f$:
   $$p =  r\cos\theta\, e_1 + r\sin\theta\, e_2 + h (w-v) \mapsto^f
     (r\cos\theta,r\sin\theta).$$
These conditions give a polar cycle $\sigma':W'\to W'$.  Let
$\sigma:W\to W$ be given by $f\sigma(p) =\sigma'f(p)$.
Call $\sigma$ the azimuth cycle
on $W$ with respect to $(v,w)$.
\index{azimuth cycle} 
\end{definition}

\begin{lemma}\rating{50} The azimuth cycle $\sigma:W\to W$ does not depend
on the choice of $e_1$ (and $e_2$ is determined by $e_1$).
\end{lemma}

\begin{proof} This follows from independence of $\sigma'$ from
rotations in the $\{e_1,e_2\}$ plane  (Equation~\ref{eqn:rotate}).
\end{proof}


\begin{lemma}\rating{40} Let $(v,w)$ be an ordered pair of points in $\ring{R}^3$,
with $v\ne w$.  Assume that $\{w_1,w_2\}$ is cyclic
with respect to $(v,w)$.  Then
  $$
  \op{azim}(v,w,w_1,w_2) + \op{azim}(v,w,w_2,w_1) 
  = \begin{cases} 2\pi, & \text{if }\op{azim}(v,w,w_1,w_2)\ne 0,\\
    0, & \text{if }\op{azim}(v,w,w_1,w_2)=0.
    \end{cases}
    $$
\end{lemma}

\begin{proof} This follows immediately from Lemma~\ref{lemma:polar2}.
\end{proof}

\begin{lemma}\rating{60} 
Let $(v,w)$ be an ordered pair of points in $\ring{R}^3$,
with $v\ne w$.  Let $W$ be a finite set in $\ring{R}^3$ that
is cyclic with respect to $(v,w)$,
with azimuth cycle $\sigma$.
Let $n=\card(W)$.  Then have for all $p\in W$,
and all $0\le i \le j < n$,
   $$
   \op{azim}(v,w,p,\sigma^i(p)) +
    \op{azim}(v,w,\sigma^i(p),\sigma^j(p)) =
   \op{azim}(v,w,p,\sigma^j(p)).
   $$
Moreover, if there exists $q\in W$ such that 
$\op{azim}(u,v,p,q)\ne0$,
we have 
  $$
  \sum_{i=0}^{n-1} \op{azim}(\sigma^ip,\sigma^{i+1}p) = 2\pi.
  $$
(If $\op{azim}(u,v,p,q)=0$ for all $q\in W$, then all the
summands are zero.)
\end{lemma}

\begin{proof} This follows immediately from 
Lemma~\ref{lemma:polar-sum}.
\end{proof}


The azimuth and dihedral angles are closely related.  

\begin{lemma}\label{lemma:dih-azim}\rating{100}
Let $w\ne v$ be a nonzero vectors in $\ring{R}^3$.
  Assume that $v_1$ and $v_2$ do not lie in the line $\op{aff}(v,w)$.
Let
  $$\gamma = \dih_V(\{v,w\},\{v_1,v_2\}).$$
  Then
    $$
    \cos(\op{azim}(v,w,v_1,v_2)) = \cos\gamma.
    $$
\end{lemma}

\begin{proof}  For simplicity,
we will take our base point $v=0$.
Let $v_i' = (w\cdot w) v_i - (w\cdot v_i) w$.  
We have $v_1'\ne 0$.  Set $e_1 = v_1'/|v'_1|$.  Choose a unit vector
$e_2$ so that $\det(e_1,e_2,w)>0$ and $e_1\cdot e_2 = w\cdot e_2=0$.
Write $v_i$ in cylindrical coordinates as 
   $$
   \begin{array}{lllll}
     v_1 &= r_1 e_1 &    &+h_1 w\\
     v_2 &= r_2 \cos\theta\, e_1 &+ r_2 \sin\theta\, e_2 &+ h_2 w.
    \end{array}
   $$
By the definition of $\op{azim}$, we have $\op{azim}(v,w,v_1,v_2)=\theta$.  
By definition, $\cos\gamma$ is the angle between $v_1'$ and $v_2'$.
We compute
   $$
   \begin{array}{lll}
     v_1' &= |v'_1| e_1 \\
     v_2' &= (w\cdot w) r_2 \cos\theta\, e_1 
       &+ (w\cdot w) r_2 \sin\theta\, e_2 \\
     \end{array}
   $$
The result $\cos\theta=\cos\gamma$ 
is now a result of the definition of angle 
(Definition~\ref{def:angle}).
\end{proof}




\subsection{spherical triangle inequality}

\begin{lemma}\rating{80}\label{lemma:sph-tri-ineq}
Let $\{p,u,v,w\}$ be a set of four points in $\ring{R}^3$.
Assume that $p$ is not collinear with any of the other two points.
Then
   $$
   \arc_V(p,u,w) \le \arc_V(p,u,v) + \arc_V(p,v,w).
   $$
Equality occurs if and only if $v\in\op{aff}_+(p,\{u,w\})$.
\end{lemma}

\begin{proof} Let $v'$ be the projection of $v$ to the plane
$\op{aff}\{p,u,w\}$.  
By the spherical law of cosines, for a right angle
   $$
   \cos\psi = \cos\beta\cos\alpha \le \cos\beta,
   $$
where $\psi = \arc_V(p,u,v)$, $\beta = \arc_V(p,u,v')$, $\alpha=\arc_V(p,v,v')$.
Thus, $\arc_V(p,u,v')=\beta\le \psi=\arc_V(p,u,v)$.
Similarly, $\arc_V(p,v',w) \le \arc_V(p,v,w)$.
Thus, it is enough to show that 
  $$
  \arc(p,u,w) \le \arc(p,u,v') + \arc(p,v',w).
  $$
The points $p,u,w,v'$ are coplanar.
By the additivity of planar angle (Lemma~\ref{lemma:polar-sum}), if 
$v'\in \op{aff}_+(p,\{u,w\})$, then
   $$
   \arc(p,u,w) = \arc(p,u,v') + \arc(p,v',w),   
   $$
and otherwise,
   $$
   \arc(p,u,w) = |\arc(p,u,v') - \arc(p,v',w)|.
   $$
The inequality follows.

Tracing this argument, we see that equality occurs exactly when
$\alpha=0$ and $v'\in \op{aff}_+(p,\{u,w\})$.  Equivalently,
$v'=v\in\op{aff}_+(p,\{u,w\})$.
\end{proof}

\begin{lemma}\rating{40}\label{lemma:sph-tri-multi}
Let $\{p,u_1,u_2,u_3,\ldots,u_r\}$ be a set of points in $\ring{R}^3$.
Assume that no triple $\{p,u_i,u_{i+1}\}$ is collinear.  Assume
that $\{p,u_1,u_r\}$ is not collinear.  Then
$$
  \arc(p,u_1,u_r) \le \sum_{i=1}^{r-1} \arc(p,u_i,u_{i+1}).
$$
\end{lemma}

\begin{proof} This is an easy induction on $r$ with base
case given by Lemma~\ref{lemma:sph-tri-ineq}.
\end{proof}
