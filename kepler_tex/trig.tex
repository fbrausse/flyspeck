\chapter{Trigonometry}
\label{part:trig}
\indy{Index}{trigonometry}%

\begin{summary}
  This part of this book, which is the first of the four foundational
  chapters, presents a systematic development of trigonometry, volume,
  hypermap, and fan.  There is a separate chapter on each of these
  topics.  The purpose of the this material is to build a bridge
  between the foundations of mathematics, as presented in formal
  theorem proving systems such as HOL Light, and the solution to the
  packing problem.  

  In this chapter, trigonometry is developed analytically.  Basic
  trigonometric functions are defined by their power series
  representations, and calculus of a single real variable is used to
  develop the basic properties of these functions.  Basic vector
  geometry is presented.
\end{summary}


\section{Background Knowledge}

\subsection{formal proof}

We repeat that our purpose is to give a
blueprint of the formal proof of Kepler's conjecture that no packing of
congruent balls in three-dimensional Euclidean space has density
greater than the familiar cannonball packing.  The blueprint of a
formal proof is not the same as a formal proof, which is a 
fleeting pattern of bits in a computer.  The book describes to the
reader\footnote{``The words will be minced into atomized search-engine
  keywords~\dots{} copied millions of times by algorithms~\dots{}
  scanned, rehashed, and misrepresented by crowds\dots.  And yet
  it is you, the person, the rarity among my readers, I hope to
  reach'' --Jaron Lanier \cite{Lanier}.}  how to construct the
computer code that  produces and then reliably reproduces that
pattern of bits.

A more traditional book might take as its starting point the imagined
mathematical background of a typical reader.  The blueprint of a
formal proof starts instead with the current mathematical background
of a formal proof assistant.  I surveyed the knowledge base of my formal
proof assistant and compared it with what is needed in the
construction of our formal proof.  It turns out that the proof
assistant already has an adequate background in real analysis, basic
topology, and plane trigonometry, including the trigonometric addition
laws, and formulas for derivatives.  Since the proof assistant already
has a significant library of theorems in real analysis and point-set topology, we
 use background facts in these areas wherever they help.


However, when this project began, the proof assistant lacked the
background in some of the less frequently used trigonometric
identities and has had nothing at all about spherical trigonometry.
While it had adequate command of general concepts of vector geometry
in $n$-dimensional Euclidean space, its library on three-dimensional
analytic geometry was spotty.  For example, dihedral angles and
cylindrical and spherical coordinates were missing from the system.
%This foundational chapter supplies all of this necessary
%background in trigonometry and three-dimensional analytic geometry.

I imagine the typical reader to have a much stronger background in
trigonometry and analytic geometry than the proof assistant, which,
after all, is still in its youth.  The mathematician might want to
jump directly to  Definition~\ref{def:aff}, which specifies subsets
$\op{aff}_\pm$ of affine space.  This definition gives a compact
notation that encompasses many of the standard polyhedra (points,
lines, planes, rays, half-planes, half-spaces, convex hulls, affine
hulls) that appear throughout the book.  From there, the reader can
consult the definition of two important polynomials $\Delta$ and
$\ups$, make a note of the unorthodox notation $\arc(a,b,c)$ for the
angle opposite $c$ of a triangle with sides of lengths $a,b,c$, stop a
moment to admire Euler's formula for the solid angle of a spherical
triangle; and then jump directly to the final section, which
introduces polar cycle.

Polar cycle is a familiar concept, wrapped in an unfamiliar way
for the sake of the proof assistant: take a finite set of points in
the plane, order them by increasing angle, and then take the cyclic
permutation on the points induced by this order.  The azimuth cycle
is the corresponding permutation in three dimensions, ordering points by
increasing azimuth angle (longitude) in spherical coordinates.
Although intuitively clear, our proof assistant demands extra
assistance at this point.
\indy{Index}{longitude}%



\subsection{real analysis}
\label{back:analysis}  
This chapter assumes general facts about
real analysis at the level of a typical
undergraduate textbook.  In particular, it assumes a general working
knowledge of set theory and basic properties of the set of \newterm{natural 
numbers}, $\ring{N}=\{0,1,\ldots\}$, and the field $\ring{R}$ 
of real numbers.  By convention, $0\in\ring{N}$.  In real analysis, the chapter assumes
basic properties of convergence, absolute convergence, limits, and
differentiation.  The term \newterm{real analysis} is
to be interpreted broadly to include even the most elementary facts of
real arithmetic, including results that do not involve limits.
\indy{Index}{real analysis}%
\indy{Index}{real arithmetic}%
\indy{Index}{natural numbers}%
\indy{Notation}{N@$\ring{N}=\{0,1,\ldots,\}$}%
\indy{Notation}{R@$\ring{R}$ (field of real numbers)}%


\subsection{Tarski arithmetic}

\label{back:tarski}
  Certain sentences in real arithmetic can be expressed with nothing
  more than the usual logical operations (the connectives {\it and},
  {\it or}, {\it implies}, {\it logical negation}); the ring
  operations (addition, subtraction, and multiplication) for the real
  numbers; comparison ($(=)$ and $(>)$) of real numbers; the constants
  $0$ and $1$; real-valued variables; and quantifiers (universal and
  existential) over the real numbers.  Such sentences are said to
  belong to the \newterm{Tarski arithmetic}.  For example, the sentence
\begin{equation}\label{eqn:tarski}
\exists x.~x^7 - 4 x - 3 = 0 ~~\land~~ x > 0
\end{equation}
falls within the Tarski arithmetic (after expanding the exponent $x^7$
as $x\cdot x\cdot x\cdot x\cdot x\cdot x\cdot x$ and the constants
$4=1+1+1+1$ and $3=1+1+1$).  Starting with Tarski, researchers have
developed algorithms to decide the truth of any sentence in the Tarski
arithmetic \cite{tarski-decision},~\cite{Mishra:1997}.  
Although these algorithms are generally too slow to be of practical
use, it is useful to identify such sentences.  To follow the details of proofs, 
reader should have the skill to solve particularly simple
problems in the Tarski arithmetic such as determining that the
sentence \eqref{eqn:tarski} is true.


\section{Trig Identities}


\subsection{sine and cosine}

The cosine and sine functions are defined\footnote{This is how the
  trigonometric functions were originally defined in the proof
  assistant HOL Light.  More recently, complex analysis has been
  developed in HOL Light sufficient for the analytic proof of
  the prime number theorem \cite{harrison:2009:pnt}.  The cosine and
  sine are now defined in the system as the real and complex parts of
  the exponential function $e^{i x}$.  To simplify the exposition, this section
  presents the original definitions.} by their infinite series:%
%\footformal{sin,\ cos,\ SIN\_0\, COS\_0}%




% from pgfmanual.pdf page 27, sec. 2.12
\begin{equation}\label{eqn:cos-def}\cos(x) = 1 - x^2/2! + x^4/4! \cdots,\qquad
  \sin(x) = x - x^3/3! + x^5/5! \cdots.
  \indy{Notation}{cos}%
  \indy{Index}{cosine}%
  \indy{Notation}{sin}%
  \indy{Index}{sine}%
  \indy{Index}{cosine!series definition}%
  \indy{Index}{sine!series definition}%
\end{equation}
%
\figODPCVGH % fig:trig

\mar{\guid{FOYTTIX} Eq.~\ref{eqn:cos-def}}
By real analysis, convergence is absolute
for every real number $x$.  Each series can be evaluated at $0$:
\begin{equation}\label{eqn:cos0}
  \cos(0) = 1,\qquad \sin(0) = 0.
\end{equation}
\mar{\guid{YIXJNJQ} Eq.~\ref{eqn:cos0}}


These series may be differentiated term by term to establish the
identities: \indy{Index}{cosine!derivative}%
\begin{equation}\label{eqn:cos'}
\frac{d\phantom{~}} {dx}\cos(x) 
= -\sin(x),\qquad \frac{ d\phantom{~} }{dx}\sin(x) = \cos(x).
\end{equation}
\mar{\guid{COHWECZ} Eq.~\ref{eqn:cos'}}%
Powers $(\cos(x))^n$ and $(\sin(x))^n$ are conventionally written
$\cos^n(x)$ and $\sin^n(x)$.

%Trigonometric identities follow easily from these definitions.    
If two functions are the {\it unique} solution of an ordinary
differential equation with given initial conditions, then the
two functions are equal.  This observation gives
 a method to prove many functional identities,
including trigonometric identities.  
The next two lemmas take this approach, by
 certifying a trigonometric identity with a function $f$ that
satisfies the ordinary differential equation $f' = 0$ with initial
condition $f(0)=0$.  
\indy{Index}{trigonometry!identities}%

\begin{lemma}[]\guid{WPMXVYZ}
\label{lemma:circle}\formal{SIN\_CIRCLE} 
\[ 
\sin^2(x) + \cos^2(x) = 1.
\] 
\end{lemma}
\indy{Index}{trigonometry!circle identity}%

% DEPRECATED HGMTQFG


\begin{proved}
  By real analysis and~\eqref{eqn:cos'}, the
  derivative of  $f(x) = \cos^2(x) +\sin^2(x)$ is
  identically zero, so the function itself is constant.
  From~\eqref{eqn:cos0}, it follows that $f(x)=f(0)=1$.
  \swallowed\end{proved}

%\footnote{
%  Incidentally, this trigonometric identity recently tried to crash
%  through the gates of physics.  Two robotics experts, Schmidt and
%  Lipson, wrote a computer program that automatically discovers
%  Hamiltons and Lagrangians from raw experimental data.  Discover
%  magazine reported that this program can discover the same laws in
%  hours that Newton took decades to find~\cite{discover-2009}.
%  However, one of the primary challenges of their project was to keep
%  out purely mathematical identities such as $\sin^2(x)+\cos^2(x)=1$,
%  which may try to pass as a conservation law with physical
%  significance~\cite{lipson}.
%}


\begin{lemma}[]\guid{WNYVJPE}\label{lemma:sin-add}
\formal{SIN\_ADD,\ COS\_ADD}
\begin{align*}
\sin(x+y) &= \sin(x)\cos(y) + \cos(x)\sin(y)\\
\cos(x+y)  &= \cos(x)\cos(y) - \sin(x)\sin(y).
\end{align*}
\end{lemma}
\indy{Index}{trigonometry!addition formula}%

%\figRUESSGQ % fig:cosadd  cos(x+y).

\begin{proved}
The proof is an exercise in real analysis.
Fix $y$.  Let
\begin{align*}
f(x) &=(\cos(x+y) - \cos(x)\cos(y) +
\sin(x)\sin(y))^2 \\ 
  &\quad+ (\sin(x+y) -\sin(x)\cos(y) -\cos(x)\sin(y))^2.
\end{align*}
The derivative of $f$ is identically zero.  The function is therefore
constant.  Also, $f(0)=0$.  Thus, $f$ is
identically zero.  If a sum of real squares is zero, the individual
terms are zero. The identities follow.  \swallowed\end{proved}

\begin{lemma}[]\guid{KGLLRQT}\label{lemma:cos-neg}
\formal{COS\_NEG,\ SIN\_NEG}
  The cosine is an even function.  The sine is an odd function.  That
  is,
\[ 
\cos(-x) = \cos(x),\quad\sin(-x) =
    -\sin(x).
\] 
\end{lemma}


\begin{proved}
The result can be checked directly from the definition of the trigonometric functions
as power series.  A second proof can be given by differentiation, as follows.
By real analysis, the derivative of
\[ 
(\cos(-x) - \cos(x))^2 + (\sin(-x)
  +\sin(x))^2
\] 
is identically zero.  Complete the proof as in the proof of
Lemma~\ref{lemma:sin-add}.  \swallowed\end{proved}

\subsection{periodicity}
\label{sec:pi}
\indy{Index}{periodicity}%

It is known that the cosine has a unique root between $0$
and $2$. The constant $\pi$ is defined to be twice that root.  Thus, by
definition 
\begin{align}\label{eqn:cospi2}
\cos(\pi/2) &= 0,\nonumber\\
\cos(x) &>0,\quad \text{when } 0<x<\pi/2.
\end{align}
\mar{\guid{CFXEKKP} Eq.~\ref{eqn:cospi2}}
The cosine is in fact
nonnegative on the interval $\leftclosed 0,\pi/2\rightclosed$:
\begin{equation}\label{eqn:cospos}
\cos(x)\ge 0,   \quad 0\le x \le \pi/2.
\end{equation}
\mar{\guid{ZSKECZV} Eq.~\ref{eqn:cospos}}
\indy{Index}{cosine!roots}%

\begin{lemma}[]\guid{CPIREMF}\label{lemma:sin-pi2}
\formal{SIN\_PI2}
The sine function is nonnegative on $[0,\pi/2]$ and  $\sin (\pi/2) = 1.$
\end{lemma}

\begin{proved}
  The proof is an exercise in real analysis.
  The derivative of the sine is
  nonnegative between $0$ and $\pi/2$.  The
  value of the sine at $0$ is $0$.  It follows that
  $\sin$ is nonnegative on $[0,\pi/2]$.  It is enough to check that
   $\sin^2(\pi/2)$ equals $1$.  Then $\sin^2(\pi/2)
  = {1-\cos^2(\pi/2)}
  = 1$.  \swallowed\end{proved}

\begin{lemma}[]\guid{SCEZKRH}\label{lemma:cos-sin}
\begin{align*}
\sin(\pi/2 - x)&=\cos(x),\\
\cos(\pi/2 - x)&=\sin(x).
\end{align*}
\end{lemma}

\begin{proved}
Apply the addition law  for the sine function (Lemma~\ref{lemma:sin-add}),
\[ 
\sin(\pi/2 - x) = \sin(\pi/2)\cos(-x) + \cos(\pi/2)\sin(-x)
\] 
and use $\sin(\pi/2) = 1$ and
$\cos(\pi/2) = 0$.  Then use that $\cos$ is an
even function.  The second identity is
similar.  \swallowed\end{proved}

Similarly,~%
%\footformal{SIN\_COS,\ SIN\_PERIODIC\_PI,\ COS\_PERIODIC\_PI, 
%SIN\_PERIODIC,\ COS\_PERIODIC}%
$\cos(\pi/2 + x) =
-\sin(x)$, $\sin(\pi/2 + x) = \cos(x)$.  Further,
\begin{alignat}{2}
\label{eqn:periodic}
\sin(\pi + x) &= \phantom{-}\cos(\pi/2 + x) &= -\sin(x),\nonumber\\
\cos(\pi + x) &= -\sin(\pi/2 + x) &= -\cos(x),\nonumber\\
\sin(2\pi + x) &= -\sin(\pi + x) &= \phantom{-}\sin(x),\\
\cos(2\pi + x) &= -\cos(\pi + x) &= \phantom{-}\cos(x)\nonumber.
\end{alignat}
\mar{\guid{LLOYXRK} Eq.~\ref{eqn:periodic}}%
\indy{Index}{trigonometry!periodicity}%

\begin{lemma}[]\guid{WIBGJRR}\label{lemma:sin-pos}
The sine function is nonnegative on $[0,\pi]$.
\end{lemma}

\begin{proof} By Lemma~\ref{lemma:sin-pi2}, $\sin$ is nonnegative on
  $[0,\pi/2]$.  Furthermore, for $x\in[\pi/2,\pi]$,
\[ 
  \sin(x) = -\sin(-x)   =  \sin(\pi-x) \ge 0.
\] 
\end{proof}



\subsection{tangent}
\label{sec:tangent}

\begin{definition}[tangent]\guid{BIRXGXP}\label{def:tan}
\formaldef{$\tan$}{tan}
Let $\tan(x) = \sin(x)/\cos(x)$, when $\cos(x)\ne0$.
%(See Figure~\ref{fig:trig}.)
\indy{Index}{tangent}%
\indy{Notation}{tan@$\tan$}%
\end{definition}



\begin{lemma}[]\guid{KWYPRWZ}
\label{lemma:tan-add}\formal{TAN\_ADD}
If $\cos(x)\ne 0$, $\cos(y)\ne 0$, and $\cos(x+y)\ne0$ then
\[ \tan(x+y) = \frac{\tan(x) + \tan(y) }{ 1 -
    \tan(x)\tan(y)}.\] 
\end{lemma}
\indy{Index}{trigonometry!tangent}%

\begin{proved}
  Divide the first line of Lemma~\ref{lemma:sin-add} by the second
  line of the same lemma.  Then use the definition
  of the tangent.  \swallowed\end{proved}

\begin{lemma}[]\guid{KSQDZSF}\label{lemma:tan-pi4}\formal{TAN\_PI4}
\[ \tan(\pi/4) = 1.\] 
\end{lemma}

\begin{proved}  
\[ 
\tan(\pi/4) = \sin(\pi/2-\pi/4)/\cos(\pi/4) 
  =
  \cos(\pi/4)/\cos(\pi/4) = 1.
\] 
\swallowed\end{proved}

\begin{lemma}[]\guid{UTNKIAC}\label{lemma:tan-monotone}
The function $\tan$ is strictly increasing and one-to-one on the domain
$\leftopen-\pi/2,\pi/2\rightopen$.
\end{lemma}

\begin{proof} \hspace{-6pt}By a derivative test, the tangent is strictly
  increasing on $\leftopen-\pi/2,\pi/2\rightopen$.  By
  real arithmetic, a strictly increasing
  function is one-to-one.
\end{proof}

\subsection{arctangent}

This section reviews the properties of the arctangent function.  

\begin{definition}[arctangent]\guid{RIQVMHH}\label{def:arctan}
\formaldef{$\arctan$}{atn}
\formal{atn,\ ATN,\ ATN\_TAN,\ ATN\_BOUNDS,\ TAN\_ATN}
  By the inverse function theorem of real
    analysis and properties of $\tan$,
  there is a unique function $\arctan:\ring{R}\to\ring{R}$ with image
  $(-\pi/2,\pi/2)$ such that
\begin{equation}\label{eqn:tanarctan}\tan(\arctan x) =x.\end{equation}
(See Figure~\ref{fig:trig}.)
\mar{\guid{EWITKLU} Eq.~\ref{eqn:tanarctan}}
\indy{Index}{arctangent}%
\end{definition}
%


Additional properties of the arctangent function are exercises in
real analysis.  If $-\pi/2 < x < \pi/2$,
then also $\arctan(\tan(x)) = x$. In particular,%
%\footformal{ATN\_1}
\begin{equation}\label{eqn:arctan-1}\
\arctan(1) = \arctan(\tan(\pi/4)) = \pi/4.
\end{equation}
\mar{\guid{YTXYLRB} Eq.~\ref{eqn:arctan-1}}  % X->Y


The function $\arctan$ is differentiable with derivative%
%\footformal{\ ATN\_MONO\_LT,\ ATN\_MONO\_LT\_EQ}
\begin{equation}\label{eqn:deriv-tan}\frac{d\phantom{~}} {dx} \arctan(x) = \frac{1}{1 +
    x^2}.\end{equation}
\mar{\guid{OKENMAM} Eq.~\ref{eqn:deriv-tan}}
The derivative is positive, and the function $\arctan$ is
strictly increasing.   \mar{\guid{LQCXGZX} increasing}
\indy{Index}{arctangent!derivative}%
Proofs in this book often need to use $\arctan(y/x)$ as  $x$ approaches $0$.
For this, the following variant of $\arctan$ is preferable because it clears the denominator.


\begin{definition}[$\atn$]\guid{GYKGARD}\label{def:atn}
\formaldef{$\atn$}{atn2}
\[ 
\atn: \ring{R}^2 \to \leftopen-\pi,\pi\rightclosed.
\] 
\[ 
\atn(x,y) = \begin{cases}
\arctan(y/x), & x > 0\\
\pi/2- \arctan(x/y), & y > 0 \\
\pi + \arctan(y/x), & x< 0,\  y\ge 0\\
-\pi/2- \arctan(x/y), & y< 0 \\
\pi, & x= y=0.\\
\end{cases}
\] 
\end{definition}
\indy{Notation}{arctan2@$\atn$}%
\indy{Notation}{arctan@$\arctan$}%
\indy{Index}{arctangent!atn@$\atn$}%
%
\figYOXQFUB % fig:atn-polar


There is some overlap between cases. Nevertheless, trig identities
similar to those already established show that this function is
well-defined.  For example, to check the equality of the first two
cases ($x>0$ and $y>0$), we compute the tangent of both sides, which is sufficient,
since both sides lie between $\leftopen-\pi/2,\pi/2\rightopen$ and
$\tan$ is one-to-one:
\[ 
  \tan(\arctan(y/x)) = y/x = 
  1/\tan(\arctan(x/y)) = \tan(\pi/2 - \arctan(x/y)).
\] 
We can give a more intuitive description of
the function $\atn$:    the polar angle of $(x,y)$ with the
branch cut along the negative axis.  That is, $x = r\cos\theta$ and
$y=r\sin\theta$ for some $r\ge0$, where $\theta=\atn(x,y)$.  This definition avoids all
the case distinctions of Definition~\ref{def:atn}.

The ANSI C programming language implements this function as {\it
  arctan2}.  Note that some programming languages implement this
function with the two arguments in reverse: $(y,x)$.
\indy{Index}{arctangent!near 0}%
%\indy{Notation}{r@$r$ (coordinate)}%
\indy{Notation}{r@$r$ (polar, cylindrical, and spherical radius)}%
\indy{Notation}{xy@$(x,y)$ (Cartesian point)}%
%\indy{Notation}{zzh@$\theta$ (coordinate)}%
\indy{Notation}{zzh@$\theta$ (polar, cylindrical, and spherical angle)}%


\subsection{inverse trig}
\indy{Index}{trigonometry!inverse}%

We prefer the arctangent over other inverse trigonometric functions
because its domain is the entire field of real numbers, its range is
bounded, and its derivative is a rational function.  Wherever angles
appear in this book, the arctangent is apt to appear as well.  Other
inverse trigonometric functions are generally  reduced to the
arctangent.  This section defines the $\arccos$ function and shows how
it can be expressed in terms of $\atn$.

\begin{definition}[arccos]\guid{QZTBJMH}
\formaldef{$\arccos$}{acs}
\label{def:arccos}\formal{acs,\ ACS\_COS,\ COS\_ACS}
  By the inverse function theorem of real
    analysis, there exists a unique function $\arccos y$ on the
  interval $[-1,1]$ that takes values in $[0,\pi]$ and that is the
  inverse function of $\cos$:
\begin{align*}
y\in [-1,1] &\Rightarrow \cos(\arccos y) = y\\
x\in[0,\pi] &\Rightarrow \arccos(\cos x) = x.
\end{align*}
\indy{Index}{arccosine}%
\indy{Notation}{arccos}%
%(See Figure~\ref{fig:trig}.)
\end{definition}


\begin{lemma}[]\guid{FMGMALU}\label{lemma:sin-arccos}
\formal{sin\_acs\_t} 
  If $y\in[-1,1]$, then
\[ \sin(\arccos(y)) = \sqrt{1-y^2}.\] 
\end{lemma}

\begin{proved}
  The range of $\arccos(y)$ is $[0,\pi]$.  On
  this interval, $\sin$ is nonnegative.  By
  real analysis, it is enough to check that
  the squares of the two nonnegative numbers are equal.  It then an
  arithmetic consequence of the circle identity
  (Lemma~\ref{lemma:circle}) and Definition~\ref{def:arccos}.
  \swallowed\end{proved}

The following lemma shows how to rewrite $\arccos$
in terms of  $\atn$.   
%Our preference is to remove the $\arccos$ function whenever
%possible, by replacing it with the $\atn$ function through the
%following identity.  


\begin{lemma}[]\guid{OUIJTWY}\label{lemma:arccos-arctan}
\formal{acs\_atn2\_t}  
  If $y\in [-1,1]$, then
  \[ \arccos(y) +  \atn\Big({
      \sqrt{1-y^2}},{y}\Big) = \pi/2.\] 
\end{lemma}
\indy{Index}{trigonometry!arccos}%
\indy{Index}{trigonometry!arctan}%
\indy{Notation}{arccos}%
\indy{Notation}{arctan@$\arctan$}%
\mar{FIGURE:The two acute angles of a right triangle have sum $\pi/2$.}

\begin{proved}
The brief justification is simply that 
$\arccos(y/z)$ gives one acute angle of a right triangle with
hypotenuse $z$ and sides $x$ and $y$, and $\atn(x,y)$ gives the other acute angle.
The two acute angles of a right triangle have sum $\pi/2$.

A bit more detail is needed for an argument that can be turned into a formal proof.
  The endpoints $y=\pm1$ can be checked directly from definitions.  If
  $y\in (-1,1)$, $\beta = \arccos(y)$, and 
\[ \alpha =
    \arctan\Big(y/\nsqrt{1-y^2}\Big) =
    \atn\Big({\sqrt{1-y^2}},{y}\Big),\]  then arithmetic gives
  $-\pi/2 < \pi/2 - \beta < \pi/2$, and $-\pi/2 < \alpha
    < \pi/2$.  By the injectivity of
  the function $\tan$, it is therefore enough to check that
  $\tan(\pi/2 - \beta) = \tan(\alpha)$.  But
\[ 
\tan(\pi/2-\beta)=
\frac{\cos(\beta)}{\sin(\beta)} =
\frac{y}{        \sin(\arccos(y))} 
=\frac{y}{ \sqrt{1-y^2}} 
=\tan(\alpha).
\] 
\swallowed\end{proved}



\section{Vector Geometry}

This section reviews vector geometry in $\ring{R}^N$, including
products (scalar and dot), inequalities (triangle and Cauchy--Schwarz),
and hulls (convex and affine).

\subsection{Euclidean space}

\begin{definition}[$\ring{R}^N$,~vector]\guid{KRZJIAD}
\formaldef{$\ring{R}^N$}{:real\textasciicircum N}
  For any finite set $N$, define $\ring{R}^N$ as the set of functions
  $\v:N\to\ring{R}$. Write $v_i$ for the value of the function $\v$ at
  $i\in N$. 
  \indy{Notation}{reals@$\ring{R}^N$}%
  A function in $\ring{R}^N$ is called a \newterm{vector}.  The zero
  vector $\orz$ is the function that is identically zero.
  \indy{Index}{vector}%
\end{definition}
\indy{Index}{vector!zero}%
Vectors are written in a bold face: $\u$, $\v$, $\w$, $\p$, $\q$, and
so forth.  As a general notational practice, there is a general
tendency to use $\u$, $\v$, and $\w$ to denote vectors that are
constrained to lie in some previously determined subset $V\subset
\ring{R}^N$ and to use $\p$ and $\q$ to denote vectors that run
without restriction over all of $\ring{R}^N$.

No distinction is made between vectors and points in $\ring{R}^N$, and
none is made between $\ring{R}^N$ and Euclidean space.  Write
$\ring{R}^n$ as an alias of $\ring{R}^N$ when $n\in\ring{N}$ and
$N=\{0,\ldots,n-1\}$.  
\indy{Index}{Euclidean space}%

\begin{definition}[vector addition,~scalar multiplication]\guid{WHIAXYC} % X->Y
\formaldef{vector addition}{(+)}
\formaldef{scalar multiplication}{(\%)}
  Two standard arithmetic operations, addition and scalar
  multiplication, are defined on the set $\ring{R}^N$.  These
  operations are the pointwise addition and scalar multiplication of
  functions:
\begin{align}
(\u + \v)_i &= u_i + v_i.\nonumber\\
(t \u)_i &= t u_i,\quad t\in\ring{R}.
\end{align}
\indy{Index}{vector!addition}%
\indy{Index}{vector!scalar multiplication}%
Define the difference of two vectors to be $\u - \v = \u + (-1) \v$.
\indy{Index}{vector!subtraction}%
\end{definition}
The operations on $\ring{R}^N$ 
satisfy the axioms of a \newterm{vector space}. 
In particular, addition is commutative and associative.


\begin{definition}[dot product]\guid{VFPCZBI}
\label{def:dot}
\formaldef{dot product}{(dot)}
The  \newterm{dot product} $(\,\cdot\,)$ is the
 bilinear binary operation on $\ring{R}^N$
%\[ 
%(\cdot):\ring{R}^N\to\ring{R}^N\to\ring{R}
%\] 
defined by
\[ 
\u\cdot \v = \sum_{i\in N} u_i v_i.
\] 
\indy{Index}{vector!dot product}%
\indy{Notation}{4@$\cdot $ (dot product)}%
\end{definition}


The dot product satisfies the following
properties:
\begin{align}\label{eqn:dot}
\u \cdot (\v + \w) &= \u \cdot \v + \u \cdot \w\nonumber\\
(\u + \v)\cdot \w &= \u \cdot \w + \v \cdot \w\nonumber\\
(t \u)\cdot \w &= t(\u \cdot \w) = \u \cdot (t \w)\\
0 &\le \u\cdot \u.\nonumber
\end{align}


\begin{definition}[norm]\guid{XHVXJVB}
\label{def:norm}
\formaldef{norm}{vector\_norm}
The \newterm{norm} of a vector $\u\in\ring{R}^N$ is
\[ \normo{\u} = \sqrt{\u\cdot \u}.\] 
\indy{Index}{vector!norm}%
\end{definition}
%\indy{Notation}{norm@\hbox{$\normo{\u}$} (vector norm)}%

By  real arithmetic,
$\normo{\u}=0$  if and only if $\u=\orz$.  Moreover,
$\normo{ t \u } = |t| \, \normo{\u}$.   

% The distance function $d(\u,\v) = \norm{ \u }{ \v}$ makes
% $\ring{R}^N$ into a metric space.  \indy{Index}{metric space}%
% The proof that $d$ is indeed a metric depends on the Cauchy--Schwarz
% inequality.


\begin{lemma}[Cauchy--Schwarz~inequality]\guid{JJKJALK}
\formal{Jordan/metric\_spaces.ml:cauchy\_schwartz}
  \[ |\u \cdot \v| \le
    \normo{\u}\,\normo{\v}.\]  Furthermore, the case
  $\pm \u\cdot \v = \normo{\u}\,\normo{\v}$ of equality holds exactly
  when $\normo{\v} \u = \pm\normo{\u} \v$ (with matching signs).
\end{lemma}
\indy{Index}{Cauchy--Schwarz inequality}%

\begin{proved}
  This is an exercise in real arithmetic.  Let $\w = \normo{\v} \u \pm
  \normo{\u} \v$.  The expansion of $\w\cdot \w$ gives
  \[ 0\le \w\cdot \w = 2\normo{\u}^2\normo{\v}^2 \pm
    2\normo{\u}\, \normo{\v} (\u\cdot \v) = 2\normo{\u}\, \normo{\v}
    (\normo{\u}\, \normo{\v} \pm (\u \cdot \v)).\]  If
  $2\normo{\u} \,\normo{\v} = 0$, then $\u$ or $\v$ is zero, and the
  result easily ensues.  Otherwise divide both sides of the
  inequality by the positive number $2 \normo{\u} \,\normo{\v}$ to
  get the result.  \swallowed\end{proved}

\begin{lemma}[triangle~inequality]\guid{OIPLPTM}
\formal{Jordan/metric\_spaces.ml:norm\_triangle}
\label{lemma:triangle-ineq}
\[ 
\normo{\u + \v} \le \normo{\u} + \normo{\v }.
\] 
Equality holds exactly when $\normo{\v}\u = \normo{\u}\v$.
\end{lemma}
\indy{Index}{triangle inequality}%

\begin{proved}  This is an exercise in real arithmetic.
Both sides are nonnegative; it is enough to compare the squares of
both sides.  By the Cauchy--Schwarz inequality,
\[ \normo{\u + \v}^2 = \u\cdot \u + 2 \u\cdot \v + \v\cdot \v \le
  \u\cdot \u + 2 \normo{ \u}\,\normo{\v} + \v\cdot \v = (\normo{\u}+\normo{\v})^2.
\] 
The case of equality follows from the case of equality in the
Cauchy--Schwarz inequality.
\swallowed\end{proved}



\subsection{affine geometry}




Most of the following definitions apply to
  $n$-dimensional Euclidean space; however, this book uses them only
  in two and three dimensions.  The first definition gives the affine
  span of a finite set.  For example, the affine span of two distinct
  points is a line; the affine span of three independent points is a
  plane.  By placing additional positivity constraints on the linear
  combinations, the definitions extend to a large assortment of other
  geometric objects such as rays, half-planes, convex hulls, and
  cones.  Each of these comes in two versions: an open version defined
  by strict inequality and a closed version defined by weak
  inequality.  For example, the closed half-plane includes a bounding
  line and the open half-plane does not.  In this chapter, open and
  closed are not topological notions; rather, they indicate the
  semialgebraic conditions of strict and weak inequality.


%% No notation is introduced for a general affine hull!
\begin{definition}[affine hull]\guid{KVLZSAQ}
\formaldef{$\op{aff}$}{(hull) affine}
\hspace{-4.2pt}A set $A\subset\ring{R}^N$ is \newterm{affine}, if for
every finite nonempty subset $S\subset A$ and every function $t:S\to\ring{R}$ such that $\sum _{\v\in S} t(\v)=1$, we have
% $\v,\w\in A$ and every $t \in \ring{R}$, 
\[ 
 \sum_{\v\in S} t(\v) \v \in A.  % t \v + (1-t) \w \in A.
\] 
The \fullterm{affine hull}{affine!hull}, $\op{aff}(S)$, of a set $S\subset\ring{R}^N$ is the smallest affine set
containing $S$. 
That is, the affine hull of $S$ is the intersection of all affine
sets containing $S$. 
\end{definition}
\indy{Index}{hull!affine}%



\begin{definition}[affine]\guid{BYFLKYM}\label{def:aff} 
\formaldef{$\op{aff}_\pm$}{aff\_ge, aff\_le}
\formaldef{$\op{aff}^0_\pm$}{aff\_gt, aff\_lt}
  If $V = \{\v_1,\v_2,\ldots,\v_k\}$ and $V'=\{\v_{k+1},\ldots,\v_n\}$
  are finite subsets of $\ring{R}^N$, then set
	\begin{align*}
\op{aff}_{\pm} (V,V') &= \{t_1 \v_1 +\cdots t_n \v_n \mid
	t_1 +\cdots+t_n = 1, \pm t_j \ge 0, \text{ for } j>k\},\\
\op{aff}^0_{\pm} (V,V') &= \{t_1 \v_1 +\cdots t_n \v_n \mid
	t_1 +\cdots+t_n = 1, \pm t_j > 0, \text{ for } j>k\}.
%\op{aff}\, V &= \op{aff}_\pm(V,\emptyset).\\
		\end{align*}
To lighten the notation for singleton sets, abbreviate
$\op{aff}_\pm(\{\v\},V')$ to $\op{aff}_\pm(\v,V')$.
\indy{Notation}{aff2@$\op{aff}_{\pm}$, $\op{aff}^0_{\pm}$}%
\indy{Index}{affine}%
\indy{Notation}{V@$V\subset\ring{R}^n$}%
\end{definition}

\figITGCYIF % fig:affset. 

\begin{remark}
  When $n+1=\card(V)+\card(V')$, the generic set $\op{aff}_+(V,V')$ is
  an $n$-dimensional polyhedron bounded by $\card(V')$ hyperplanes.
  For example, $n=1$, gives a segment, a ray, or a line
  (Figure~\ref{fig:affset}).  When $n=2$, the set is a $2$-simplex, a
  planar wedge bounded by two lines, a half-plane, or a plane.  When
  $n=3$, the set is a $3$-simplex; an unbounded connected region in
  space bounded by one, two, or three intersecting planes; or all of
  $\ring{R}^3$.
\end{remark}

\begin{definition}[convex hull]\guid{OWECYNV}
\formaldef{$\op{conv}$}{(hull) convex}
A subset $C\subset\ring{R}^N$ is \newterm{convex}, if for
every $\v,\w\in C$ and every $t \in \leftclosed0,1\rightclosed$,
\[ 
t \v + (1-t) \w \in C.
\] 
If $S\subset\ring{R}^N$, then let $\op{conv}(S)$ be the smallest convex set
(or equivalently, the intersection of all convex sets)
containing $S$.  It is called the \newterm{convex hull}.
\end{definition}

When the set is finite, the convex hull takes the following form.

\begin{lemma}[]\guid{GDCZMLO}
If $V = \{\v_1,\v_2,\ldots,\v_n\}\subset\ring{R}^N$, then
	\[ 
\op{conv}\, V = \op{aff}_+\, (\emptyset,V).
\] 
\indy{Notation}{conv}%
\indy{Index}{convex hull}%
\end{lemma}

\begin{lemma}[]\guid{UIVNNRR}
If $V\subset\ring{R}^N$ is finite, then
$\op{aff}_\pm (V,\emptyset) = \op{aff}^0_\pm(V,\emptyset)$
is the affine hull of $V$.
\end{lemma}

\begin{proof}  Both proofs are left as  exercises for the reader.
\end{proof}

In the following definition of a cone, the point $\v$ is the apex,
and $V$ is a generating set for the positive directions.  In the
special case that $V$ is a singleton $\{\w\}$, the cone gives a ray
originating at $\v$ and passing through $\w$.  Later chapters call
a set of the form $\op{aff}_+(\v,\{\u_1,\u_2\})$ a \newterm{blade}.
Blades are planar sets bounded by two rays originating at $\v$.
\indy{Notation}{v7@$\v\in\ring{R}^3$}%
\indy{Index}{blade}%

% Cone deprecated Jan 17, 2012.
%\begin{definition}[cone]\guid{LLOUBAX}
%\formaldef{$\op{cone}$}{cone}
%Let $V$ be a finite subset of
%$\ring{R}^N$ and let $\v\in\ring{R}^N$. Set
%\[ 
%\op{cone}(\v,V) = \op{aff}_+(\{\v\},V)
%\op{cone}^0(\v,V) &= \op{aff}^0_+(\{\v\},V)\\
%\] 
%\indy{Index}{cone}%
%\indy{Notation}{cone@$\op{cone}$}%
%\end{definition}

% The Voronoi cell is one of the fundamental geometric objects in this
% book.  Earlier chapters have already discussed it at great length.
% Some authors use a weak inequality in the definition, others strict.
% The definition takes strict inequalities.


%\begin{definition}[Voronoi cell $\Omega$]\guid{VOWVHBW}
%Let $V$ be a finite set of points in 
%$\ring{R}^3$.  Let $\v\in\ring{R}^3$. Set
% \[ 
%\Omega(\v,V) = 
%\{x \mid \norm{\v}{x} \le \norm{\w}{x} forall \w\in V\setminus\{\v\}\}
%\] 
%\end{definition}

%% Changed to weak inequality May 14, 2009. -tchales.
	
\begin{definition}[line,~collinear,~parallel]\guid{SWKFLBJ}
\formaldef{line}{line}
\formaldef{collinear}{collinear}
\formaldef{parallel}{parallel}
  Any set of the form $\op{aff}\{\v,\w\}$ is a \newterm{line} when
  $\v\ne \w$.  A set that is contained in some $\aff\{\v,\w\}$ is
  \newterm{collinear}.  If $\{\orz,\v,\w\}$ is collinear, then
  $\v$ and $\w$ are said to be \newterm{parallel}. Also, $\{\v,\w\}$
  is said to be a parallel set.
\end{definition}
\indy{Index}{line}%
\indy{Index}{collinear}%

\begin{definition}[plane, half plane, coplanar]\guid{JLWZFBH}\label{def:plane}
\formaldef{plane}{plane}
\formaldef{half-plane}{closed\_half\_plane, open\_half\_plane}
\formaldef{coplanar}{coplanar}	
  An affine hull $A=\op{aff}\{\u,\v,\w\}$ is a \newterm{plane} when
  $\{\u,\v,\w\}$ is not collinear.  A set $\op{aff}_\pm(\{\u,\v\},\{\w\})$
  is a \newterm{half-plane} when $\{\u,\v,\w\}$ is not collinear. A
  set that is contained in some $\aff\{\u,\v,\w\}$ is \newterm{coplanar}.
\end{definition}
\indy{Index}{plane}%
\indy{Index}{half-plane}%
\indy{Notation}{A@$A$ (plane)}%
\indy{Index}{coplanar}%


\begin{definition}[half space]\guid{OAUVFPS} 
\formaldef{half space}{closed\_half\_space, open\_half\_space}
A set
  $\op{aff}_{\pm}(\{\u,\v,\w\},\{\v'\})$ is a \newterm{half-space},
  when $\{\u,\v,\w,\v'\}$ is not coplanar.  Under the substitution of
  $\op{aff}_{\pm}$ for $\op{aff}_{\pm}^0$, it is called an
  \newterm{open half-space}.
\end{definition}
\indy{Index}{half-space}%
\indy{Index}{half-space!open}%

\subsection{parallelepiped}\label{sec:piped}
\indy{Index}{parallelepiped}%



The following polynomial, $\Delta$, appears in many different
functions related to the geometry of three dimensions.  The formula
following the definition shows that it is closely related to the
square of the volume of a parallelepiped.  The interpretation as
volume is not relevant until the next chapter, but  its nonnegativity is
immediately relevant.  

%% WW repeated DEF.
\begin{definition}[$\Delta$]\guid{AVWKGNB}\label{def:delta}
\formaldef{$\Delta$}{delta\_x}
\formal{definitions\_kepler.ml:delta\_x}
  Let
\begin{align*}
\Delta(x_1,\ldots,x_6) &= x_1 x_4 (- x_1+x_2+x_3- x_4+x_5+x_6)\\
&\qquad+x_2 x_5 (x_1- x_2+x_3+x_4- x_5+x_6)\\
&\qquad+x_3 x_6 (x_1+x_2- x_3+x_4+x_5- x_6)\\
&\qquad- x_2 x_3 x_4- x_1 x_3 x_5- x_1 x_2 x_6- x_4 x_5 x_6.
\end{align*}
\end{definition}
\indy{Notation}{zzD@$\Delta$}%
\indy{Index}{Cayley--Menger!determinant}%
\indy{Index}{determinant!Cayley--Menger}%


\begin{remark}[Cayley--Menger determinant]\guid{DQGHCSH}\label{rem:cayley}
  The polynomial $\Delta$ appears in the following context.
  Cayley and Menger found a formula for the square of the determinant
  $D$ of the matrix with rows $\v_1-\v_0$, $\ldots,$ $\v_n-\v_0$ for
  arbitrary vectors $\v_i\in\ring{R}^n$.  Set
\begin{equation}\label{eqn:xij}
x_{ij} = \norm{\v_i}{\v_j}^2,
\end{equation}
arranged as entries of a matrix $[x_{ij}]$.
Write $\underbar 1$ for a row vector of length $n$ 
with entries that are all equal to $1\in\ring{R}$.
They found that elementary matrix manipulations give an identity
of determinants:
\begin{align}\label{eqn:cmd}
D^2 &= \frac{(-1)^{n-1}}{2^n}
\left|\begin{matrix}[x_{ij}]& {}^t{\underbar 1}\\ {\underbar 1}& 0
\end{matrix}\right|.
\end{align}
The right-hand side is a polynomial in the squares of the edge lengths.
% The special case $n=2$ gives the polynomial $\ups$
% (Definition~\ref{def:ups}).
\indy{Notation}{D@$D$ (determinant)}%

A calculation of the determinant on the right when $n=3$ yields 
the polynomial $\Delta$.
\[ 
4 D^2 = \Delta(x_{01},x_{02},x_{03},x_{23},x_{13},x_{12}).
\] 
The left-hand side is evidently a square and the polynomial on the
right is nonnegative, whenever the variables $x_{ij}$
satisfy~\eqref{eqn:xij} for some vectors
$\v_0,\ldots,\v_3\in\ring{R}^3$.  Moreover, $D$ and hence also
$\Delta$ is positive when the set of four vectors is not
coplanar.
\end{remark}
\indy{Index}{edge!length}%
\indy{Notation}{zzu@$\ups$ (polynomial)}%
\indy{Notation}{zzD@$\Delta$}%
%\indy{Notation}{xij@$x_{ij}=\norm{\v_i}{\v_j}$}% % doesn't parse
%Write $\Delta_j$ for the $j$th partial derivative of $\Delta$. 
%Let $D = \det(\v_2-\v_1,\v_3-\v_1,\v_4-\v_1)$.
\indy{Index}{determinant}%

\begin{background}[matrix theory]\label{back:matrix}
  Very little matrix theory is required in this book.  The next lemma
  is a rare exception.  Its proof requires various very basic facts
  about $3\times 3$ matrices and determinants.  The determinant of a
  product of two matrices is the product of determinants.  The
  transpose of a matrix $A$ has the same determinant as $A$.  The
  determinant of a matrix $A$ is zero if and only if there exists a
  (row) vector $\u$ such that $\u\, A = \orz$.
\end{background}

\begin{lemma}[]\guid{CTCZHMR}\label{lemma:delta-pos}
  Let $V=\{\v_0,\v_1,\v_2,\v_3\}\subset\ring{R}^3$.  Let $x_{ij} =
  \norm{\v_i}{\v_j}^2$.  Then $\Delta(x_{ij})\ge 0$.  Moreover, the
  set $V$ is coplanar if and only if $\Delta(x_{ij}) = 0$.%
\mar{\guid{LBEVAKV} $\ge$ LEG}  % delta >=0, 
\mar{\guid{POLFLZY} $=$ LEG} % coplanar <=> delta=0.
\mar{more on $\Delta$ in LEG}
\end{lemma}

\begin{proof} The proof is an exercise in
  matrix theory and
  real arithmetic.  (The statement also
  falls within the scope of Tarski
  arithmetic.)  This lemma can be proved directly as follows, without
  recourse to the general Cayley--Menger theorem.

  Let $A$ be the $3\times 3$ matrix with rows  $\v_i - \v_0$.  Then
  $D^2 = \det(A)^2 = \det(A \,\hbox{}^t A)$.  Each entry of the
  product $A\,\hbox{}^tA$ is a dot product $(\v_i-\v_0)\cdot
  (\v_j-\v_0)$, which can be expressed in terms of the constants
  $x_{ij}$ by the following identity:
\begin{align}\label{eqn:dot-law}
  2 (\v_i-\v_0)\cdot (\v_j-\v_0) 
&= (\v_i-\v_0)\cdot(\v_i-\v_0) + (\v_j-\v_0)\cdot (\v_j-\v_0)\nonumber \\
  & \qquad - (\v_i-\v_j)\cdot (\v_i-\v_j)\nonumber\\
&= x_{i0} + x_{j0} - x_{ij}.
\end{align}
%which equals $x_{i0} + x_{j0} - x_{ij}$.
A computation of the determinant then gives $4D^2=\Delta$.
Thus, $D^2\ge0$ implies $\Delta\ge 0$.

Also $\Delta=0$ if and only if $D=0$, which holds if and only if $\u\,
A = \orz$ for some vector $\u$.  By the
definition of coplanar, this holds if and only
if $V$ is coplanar.
\end{proof}

\begin{remark}\guid{SZIHGLO}
  The calculation of the general Cayley--Menger formula~\eqref{eqn:cmd}
  for $n+1$ points in $\ring{R}^n$ is based on the same method as the
  $3\times 3$ case; the identity~\eqref{eqn:dot-law} gives a rewrite
  rule for each matrix entry of $\det(A\,\hbox{}^t A)$ as a linear
  combination of the variables $x_{ij}$.  Row and column operations
  then put the matrix in a form in which each matrix entry is a single
  variable $x_{ij}$.
\end{remark}

\begin{remark}[]\guid{KZVHHBG}\label{rem:CM5}
  The volume of a $4$-simplex in $\ring{R}^3$ is zero.  This implies
  that Cayley--Menger determinant for $\v_0,\ldots,\v_4\in\ring{R}^3$
  is zero.  %
  \mar{\guid{NUHSVLM} LEG}%
  \mar{\guid{RPFVZDI} LEG}%
  \mar{\guid{GJWYYPS} LEG}%
  \mar{\guid{GDLRUZB} LEG}% 
  \mar{\guid{LTCTBAN} LEG}%
  This gives a polynomial relation between the $10 = \tbinom{5}{2}$
  squared edge lengths $x_{ij}$.  The relation is
  quadratic in the tenth edge, say $x=x_{04}$, expressing it in terms of the other
  nine. The leading coefficient of the quadratic polynomial is nonzero if $\{\v_1,\v_2,\v_3\}$
  is not collinear.
\end{remark}

\section{Angle}\label{sec:angle}

Until now, the discussion of trigonometric functions has been purely
analytic.  This section interprets them geometrically.  It covers
fundamental identities in both Euclidean and spherical trigonometry,
including the law of cosines, the law of sines, the spherical law of
cosines, and a beautiful formula that Euler and Lagrange gave for the area of a spherical triangle.

If $\v,\w$ are nonzero vectors, then by the
Cauchy--Schwarz inequality,
\[ -1 \le \frac{\v\cdot \w}{\normo{\v}\,\normo{\w}}
  \le 1.\]  The middle term  lies in the
domain of the function $\arccos$. The value of this function is the angle in  the following
definition.  \indy{Index}{Cauchy--Schwarz inequality}%
\indy{Notation}{v7@$\v\in\ring{R}^3$}%
\indy{Notation}{wi@$\w\in\ring{R}^3$}%

\begin{definition}[angle,\ arclength]\guid{WZYUXVC}\label{def:angle}
\formaldef{$\arc_V$}{arcV}
Let $\u,\v,\w$ be vectors with $\u\ne \v,\w$.
Define 
\[ 
  \arc_V(\u,\{\v,\w\}) = \arccos\left(\frac{(\v-\u)\cdot 
(\w-\u)}{\norm{\v}{\u}\,\norm{\w}{\u}}\right).
\] 
The value of this function is the \newterm{angle} at $\u$ formed by
$\v$ and $\w$.  
\indy{Index}{angle}%
\indy{Index}{arc}%
\indy{Index}{arclength}%
\indy{Notation}{wi@$\w\in\ring{R}^3$}%
\indy{Notation}{arcv@$\arc_V$}%
\end{definition}

\figLIKEURF % fig:arcV

%\begin{remark}\guid{OAXCOPU}
%  According to the formalist,  a definition requires no
%  justification.  As Hilbert
%  famously said, ``One must be able to say at all times -- instead of
%  points, straight lines, and planes -- tables, beer mugs, and
%  chairs.''  The intuitive geometer asks for more: angles should be
%  invariant under isometries of $\ring{R}^n$, and when $\u,\v,\w$ are
%  mapped by an isometry into a fixed plane, this definition of angle
%  in $\ring{R}^n$ should agree with the accepted definition in the
%  plane.  This definition meets such a standard.  The norm
%  (Definition~\ref{def:norm}) also extends the intuition of the plane,
%  obtained as it is by successive applications of the Pythagorean
%  theorem in two dimensions.
%\[
%\normo{\u}^2 = u_0^2 + v_0^2,\quad v_0^2 = u_1^2 + v_1^2,\ldots
%\quad v_{n-2}^2 = u_{n-1}^2 + v_{n-1}^2,\qquad v_{n-1}=0.
%\]
%\end{remark}

By the relation between $\arccos$ and $\atn$
(Lemma~\ref{lemma:arccos-arctan}), %if $|\u\cdot \v|\ne
                                   %\normo{\u}\,\normo{\v}$,
%then 
\begin{equation}\label{eqn:angle}
  \arc_V(\orz,\{\v,\w\}) = \frac{\pi}2 - \atn\left ({\sqrt{(\normo{\v}^2\normo{\w}^2 -
        (\v\cdot \w)^2)}}, {\v\cdot \w}\right).
\end{equation}
\mar{\guid{ACNBFRL} Eq.~\ref{eqn:angle}}
\indy{Index}{arclength}%

The notation $\arc_V$ for angle comes from its interpretation as the
length of a geodesic arc on a unit sphere
centered at $\u$ from point $\v$ to $\w$.
\indy{Index}{arc!geodesic}%
The subscript $V$ is a reminder that
the function arguments are vectors.  The function
$\arc$, without the subscript,  gives the angle as a function
of the three edge lengths of a triangle.
\indy{Notation}{V@$V$ (subscript marking vector functions)}%
\indy{Notation}{arc@$\arc$}%

% \begin{definition}[arc length]\guid{WHDSIZT} 
%The arclength of a geodesic arc on a
%   unit sphere centered at $\v_0$ from point $\v_1$ to $\v_2$ is the
%   angle formed by $\v_1$ and $\v_2$ at $\v_0$.
%\end{definition}

\begin{definition}[arc]\guid{PQQDENV}\label{def:arc}
\formaldef{arc}{arclength}
Define
\[ \arc(a,b,c) = \arccos(\frac{a^2 + b^2 - c^2}{2 a
    b}).\] 
\indy{Index}{arc}%
\end{definition}

If the triangle inequalities hold:
\[ 
a + b \ge c,\quad b + c \ge a, \quad c+a \ge b
\] 
and if $a,b >0$, then
\[ 
  2 a b = (\mp a+b+c)(a \mp b \pm c) \pm (a^2 + b^2 - c^2) 
\ge \pm  (a^2 + b^2 - c^2)
\] 
and the argument of $\arccos$ in the definition of $\arc$ falls within
its domain.

\begin{lemma}[law of cosines]\guid{HQTBPCM}\label{lemma:loc}
Let $\u,\v,\w$ be vectors with $\v\ne \u$, $\w\ne \u$.  Let $a
= \norm{\w }{ \u}$, $b = \norm{\v }{ \u}$, and $c = \norm{\v }{ \w}$.
Let $\gamma=\arc_V(\u,\{\v,\w\})$.    Then
\[ c^2 = a^2 + b^2 - 2 a b \cos\gamma.\] 
Also,
\[ 
\arc_V(\u,\{\v,\w\})= \arc(a,b,c).
\] 
%if $\v$, $\w$, and $\u$ are not collinear then

\end{lemma}
\indy{Notation}{zzc@$\gamma$ (angle)}%
\indy{Index}{arc}%
\indy{Index}{law of cosines} %
\indy{Index}{trigonometry!law of cosines}%
\indy{Index}{cosine!law of cosines}%

\begin{proved}
By the definition of $\arc_V$, the
definition of $\arccos$, and~\eqref{eqn:dot-law},
\[ 
2 a b \cos \gamma = 2 (\w - \u)\cdot (\v - \u) = a^2 + b^2 - c^2.
\] 
This identity can be solved for $\gamma$ and
 gives the final statement of the lemma.  \swallowed\end{proved}


\begin{definition}[$\ups$]\guid{OBPIOXD}\label{def:ups}
\formaldef{$\ups$}{ups\_x}
Let $\ups$ (the symbol is a Greek upsilon, which is written with a
wider stroke than a roman vee) be the polynomial
\[ \ups(x,y,z) = -x^2 - y^2 - z^2 + 2 x y + 2 y z + 2
  z x.\] 
\indy{Notation}{zzu@$\ups$ (polynomial)}%
\end{definition}



%% WW Repeated def (tarski.tex)
This polynomial is nonnegative under conditions described by the
following lemma. 


\begin{lemma}[]\guid{QRAAWFS}\label{lemma:ups} Let
  $V=\{\v_0,\v_1,\v_2\}\subset\ring{R}^3$.  Let $x_{ij} =
  \norm{\v_i}{\v_j}^2$.  Then 
\[
\ups(x_{01},x_{12},x_{02})\ge 0.
\]
  Moreover, the set $V$ is collinear if and only if $\ups(x_{ij}) =
  0$.%
\mar{\guid{FHFMKIY} $=$ LEG}
\end{lemma}

\begin{proof}
The polynomial factors
\begin{equation}\label{eqn:ups}
\ups(a^2,b^2,c^2) = 16 s (s-a) (s-b)
  (s-c),
\end{equation}
\mar{\guid{IHIQXLM} Eq.~\ref{eqn:ups}}
where $s = (a+b+c)/2$.  If $a,b,c$ are the lengths of the sides of a triangle, then
$a,b,c\ge0$ and the triangle inequality (Lemma~\ref{lemma:triangle-ineq})
holds for all orderings of sides: $(b+c-a)\ge 0$ and so forth.
Non-negativity $0\le \ups(a^2,b^2,c^2)$ follows from the triangle
inequality applied to each factor in the factorization of $\ups$:
$2(s-a) = (b+c-a) \ge0$ and so forth.  The case of equality in the lemma is the
case of equality in the triangle inequality.
\indy{Index}{Cauchy--Schwarz inequality}%
\indy{Index}{triangle inequality}%
\end{proof}

An alternative way to view nonnegativity is
that $\ups$, like $\Delta$, is the square of a Cayley--Menger determinant
\eqref{eqn:cmd}.  
\[
0\le (2D)^2 = -
\left|\begin{matrix} 0 & a^2 & b^2 & 1\\ a^2 & 0 & c^2 & 1\\  b^2 & c^2 & 0 & 1\\
1 & 1 & 1& 1
\end{matrix}\right| = \ups(a^2,b^2,c^2).
\]
Section~\ref{sec:cross}  further identifies
the determinant $D$ as the norm of a cross product.
Volume and area are the topics of the next chapter, but it
is appropriate at this point to consider a formula for the area of a
triangle.  By means of formula \eqref{eqn:ups} for $\ups$, Heron's classical formula
for the area of a triangle with sides $a,b,c$ can be put in the form
\[ \sqrt{\ups(a^2,b^2,c^2)}/4.\] 
\indy{Index}{Heron's formula}%


\begin{lemma}[law of sines]\guid{UKBAHKV}\label{lemma:los}
Assume that $a,b>0$ and $a+b\ge c$, $b+c\ge a$, and $c+a\ge b$.
Let $\gamma=\arc(a,b,c)$.  Then
\[ 2 a b \sin\gamma =
  \sqrt{\ups(a^2,b^2,c^2)}.\] 
\end{lemma}
\indy{Index}{trigonometry!law of sines}%
\indy{Index}{law of sines}%
\indy{Index}{sine!law of sines}%
\begin{proved}
  Both sides are nonnegative, so it is
  enough to check that their squares are equal.  By the definition of
  $\arc$, we have
\[ 
4 a^2 b^2 \sin^2\gamma 
= 4 a^2 b^2 (1-\cos^2\gamma) 
= (4 a^2 b^2 - (a^2 + b^2 -
c^2)^2) 
= \ups(a^2,b^2,c^2).\] 
% checked 4/4/2008
\swallowed\end{proved}

Another useful relation writes $\arc$ in terms of $\atn$.
\begin{equation}\label{eqn:arc-atn}
\arc(a,b,c) = 
\pi/2 - \atn\Big({\sqrt{\ups(a^2,b^2,c^2)}},{ a^2 + b^2 - c^2}\Big).
\end{equation}
\mar{\guid{GVWTZKY} Eq.~\ref{eqn:arc-atn}}
This follows directly from Lemma~\ref{lemma:arccos-arctan} and the
definitions of $\arc$ and
  $\ups$.



\subsection{cross product} \label{sec:cross}

This book makes infrequent use of the cross product.
A definition and the most basic properties  suffice.

\begin{definition}[cross product]\guid{FCUAGAJ}\label{def:cross}
\formaldef{cross product}{(cross)}   
Let $\v =(x,y,z)$ and $\w = (x',y',z')$.  
Let the cross product be defined
by
\[ 
\v \times \w = (y z' - y' z, z x' - x z', x y' - y x').
\] 
\indy{Index}{cross product}%
\indy{Index}{vector!cross product}%
\indy{Notation}{5@$\times$ (cross product)}%
\end{definition}

\begin{lemma}[]\guid{KVVWPNA}  
\label{lemma:los-cross}
Any two vectors $\v,\w\in \ring{R}^3$ satisfy
\[ \normo{\v \times \w} =
  \normo{\v}\,\normo{\w}\sin\gamma,\] 
where $\gamma=\arc_V(\orz,\{\v,\w\})$.
Also, $\v \cdot (\v\times \w) = \w\cdot (\v\times \w) = \orz$.
\end{lemma}

\begin{proved} This proof is an exercise in
  real arithmetic and basic trigonometry.
  Both the left and
  right sides are nonnegative, so it is
  enough to compare the squares of both sides.  The square of the
  left-hand side is
\begin{align}\label{eqn:cross-dot}
  \normo{\v \times \w}^2 &= (y z'- y'z)^2 + (z x' - x z')^2 + (x y' - y x')^2 \notag\\
  &= %\qquad\qquad=
  (x^2 + y^2 + z^2)(x'^2 + y'^2 + z'^2) - (x x' + y y' + z z')^2
 \notag \\&= %\qquad\qquad =\, 
  \normo{\v}^2\normo{\w}^2 - (\v\cdot \w)^2\\
  &= %\qquad\qquad=\, 
  \normo{\v}^2\normo{\w}^2 ( 1 - \cos^2\gamma)\notag\\
  &= %\qquad\qquad=\, 
\normo{\v}^2\normo{\w}^2 \sin^2\gamma.\notag
\end{align}
The second assertion of the lemma follows by arithmetic directly from
the definitions of the dot and cross products.  \swallowed\end{proved}

\begin{lemma}[]\guid{GZPIJUR}\label{lemma:cross-collinear}
For any $\v,\w\in\ring{R}^3$,
the set $\{\orz,\v,\w\}$ is collinear if and only if $\v\times\w=\orz$.
\end{lemma}

\begin{proof}
By Equation~\eqref{eqn:cross-dot},
\[
\v\times\w = \orz \quad\text{ if and only if }\quad \normo{\v}\normo{\w} = | (\v\cdot \w) |.
\]
This is the case of equality in the Cauchy--Schwarz inequality, which is given as
%
%
%By Lemma~\ref{lemma:los-cross}, $\v\times\w=\orz$ if and only if $\v=\orz$, $\w=\orz$,
%or $\arc_V(\orz,\{\v,\w\})$ is $0$ or $\pi$.  By the definition of $\arc_V$, it equals $0$ or $\pi$
%exactly in the case of equality of the Cauchy--Schwarz inequality.
\[
\normo{\v} \,\w = \pm \normo{\w}\,\v.
\]
This is equivalent to the collinearity of $\{\orz,\v,\w\}$.
\end{proof}

\begin{lemma}[]\guid{BKMUSOX}\label{lemma:cross-id}
\[ 
\u\times \v = -\v\times \u,\quad
(\u\times \v)\cdot \w = (\v\times \w)\cdot \u,\quad
(\u\times  \v)\times \w = (\u\cdot \w)\, \v - (\v\cdot\w) \,\u.
\] 
\end{lemma}

\begin{proved}
These are arithmetic consequences of the definition of cross product.
\swallowed\end{proved}



\subsection{dihedral angle}

A dihedral angle of a tetrahedron is the angle formed between two of
its facets. In general, the dihedral angle refers to the angle formed
by two half-planes delimited by a common line.  The dihedral angle is
determined by a pair $\{\v_0,\v_1\}$ of points on the delimiting line
and another pair $\{\v_2,\v_3\}$ of two points on the respective
half-planes.  \indy{Index}{angle!dihedral}%
\indy{Index}{tetrahedron}%
\indy{Notation}{dihv@$\dih_V$}%
\indy{Index}{vector!projection}%
\indy{Index}{orthogonality} %

\begin{definition}[dihedral angle]\guid{YMHELNF}\label{def:dih}
\formaldef{$\dih_V$}{dihV}
 When $\v_0\ne \v_1$,
  write $\dih_V(\{\v_0,\v_1\},\{\v_2,\v_3\})$ for the angle
  $\gamma\in[0,\pi]$ formed by
\[ 
\bar {\w}_2 = (\w_1\cdot \w_1) \w_2 - (\w_1\cdot \w_2) \w_1\textand  \bar {\w}_3 =
(\w_1\cdot \w_1) \w_3 - (\w_1\cdot \w_3) \w_1,
\] 
where $\w_i=\v_i-\v_0$.  We call it
the dihedral angle formed by $\v_2$ and $\v_3$ along $\{\v_0,\v_1\}$.
\indy{Notation}{dih}%
\indy{Index}{angle!dihedral}%
\end{definition}
The subscript $V$ is a reminder 
that the dihedral angle takes vector arguments.
Later, a second version, without the subscript, 
computes the angle as a function of the lengths of edges of a 
tetrahedron.
\indy{Index}{edge!length}%
\indy{Notation}{V@$V$ (subscript marking vector functions)}%
As the notation suggests, the dihedral angle depends only
on the unordered pairs $\{\v_0,\v_1\}$, $\{\v_2,\v_3\}$.

\figGJRSLPT % fig:dih


The dihedral angle can be interpreted as the planar angle between two rays, obtained by
projection of the two half-planes to a plane orthogonal to both of
them.  Up to positive scalars, $\bar {\w}_2$ and $\bar {\w}_3$ are the
projections of $\w_2$ and $\w_3$ to the plane through the origin
orthogonal to the vector $\w_1$.  The dihedral angle is the angle
between the projections $\bar {\w}_2$ and $\bar {\w}_3$ at $\orz$.

\begin{remark}\label{rem:dih}\guid{LHYCNII}
  The dihedral angle is unchanged if $\w_1$ is replaced with $t \w_1$ with
  $t\ne0$. The dihedral angle is unchanged if $\w_2$ is replaced with
  $t_2 \w_2 + t_1 \w_1$ with $0 < t_2$ and $t_1$ arbitrary because
  such points project along the same ray.  It is unchanged if $\w_3$ is
  replaced with $t_3 \w_3 + t_1 \w_1$ with $0 < t_3$ and $t_1$
  arbitrary, because such points project along the same ray.  In
  particular, the dihedral angle formed by $\w_2$ and $\w_3$ along
  $\{\orz,\w_1\}$ is the same as that formed by $\w_2/\normo{\w_2}$ and
  $\w_3/\normo{\w_3}$ along $\w_1/\normo{\w_1}$.
\end{remark}

The dihedral angle is degenerate and is not be used when $\w_1 =
\orz$, $\bar {\w}_2 = \orz$, or $\bar {\w}_3 = \orz$.  Equivalently, degeneracy
occurs when $\{\v_0,\v_1,\v_2\}$ or $\{\v_0,\v_1,\v_3\}$ is a collinear set.

\begin{lemma}\guid{HVIHVEC}\label{lemma:dih-cross}
  Let $\v_0,\ldots,\v_3\in\ring{R}^3$ be given with $\v_0\ne \v_1$.
  Then 
 \[
\dih_V(\{\v_0,\v_1\},\{\v_2,\v_3\})
\] 
is the angle at $\orz$ formed by
  $\w_1\times \w_2$ and $\w_1\times \w_3$, where $\w_i= \v_i-\v_0$.
\end{lemma}

\begin{proof}  For any  $\u,\v,~\w\in\ring{R}^3$ with $\u\cdot\w=\v\cdot\w=0$, 
we use Lemma~\ref{lemma:cross-id}
to compute
\begin{align*}
  (\u\times \w)\cdot (\v\times \w) &= - (\u\times \w)\cdot (\w\times \v) \\
  &= -\v\cdot ((\u\times \w)\times \w) \\
  &= -\v\cdot (-(\w\cdot \w) \u)\\
  &= \,\,(\u\cdot \v) (\w\cdot \w).
\end{align*}
That is, $\wild\times \w$ preserves dot products, up to a scalar
$(\w\cdot\w)$.  Thus, if $\w\ne\orz$, the angle formed by $\u$ and
$\v$ is equal to the angle formed by $\u\times \w$ and $\v \times \w$.

The dihedral angle is the angle formed by
\begin{align*}
  \bar {\w}_2 & = (\w_1\cdot \w_1) \w_2 - (\w_1\cdot \w_2) \w_1 = (\w_1\times \w_2)\times \w_1\\
  \bar {\w}_3 & = (\w_1\cdot \w_1) \w_3 - (\w_1\cdot \w_3) \w_1 = (\w_1\times \w_3)\times \w_1.
\end{align*}
Let $\u=\w_1\times \w_2$, $\v=\w_1\times \w_3$, and $\w=\w_1$.  The
preceding calculation shows that the angle formed by $\bar {\w}_2 =
\u\times\w$ and $\bar {\w}_3 = \v\times \w$ is equal to the angle formed
by $\u$ and $\v$.  The lemma ensues.
\end{proof}

\begin{lemma}[spherical law of cosines]\guid{RLXWSTK}\label{lemma:sloc}
   \formalauthor{Nguyen Quang Truong} Let $\gamma$ be the
  dihedral angle formed by $\v_2$ and $\v_3$ along $\{\v_0,\v_1\}$.  Let
  $a$, $b$, and $c$ be the angle at $\v_0$ between $\v_3$ and $\v_1$, $\v_2$
  and $\v_1$, and $\v_2$ and $\v_3$, respectively. %Assume $\v_1\ne \v_0$.
  Assume that $\{\v_0,\v_1,\v_2\}$ and $\{\v_0,\v_1,\v_3\}$ are not collinear.
  Then
  \[ \cos\gamma = \frac{\cos c - \cos a \cos b}{\sin
      a\sin b}.\] 
\end{lemma}
\indy{Index}{cosine!spherical law of cosines}%
\indy{Index}{spherical!law of cosines}%
\indy{Index}{trigonometry!spherical}%

\begin{remark}
  The spherical law of cosines is the most fundamental identity of
  spherical trigonometry.  A \fullterm{spherical
    triangle}{spherical!triangle} is a figure formed by three points
  on a unit sphere, together with three minimal geodesic arcs on the
  sphere that connect each pair of points.  In the lemma, $a$, $b$,
  and $c$ are the arclengths of the sides of a spherical triangle with
  vertices $\v_2/\normo{\v_2}$, $\v_3/\normo{\v_3}$, and
  $\v_1/\normo{\v_1}$, when $\v_0=\orz$. See Figure~\ref{fig:sloc}.
  Also, $\gamma$ measures the angle of the spherical triangle opposite
  the side $c$.  
  \indy{Index}{triangle!spherical}%
\end{remark}

\figNUPFYMD % spherical law of cosines.


\begin{proof} The proof is an exercise based on previously established
  trigonometric identities.  Let $\w_i = \v_i-\v_0$.  An earlier
  remark states that the dihedral angle is
  unchanged if $\w_2$, $\w_3$, and $\w_1$ are replaced by
  $\w_2/\normo{\w_2}$, $\w_3/\normo{\w_3}$, $\w_1/\normo{\w_1}$,
  respectively.  Hence, we may assume without loss of generality that
  $\normo{\w_2}=\normo{\w_3}=\normo{\w_1}=1$.

Let $\bar{\w}_2$ and $\bar{\w}_3$ be the vectors in Definition~\ref{def:dih}.
The law of cosines gives
\[ \cos\gamma = \frac{\bar{\w}_2\cdot \bar{\w}_3}
{\normo{\bar{\w}_2}\,\normo{\bar{\w}_3}}.
\] 
The unit normalizations of $\w_3,\w_2,\w_1$ give
\[ 
\normo{\bar{\w}_2}^2 = \bar{\w}_2\cdot \bar{\w}_2 =
(\w_2 - (\w_1\cdot \w_2)\w_1)\cdot (\w_2 - (\w_1\cdot \w_2) \w_1) =
1 - (\w_1\cdot \w_2)^2 = \sin^2 b.
\] 
So $\normo{\bar{\w}_2} =\sin b$. Similarly, $\normo{\bar{\w}_3} = \sin a$.
These calculations give the denominator in the spherical law of cosines.  An
expansion of the dot product gives the numerator:
\begin{align*}
\bar{\w}_2\cdot \bar{\w}_3 &=
 (\w_2 - (\w_1\cdot \w_2) \w_1)\cdot (\w_3 - (\w_1\cdot \w_3) \w_1)\\
&= (\w_2\cdot \w_3) - (\w_1\cdot \w_2) (\w_1\cdot \w_3) \\
&= \cos c - \cos a \cos b.
\end{align*}
The identity ensues.
\end{proof}

The spherical law of cosines gives the angles of a spherical triangle
as a function of its sides.  In spherical geometry, a
duality%
\footnote{In three-dimensional Euclidean space, the orthogonal
  complement of a plane through the origin is a line through the
  origin, giving a duality between planes and lines through the
  origin.  The intersection of each plane and line with a unit sphere
  at the origin yields a duality between great circles and antipodal
  pairs of points (the poles of the great circle).  The three edges of
  a spherical triangle $ABC$ lie on three great circles that
  determine three antipodal pairs of points.  From each of the three
  pairs, a coherent choice can be made between the two poles (with the preferred pole closer to the opposite vertex of $ABC$).  These
  three poles are the vertices of the polar triangle $A'B'C'$.  Each
  statement about the triangle $ABC$ can be dualized to a statement
  about $A'B'C'$.  In particular, the edges $a,b,c$ and angles
  $\alpha,\beta,\gamma$ of $ABC$ are related to those $a',b',\ldots$
  of $A'B'C'$ by
\[ 
a + \alpha' = \pi,\quad a' + \alpha= \pi,
\] 
and so forth.}%
\,\,exists between angles and sides of a triangle.  As a result, formulas
in spherical trigonometry tend to come in pairs.  The spherical law of
cosines gives the angle of a spherical triangle as a function of its
edge lengths.  The polar form of the formula gives the edge length of
a spherical triangle as a function of its angles.  Up to signs, the
polar formula has the same form as the law of cosines.
\indy{Index}{great circle}%
\indy{Notation}{A@$ABC$ (triangle)}%
\indy{Index}{polar!triangle}%

\pagebreak[4]
\begin{lemma}[spherical law of cosines - polar form]\guid{NLVWBBW}
\label{lemma:sloc2} \formalauthor{Nguyen Quang Truong} Let
  $\{\v_0,\v_1,\v_2,\v_3,\}\subset\ring{R}^3$.  Let
  $\alpha,\beta,\gamma$ be the dihedral angles:
\begin{align*}
\alpha &= \dih_V(\{\v_0,\v_2\},\{\v_3,\v_1\})\\
\beta &= \dih_V(\{\v_0,\v_3\},\{\v_2,\v_1\})\\
\gamma&= \dih_V(\{\v_0,\v_1\},\{\v_3,\v_2\}).\\
\end{align*}
Let $c$ be the
angle between $\v_2$ and $\v_3$ at $\v_0$. 
Assume that $\{\v_0,\v_2,\v_1\}$, $\{\v_0,\v_2,\v_3\}$, and $\{\v_0,\v_3,\v_1\}$ are not collinear.
Then
\[ 
\cos c = \frac{\cos \gamma + \cos \alpha \cos \beta}
{\sin \alpha\sin \beta}.
\] 
\end{lemma}
\indy{Index}{cosine!spherical law of cosines}%
\indy{Index}{spherical!law of cosines}%

\begin{proof}  
  What follows is a direct computational proof that avoids polarity and
is an
  application of established trigonometric identities.  Let $a$ be the
  angle between $\v_1$ and $\v_3$, and let $b$ be the angle between $\v_1$
  and $\v_2$ at $\v_0$.  Let $A=\cos a$, $B=\cos b$, $C=\cos c$,
  $A'=\sin a$, $B'=\sin b$, $C'=\sin c$.  The spherical
  law of cosines gives
\[ \sin^2\beta = 1-\left(\frac{B-A C}{A' C'}\right)^2
  = \frac{p}{A'^2 C'^2},\] 
where $p=1-A^2 - B^2 - C^2 + 2 A B C$.
In particular, $p\ge 0$.
\indy{Notation}{p@$p$ (trigonometric expression)}%
A computation of $\sin^2\alpha$ and the remaining terms in the same way gives
\begin{align*}
  \sin\alpha\sin\beta &= \frac{\displaystyle p}{\displaystyle A' B' C'^2}\\ 
  \\
  \cos\gamma + \cos\alpha \cos\beta &=
  \frac{\displaystyle C - A B}{\displaystyle A' B'} + 
\frac{\displaystyle A - B C}{\displaystyle B' C'} 
\frac{\displaystyle B - A C}{\displaystyle A' C'}
  = \frac{\displaystyle p C}{\displaystyle A' B' C'^2}.
% C &= \frac{\cos\gamma + \cos\alpha \cos\beta}{\sin\alpha \sin\beta}\\
\end{align*}
The result follows by real arithmetic.
\end{proof}

The following lemma gives a formula for the dihedral angle
of a tetrahedron along an edge in terms of its edge lengths.  The
familiar polynomials $\ups$ and $\Delta$ appear once again.
\indy{Notation}{zzu@$\ups$ (polynomial)}%
\indy{Notation}{zzD@$\Delta$}%


\begin{lemma}[]\guid{OJEKOJF}\label{lemma:dihform}
\formalauthor{Nguyen Quang Truong}
Let $\v_0,\v_1,\v_2,\v_3$ 
be vectors with $\{\v_0,\v_1,\v_2\}$ not collinear, 
and $\{\v_0,\v_1,\v_3\}$ not
collinear. 
Let $\gamma$ be the dihedral angle formed
by $\v_2$ and $\v_3$ along $\{\v_0,\v_1\}$. Let
\[ (x_1,\ldots,x_6) = 
(x_{01},x_{02},x_{03},x_{23},x_{13},x_{12}),
\text{ where } x_{ij}=\norm{\v_i}{\v_j}^2.\] 
Let $\Delta_4$ be the partial derivative of $\Delta(x_1,\ldots,x_6)$ with
respect to $x_4$.
The dihedral angle $\gamma=\dih_V(\{\v_0,\v_1\},\{\v_2,\v_3\})$
is given by
\[ 
\gamma=\arccos\left(\frac{\Delta_4(x_1,\ldots,x_6)}{\sqrt{
\ups(x_1,x_2,x_6)\ups(x_1,x_3,x_5)}}\right).
\] 
%Assuming that $\gamma\ne 0,\pi$, 
It is also given by
\[ 
\gamma=\frac{\pi}{2} - \atn
\Big({\sqrt{4 x_1 \Delta(x_1,\ldots,x_6)}},{\Delta_4(x_1,\ldots,x_6)}\Big).
\] 
\end{lemma}
%% pi/ 2. -  arctan(  deltax4/ (sqrt (4. * x1 * delta)))
\indy{Index}{angle!dihedral}%

\indy{Notation}{zzb@$\beta$ (angle)}%
\begin{proof}  We use the notation $\w_i, \bar{\w}_i$ established in Definition~\ref{def:dih}.
  Let $\beta = \arc_V(\v_0,\{\v_1,\v_2\})$.  The assumptions give
  $\bar{\w}_2\ne \orz$ and $\bar{\w}_3 \ne \orz$.  
  By expanding definitions and dot products and by the
  law of sines,
\[ 
  \bar{\w}_2\cdot \bar{\w}_2 = (\w_1\cdot \w_1) ((\w_1\cdot \w_1)(\w_2\cdot \w_2) -
  (\w_1\cdot \w_2)^2) =  x_1^2 x_2 \sin^2 \beta = \frac{1}{4}
  x_1
  \ups(x_1,x_2,x_6).
\] 
Similarly,
\[ \bar{\w}_3 \cdot \bar{\w}_3 = \frac{1}{4} x_1
  \ups(x_1,x_3,x_5)\] 
%Let $y_i = \sqrt{x_i}$. 
and by dot product formula \eqref{eqn:dot-law},
\begin{align*}
    \bar{\w}_2\cdot \bar{\w}_3 &= (\w_1\cdot \w_1)((\w_1\cdot \w_1)(\w_2\cdot \w_3) -
    (\w_1\cdot \w_2)(\w_1\cdot \w_3) ) \vspace{6pt} \\  
    &= x_1 \left(\frac{\displaystyle x_1 (x_2 + x_3 -
        x_1)}{2} - \frac{\displaystyle (x_1 + x_2 - x_6)(x_1 + x_3 -
        x_5)}{4} \right)\vspace{6pt}\\
%= \frac{x_1}{4} (2 x_1 (x_2+x_3-x_4) -
%(x_1+x_2-x_6)(x_1+x_3-x_5)) \vspace{6pt}\\
&= {x_1\Delta_4(x_1,\ldots,x_6)}/{4}.
\end{align*}
The result follows in terms of $\arccos$.

The translation to $\atn$ uses the $\arccos$-$\atn$
identity (Lemma~\ref{lemma:arccos-arctan}) and the following polynomial
identity
\[ 
  % \frac{16}{x_1^2}(\normo{\bar{\w}_2}^2 \normo{\bar{\w}_3}^2 - (\bar
  % \w_2\cdot \bar{\w}_3)^2) =
\ups(x_1,x_2,x_6)\ups(x_1,x_3,x_5) - \Delta_4(x_1,\ldots,x_6)^2
= 4 x_1 \Delta(x_1,\ldots,x_6).
\] 
\end{proof}

\subsection{Euler triangle}

The expression $\alpha_1+\alpha_2+\alpha_3-\pi$ is \newterm{Girard's
  formula} (known first to Harriot) for the area of a spherical
triangle with angles $\alpha_1$, $\alpha_2$, $\alpha_3$.  We return to
this formula in the next chapter~\eqref{eqn:girard}, when area and
volume are treated.  Although the statement and proof do
not explicitly mention area, the following lemma can be interpreted
as an alternative formula discovered by Euler and Lagrange for the
area of a spherical triangle.
% \indy{Index}{Girard, A.}%
% Albert Girard's Book on trigonometry was published in 1626. Harriot
% lived 1560 - 1621.
\indy{Index}{Girard's formula}%
\indy{Index}{triangle!spherical}%
\indy{Notation}{zza@$\alpha$ (angle)}%
\indy{Index}{Harriot, T.}%

\begin{lemma}[Euler triangle]\guid{JLPSDHF}\label{lemma:euler} %was 600
Let $\v_0,\v_1,\v_2,\v_3$ be points in $\ring{R}^3$. 
Let 
\[ (y_1,\ldots,y_6)
  =(y_{01},y_{02},y_{03},y_{23},y_{13},y_{12}), \text{ where }
  y_{ij}=\norm{\v_i}{\v_j}.\]  Set $x_i = y_i^2$.  and
\[ 
p = y_1 y_2 y_3 + y_1 (\w_2\cdot \w_3) + y_2 (\w_1\cdot \w_3) + y_3
(\w_1\cdot \w_2).
\] 
\indy{Notation}{p@$p$ (Euler solid angle numerator)}%
where $\w_i = \v_i- \v_0$.  Let \[ \alpha_i
  =\dih_V(\{\v_0,\v_i\},\{\v_j,\v_k\})\] 
where $\{i,j,k\}=\{1,2,3\}$.
Assume that $\Delta(x_1,\ldots,x_6)>0$. 
Then
\[ 
\alpha_1+\alpha_2+\alpha_3 - \pi
= {\pi} - 2\,\atn({\Delta(x_1,\ldots,x_6)^{1/2}},{2 p}).
\] 
\end{lemma}
\indy{Index}{triangle!Euler}%


Before we jump into the details of the proof, it helps to understand
why a formula of this general form should exist.  
Each angle $\alpha_i$ equals a single arc\-tangent (Lemma~\ref{lemma:dihform}).
The addition law for arctangent, which is obtained by inverting the additional law for
the tangent (Lemma~\ref{lemma:tan-add}),
rewrites the sum $\alpha_1+\alpha_2+\alpha_3$
of arctangents as a single arctangent, or as twice a single arctangent if
the double angle formula is invoked.  Euler's formula is a precise formula for the
sum of arctangents in the form $2\atn(\cdots)$.

In practice, it is easier to carry out the details of the proof by a
slightly different strategy.  We can check that the derivatives of the
two sides of the identity are equal as rational functions.  The domain
is connected, and from this it follows that the two sides differ by at
most a constant.  By calculating a particular test value, we see that
the two sides are precisely equal.



\begin{proof}
%% I checked all the details of this proof in 
%% Math'ca on May12,2007
  This proof is an exercise in real analysis
  and established trigonometric identities.  According to an earlier
  remark, the dihedral angles are unchanged if the
  vectors $\w_i$ are rescaled so that $\normo{\w_i}=1$.  By
  inspection, the given formula is also unchanged under rescalings:
  the factor $p$ is homogeneous of degree three under a change $\w_i
  \mapsto t \w_i$ for $t>0$, and so is $\sqrt{\Delta}$ by the formula
  for $\Delta$.  Thus, without loss of generality, $\normo{\w_i}=1$ for $i=1,2,3$.  Consequently, $y_1=y_2=y_3=1$.  It is convenient to
  use different notation $a=x_4$, $b=x_5$, $c=x_6$ for the other
  variables. The expansion of the dot products in $p$ by the dot
  product law gives
\[ 2 p = 8 - (a+b+c).\] 
Also, the definitions of $\Delta$ and $\ups$ give
\[ \Delta(x_1,\ldots,x_6) = \Delta(1,1,1,a,b,c) =
\ups(a,b,c) - a b c.\] 
Since $\Delta>0$ by assumption, the arctangent formula
in Lemma~\ref{lemma:dihform} 
applies for the dihedral angles $\alpha_i$.  After
this substitution (and clearing a factor of three),  %and clearing the
                                                   %$3$ from the
                                                   %denominator,
the desired identity takes the form $f(a,b,c)=0$, where
\[ 
f(a,b,c)= -\pi/2 - \sum_{i=1}^3\arctan\Big(u_i/\nsqrt{\Delta}\Big) +
2\arctan\Big(2 p/\nsqrt{\Delta}\Big),
\] 
for some rational functions $u_i$ of $a,b,c$.  The aim is to prove
this trig identity holds whenever $\Delta>0$.

To see that the function $f$ does not depend on $a$, 
we fix $(b,c)$ and differentiate $f$ with respect to $a$.  The partial
derivative $\partial f/\partial a$ has the form
$g(a,b,c)/\nsqrt{\Delta}$ for some rational function $g$ of $a,b,c$.
The denominator of $g$ has no real zero.  Algebraic simplification of
this rational function shows that the polynomial numerator of
$g(a,b,c)$ is identically zero.  (Euler himself did not shun brute
force~\cite{Euler}.)

By real analysis, the derivative of $f$ is zero, and the function $f$
is constant along any segment in $\ring{R}^3$ along which $\Delta$ is
positive.  The remaining part of the proof constructs two segments
along which $\Delta$ is positive.
%\footnote{In the formal proof, Vu
%  Khac Ky uses three segments: the first segment runs from $(a,b,c)$
%  to $(b+c-b c/2,b,c)$, the second continues to $(2c - c^2/2,c,c)$,
%  and the final segment terminates at $(2,2,2)$.}   
The
first connects $f(a,b,c)$ to $f(a,2,2)$, provided the variables are
ordered appropriately.  The second connects $(a,2,2)$ to $(2,2,2)$.
From this construction it follows that $f(a,b,c)=f(2,2,2)$.  The last
step is to evaluate the constant $f(2,2,2)$.  Arithmetic gives
$\Delta=4$, $2p= 2$, $u_1=u_2=u_3 =0$, when $a=b=c=2$.  Finally,
\[ f(a,b,c)= f(2,2,2) = -\pi/2 + 2\arctan(1)
  =0.\] 


Let us return to the construction of the two segments.  By the
triangle inequality, $a =\norm{\v_2}{\v_3}^2 \le
(\norm{\v_2}{\v_0}+\norm{\v_3}{\v_0})^2 = 4$.  If equality holds, then
$\{\v_0,\v_2,\v_3\}$ is collinear and $\{\v_0,\ldots,\v_4\}$ is
coplanar.  From this it follows that $\Delta=0$, which is contrary to
assumption.  Similarly, $a=0$ implies that $\Delta=0$.  Hence $0<a<4$.
Similarly, $0<b<4$ and $0<c<4$.  By the  {\it pigeonhole}
principle, two of the real numbers $a,b,c$ must lie in the same
subinterval $[0,2]$ or $[2,4]$.  To fix notation, assume that $b$ and
$c$ lie in the same subinterval.

\claim{The polynomial $\Delta$ is positive\footnote{This paragraph follows the book's
    general convention of typesetting claims in italic.} 
  on the linear segment from $(a,b,c)$ to
  $(a,2,2)$.}  Indeed, for $0\le t \le 1$, Tarski
arithmetic gives
\begin{align*}
\Delta(1,1,1,a, &\,b(1-t)+2t,c(1-t)+2t)  \\
&= \Delta(1,1,1,a,b,c) + 
t (2-t) (a (b-2)(c-2) + (b-c)^2)\\
&\ge \Delta(1,1,1,a,b,c)\\
&> 0.
\end{align*}

\claim{The polynomial $\Delta$ is positive on the linear segment from $(a,2,2)$ to
  $(2,2,2)$.}  Indeed,
\[ \Delta(1,1,1,a,2,2) = a(4-a)>0.\]   
The rest of the proof has been sketched above.
\end{proof}
\indy{Notation}{zzD@$\Delta$}%






%\subsection{Lexell's theorem}
%
%\begin{lemma}[Lexell]\guid{UWIPRDV}
%% was 1000 with old proof including lemma ZHH
% Fix two points $\v_1,\v_2$ on a unit sphere that are not antipodal.
% Let $\u,\u'$ be two other points the sphere in the same open
% hemisphere determined by the great circle through $\v_1,\v_2$.  Then
% the two spherical triangles $\{\v_1,\v_2,\u\}$ and
% $\{\v_1,\v_2,\u'\}$ have the same area if and only if the four
% points $\u$, $\u'$, $\v^*_1$, $\v^*_2$ are concircular, where
% $\v^*_i$ is the point antipodal to $\v_i$.
%\end{lemma}
%\indy{Index}{Lexell's Theorem}%
%
%
%
%\begin{proof} By the polarity of triangles mentioned above, it is
%  enough to prove the polar statement.  By Girard's formula, fixing
%  the area fixes the sum of the angles.  The polar triangle has fixed
%  perimeter.  By polarity, Lexell's theorem is a consequence of the
%  following lemma.
%\end{proof}
%\indy{Index}{Girard's formula}%
%
%\begin{lemma}[]\guid{ZHHSGTF} Fix one point $\v$ on the unit
%  sphere, with antipodal point $\v^*$.  Consider two great
%  half-circles $D_i$, $i=1,2$ between $\v$ and $\v^*$ that are not
%  coplanar.  Two great circles $A$ and $B$ cut equi-perimeter
%  triangles with vertex $\v$ along $D_i$ if and only if the great
%  circles $D_i$, $A$, and $B$ are tangent to a common circle $C$.
%\end{lemma}
%\indy{Index}{great circle}%
%
%\begin{proof} The two tangents to a circle through a given point have
%  the same length.  If $C$ exists, then this fact implies that a
%  great circle $A$ that is tangent to $C$ cuts a triangle with vertex
%  $\v$ along $D_i$ with a perimeter that is equal to the sum of the
%  distances from $\v$ to the two points of tangency $C\cap D_i$.
%  This is independent of $A$. 
%
%Conversely, for $A$ any great circle there is a unique $C$ that
% inscribes the great circles $D_i$, and $A$.  The perimeter of the
% triangle is the sum of the distances from $\v$ to the points $C\cap
% D_i$.  If a second $A$ gives a triangle with the same perimeter, its
% circle $C'$ must satisfy $C'\cap D_i = C\cap D_i$.  This forces
% $C=C'$.
%\end{proof}
%

\section{Coordinates}

This section establishes the existence and basic properties of the
standard coordinate systems: polar coordinates, spherical coordinates,
and cylindrical coordinates.  
%
\indy{Index}{azimuth}%
\indy{Index}{angle!azimuth}%
\indy{Index}{azimuth cycle}%

\subsection{azimuth angle}

\label{sec:polar}
\indy{Index}{polar!coordinates}%
\indy{Index}{coordinate systems!polar coordinates}%


For every pair of real numbers $x$ and $y$,  there are real numbers
$r$ and $\theta$ such that
\begin{equation}\label{eqn:polar}
x = r\cos\theta,\quad y = r\sin\theta.
\end{equation}
\mar{\guid{FEVNANL} Eq.~\ref{eqn:polar}} If $x$ and $y$ are both zero,
then take $r=0$, and~\eqref{eqn:polar} holds for all choices of
$\theta$. If $x$ and $y$ are not both zero, then take $0<r$, and
$\theta$ is uniquely determined (up to multiples of $2\pi$).  By
convention, we take $0\le\theta < 2\pi$.  
\indy{Notation}{r@$r$ (polar, cylindrical, and spherical radius)}%
%\indy{Notation}{zzh@$\theta$ (polar, cylindrical, and spherical coordinate)}%
\indy{Notation}{zzh@$\theta$ (polar, cylindrical, and spherical angle)}%




%%  e3 is defined in terms of v1. The indexing confuses.  % fixed 3/21/2010


\begin{definition}[frame,~positive,~adapted]\guid{AXBTGQX}
\formaldef{frame}{orthonormal}
A tuple $(\e_1,\e_2,\e_3)$ of vectors in $\ring{R}^3$ is a 
\newterm{frame} if $\e_i\cdot \e_j$ and $\normo{\e_i}=1$ 
for all $i$ and $j$.
A tuple $(\e_1,\e_2,\e_3)$ is \newterm{positive} if $(\e_1\times \e_2)\cdot\e_3=1$.
% Let $\{\v_0,\v_1,\v_2\}\subset\ring{R}^3$ be a set that is not
% collinear.
A tuple $(\e_1,\e_2,\e_3)$ is \newterm{adapted} to $(\v_0,\v_1,\v_2)$ if
\[
\e_1 = (\v_1-\v_0)/\norm{\v_0}{\v_1}\quad\text{and}\quad
\e_2\in\op{aff}_+^0(\{\v_0,\v_1\},\v_2).
\].
% such that $\normo{\e_1}=1$ and $\e_1\cdot\e_3=0$; $\e_2 = \e_3\times
% \e_1$.  The tuple $E=(\e_1,\e_2,\e_3)$ is \newterm{adapted} to
% $(\v_0,\v_1,\v_2)$.
\end{definition}
\indy{Index}{frame}%
\indy{Index}{adapted}%
\indy{Notation}{E4@$E$ (frame)}%

\begin{lemma}[orthonormalization]\guid{QAUQIEC}
\label{lemma:frame}
  Assume that the set $\{\v_0,\v_1,\v_2\}\subset\ring{R}^3$ is not collinear.
  Then the unique positive frame adapted to 
  $\{\v_0,\v_1,\v_2\}$ is $(\e_1,\e_2,\e_3)$, where
\begin{align*}
\e_1 &= \w_1/\normo{\w_1},\\
\e_2 &= \bar{\w}_2/\normo{\bar{\w}_2},\quad \bar{\w}_2 = \w_2 - (\e_1\cdot \w_2) \e_1,\\
\e_3 &= \e_1 \times \e_2,
\end{align*}
and where $\w_i = \v_i - \v_0$.
\end{lemma}

\begin{proof} It follows by basic vector arithmetic that
  $(\e_1,\e_2,\e_3)$ is a positive frame adapted to
  $\{\v_0,\v_1,\v_2\}$.  The choices of vectors $\e_1$ and $\e_2$ are
  dictated by the definition of adapted frame.  The choice of $\e_3$
  is dictated by the definition of positive frame.
\end{proof}

\begin{lemma}[cylindrical coordinates]\guid{EYFCXPP}
\formalauthor{Nguyen Quang Truong}
Let $\v_0$ and $\v_1$ be distinct points in 
$\ring{R}^3$.  Let $(\e_1,\e_2,\e_3)$ be a positive frame 
where $\e_1 = (\v_1-\v_0)/\norm{\v_1}{\v_0}$.
Then every
$\p\in\ring{R}^3$ that is not in the line $\op{aff}(\v_0,\v_1)$
can be uniquely expressed in the form
\[ 
\p = \v_0 + r\cos\psi\, \e_2 + r\sin\psi\, \e_3 + h (\v_1-\v_0),
\] 
\indy{Notation}{h@$h$ (cylindrical coordinate)}%
\indy{Notation}{ez@$\e_i$ (orthonormal vectors)}%
for some $0< r$, $0\le \psi < 2\pi$, $h\in\ring{R}$.
Furthermore,
assume that $\p_1$ and $\p_2$ do
not lie in the line $\op{aff}(\v_0,\v_1)$.
Then there exist unique $\psi,\theta,r_1,r_2,h_1,h_2$
such
that $0\le\psi<2\pi$, $0\le\theta < 2\pi$, $0 < r_1$, $0 < r_2$, and
\begin{align*}
\p_1 &= \v_0 + r_1\cos\psi\, \e_2 + r_1\sin\psi\, \e_3 + h_1(\v_1-\v_0),\\
\p_2 &= \v_0 + r_2\cos(\psi+\theta)\, \e_2 + r_2\sin(\psi+\theta)\, \e_3 
+ h_2(\v_1-\v_0).
\end{align*}
Finally, the angle $\theta$ is independent of the choice of $\e_2,\e_3$
giving the positive frame.
\end{lemma}
\indy{Index}{coordinate systems!cylindrical coordinates}%
\indy{Index}{cylindrical coordinates}%
\indy{Notation}{zzv@$\psi$}%
%\indy{Notation}{zzh@$\theta$ (coordinate)}%
\indy{Notation}{zzh@$\theta$ (polar, cylindrical, and spherical angle)}%
%\indy{Notation}{r@$r$ (coordinate)}%
\indy{Notation}{r@$r$ (polar, cylindrical, and spherical radius)}%
\indy{Notation}{h@$h$ (cylindrical coordinate)}%
%
The degenerate point $\p\in\op{aff}\{\v_0,\v_1\}$ is excluded from the
lemma.  Nevertheless, it too has a cylindrical coordinate
representation of the form $\p = \v_0 + h(\v_1-\v_0)$ (with $r=0$).
Only uniqueness fails, because every $\theta$ gives the same
representation.

\begin{remark}
The reader should carefully note the indexing of the vectors in the
orthonormal frame as it appears in the cylindrical coordinate system.
This book breaks with tradition by making $h$ the coefficient of the
frame vector $\e_1$ (rather than $\e_3$) and makes a corresponding
change in spherical coordinates.  This nontraditional order is better
suited to the definition of dihedral angle, the arguments of which 
 are grouped in pairs $\dih_V(\{\v_0,\v_1\},\{\v_2,\v_3\})$
to emphasize the symmetries
$\v_0\leftrightarrow\v_1$ and $\v_2\leftrightarrow\v_3$.  Under this pairing
of arguments, the axis of the dihedral angle is the line
$\op{aff}\{\v_0,\v_1\}$, which gives the direction $\v_1-\v_0$ of the cylinder.
%
\indy{Index}{coordinate systems}%
\end{remark}

\begin{definition}[azim]\guid{UJBHGUX}\label{def:azim}
\formaldef{$\op{azim}$}{azim}
  Define $\op{azim}(\v_0,\v_1,\v_2,\v_3)$, the \newterm{azimuth} angle
  (or \newterm{longitude}), to be the uniquely determined angle
  $\theta$  given by the previous lemma for the points $\p_1=\v_2$ and $\p_2=\v_3$.
  By convention, let the azimuth angle be $0$ in the degenerate cases
  when $\{\v_0,\v_1,\v_2\}$ or $\{\v_0,\v_1,\v_3\}$ is collinear.
  \indy{Notation}{azim}%
  \indy{Index}{azimuth}%
  \indy{Index}{angle!azimuth}%
\end{definition}
\indy{Notation}{azim}%

%The azimuth angle is a polar coordinate of the projection 
%$\p -\v_0-r\cos\phi\,\e_1 \in\op{aff}\{\e_2,\e_3\}$:
%    \[ 
%    (x,y) = (r'\cos\theta,r'\sin\theta), \quad r' = r\sin\phi.
%    \] 

The azimuth and dihedral angles are closely related~(Figure~\ref{fig:dih}).  The azimuth
angle
 takes values between $0$ and $2\pi$, but the dihedral angle is
never greater than $\pi$.  The following lemma reveals that the
azimuth angle is an oriented extension of the dihedral angle and is always
equal to $\dih$ or $2\pi - \dih$.  \indy{Index}{angle!azimuth}%
\indy{Index}{angle!dihedral}%
\indy{Notation}{dih}%
\indy{Index}{azimuth}%

\begin{lemma}[]\guid{QQZKTXU}\label{lemma:dih-azim}
    \formalauthor{Nguyen Quang Truong} Let
  $\v_1\ne \v_0$ be a nonzero vectors in $\ring{R}^3$.  Assume that
  $\v_2$ and $\v_3$ do not lie in the line $\op{aff}\{\v_0,\v_1\}$.  Let
\[ 
\gamma = \dih_V(\{\v_0,\v_1\},\{\v_2,\v_3\}).
\] 
Then
\[ 
\cos(\op{azim}(\v_0,\v_1,\v_2,\v_3)) = \cos\gamma.
\] 
\end{lemma}

\begin{proof} For simplicity, take $\w_i = \v_i-\v_0$.  Let
  $\bar{\w}_i = (\w_1\cdot \w_1) \w_i - (\w_1\cdot \w_i) \w_1$.  From
  the assumptions of the lemma, $\bar{\w}_2\ne 0$.  Set $\e_2 =
  \bar{\w}_2/\normo{\bar{\w}_2}$.  Choose a unit vector $\e_3$ so that
  $(\e_2\times \e_3)\cdot\w_1>0$ and $\e_2\cdot \e_3 = \w_1\cdot
  \e_3=0$.  Write $\w_i$ in cylindrical coordinates as
\begin{alignat*}{8}
\w_2 &=~ &r_1 \e_2 &    &&+h_1 \w_1\\
\w_3 &=~ &r_2 \cos\theta\,\e_2 &+ r_2 \sin\theta\, \e_3 &&+ h_2 \w_1.
\end{alignat*}
The definition of $\op{azim}$ gives
$\op{azim}(\w_0,\w_1,\w_2,\w_3)=\theta$.  By definition, $\cos\gamma$
is the angle between $\bar{\w}_2$ and $\bar{\w}_3$.  We compute
\begin{alignat*}{8}
\bar{\w}_2 &=~ &\normo{\bar{\w}_2} \e_2&\\
\bar{\w}_3 &=~ &(\w_1\cdot \w_1) r_2 \cos\theta\, \e_2 
&+ (\w_1\cdot \w_1) r_2 \sin\theta\, \e_3.
\end{alignat*}
The result $\cos\theta=\cos\gamma$ 
is now a result of the definition of angle 
(Definition~\ref{def:angle}).
\end{proof}
\indy{Notation}{zzc@$\gamma$ (angle)}%
%\indy{Notation}{zzh@$\theta$ (angle)}%
\indy{Notation}{zzh@$\theta$ (polar, cylindrical, and spherical angle)}%

The previous lemma identifies the cosine of the azimuth angle.  The final
lemma of this subsection determines the sign of its sine.

\begin{lemma}[]\guid{JBDNJJB}\label{lemma:sim}
\formalauthor{Nguyen Quang Truong}
% 
Write $x\sim y$ when there exists $t>0$ such that $x= t y$. 
Then 
\[ 
\sin(\op{azim}(\orz,\v_1,\v_2,\v_3))\sim (\v_1
  \times \v_2)\cdot \v_3.
\] 
\end{lemma}
\indy{Notation}{9a@$\sim$ (equal up to positive scalar)}%

\begin{proof}\hspace{-3pt}
  The relation $\sim$ is an equivalence relation.  We may assume that
  $\{\orz,\v_1,\v_2\}$ and $\{\orz,\v_1,\v_3\}$ are not collinear
  sets, because otherwise both sides are zero.  Let $(\e_1,\e_2,\e_3)$ be
  the positive frame adapted to $(\orz,\v_1,\v_2)$.
%\[ 
%\begin{align}
%   \e_1 &= \v_1/\normo{\v_1}\\
%   \v_2' &= \v_2 - (\e_1\cdot \v_2) \e_1\\
%   \e_2 &= \v_2'/\normo{\v_2'}\\
%   \e_3 &= \e_1 \times \e_2 \\
%\end{align}
%\] 
Write $\v_3= r\cos\theta\, \e_2 + r\sin\theta \, \e_3 + h\, \e_1$ in
cylindrical coordinates, where $\theta =
\op{azim}(\orz,\v_1,\v_2,\v_3)$.  Then by the explicit formulas for
the positive frame,
%\arrayqed
\begin{align*}
(\v_1\times \v_2)\cdot \v_3 &\sim (\e_1\times \v_2)\cdot \v_3\\
%&= (\e_1\times \v_2')\cdot \v_3\\
&\sim (\e_1\times \e_2)\cdot \v_3\\
&= \e_3 \cdot \v_3\\
&= r\sin\theta \\
&\sim \sin\theta.
%\arrayqedhere
%\mbox{\qedhere}
\end{align*}
\end{proof}


\subsection{zenith angle}
\label{sec:spherical}

\indy{Index}{angle!zenith}%
\indy{Index}{zenith}%
\indy{Index}{latitude}%
\indy{Notation}{zzv@$\phi$ (zenith)}%

%
%\begin{definition}[spherical coordinates]\guid{IESAXWY}
%Let $x,y,z$ be any real numbers.  A
%triple $(r,\theta,\phi)$ such that
%    \begin{equation}
%    \label{eqn:spherical}
%    x = r\cos\theta\sin\phi,\quad y = r\sin\theta\sin\phi,\quad
%    z = r\cos\phi
%    \end{equation}
%with $0\le r$, $0\le\theta<2\pi$, and $0\le\phi\le\pi$ are called
%spherical coordinates of $(x,y,z)$. 


%\begin{definition}[azimuth]\guid{OSPVIBZ}\label{def:azimuth}


The following lemma identifies the \newterm{zenith} angle $\phi$.  Because it is
easily expressed in terms of the more basic function $\arc_V$, there
is little need to refer to it directly.
\indy{Index}{orthogonal frame}%

\begin{lemma}[zenith]\guid{QAFHJNM}
    \formalauthor{Nguyen Quang Truong} Let
  $(\v_0,\v_1)$ be an ordered pair of distinct points in $\ring{R}^3$.
  Let $\v_2\ne \v_0$.  Set $\phi =
  \arc_V(\v_0,\{\v_2,\v_1\})\in[0,\pi]$.  Let $\e_1$ be the unit
  vector $(\v_1-\v_0)/\norm{\v_1}{\v_0}$.  Let $r =
  \norm{\v_2}{\v_0}$.  Then $\v_2$ can be expressed in the form
\[ 
\v_2 = \v_0 + \u +
r\cos\phi\, \e_1,
\] 
where $\u\cdot \e_1 = 0$.  The angle $\phi$ is called the
\newterm{zenith} angle (or \newterm{latitude}) of $\v_2$ along
$(\v_0,\v_1)$.  \indy{Index}{zenith}%
\indy{Index}{angle!zenith}%
\end{lemma}

\begin{proof} The lemma is a direct consequence of the definition of $\arc_V$:
\[ (\v_2-\v_0)\cdot \e_1 = r\cos\phi.\] 
\end{proof}

\begin{lemma}[spherical coordinates]\guid{XPHCPNY}\label{lemma:sph}
\formal{SPHERICAL\_COORDINATES}
  Assume that
  $\{\v_0,\v_1,\v_2\}\subset\ring{R}^3$ % and $\{\v_0,\v_1,\p\}$
  is not a collinear set.  Let $(\e_1,\e_2,\e_3)$ be the positive
  frame adapted to $(\v_0,\v_1,\v_2)$.  Then for any $\p$,
\begin{equation}
\p = \v_0 + r \cos\theta \sin\phi\, \e_2 + r \sin\theta\sin\phi\, \e_3 +
r\cos\phi\,\e_1,
\label{eqn:sph}
\end{equation}
where%
  \footnote{This book follows the variable naming conventions
    $(\theta,\phi)$ of American calculus textbooks, which reverses the
    international scientific notation.} 
\begin{align*}
r &= \norm{\v_0 }{ \p}\\
\phi &= \text{zenith angle of } \p \text{ along } (\v_0,\v_1)\\
\theta &=\op{azim}(\v_0,\v_1,\v_2,\p).
\end{align*}
\end{lemma}
%\indy{Notation}{zzh@$\theta$ (azimuth)}%
\indy{Notation}{zzh@$\theta$ (polar, cylindrical, and spherical angle)}%
\indy{Index}{coordinate systems}%
\indy{Index}{coordinate systems!spherical coordinates}%
\indy{Index}{spherical!coordinates}%
%\indy{Notation}{r@$r$ (polar, cylindrical, spherical coordinate)}%
\indy{Notation}{r@$r$ (polar, cylindrical, and spherical radius)}%

 
\begin{proof}
Cylindrical coordinates give
\[ 
\p = \v_0 + r'\cos\theta\,\e_2 + r'\sin\theta\,\e_3 + h\, \e_1,
\] 
for some $h$ and $r'=\normo{\p-\v_0-h\,\e_1}\ge0$.  The zenith angle
puts $\p$ in the form
\[ 
\p = \v_0 + r'\cos\theta\,\e_2 + r'\sin\theta\,\e_3 + r\cos\phi\, \e_1,
\] 
where
\begin{align*}
r^2 &= \norm{\p}{\v_0}^2\\ 
&= \normo{\p-\v_0-h\,\e_1}^2 + \normo{h\,\e_1}^2\\
&= (r')^2 + r^2 \cos^2\phi,
\end{align*}
Since $\sin\phi$, $r$, and $r'$ are nonnegative, it follows that $r'=r\sin\phi$, as
desired.
\end{proof}

\begin{definition}[spherical coordinates]\guid{LVDJVFD}\label{def:sph}
  \formaldef{spherical coordinates}{SPHERICAL\_COORDINATES}
  Equation~\eqref{eqn:sph} is called the spherical coordinate representation of $\p$ with
  respect to $(\v_0,\v_1,\v_2)$.
\end{definition}



% Any triple $(x,y,z)$ has spherical coordinates.  The radial
% component is $r = \sqrt{x^2+y^2+z^2}$.  In the degenerate case when
% $r=0$, Equations~\eqref{eqn:spherical} becomes independent of
% $\theta$ and $\phi$. In the degenerate case when $\phi = 0$ or $\phi
% = \pi$, the equations become independent of $\theta$. If $0<r$ and
% $\phi\ne 0,\pi$, then $\theta$ is uniquely determined by $x,y,z$. If
% $0<r$, then $\theta$ is uniquely determined.
%


%The following gives the existence of polar coordinates on any
% oriented plane in three dimensions, with a general point $\v$ on the
% plane serving as the origin.  A normal vector $n$ orients the plane,
% then polar coordinates appear as the restriction of the spherical
% coordinates $(r,\theta,\phi)$ to the plane.  The following lemma
% shows that the value of $\phi$ is fixed, so that it may be dropped
% from the notation.  \indy{Index}{polar!coordinates}%
% \indy{Notation}{n@$n$ (normal vector)}%
%
%\begin{lemma}[]\guid{YBXRVTS}\label{lemma:polar-gen}
%   \formalauthor{Nguyen Quang Truong} Let $\{\v,\w,\u\}$ be
%  a set of three points in $\ring{R}^3$ that is not collinear.  Let
%  $n = (\w-\v) \times (\u-\v)$.  Then the zenith angle of any $\p\ne
%  \v$ in the plane $\op{aff}\{\v,\w,\u\}$, computed with respect to
%  $(\v,\v+n)$, is $\pi/2$.
%\end{lemma}
%\indy{Index}{zenith}%
%\indy{Index}{angle!zenith}%
%
%\begin{definition}[polar coordinate]\guid{WNLMGUV}\label{def:polar}
%Call  the two remaining coordinates, $(r,\theta)$, 
%the polar coordinates of $\p\in\op{aff}\{\v,\w,\u\}$ with
%respect to $(\v,\w,\u)$.
%\end{definition}
%\indy{Index}{coordinate systems}%
%\indy{Index}{coordinate systems!polar coordinates}%
%\indy{Index}{polar coordinates}%
%\indy{Notation}{r@$r$ (coordinate)}%
%\indy{Notation}{zzh@$\theta$ (coordinate)}%
%
%In the special case that $\op{aff}\{\v,\w,\u\}=\ring{R}^2\subset
% \ring{R}^3$, this construction agrees with the previously defined
% polar coordinates of a point in the plane.


%\subsection{Lexell without polarity}
%
%Here is a second proof of Lexell's theorem that does not depend on
% polar triangles.
%
%\begin{proof} Select coordinates so that the Lexell circle (through
%  $\u,\v^*_1,\v^*_2$) has constant zenith angle $\phi$.  Without loss
%  of generality, an appropriate coordinate system gives
%\[ 
%\begin{align}
%\v_1 &= \{\cos\theta\sin\phi,+\sin\theta\sin\phi,-\cos\phi\}\\
%\v_2 &= \{\cos\theta\sin\phi,-\sin\theta\sin\phi,-\cos\phi\}\\
%\u &= \{\cos\alpha\sin\phi,\sin\alpha\sin\phi,\cos\phi\}\\
%\end{align}
%\] 
%The area of a triangle is given by Euler's formula
% (Lemma~\ref{lemma:euler}).  If these coordinates are used in Euler's
% formula, then a calculation gives the area $\pi-2\atn(t,1)$, when
%\[ 
%t=\cos\phi \tan\theta.
%\] 
%This is independent of $\alpha$, proving that every point on the
% Lexell circle (except for the degenerate points $\u=
% \v^*_1,\u=\v^*_2$ with $\Delta=0$) gives the same solid angle.
%
% To check that points on different Lexell circles give different
% solid angles, any convenient point on the circle will do.  For
% example, there is an isosceles triangle $b=c$.  An easy derivative
% calculation shows that the function is increasing.  Hence different
% Lexell circles give different values.
%\end{proof}






\section{Cycle}


The azimuth angle of the spherical coordinate system
determines a cyclic permutation, called the azimuth cycle, on a finite
set of points in $\ring{R}^3$, ordered according to increasing azimuth
angle.  The basic properties of that permutation are developed.
\indy{Index}{cyclic!permutation}%
\indy{Index}{angle}%
\indy{Index}{coordinate systems}%


\subsection{polar cycle}

Let $V=\{\v_1,\ldots,\v_k\}$ be a finite set of nonzero points in the
plane, with polar coordinates $\v_i =
(r_i\cos\theta_i,r_i\sin\theta_i)$.  It is useful to order the set of
points according to increasing angle.  To deal with degenerate cases
when some points have exactly the same angle, order the points with
the lexicographic order on their polar coordinates.  We write $\v_i \prec
\v_j$ for the total lexicographical order on points: 
$\theta_i < \theta_j$ or both $\theta_i=\theta_j$ and $r_i<r_j$.
(The degenerate case of two equal angles does not occur in this book, but by
defining a total order, there is no need to revisit the issue.)
See Figure~\ref{fig:polarcycle}.
\indy{Index}{order!total}%

\figROHSJRP % {fig:polarcycle}

\begin{definition}[polar cycle]\guid{TNZQDCX}
\formaldef{polar cycle}{polar\_cycle}
A cyclic permutation $\sigma:V\to V$ sends $\v\in V$ to
the next larger element with respect to this order or back to the
first element if $\v$ is the largest.  We call $\sigma$ the
\fullterm{polar cycle}{polar!cycle} of the set $V$.
\end{definition}
\indy{Index}{order!lexicographic}%
\indy{Index}{cyclic!permutation}%
\indy{Notation}{zzs@$\sigma$ (azimuth and polar cycle)}%




For $\psi\in\ring{R}$, let $T:\ring{R}^2\to\ring{R}^2$ be the
rotation of the plane:
\begin{equation}
\label{eqn:rotate}
(x,y) \mapsto  (x\cos\psi + y\sin\psi,-x\sin\psi+y\cos\psi).
\indy{Index}{rotation}%
\end{equation}
Let $\sigma'$ be the polar cycle for $T(V)$.  Then 
\[ 
\sigma'(T \v) = T (\sigma \v),\quad \text{ for } \v\in V. 
\] 
\indy{Notation}{zzv@$\psi$}%
\indy{Notation}{T@$T$ (rotation)}%

\begin{lemma}[]\guid{PDPFQUK}\label{lemma:polar2}
    \formalauthor{Nguyen Quang Truong}
  \formal{thetaij\_t} Let $\theta_i$ be real numbers such that $0\le
  \theta_i < 2\pi$ for $i=1,2$.  Let \[  \theta_{ji}
    = \theta_i - \theta_j + 2\pi k_{ji},
\] 
where integers $k_{ij}$ satisfy $0\le \theta_{ji}< 2\pi$.
Then 
\[ 
\theta_{12} + \theta_{21} = \begin{cases}
2\pi, & \text{ if }\theta_i\ne\theta_j\\
0,    & \text{ if }\theta_i=\theta_j.
\end{cases}
\] 
\end{lemma}
%\indy{Notation}{zzh@$\theta$}%
\indy{Notation}{zzh@$\theta$ (polar, cylindrical, and spherical angle)}%

\begin{proof} The proof is elementary.
\end{proof}

The next lemma gives a precise form to the observation
that given a finite number of rays emanating from the origin
in the plane, the sum of the included angles is $2\pi$.
In precise form, the polar cycle is used to place
a cyclic order on the rays.  There is a degenerate case
when there is at most one ray.


\begin{lemma}[]\guid{ISRTTNZ}\label{lemma:polar-sum}
\formalauthor{Nguyen Quang Truong}
%\formal{thetapq\_wind\_t}
  Let $V\subset\ring{R}^2$ be a set of cardinality $n$ that
  does not contain $0$.  Let $\sigma$ be the polar cycle on $V$.  In
  polar coordinates,
\[ 
\v=\left(\, r(\v)\cos\theta(\v),\, r(\v)\sin\theta(\v)\,\right),
\]  
for $\v\in V$, with
$0\le\theta(\v)<2\pi$.
Write
\[ 
\theta(\v,\w) = \theta(\w) - \theta(\v) + 2\pi k_{pq},
\] 
for some integers $k_{pq}$ that give $0\le \theta(\v,\w) < 2\pi$.
Then for all $\v\in V$
and all $0\le i \le j < n$,
\[ 
\theta(\v,\sigma^i(\v)) +\theta(\sigma^i(\v),\sigma^j(\v)) =
\theta(\v,\sigma^j(\v)).
\] 
Moreover, if there exist $\v,\w\in V$ such that $\theta(\v)\ne\theta(\w)$,
\[ 
\sum_{i=0}^{n-1} \theta(\sigma^{i}\v,\sigma^{i+1} \v) = 2\pi.
\] 
(If $\theta(\v)=\theta(\w)$ for all $\v,\w\in V$, then all the
summands are zero.)
\end{lemma}
%\indy{Notation}{zzs@$\sigma$ (permutation)}%
\indy{Notation}{zzs@$\sigma$ (azimuth and polar cycle)}%

\begin{proof}
Fix $\v\in V$.
For $0\le i<n$, define $\theta_i$ by
$\theta_0=\theta(\v)$ and 
\[ \theta_i = \theta(\sigma^i(\v)) + 2\pi \ell_i,
\] 
where  $\ell_i$ satisfies $\theta_0\le \theta_i < \theta_0+2\pi$.
It follows from the definition of the polar cycle that
$\theta_i \le \theta_j$ for $0\le i\le j < n$.  Then
$\theta(\sigma^i \v ,\sigma^j \v) = \theta_j - \theta_i$.
The first conclusion of the lemma reduces to
\[ 
(\theta_i-\theta_0) + (\theta_j-\theta_i) = (\theta_j-\theta_0).
\] 
The second conclusion reduces to
\[ 
\sum_{i=0}^{n-2} (\theta_{i+1}-\theta_i) + \theta(\sigma^{n-1}\v,\v)
= \theta(\v,\sigma^{n-1}\v) + \theta(\sigma^{n-1}\v,\v).
\] 
By the previous lemma, this is $0$ or $2\pi$.
\end{proof}


\subsection{azimuth cycle}

As already defined, the polar cycle is a cyclic permutation on a set
of vectors in the plane that traverses them in order of increasing
angle.  What follows is the corresponding construction in three
dimensional space.  There is a cyclic permutation, called the
\newterm{azimuth cycle}, on a set $V$ of vectors in space that
traverses them in order of increasing azimuth angle.  Most of the work
for this construction has already been done in the subsection on polar
cycle, because the azimuth cycle may be constructed as the polar cycle
on the projection of $V$ to a plane.  However, a nondegeneracy
condition must be imposed on $V$ to ensure that the projection to the
plane is one-to-one.  The following definition captures this
nondegeneracy condition.  \indy{Index}{azimuth cycle}%
\indy{Index}{azimuth}%
\indy{Index}{cyclic!permutation}%
\indy{Index}{vector!projection}%


\begin{definition}[cyclic set]\guid{KFKHLWK}
\formaldef{cyclic set}{cyclic\_set} 
Let $(\v_0,\v_1)$ be an ordered pair of
  distinct points in $\ring{R}^3$.  Let $V$ be a finite set of points
  in $\ring{R}^3$.  We say that $V$ is \fullterm{cyclic}{cyclic!set} with respect to
  $(\v_0,\v_1)$ if the following two conditions hold.
\begin{enumerate}
\item If $\u = \w + h (\v_1-\v_0)$, with $\u,\w\in V$ and $h\in \ring{R}$,
then $\u=\w$.  
\item  The line through $\v_0$ and $\v_1$ does not meet $V$.
\end{enumerate}
\end{definition}

A cyclic set $V$ has a well-defined azimuth cycle (Figure~\ref{fig:azimuthcycle}).

\figHOUNZSY % {fig:azimuthcycle}

\begin{definition}[azimuth cycle]\guid{YESEEWW}
\formaldef{$\sigma$}{azim\_cycle}
  Let $\v_0$ and $\v_1$ be distinct points in $\ring{R}^3$.  Let $V$
  be a finite set of points in $\ring{R}^3$ that is cyclic with
  respect to $(\v_0,\v_1)$.  Select $\p\in\ring{R}^3$ such that
  $\{\v_0,\v_1,\p\}$ is not collinear and let $\{\e_1,\e_2,\e_3\}$ be
  the corresponding positive, adapted, frame.  Let $f$ be the
  projection map:
\[ \v_0 + x\, \e_2 + y\, \e_3 + z\, \e_1 \mapsto
(x,y).\] 
Let $\sigma'$ be the polar cycle on $f(V)$. We define
$\sigma:V\to V$ by $f\sigma(\u) =\sigma'f(\u)$
and call $\sigma$ the \newterm{azimuth cycle}
on $V$ with respect to $(\v_0,\v_1)$.
\indy{Index}{azimuth cycle} %
\indy{Index}{frame}%
\indy{Index}{polar!cycle}%
\indy{Notation}{f@$f$ (function name)}%
\indy{Notation}{zzs@$\sigma$ (azimuth and polar cycle)}%
%\indy{Notation}{zzs@$\sigma$ (polar cycle)}%
%\indy{Notation}{zzs@$\sigma$ (azimuth cycle)}%
\end{definition}

Because facts about the polar cycle lift to facts about the azimuth cycle,
the next few lemmas follow naturally.


\begin{lemma}[]\guid{NLOFMTR} The azimuth cycle $\sigma:V\to V$ on
  a cyclic set $V$ with respect to $(\v_0,\v_1)$ does not depend on
  the choice of $\p\in\ring{R}^3$ such that $\{\v_0,\v_1,\p\}$ is
  noncollinear.
\end{lemma}
\indy{Index}{azimuth cycle}%
\indy{Index}{cyclic!set}%

\begin{proof} The lemma follows from independence of $\sigma\,'$ from
rotations in the $\{\e_2,\e_3\}$ plane  in~\eqref{eqn:rotate}.
\end{proof}


\begin{lemma}[]\guid{YVREJIS} 
\formalauthor{Nguyen Quang Truong}
Let $(\v_0,\v_1)$ be an ordered pair of points in $\ring{R}^3$,
with $\v_0\ne \v_1$.  Assume that $\{\v_2,\v_3\}$ is cyclic
with respect to $(\v_0,\v_1)$.  Then
\[ 
\op{azim}(\v_0,\v_1,\v_2,\v_3) + \op{azim}(\v_0,\v_1,\v_3,\v_2) 
= \begin{cases} 2\pi, & \text{if }\op{azim}(\v_0,\v_1,\v_2,\v_3)\ne 0,\\
0, & \text{if }\op{azim}(\v_0,\v_1,\v_2,\v_3)=0.
\end{cases}
\] 
\end{lemma}


\begin{proof} The lemma follows immediately from Lemma~\ref{lemma:polar2}.
\end{proof}

\begin{lemma}[]\guid{ULEKUUB} \label{lemma:2pi-sum}
Let $(\v_0,\v_1)$ be an ordered pair of points in $\ring{R}^3$,
with $\v_0\ne \v_1$.  Let $V$ be a finite set in $\ring{R}^3$ of
cardinality $n$ that
is cyclic with respect to $(\v_0,\v_1)$,
with azimuth cycle $\sigma$.
Then for all $\u\in V$,
and all $0\le i \le j < n$,
\[ 
\op{azim}(\v_0,\v_1,\u,\sigma^i(\u)) +
\op{azim}(\v_0,\v_1,\sigma^i(\u),\sigma^j(\u)) =
\op{azim}(\v_0,\v_1,\u,\sigma^j(\u)).
\] 
Moreover, if there exists $\w\in V$ such that 
$\op{azim}(\v_0,\v_1,\u,\w)\ne0$,
then
\[ 
\sum_{i=0}^{n-1} \op{azim}(\v_0,\v_1,\sigma^i\u,\sigma^{i+1}\u) = 2\pi.
\] 
(If $\op{azim}(\v_0,\v_1,\u,\w)=0$ for all $\w\in V$, then all the
summands are zero.)
\end{lemma}
\indy{Notation}{azim}%
\indy{Index}{azimuth}%
\indy{Index}{azimuth cycle}%
%\indy{Notation}{zzs@$\sigma$}%
\indy{Notation}{zzs@$\sigma$ (azimuth and polar cycle)}%
\indy{Notation}{n@$n$ (integer variable)}%

\begin{proof} This follows immediately from 
Lemma~\ref{lemma:polar-sum}.
\end{proof}


\subsection{spherical triangle inequality} %%
\indy{Index}{triangle!spherical}%
\indy{Index}{spherical!triangle inequality}%

The geodesic length between two points
$\u,\v$ on a unit sphere centered at $\v_0$ is $\arc_V(\v_0,\{\u,\v\})$.
The following lemma is part of the verification that
the function $d(\u,\v) = \arc_V(\v_0,\{\u,\v\})$ is a metric
on the unit sphere.  The lemma excludes the degenerate case when
points on the sphere are antipodal.
\indy{Notation}{d@$d(\u,\v)$ (metric on $\ring{R}^3$)}%

\begin{lemma}[]\guid{KEITDWB}\label{lemma:sph-tri-ineq}
\formalauthor{Nguyen Quang Truong}
Let $\{\v_0,\v_1,\v_2,\v_3\}$ be a set of four points in $\ring{R}^3$.
Assume that $\v_0$ is not collinear with any pair of other points.
Then
\[ 
  \arc_V(\v_0,\{\v_1,\v_3\}) \le \arc_V(\v_0,\{\v_1,\v_2\}) + \arc_V(\v_0,\{\v_2,\v_3\}).
\] 
Equality occurs if and only if $\v_2\in\op{aff}_+(\v_0,\{\v_1,\v_3\})$.
\end{lemma}

\begin{proof} Let $\v_2'$ be the projection of $\v_2$ to the plane
$\op{aff}\{\v_0,\v_1,\v_3\}$.  
By the spherical law of cosines in the special case of a right triangle,
\[ 
\cos\psi = \cos\beta\cos\alpha \le \cos\beta,
\] 
where $\psi = \arc_V(\v_0,\{\v_1,\v_2\})$, $\beta =
\arc_V(\v_0,\{\v_1,\v_2'\})$, $\alpha=\arc_V(\v_0,\{\v_2,\v'_2\})$.  Thus,
$\arc_V(\v_0,\{\v_1,\v_2'\})=\beta\le \psi=\arc_V(\v_0,\{\v_1,\v_2\})$.
Similarly, 
\[
\arc_V(\v_0,\{\v_2',\v_3\}) \le \arc_V(\v_0,\{\v_2,\v_3\}).
\]
Thus, it is enough to show that
\[ 
  \arc_V(\v_0,\{\v_1,\v_3\}) \le \arc_V(\v_0,\{\v_1,\v_2'\}) + \arc_V(\v_0,\{\v_2',\v_3\}).
\] 
The points $\v_0,\v_1,\v_3,\v_2'$ are coplanar.
By the additivity of angles (Lemma~\ref{lemma:polar-sum}), if 
$\v_2'\in \op{aff}_+(\v_0,\{\v_1,\v_3\})$, then
\[ 
  \arc_V(\v_0,\{\v_1,\v_3\}) = \arc_V(\v_0,\{\v_1,\v_2'\}) + \arc_V(\v_0,\{\v_2',\v_3\}),   
\] 
and otherwise,
\[ 
  \arc_V(\v_0,\{\v_1,\v_3\}) = \norm{\arc_V(\v_0,\{\v_1,\v_2'\}) }{ \arc_V(\v_0,\{\v_2',\v_3\})}.
\] 
The inequality ensues.

Further inspection shows that equality occurs exactly when
$\alpha=0$ and $\v_2'\in \op{aff}_+(\v_0,\{\v_1,\v_3\})$.  Equivalently,
$\v_2'=\v_2\in\op{aff}_+(\v_0,\{\v_1,\v_3\})$.
\end{proof}

\begin{lemma}[]\guid{FGNMPAV}
\formalauthor{Nguyen Quang Truong}
\label{lemma:sph-tri-multi}
Let $\{\v_0,\u_0,\u_1,\u_2,\ldots,\u_r\}$ be a set of points in
$\ring{R}^3$.  Assume that no triple $\{\v_0,\u_i,\u_{i+1}\}$ is
collinear.  Assume that $\{\v_0,\u_0,\u_r\}$ is not collinear.  Then
\[ 
  \arc_V(\v_0,\{\u_0,\u_r\}) \le \sum_{i=0}^{r-1} \arc_V(\v_0,\{\u_i,\u_{i+1}\}).
\] 
\end{lemma}

\begin{proof}\hspace{-7.5pt} The proof is an easy induction on $r$ with base case given by
  Lemma~\ref{lemma:sph-tri-ineq}.
\end{proof}


\section{Chapter Summary}

%\subsection{formal proof}

%Formal proofs of all of the major results in this chapter have already
%been constructed.  In fact, many of them are part of standard
%distribution of the HOL Light proof assistant.  In 2008, Jason Rute
%constructed the formal proof of some of the theorems in this chapter.
%Most of the remaining work was carried out by Nguyen Quang Truong in
%2009.  He also constructed the formal proofs of a large collection of
%lemmas in elementary geometry, including basic facts about the
%functions $\ups$ and $\Delta$.  Finally in 2010, Euler's theorem was
%formalized by Vu Khac Ky.
%

%\subsection{summary of notation}

We give a brief chapter summary.  The trigonometric functions $\cos$,
$\sin$, $\arctan$, $\arccos$ are defined in the standard way.  The
function $\atn(x,y)$ is an extension of $\arctan(y/x)$ to every point
$(x,y)$ in the plane.  It is the polar coordinate angle of $(x,y)$.

 $\ring{R}^N$ is the vector space of functions from the finite set $N$ to $\ring{R}$.  If
$n\in\ring{R}$,   then by convention, $\ring{R}^n = \ring{R}^N$, where $N=\{0,\ldots,n-1\}$.
A bold face $\u,\v,\p,\q$ is used for points in $\ring{R}^N$.   Vector space operations, the
dot product $\u\cdot \v$, and the norm $\normo{\u}$ are defined in the standard way.

We write $\op{aff}(S)$ for the affine hull of a set and $\op{conv}(S)$ for the convex hull of a set.
The notation is extended to allow inequality constraints:
	\begin{align*}
\op{aff}_{\pm} (V,V') &= \{t_1 \v_1 +\cdots t_n \v_n \mid
	t_1 +\cdots+t_n = 1, \pm t_j \ge 0, \text{ for } j>k\},\\
\op{aff}^0_{\pm} (V,V') &= \{t_1 \v_1 +\cdots t_n \v_n \mid
	t_1 +\cdots+t_n = 1, \pm t_j > 0, \text{ for } j>k\}.
%\op{aff}\, V &= \op{aff}_\pm(V,\emptyset).\\
\end{align*}
Lines, planes, rays, cones, half-planes, half-spaces, and convex hulls
can all be represented in this compact notation.

The function $\arc_V(\u,\{\v,\w\})$ gives
the angle at point $\u$ of a triangle with vertices $\u,\v,\w$.  The
function $\arc(a,b,c)$ is the angle opposite $c$ of a triangle with
sides $a,b,c$.  The function $\dih_V$ is the dihedral angle of a
simplex, expressed as a function of its four vertices.  The function
$\dih$ is the dihedral angle of a simplex, expressed as a function of
its six edges.  The polynomials $\ups$ and $\Delta$, which appear in
formulas for volume, area, and angle, depend on three and six
variables, respectively.  

The cylindrical coordinates of a point in $\ring{R}^3$ are
$(r,\theta,h)$.  The spherical coordinates are $(r,\theta,\phi)$.  The
angle $\theta$ is called the azimuth angle and is determined by four
points $\v_0,\v_1,\v_2,\v_3$.  The angle $\phi$ is the zenith angle.
This book follows a nonstandard convention for the labeling of the
coordinate axes in cylindrical and spherical coordinates: the central
line of the cylinder and the line through the poles of the coordinate
sphere lie in the direction of the first unit vector $\e_1$.

The cyclic permutation of a finite set of points in the plane, ordered
by increasing angle in polar coordinates is called the polar cycle.
The cyclic permutation $\sigma$ of a finite set of points in
three-dimensional space, ordered by increasing azimuth angle is called
the azimuth cycle.


