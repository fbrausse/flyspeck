% This is the first chapter.
% Author: Thomas Hales, copyright 2009.


\chapter{Trigonometry}\label{part:trig}
\indy{Index}{trigonometry}%

The first part of this book consists of a series of essays
on packings.  The second part of this book presents
a systematic development of foundational material on
trigonometry, volume, hypermap, and fan.  There is a separate
chapter on each of these topics.  The purpose of the
foundational material is to build a bridge between
the foundations of mathematics, as presented in formal
theorem proving systems such as {\tt HOL Light}, and the
solution to the packing problem.  
This chapter is the first of the four foundational chapters.


In this chapter, trigonometry is developed analytically.  The basic
trigonometric functions are defined by their power series
representations, and calculus of a single real variable is used to
develop the basic properties of these functions.  Basic vector geometry is presented.
%This chapter begins with a brief review of the definitions and properties.

\section{Trig Identities}


\subsection{sine and cosine}

The cosine and sine functions are defined by their infinite series:%
\footformal{sin,\ cos,\ SIN\_0\, COS\_0}%
\footformal{DIFF\_SIN\, DIFF\_COS}
    \begin{equation}\label{eqn:cos-def}\cos(x) = 1 - x^2/2! + x^4/4! \cdots,\qquad
  \sin(x) = x - x^3/3! + x^5/5! \cdots.
    \indy{Notation}{cos}%
    \indy{Index}{cosine}%
    \indy{Notation}{sin}%
    \indy{Index}{sine}%
    \indy{Index}{cosine!series definition}%
    \indy{Index}{sine!series definition}%
    \end{equation}
Convergence is absolute for every real number $x$.
Each series can be evaluated at $0$:
    \begin{equation}\label{eqn:cos0}
    \cos(0) = 1,\qquad \sin(0) = 0.
    \end{equation}

These series may be differentiated term-by-term to establish the identities:
\indy{Index}{cosine!derivative}%
    \begin{equation}\label{eqn:cos'}
    \frac{d\phantom{~}} {dx}\cos(x) = -\sin(x),\qquad \frac{ d\phantom{~} }{dx}\sin(x) = \cos(x).
    \end{equation}

The powers $(\cos(x))^n$ and $(\sin(x))^n$ are conventionally written
$\cos^n(x)$ and $\sin^n(x)$.

Trigonometric identities follow easily from these definitions.  The next two lemmas are examples.
\indy{Index}{trigonometric identities}%

\begin{lemma}\guid{WPMXVYZ}\label{lemma:circle}\formal{SIN\_CIRCLE} 
   $$\sin^2(x) + \cos^2(x) = 1.$$
\end{lemma}
\indy{Index}{trigonometric identities!circle identity}%

\begin{proved}
By basic properties of derivatives and Equation~\ref{eqn:cos'},
the derivative of the function $f(x) = \cos^2(x) +\sin^2(x)$ is
identically zero, so the function itself is constant.  From
Equation~\ref{eqn:cos0}, it follows that $f(x)=f(0)=1$.
\swallowed\end{proved}


\begin{lemma}\guid{WNYVJPE}\label{lemma:sin-add}\formal{SIN\_ADD,\ COS\_ADD}
  $$\begin{array}{lll}
  \sin(x+y) &= \sin(x)\cos(y) + \cos(x)\sin(y)\\
  \cos(x+y)  &= \cos(x)\cos(y) - \sin(x)\sin(y).
  \end{array}$$
\end{lemma}
\indy{Index}{trigonometric identities!addition}%

\begin{proved}
Fix $y$.  Let
    $$\begin{array}{lll}
    f(x) = &(\cos(x+y) - \cos(x)\cos(y) +
    \sin(x)\sin(y))^2 +\\ & (\sin(x+y) -\sin(x)\cos(y) -
    \cos(x)\sin(y))^2.
    \end{array}$$
The derivative of $f$ is identically zero.  The function is
therefore constant. Also, $f(0)=0$.  Thus, $f$ is identically zero.
If a sum of real squares is zero, the individual terms are zero. The
identities follow.
\swallowed\end{proved}

\begin{lemma}\guid{KGLLRQT}\label{lemma:cos-neg}\formal{COS\_NEG,\ SIN\_NEG}
The cosine is an even function.  The sine is an odd
function.  That is,
    $$\cos(-x) = \cos(x),\quad\sin(-x) = -\sin(x).$$
\end{lemma}
\indy{Index}{function}%
\indy{Index}{function!even}%
\indy{Index}{function!odd}%


\begin{proved}
The derivative of
    $$(\cos(-x) - \cos(x))^2 + (\sin(-x) +\sin(x))^2$$
is identically zero.  Argue as in the previous lemmas.
\swallowed\end{proved}

\subsection{periodicity}
\label{sec:pi}
\indy{Index}{periodicity}%

It is known that the cosine function has a unique root between $0$
and $2$. The constant $\pi$ is defined to be twice that root.  Thus, by
definition $\cos(\pi/2) = 0$, and the cosine has no root greater
than $0$ and less than $\pi/2$. The $\cos$ function is in fact
positive on the interval $\leftclosed 0,\pi/2\rightopen$.
\indy{Index}{cosine!roots}%

\begin{lemma}\guid{CPIREMF}\label{lemma:sin-pi2}\formal{SIN\_PI2}
    $\sin (\pi/2) = 1.$
\end{lemma}

\begin{proved}
The derivative of $\sin$ is non-negative between $0$ and $\pi/2$.
Its value at $0$ is $0$.  Thus, $\sin$ is non-negative on
$[0,\pi/2]$.  It is enough to check
that the squares of the two sides are equal. Then $\sin^2(\pi/2) =
{1-\cos^2(\pi/2)} = 1$.
\swallowed\end{proved}

\begin{lemma}\guid{SCEZKRH}\rating{1}\label{lemma:cos-sin}
    $$\cos(x) = \sin(\pi/2 - x).$$
\end{lemma}

\begin{proved}
    Apply the addition law for the sine function,
    $$\sin(\pi/2 - x) = \sin(\pi/2)\cos(-x) + \cos(\pi/2)\sin(-x)$$
    and use
    $\sin(\pi/2) = 1$, $\cos(\pi/2) = 0$.  Then use that $\cos$ is
    an even function.
\swallowed\end{proved}

Similarly,~%
\footformal{SIN\_COS,\ SIN\_PERIODIC\_PI,\ COS\_PERIODIC\_PI, 
SIN\_PERIODIC,\ COS\_PERIODIC}%
$\cos(\pi/2 - x) = \sin(x)$ or $\cos(\pi/2 + x) =
-\sin(x)$, $\sin(\pi/2 + x) = \cos(x)$.  Further,
    $$\begin{array}{lll}
      \sin(\pi + x) &= \phantom{-}\cos(\pi/2 + x) &= -\sin(x),\\
      \cos(\pi + x) &= -\sin(\pi/2 + x) &= -\cos(x),\\
      \sin(2\pi + x) &= -\sin(\pi + x) &= \phantom{-}\sin(x),\\
      \cos(2\pi + x) &= -\cos(\pi + x) &= \phantom{-}\cos(x).
      \end{array}$$
\indy{Index}{function!periodic}%
\indy{Index}{periodicity}%


\subsection{tangent}
\label{sec:tangent}

\begin{definition}[tangent]\label{def:tan}
Let $\tan(x) = \sin(x)/\cos(x)$, defined when $\cos(x)\ne0$.
\indy{Index}{tangent}%
\indy{Notation}{tan@$tan$}%
\end{definition}


\begin{lemma}\guid{KWYPRWZ}\label{lemma:tan-add}\formal{TAN\_ADD}
    If $\cos(x)\ne 0$, $\cos(y)\ne 0$, and $\cos(x+y)\ne0$ then
    $$\tan(x+y) = \frac{\tan(x) + \tan(y) }{ 1 - \tan(x)\tan(y)}$$
\end{lemma}
\indy{Index}{trigonometric identities!tangent}%

\begin{proved}
  Divide the first line of Lemma~\ref{lemma:sin-add} by the second
  line of the same lemma.
\swallowed\end{proved}

\begin{lemma}\guid{KSQDZSF}\label{lemma:tan-pi4}\formal{TAN\_PI4}
    $$\tan(\pi/4) = 1.$$
\end{lemma}

\begin{proved}
    $$\tan(\pi/4) = \sin(\pi/2-\pi/4)/\cos(\pi/4) =
    \cos(\pi/4)/\cos(\pi/4) = 1.$$
\swallowed\end{proved}


\subsection{arctangent}

This section reviews the properties of the arctangent function.

\begin{definition}[arctangent]\label{def:arctan}\formal{atn,\ ATN,\ ATN\_TAN,\ ATN\_BOUNDS,\ TAN\_ATN}
There is a unique function $\arctan:\ring{R}\to\ring{R}$ with
image $(-\pi/2,\pi/2)$ such that
    $$\tan(\arctan x) =x.$$
\indy{Index}{arctangent}%
\end{definition}

If $-\pi/2 < x < \pi/2$, then also $\arctan(\tan(x)) = x$. In
particular,\footformal{ATN\_1}
    $$\arctan(1) = \arctan(\tan(\pi/4)) = \pi/4.$$


The function $\arctan$ is differentiable with derivative%
\footformal{DIFF\_ATN,\ ATN\_MONO\_LT,\ ATN\_MONO\_LT\_EQ}
    $$\frac{d\phantom{~}} {dx} \arctan(x) = \frac{1}{1 + x^2}.$$
The derivative is everywhere positive, and the function $\arctan$ is
strictly increasing.
\indy{Index}{arctangent!derivative}%


The proofs in this book often use $\arctan(y/x)$ when $x$ is near $0$.
The following variant of $\arctan$ clears the denominator:
$$
\atn: \ring{R}^2\setminus\{(0,0)\} \to (-\pi,\pi].
$$
$$
\atn(x,y) = \begin{cases}
   \arctan(y/x) & x > 0\\
   \pi/2- \arctan(x/y) & y > 0 \\
   \pi + \arctan(y/x) & x< 0,\  y\ge 0\\
   -\pi/2- \arctan(x/y) & y< 0 \\
\end{cases}
$$
\indy{Notation}{arctan2@$\atn$}%
\indy{Notation}{arctan@$\arctan$}%


There is some overlap between cases. Nevertheless, 
this function is well-defined.  
The {\tt ANSI C} programming language implements this function as {\it arctan2}.  It gives the
angular argument of $(x,y)$ with the branch cut along the negative axis.
That is, $x = r\cos\phi$, $y=r\sin\phi$, with $\phi=\atn(x,y)$.
Note that some programming languages implement this function with the two arguments in reverse: $(y,x)$.
\indy{Index}{arctangent!near 0}%
\indy{Notation}{r@$r$ (coordinate)}%
\indy{Notation}{xy@$(x,y)$ (Cartesian point)}%
\indy{Notation}{ZZphi@$\phi$ (coordinate)}%


\subsection{inverse trig}
\indy{Index}{function!inverse trigonometric}%
Other inverse trigonometric functions will generally be reduced to
the arctangent.  This section defines the $\arccos$ function and show how it can be expressed in terms of $\atn$.

\begin{definition}[arccos]\label{def:arccos}\formal{acs,\ ACS\_COS,\ COS\_ACS}
$\arccos y$ is the function on the interval $[-1,1]$ which takes
values in $[0,\pi]$ and which is the inverse function of $\cos$:
    $$\begin{array}{lll}
        y\in [-1,1] &\Rightarrow \cos(\arccos y) = y\\
        x\in[0,\pi] &\Rightarrow \arccos(\cos x) = x
    \end{array}$$
\indy{Index}{arccosine}%
\indy{Notation}{arccos}%
\end{definition}

\begin{lemma}\guid{FMGMALU}\rating{2}\label{lemma:sin-arccos}\formal{sin\_acs\_t} 
If $y\in[-1,1]$, then
    $$\sin(\arccos(y)) = \sqrt{1-y^2}.$$
\end{lemma}

\begin{proved}
    The range of $\arccos(y)$ is $[0,\pi]$.  On this interval, $\sin$
    is nonnegative.  It is enough to check that the squares of the two sides are equal.  It then follows from the circle identity
    (Lemma~\ref{lemma:circle}).
\swallowed\end{proved}


Our preference is to remove the $\arccos$ function whenever
possible, by replacing it with the $\atn$ function through the
following identity.  


\begin{lemma}\guid{OUIJTWY}\rating{1}\label{lemma:arccos-arctan}\formal{acs\_atn2\_t}  
If $y\in [-1,1]$, then
    $$\arccos(y) = \pi/2 - \atn({ \sqrt{1-y^2}},{y}).$$
\end{lemma}
\indy{Index}{trigonometric identities!arccos}%
\indy{Index}{trigonometric identities!arctan}%
\indy{Notation}{arccos}%
\indy{Notation}{arctan@$\arctan$}%

\begin{proved}
The endpoints $y=\pm1$ can be checked directly.
If $y\in (-1,1)$,  $x = \arccos(y)$, 
$z = \arctan(y/\sqrt{1-y^2})$, then
    $-\pi/2 < \pi/2 - x < \pi/2$, and $-\pi/2 < z < \pi/2$.  It is
    therefore enough to check that
        $\tan(\pi/2 - x) = \tan(z)$.
    But
        $$\tan(\pi/2-x) = \frac{\cos(x)}{\sin(x)} = \frac{y}{
        \sin(\arccos(y))} = \frac{y}{ \sqrt{1-y^2}} = \tan(z).$$
\swallowed\end{proved}

%\begin{definition}[arcsine]\label{def:arcsin}\formal{asn}
%$\arcsin y$ is the function on the interval $\leftclosed
%-1,1\rightclosed$ taking values in $[-\pi/2,\pi/2]$ that is the
%inverse function of $\sin$:
%    $$\begin{array}{lll}
%        y\in [-1,1] &\Rightarrow \sin(\arcsin y) = y\\
%        x\in[-\pi/2,\pi/2] &\Rightarrow \arcsin(\sin x) = x
%    \end{array}$$
%\indy{Index}{arcsine}%
%\indy{Notation}{arcsin}%
%\end{definition}
%
%As this book does not use the arcsine function, it does not develop any of its properties.





\section{Vector Geometry}

This section reviews vector geometry in $\ring{R}^N$, including products (scalar and dot), inequalities (triangle and Cauchy-Schwarz), and hulls (convex and affine).

\begin{definition}
For any finite set $N$, define $\ring{R}^N$ as the set of functions
$\v:N\to\ring{R}$. Write $\v_i$ for the value of the function $\v$ at $i\in N$.
\indy{Index}{real numbers}%
\indy{Notation}{reals@$\ring{R}^N$}%
A function in $\ring{R}^N$ is called a {\it vector}.  
The zero vector $0$ is the function that is identically zero.  
\indy{Index}{vector}%
\end{definition}
 \indy{Index}{vector!zero}%
Write $\ring{R}^n$ as an alias of $\ring{R}^N$, 
when $n\in\ring{N}$ and $N=\{0,\ldots,n-1\}$.

Addition and scalar multiplication on $\ring{R}^N$
is the pointwise addition and scalar multiplication of functions:
    $$\begin{array}{rll}
    (\u + \v)_i &= \u_i + \v_i.\\
    (t \u)_i &= t \u_i,\quad t\in\ring{R}.\\
    \end{array}
    $$
\indy{Index}{function!addition}%
\indy{Index}{function!multiplication}%
Addition is commutative and associative, and gives
$\ring{R}^N$ the structure of a vector space.
\indy{Index}{vector space} %
Define the difference of two vectors to be $\u - \v = \u + (-1) \v$.
\indy{Index}{vector!difference}%

There is a dot product
$$(\cdot):\ring{R}^N\to\ring{R}^N\to\ring{R}$$ defined by
    $$\u\cdot \v = \sum_{i\in N} \u_i \v_i.$$
\indy{Index}{vector!dot product}%
\indy{Notation}{1@$\cdot $ (dot product)}%
It satisfies the following
properties:
    $$\begin{array}{rll}
        \u \cdot (\v + \w) &= \u \cdot \v + \u \cdot \w\\
        (\u + \v)\cdot \w &= \u \cdot \w + \v \cdot \w\\
        (t \u)\cdot \w &= t(\u \cdot \w) = \u \cdot (t \w)\\
        0 &\le \u\cdot \u\\
    \end{array}$$
There is also a norm
$$\normo{\u} = \sqrt{\u\cdot \u},$$
which satisfies $\normo{ t \u } = |t| \, \normo{\u}$.  Clearly, $\normo{\u}=0$  if and only if $\u=0$.
\indy{Index}{vector!norm}%
%\indy{Notation}{norm@\hbox{$\normo{\u}$} (vector norm)}%

The distance function $d(\u,\v) = \norm{ \u }{ \v}$ makes
$\ring{R}^N$ into a metric space.  
\indy{Index}{metric space}%
\indy{Index}{function!distance}%
\indy{Notation}{d@$d$ (metric)}%
The proof that $d$ is indeed a metric depends on the Cauchy-Schwarz inequality:


\begin{lemma}\guid{JJKJALK}[Cauchy-Schwarz inequality]\formal{Jordan/metric\_spaces.ml:cauchy\_schwartz}
    $$|\u \cdot \v| \le \normo{\u}\,\normo{\v}.$$
Furthermore, the case
$\pm \u\cdot \v = \normo{\u}\,\normo{\v}$  of equality holds exactly when $\normo{\v} \u = \pm\normo{\u} \v$.
\end{lemma}
\indy{Index}{Cauchy-Schwarz inequality}%

\begin{proved}
   Let $\w = \normo{\v} \u \pm \normo{\u} \v$.  The expansion of $\w\cdot \w$ gives
    $$0\le \w\cdot \w = 2\normo{\u}^2\normo{\v}^2 \pm 2\normo{\u}\, \normo{\v} (\u\cdot \v) =
    2\normo{\u}\,
    \normo{\v} (\normo{\u}\, \normo{\v} \pm (\u \cdot \v)).$$
    If $2\normo{\u} \,\normo{\v} = 0$, then $\u$ or $\v$ is zero, and the result
    easily follows.  Otherwise divide both sides of the inequality
    by the positive quantity $2 \normo{\u} \,\normo{\v}$ to get the result.
\swallowed\end{proved}

\begin{lemma}\guid{OIPLPTM}[triangle inequality]\formal{Jordan/metric\_spaces.ml:norm\_triangle}
  $$
  \normo{\u + \v} \le \normo{\u} + \normo{\v }.
  $$
Equality holds exactly when $\normo{\v}\u = \normo{\u}\v$.
\end{lemma}
\indy{Index}{triangle inequality}%

\begin{proved}
Both sides are nonnegative; it is enough to compare the squares of
both sides.  By the Cauchy-Schwarz inequality,
    $$\normo{\u + \v}^2 = \u\cdot \u + 2 \u\cdot \v + \v\cdot \v \le
      \u\cdot \u + 2 \normo{ \u}\,\normo{\v} + \v\cdot \v = (\normo{\u}+\normo{\v})^2.
    $$
The case of equality follows from the case of equality in the
Cauchy-Schwarz inequality.
\swallowed\end{proved}





\subsection{parallelepiped}\label{sec:piped}
\indy{Index}{parallelepiped}%



The following polynomial, $\Delta$,  appears in many different functions related to the geometry of three dimensions.  The formula following the definition shows that it is closely related to the square of the volume of a parallelepiped.  The interpretation as  volume is not relevant until the next chapter.  Its non-negativity is immediately relevant. 
\indy{Index}{parallelepiped!volume}%

%% WW repeated DEF.
\begin{definition}[$\Delta$]\label{def:delta}\formal{definitions\_kepler.ml:delta\_x}  Let 
$$
\begin{array}{lll}
\Delta(x_1,\ldots,x_6) &= x_1 x_4 (- x_1+x_2+x_3- x_4+x_5+x_6)+\\&
            x_2 x_5 (x_1- x_2+x_3+x_4- x_5+x_6)
            +x_3 x_6 (x_1+x_2- x_3+x_4+x_5- x_6)
            - \\&x_2 x_3 x_4- x_1 x_3 x_5- x_1 x_2 x_6- x_4 x_5 x_6
\end{array}
$$
\end{definition}
\indy{Notation}{ZZdelta@$\Delta$}%
\indy{Index}{determinant!Cayley-Menger}%

The polynomial $\Delta$ appears in the following context.
Cayley and Menger compute the determinant $D$ of the
matrix with rows $\v_1-\v_0$, $\ldots,$ $\v_n-\v_0$, 
for any vectors $\v_i\in\ring{R}^n$.   Set
\begin{equation}\label{eqn:xij}
x_{ij} = \norm{\v_i}{\v_j}^2,
\end{equation}
entries of a matrix $[x_{ij}]$.
Write $\underbar 1$ for a row vector of length $n$ 
whose entries all equal $1\in\ring{R}$.
Elementary matrix manipulations give
$$
D^2 = \frac{(-1)^{n-1}}{2^n}
    \left|\begin{matrix}[x_{ij}]& {}^t{\underbar 1}\\ {\underbar 1}& 0
        \end{matrix}\right|.
$$
The right-hand side is a polynomial in the squares of the edge lengths.
%The special case  $n=2$ gives the polynomial $\ups$ (Definition~\ref{def:ups}).  

The case $n=3$ gives $\Delta$:
$$
4 D^2 = \Delta(x_{12},x_{13},x_{14},x_{34},x_{24},x_{23}).
$$
The
left-hand side is a square and the polynomial on the right is
non-negative, whenever the variables $x_{ij}$ satisfy~\eqn{eqn:xij}.  In this case there 
are four vectors $\v_1,\ldots,\v_4$.  
The polynomial is even positive when the four vectors are affinely independent.
\indy{Index}{edge!length}%
\indy{Notation}{ZZups@$\ups$}%
\indy{Notation}{ZZdelta@$\delta$}%
\indy{Notation}{xij@$x_{ij}$}%
%Write $\Delta_j$ for the $j$th partial derivative of $\Delta$. 
%Let $D = \det(\v_2-\v_1,\v_3-\v_1,\v_4-\v_1)$.


\indy{Index}{determinant}%





\subsection{affine geometry}




Most of the following definitions apply to $n$-dimensional
Euclidean space; however, this book uses them only in
three dimensions.  The first definition 
gives the affine span of a finite set.  For example,
the affine span of two distinct points is a line;
the affine span of three independent points is a plane.
By placing additional
positivity constraints on the linear combinations, the definitions
extend to a large assortment of other geometric objects
such as rays, half-planes, convex hulls, and cones.  
Each of these comes in two versions: an open version
defined by strict inequality and a closed version defined
by weak inequality.  For example, the closed half-plane
includes a bounding line and the open half-plane does
not.  In this chapter, `open' and `closed' are not topological notions; rather, they
indicate the semialgebraic conditions of strict  and weak inequality.


\begin{definition}[affine]\label{def:aff} 
 If $S = \{\v_1,\v_2,\ldots,\v_k\}$ 
and $S'=\{\v_{k+1},\ldots,\v_n\}$ are  finite sets, then
set
	$$\begin{array}{lll}
      \op{aff}\, S &= \{t_1 \v_1 +\cdots t_k \v_k \mid
	t_1 +\cdots+t_k = 1\}.\\
        \op{aff}_{\pm} (S,S') &= \{t_1 \v_1 +\cdots t_n \v_n \mid
	t_1 +\cdots+t_n = 1, \pm t_j \ge 0, \text{ for } j>k.\}.\\
        \op{aff}^0_{\pm} (S,S') &= \{t_1 \v_1 +\cdots t_n \v_n \mid
	t_1 +\cdots+t_n = 1, \pm t_j > 0, \text{ for } j>k.\}.\\
		\end{array}
        $$
To lighten the notation for singleton sets, abbreviate $\op{aff}_\pm(\{\v\},S')$ to
$\op{aff}_\pm(\v,S')$.
\indy{Notation}{aff@$\op{aff}$}%
\indy{Notation}{aff2@$\op{aff}_{\pm}$}%
\indy{Notation}{aff3@$\op{aff}^0_{\pm}$}%
\indy{Index}{affine}%
\indy{Notation}{S@$S$ (set)}%
\end{definition}


In the next definition, $\op{conv}\,S$ agrees with the usual
notion of the convex hull of a finite set of points.
The set $\op{conv}^0\,S$ is similar, but defined by strict inequalities.


\begin{definition}[convex hull]  If $S = \{\v_1,\v_2,\ldots,\v_n\}$ is a finite set
of points in $\ring{R}^3$, then
set
	$$
        \begin{array}{lll}
          \op{conv}\, S &= \op{aff}_+\, (\emptyset,S)\\
	   \op{conv}^0 S &= \op{aff}^0_+\, (\emptyset,S).\\
           \end{array}
        $$
\indy{Notation}{conv}%
\indy{Notation}{conv0@$\op{conv^0}$}%
\indy{Index}{convex hull}%
\end{definition}

In the following definition of a cone, the point $\v$ serves
as apex, and $S$ is a generating set for the positive directions.
In the special case that $S$ is a singleton $\{\w\}$, 
the cone gives
a ray originating at $\v$ and passing through $\w$.  Later
chapters call sets of the form $\op{cone}(\v,\{\u_1,\u_2\})$ {\it blades}.
Blades are planar sets bounded by two rays originating at $\v$.
\indy{Notation}{\v@$\v$ (apex)}%
\indy{Notation}{S@$S$ (generating set)}%
\indy{Index}{blade}%

\begin{definition}[cone]
Let $S$ be a finite subset of
$\ring{R}^3$ and let $\v\in\ring{R}^3$. Set
  $$\begin{array}{lll}
  \op{cone}(\v,S) &= \op{aff}_+(\{\v\},S)\\
  \op{cone}^0(\v,S) &= \op{aff}^0_+(\{\v\},S)\\
  \end{array}
  $$
\indy{Index}{cone}%
\indy{Notation}{cone@$\op{cone}$}%
\indy{Notation}{cone0@$\op{cone}^0$}%
\end{definition}

%The Voronoi cell is one of the fundamental geometric objects in this book.  Earlier chapters have already discussed it at great length.  Some authors use a weak inequality in the definition, others strict.  The definition takes strict inequalities.


%\begin{definition}[Voronoi cell $\Omega$] 
%Let $S$ be a finite set of points in 
%$\ring{R}^3$.  Let $\v\in\ring{R}^3$. Set
 % $$
  %\Omega(\v,S) = \{x \mid \norm{\v}{x} \le \norm{\w}{x}, \forall \w\in S\setminus\{\v\}\}
  %$$
%\end{definition}

%% Changed to weak inequality May 14, 2009. -tchales.
	
\begin{definition}[line,~collinear]	
Any set of the form $\op{aff}\{\v,\w\}$ is a {\it line} when $\v\ne \w$.  A set that is contained in a line is {\it collinear}.  If $\{0,\v,\w\}$ is not collinear, then $\v$ and $\w$ are said to be independent.
\end{definition}
\indy{Index}{line}%
\indy{Index}{collinear}%

\begin{definition}[plane, half plane, coplanar]	
An affine hull $A=\op{aff}\{\u,\v,\w\}$ is a {\it plane} when $\{\u,\v,\w\}$ is not collinear.   A set $\op{aff}(\{\u,\v\},\{\w\})$
is a {\it half-plane} when $\{\u,\v,\w\}$ is not collinear. A set that is contained in a plane is  {\it coplanar}.
\end{definition}
\indy{Index}{plane}%
\indy{Index}{half-plane}%
\indy{Notation}{A@$A$ (plane)}%
\indy{Index}{coplanar}%


\begin{definition}[half space] A set $\op{aff}_{\pm}(\{\u,\v,\w\},\{\v'\})$ is a {\it half-space},
when $\{\u,\v,\w,\v'\}$ is not coplanar.  Under the substitution of
$\op{aff}_{\pm}$ for $\op{aff}_{\pm}^0$, it is called an
{\it open half-space}.
\end{definition}
\indy{Index}{half-space}%
\indy{Index}{half-space!open}%

\section{Angle}\label{sec:angle}

Until now, the discussion of trigonometric functions has been purely analytic.  This section
interprets them geometrically.
It covers fundamental identities
in both Euclidean and spherical trigonometry, including the law
of cosines, the law of sines, the spherical law of cosines, 
and a beautiful formula due to Euler for
the area of a spherical triangle.

If $\u,\v$ are given vectors with $\u$ and $\v$ nonzero, then by the
Cauchy-Schwarz inequality,
    $$-1 \le \frac{\u\cdot \v}{\normo{\u}\,\normo{\v}} \le 1.$$
The expression in the middle lies in the domain of the function $\arccos$. This permits the following definition.
\indy{Index}{Cauchy-Schwarz inequality}%
\indy{Notation}{uvector@$\u$ (vector)}%
\indy{Notation}{\v@$\v$ (vector)}%

\begin{definition}[angle,\ arclength]\label{def:angle}
Let $\u,\v,\w$ be vectors with $\u\ne \v,\w$.
Define 
    $$
    \arc_V(\u,\{\v,\w\}) = \arccos\left(\frac{(\u-\v)\cdot (\u-\w)}{\norm{\u}{\v}\,\norm{\u}{\w}}\right).
    $$
The value of this function is the {\it angle} at $\u$ formed by $\v$ and $\w$.
\indy{Index}{central angle}%
\indy{Index}{arc}%
\indy{Index}{arclength}%
\indy{Notation}{wz@$\w$ (vector)}%
\indy{Notation}{arcv@$\arc_V$}%
\end{definition}

By the relation between $\arccos$ and $\atn$
(Lemma~\ref{lemma:arccos-arctan}), %if $|\u\cdot \v|\ne \normo{\u}\,\normo{\v}$,
%then 
    \begin{equation}\label{eqn:angle}
    \arc_V(\u,\{\v,\w\}) = \frac{\pi}2 - \atn\left ({\sqrt{(\normo{\u}^2\normo{\v}^2 -
    (\u\cdot \v)^2)}}, {\u\cdot \v}\right).
    \end{equation}
\indy{Index}{arclength}%

The notation $\arc_V$ for angle comes from its interpretation as the
length of a geodesic arc on a unit sphere
centered at $\u$ from point $\v$ to $\w$.
\indy{Index}{arc!geodesic}%
The subscript $V$ is a reminder that
the function arguments are vectors.  The function
$\arc$, without the subscript,  gives the angle as a function
of the three edge lengths of a triangle.
\indy{Index}{function!vector}%
\indy{Notation}{V@$V$ (subscript)}%
\indy{Notation}{arc@$\arc$}%

%\begin{definition}[arc length]  The arclength of a geodesic arc on a unit sphere
%centered at $\v_0$ from point $\v_1$ to $\v_2$ is the angle formed by
%$\v_1$ and $\v_2$ at $\v_0$.
%\end{definition}

\begin{definition}[arc]
When the triangle inequalities hold:
$$
a + b \ge c,\quad b + c \ge a, \quad c+a \ge b
$$
and $a,b,c >0$, define
 $$\arc(a,b,c) = \arccos(\frac{a^2 + b^2 - c^2}{2 a b}).$$
\indy{Index}{arc}%
\end{definition}

\begin{lemma}\guid{HQTBPCM}[law of cosines]\rating{5}
Let $\u,\v,\w$ be vectors with $\u\ne \w$, $\v\ne \w$.  Let $a
    = \norm{\v }{ \w}$, $b = \norm{\u }{ \w}$, and $c = \norm{\u }{ \v}$.
    Let $\gamma=\arc_V(\w,\{\u,\v\})$.    Then
        $$c^2 = a^2 + b^2 - 2 a b \cos\gamma.$$
Also,
$$
\arc_V(\w,\{\u,\v\})= \arc(a,b,c).
$$
%if $\u$, $\v$, and $\w$ are not collinear then

\end{lemma}
\indy{Notation}{ZZddgamma@$\gamma$ (angle)}%
\indy{Index}{arc}%
\indy{Index}{law of cosines} %
\indy{Index}{trigonometric identities!law of cosines}%
\indy{Index}{cosine!law of cosines}%
\begin{proved}
    $$\begin{array}{lll}c^2 &= \norm{\v }{ \u}^2 = ((\v - \w) - (\u - \w))\cdot ((\v - \w) - (\u -
    \w)) \\ &= a^2 + b^2 - 2 (\v - \w)\cdot (\u - \w) = a^2 +b ^2 - 2 a b
    \cos\gamma.
    \end{array}$$
This identity can be solved for $\gamma$, and this gives the final statement of the lemma.
\swallowed\end{proved}


\begin{definition}[$\ups$]\label{def:ups}
Let $\ups$ (the symbol is a greek upsilon, which is written with a
wider stroke than a roman vee) be the polynomial
    $$\ups(x,y,z) = -x^2 - y^2 - z^2 + 2 x y + 2 y z + 2 z x.$$
\indy{Notation}{ZZups@$\ups$}%
\end{definition}



%% WW Repeated def (tarski.tex)
This polynomial is non-negative under certain conditions. (The polynomial
$\ups$, like $\Delta$, 
is the square of a Cayley-Menger determinant.)  
If $a,b,c$ are the sides of a triangle, then $a,b,c>0$ and the triangle
inequality holds for all orderings of sides: $(b+c-a)\ge 0$, and so forth.
The polynomial factors
    $$\ups(a^2,b^2,c^2) = 16 s (s-a) (s-b) (s-c),$$
where $s = (a+b+c)/2$.
Non-negativity $0\le
\ups(a^2,b^2,c^2)$ follows from the triangle inequality applied to
each factor in the factorization of $\ups$: $2(s-a) = (b+c-a) \ge0$, and
so forth.  
\indy{Index}{Cauchy-Schwarz inequality}%
\indy{Index}{triangle inequality}%


Heron's formula for the area of 
a triangle with sides $a,b,c$ is $$\sqrt{\ups(a^2,b^2,c^2)}/4.$$  
\indy{Index}{Heron's formula}%
The following
lemma  computes the area of a triangle.  

\begin{lemma}\guid{UKBAHKV}[law of sines]\rating{20}
Assume that $a,b\ne 0$ and $a+b\ge c$, $b+c\ge a$, and $c+a\ge b$.
Let $\gamma=\arc(a,b,c)$.  Then
        $$2 a b \sin\gamma = \sqrt{\ups(a^2,b^2,c^2)}.$$
\end{lemma}
\indy{Index}{trigonometric identities!law of sines}%
\indy{Index}{law of sines}%
\indy{Index}{sine!law of sines}%
\begin{proved}
Both sides are non-negative, so it is enough to check
that their squares are equal.  By the definition of $\arc$:
      $$4 a^2 b^2 \sin^2\gamma = 4 a^2 b^2 (1-\cos^2\gamma) = (4 a^2 b^2 - (a^2 + b^2 -
      c^2)^2) = \ups(a^2,b^2,c^2).$$
      % checked 4/4/2008
\swallowed\end{proved}

Another useful relation gives $\arc$, expressed in terms of $\atn$:
  $$
  \arc(a,b,c) = 
    \pi/2 - \atn({\sqrt{\ups(a^2,b^2,c^2)}},{ a^2 + b^2 - c^2}).
    $$



\subsection{cross product} uses angle.

This book makes infrequent use of the cross product.
A definition and the most basic properties will suffice.

\begin{definition}[cross product]   Let $\u =(x,y,z)$ and $\u' = (x',y',z')$.  
Let the cross product be defined
by
    $$
    \u \times \u' = (y z' - y' z, z x' - x z', x y' - y x').
    $$
\indy{Index}{cross product}%
\indy{Index}{vector!cross product}%
\indy{Notation}{1@$\times$ (cross product)}%
\end{definition}

\begin{lemma}\guid{KVVWPNA}\rating{20}  
Any two vectors $\u,\v$ satisfy
    $$\normo{\u \times \v} = \normo{\u}\,\normo{\v}\sin\gamma,$$
where $\gamma=\arc_V(0,\{\u,\v\})$.
Also $\u \cdot (\u\times \v) = \v\cdot (\u\times \v) = 0$.
\end{lemma}

\begin{proved}
   Both sides are non-negative, so it is enough to compare the
   squares of both sides.  The square of the left-hand side is
   $$
   \begin{array}{lll}
   &(y z'- y'z)^2 + (z x' - x z')^2 + (x y' - y x')^2 \\
    &\qquad\qquad=
   (x^2 + y^2 + z^2)(x'^2 + y'^2 + z'^2) - (x x' + y y' + z z')^2
   \\&\qquad\qquad= \normo{\u}^2\normo{\v}^2 - (\u\cdot \v)^2 = \normo{\u}^2\normo{\v}^2 \sin^2\gamma.
   \end{array}
   $$
The second assertion of the lemma follows directly from the definitions of the dot and cross products.
\swallowed\end{proved}


\begin{lemma}\guid{BKMUSOX}\rating{20}
    $$
    \u\times \v = -\v\times \u,\quad
    (\u\times \v)\cdot \w = (\v\times \w)\cdot \u.
    $$
\end{lemma}

\begin{proved}
These are elementary calculations.
\swallowed\end{proved}



\subsection{dihedral angle}

A dihedral angle of a tetrahedron are the angles formed between two of its faces. In general,
the dihedral angle refers to the angle formed by two half-planes
delimited by a common line.  The dihedral angle is determined
by two points $\{\w_0,\w_1\}$ on the delimiting line
and two points $\w_2$ and $\w_3$ on the two half-planes.
\indy{Index}{angle!dihedral}%
\indy{Index}{tetrahedron}%
\indy{Index}{function!vector}%
\indy{Notation}{dihv@$\dih_V$}%
\indy{Index}{vector!projection}%
\indy{Index}{orthogonality}  %

\begin{definition}[dihedral angle]\label{def:dih} Assume that $\w_0\ne \w_1$.
Write $\dih_V(\{\w_0,\w_1\},\{\w_2,\w_3\})$ for the angle $\gamma\in[0,\pi]$
formed
by 
    $$
    \bar \v = (\w\cdot \w) \v - (\w\cdot \v) \w\quad\text{and }\quad \bar \u =
            (\w\cdot \w) \u - (\w\cdot \u) \w,
    $$
where $\v = \w_2-\w_0$, $\u=\w_3-\w_0$ and $\w=\w_1-\w_0$.  Call it
the dihedral angle formed by $\w_2$ and $\w_3$ along $\{\w_0,\w_1\}$.
\indy{Notation}{dih}%
\indy{Index}{angle!dihedral}%
\end{definition}
The subscript $V$ is a reminder 
that the dihedral angle takes vector arguments.
Later, a second version, without the subscript, will
compute the angle as a function of the lengths of edges of a 
tetrahedron.
\indy{Index}{edge!length}%
\indy{Notation}{V@$V$ (subscript)}%
As the notation suggests, the dihedral angle depends only
on the unordered pairs $\{\w_0,\w_1\}$, $\{\w_2,\w_3\}$.

The dihedral angle is the planar angle between two rays, obtained by projection of the two half-planes to a plane orthogonal to both of them.
Up to positive scalars, $\bar \u$ and $\bar \v$ are the projections of
$\u$ and $\v$ to a plane orthogonal to the vector $\w$.  The
dihedral angle is the angle between $\bar \u$ and $\bar \v$ at $0$.

The dihedral angle is unchanged if $\w$ is replaced by $t \w$ with
$t\ne0$. The dihedral angle is unchanged if $\v$ is replaced with
$t_\v \v + t_\w \w$ with $0 < t_\v$ and $t_\w$ arbitrary, because such points project along the same ray.  
It is unchanged if
$\u$ is replaced with $t_\u \u + t_\w \w$ with $0 < t_\u$ and $t_\w$
arbitrary, because such points project along the same ray.  In particular, the dihedral angle formed by $\v$ and
$\u$ along $\{0,\w\}$ is the same as that formed by $\v/\normo{\v}$ and
$\u/\normo{\u}$ along $\w/\normo{\w}$.

The dihedral angle is degenerate and will not be used when $\w =
0$, $\bar \v = 0$, or $\bar \u = 0$.




\begin{lemma}\guid{RLXWSTK}[spherical law of cosines]\label{lemma:sloc}\oldrating{100}
\rating{0}
\formalauthor{Nguyen Quang Truong}
Let $\gamma$ be the dihedral angle formed by $\v$ and $\u$ along
$\{\v_0,\w\}$.  Let $a$, $b$, and $c$ be the
angle between $\u$ and $\w$, $\v$ and $\w$, and $\v$ and
$\u$, respectively. %Assume $\w\ne \v_0$.  
Assume that $\{\v_0,\v,\w\}$ and $\{\v_0,\u,\w\}$ are not collinear.
Then
    $$\cos\gamma = \frac{\cos c - \cos a \cos b}{\sin a\sin b}.$$
\end{lemma}
\indy{Index}{cosine!spherical law of cosines}%
\indy{Index}{spherical law of cosines}%
\indy{Index}{trigonometric identities!spherical}%

The spherical law of cosines is the most fundamental identity of spherical trigonometry.    Although  spherical
triangles do not become a topic until later in the book, $a$, $b$, and $c$ may be interpreted as
the arclengths of the sides of a spherical triangle with
vertices $\v/\normo{\v}$, $\u/\normo{\u}$, and $\w/\normo{\w}$,  when $\v_0=0$.  Also,
$\gamma$ measures the angle of the spherical triangle opposite the
side $c$.
\indy{Index}{spherical geometry}%
\indy{Index}{triangle!spherical}%


\begin{proof}  By translation, without loss of generality, suppose that $\v_0=0$.  
The formula for the dihedral angle shows that the
dihedral angle is unchanged if $\v$, $\u$, and $\w$ are replaced
by $\v/\normo{\v}$, $\u/\normo{\u}$, $\w/\normo{\w}$, respectively.  Hence assume without
loss of generality that $\normo{\v}=\normo{\u}=\normo{\w}=1$.

Let $\bar \v$ and $\bar \u$ be the vectors in Definition~\ref{def:dih}.
The law of cosines gives
        $$\cos\gamma = \frac{\bar \v\cdot \bar \u}{\normo{\bar \v}\,\normo{\bar \u}}.$$
The vectors $\v$, $\u$, and $\w$ all have unit length.  Hence
        $$
        \normo{\bar \v}^2 = \bar \v\cdot \bar \v =
        (\v - (\w\cdot \v)\w)\cdot (\v - (\w\cdot \v) \w) =
        1 - (\w\cdot \v)^2 = \sin^2 b.
        $$
So $\normo{\bar \v} =\sin b$. Similarly, $\normo{\bar \u} = \sin a$.  This gives
the denominator in the spherical law of cosines.  An expansion of the dot product
gives the numerator:
    $$
    \bar \v\cdot \bar \u = (\v - (\w\cdot \v) \w)\cdot (\u - (\w\cdot \u) \w)
    = (\v\cdot \u) - (\w\cdot \v) (\w\cdot \u) = \cos c - \cos
    a \cos b.
    $$
The identity follows.
\end{proof}

The spherical law of cosines gives the angles of a spherical
triangle as a function of its sides.  In spherical geometry,
there is a polarity between angles and sides of a triangle.
This book does not go into details about this polarity.%
\footnote{In three dimensionsal Eulidean space, the orthogonal
complement of a plane through the origin is a line through
the origin.  This gives a polarity between planes and lines
through the origin.  The intersection of each plane and line with
a unit sphere at the origin yields a polarity between great
circles and antipodal
pairs of points (the poles of the great circle).  The three edges
of a spherical triangle $ABC$ lie on three great circles which
determine three
antipodal pairs of points.  From each of the three  pairs, 
a coherent
choice can be made of one of the two poles (by choosing the pole
closer to the opposite vertex of $ABC$).  
These three poles are the vertices
of the polar triangle $A'B'C'$.  Each statement about the triangle $ABC$
can be polarized to a statement about $A'B'C'$.
In particular, the edges $a,b,c$ and angles $\alpha,\beta,\gamma$ of $ABC$ 
are related to those $a',b',\ldots$ of $A'B'C'$ by
   $$
   a + \alpha' = \pi,\quad a' + \alpha= \pi,
   $$
and so forth.
\indy{Notation}{A@$ABC$ (triangle)}}  %
One
consequence of this polarity is a formula for the sides of
a triangle as a function of its angles.  Up to signs,
it has the same form as the law of cosines.
\indy{Index}{great circle}%

\begin{lemma}\guid{NLVWBBW}[spherical law of cosines - second form]\oldrating{80}
\rating{0}
\formalauthor{Nguyen Quang Truong}
Let $\v,\u,\w$ be three points in $\ring{R}^3$.
Let $\alpha,\beta,\gamma$ be the dihedral angles: 
   $$
   \begin{array}{lll}
     \alpha &= \dih_V(\{\v_0,\v\},\{\u,\w\})\\
     \beta &= \dih_V(\{\v_0,\u\},\{\v,\w\})\\
     \gamma&= \dih_V(\{\v_0,\w\},\{\u,\v\})\\
     \end{array}
   $$
Let $c$ be the
angle between $\v$ and $\u$ at $\v_0$. 
Assume that $\{\v_0,\v,\w\}$ and $\{\v_0,\u,\w\}$ are not collinear.
Then
    $$
    \cos c = \frac{\cos \gamma + \cos \alpha \cos \beta}
     {\sin \alpha\sin \beta}.
    $$
\end{lemma}
\indy{Index}{cosine!spherical law of cosines}%
\indy{Index}{spherical law of cosines}%

\begin{proof}  
Here is a direct
computational proof that avoids polarity.
Let $a$ be the angle between $\u$ and $\w$, and let $b$ be the angle
between $\v$ and $\w$ at $\v_0$.
Let $A=\cos a$, $B=\cos b$, $C=\cos c$,
$A'=\sin a$, $B'=\sin b$, $C'=\sin c$.  The
spherical law of cosines gives
   $$\sin^2\beta = 1-\left(\frac{B-A C}{A' C'}\right)^2
     = \frac{p}{A'^2 C'^2},$$
where $p=1-A^2 - B^2 - C^2 + 2 A B C$.
In particular, $p\ge 0$.
\indy{Notation}{p@$p$ (trigonometric expression)}%
A computation of $\sin^2\alpha$ and the remaining terms in the same way gives
   $$
   \begin{array}{lll}
     \sin\alpha\sin\beta &= \frac{\displaystyle p}{\displaystyle A' B' C'^2}\\ 
      \\
     \cos\gamma + \cos\alpha \cos\beta &=
         \frac{\displaystyle C - A B}{\displaystyle A' B'} + \frac{\displaystyle A - B C}{\displaystyle B' C'} \frac{\displaystyle B - A C}{\displaystyle A' C'}
         = \frac{\displaystyle p C}{\displaystyle A' B' C'^2}.\\
    % C &= \frac{\cos\gamma + \cos\alpha \cos\beta}{\sin\alpha \sin\beta}\\
   \end{array}
   $$
The result follows.
\end{proof}

The following lemma gives a formula for the dihedral angle
of a tetrahedron in terms of its edge lengths.  The
familiar polynomials $\ups$ and $\Delta$ appear once again.
\indy{Notation}{ZZups@$\ups$}%
\indy{Notation}{ZZdelta@$\Delta$}%


\begin{lemma}\guid{OJEKOJF} \label{lemma:dihform}\oldrating{80}
\rating{0}
\formalauthor{Nguyen Quang Truong}
Let $\v_0,\v_1,\v_2,\v_3$ 
be vectors with $\{\v_0,\v_1,\v_2\}$ not collinear, 
and $\{\v_0,\v_1,\v_3\}$ not
collinear. 
Let $\gamma$ be the dihedral angle formed
by $\v_2$ and $\v_3$ along $\{\v_0,\v_1\}$. Let
    $$(x_1,\ldots,x_6) = 
    (x_{01},x_{02},x_{03},x_{23},x_{13},x_{12}),
    \text{ where } x_{ij}=\norm{\v_i}{\v_j}^2.$$
Let $\Delta_4$ be the partial derivative of $\Delta(x_1,\ldots,x_6)$ with
respect to $x_4$.
The dihedral angle $\gamma=\dih_V(\{\v_0,\v_1\},\{\v_2,\v_3\}$
is given by
    $$
    \gamma=\arccos(\frac{\Delta_4(x_1,\ldots,x_6)}{\sqrt{
    \ups(x_1,x_2,x_6)\ups(x_1,x_3,x_5)}}).
    $$
%Assuming that $\gamma\ne 0,\pi$, 
It is also given by
    $$
    \gamma=\frac{\pi}{2} - \atn
     ({\sqrt{4 x_1 \Delta(x_1,\ldots,x_6)}},{\Delta_4(x_1,\ldots,x_6)}).
    $$
\end{lemma}
%% pi/ 2. -  arctan(  deltax4/ (sqrt (4. * x1 * delta)))
\indy{Index}{angle!dihedral}%


\begin{proof}
Let $\beta = \arc_V(\v_0,\{\v_1,\v_2\})$.
The assumptions give $\bar \v_2\ne 0$ and $\bar \v_3 \ne 0$ (where $\bar \v_2$ and
$\bar \v_3$ are the projections computed as in Definition~\ref{def:dih}).  
\indy{Notation}{ZZbeta@$\beta$}%
    By expanding definitions and dot products
    $$
    \bar \v_2\cdot \bar \v_2 = (\v_1\cdot \v_1) ((\v_1\cdot \v_1)(\v_2\cdot \v_2) -
    (\v_1\cdot \v_2)^2) =  x_1^2 x_2 \sin^2 \beta = \frac{1}{4}
    x_1
    \ups(x_1,x_2,x_6).
    $$
    Similarly,
    $$\bar \v_3 \cdot \bar \v_3 = \frac{1}{4} x_1 \ups(x_1,x_3,x_5).$$

Let $y_i = \sqrt{x_i}$. Then
    $$\begin{array}{lll}
    \bar \v_2\cdot \bar \v_3 &= (\v_1\cdot \v_1)((\v_1\cdot \v_1)(\v_2\cdot \v_3) -
    (\v_1\cdot \v_2)(\v_1\cdot \v_3) ) \vspace{6pt} \\  &
    = x_1 \left(\frac{\displaystyle x_1 (x_2 + x_3 -
    x_1)}{2} - \frac{\displaystyle (x_1 + x_2 - x_6)(x_1 + x_3 -
    x_5)}{4} \right)\vspace{6pt}\\&
    %= \frac{x_1}{4} (2 x_1 (x_2+x_3-x_4) -
    %(x_1+x_2-x_6)(x_1+x_3-x_5)) \vspace{6pt}\\&
    = {x_1\Delta_4(x_1,\ldots,x_6)}/{4}.
    \end{array}
    $$
The result follows in terms of $\arccos$.

The translation $\atn$ uses the $\arccos$-$\atn$ identity
and the following polynomial identity
    $$
    \frac{16}{x_1^2}(\normo{\bar \v_2}^2 \normo{\bar \v_3}^2 - (\bar \v_2\cdot \bar \v_3)^2) =
    \ups(x_1,x_2,x_6)\ups(x_1,x_3,x_5) - \Delta_4(x_1,\ldots,x_6)^2
    = 4 x_1 \Delta(x_1,\ldots,x_6).
    $$
\end{proof}






\subsection{Euler angle sum}

The expression $\alpha_1+\alpha_2+\alpha_3-\pi$ is Girard's
formula (known first to T. Harriot) 
for the area of a spherical triangle with angles
$\alpha_1$, $\alpha_2$, $\alpha_3$.  The following lemma
gives a formula for the area, discovered by
Euler and Lagrange.
% \indy{Index}{Girard, A.}%
% Albert Girard's Book on trigonometry was published in 1626. Harriot lived 1560 - 1621.
\indy{Index}{Girard's formula}%
\indy{Index}{geometry!spherical}%
\indy{Index}{triangle!spherical}%
\indy{Index}{ZZalphai@$\alpha_i$}%
\indy{Index}{Harriot, T.}%

\begin{lemma}\guid{JLPSDHF}[Euler triangle]\label{lemma:euler}\rating{600}
Let $\v_0,\v_1,\v_2,\v_3$ be points in $\ring{R}^3$. 
Let 
  $$(y_1,\ldots,y_6) =(y_{01},y_{02},y_{03},y_{23},y_{13},y_{12}),
   \text{ where } y_{ij}=\norm{\v_i}{\v_j}.$$
Set
$x_i = y_i^2$.   
and
    $$
    p = y_1 y_2 y_3 + y_1 (\w_2\cdot \w_3) + y_2 (\w_1\cdot \w_3) + y_3
    (\w_1\cdot \w_2).
    $$
\indy{Notation}{p@$p$ (Euler solid angle numerator)}%
where $\w_i = \v_i- \v_0$.
Let $$\alpha_i =\dih_V(\{\v_0,\v_i\},\{\v_j,\v_k\})$$
where $\{i,j,k\}=\{1,2,3\}$.
Assume that $\Delta(x_1,\ldots,x_6)>0$. 
Then
    $$
    \alpha_1+\alpha_2+\alpha_3 - \pi
     = {\pi} - 2\atn({\Delta(x_1,\ldots,x_6)^{1/2}},{2 p}),
    $$
for three given dihedral angles $\alpha_i$.
\end{lemma}
\indy{Index}{triangle!Euler}%

\begin{proof}
%% I checked all the details of this proof in 
%% Math'ca on May12,2007
The angles are unchanged if the vectors $\w_i$ are rescaled so that
$\normo{\w_i}=1$.  The given formula is also unchanged under rescalings:
the factor $a$ is homogeneous of degree $3$ under a change $\w_i
\mapsto t \w_i$ for $t>0$, and so is $\sqrt{\Delta}$ by the
formula for $\Delta$.  Thus, without loss of generality, $\normo{\w_i}=1$, for
$i=1,2,3$.  Consequently, $y_1=y_2=y_3=1$.  It is convenient to use
different notation $a=x_4$, $b=x_5$, $c=x_6$ for the other
variables. The expansion of the dot products in $p$ by the law of cosines
gives
    $$2 p = 8 - (a+b+c).$$
Also, $$\Delta(x_1,\ldots,x_6) = \Delta(1,1,1,a,b,c) =
    \ups(a,b,c) - a b c.$$
Since $0 <\Delta$, the arctangent formula
in Lemma~\ref{lemma:dihform} 
applies for the dihedral angles $\alpha_i$.  After
this substitution (and clearing a factor of $3$),  %and clearing the $3$ from the denominator, 
the desired identity takes the form $f(a,b,c)=0$, where
    $$
    f(a,b,c)= -\pi/2 - \sum_{i=1}^3\arctan(\u_i/\sqrt{\Delta}) +
    2\arctan(2 p/\sqrt{\Delta}),
    $$
for some rational functions $\u_i$ of $a,b,c$.   The aim is to prove this trig identity holds whenever $\Delta>0$.

Fix $b,c$ and differentiate $f$ with respect
to $a$.  The partial derivative $\partial f/\partial a$ has the form
$g(a,b,c)/\sqrt{\Delta}$ for some rational function of $a,b,c$ (with
nonzero denominator).  A brute force calculation shows that $g(a,b,c)$ is
identically $0$.  (Euler himself did not shun brute force.  See
\cite{Euler}.)

By symmetry, the partial derivatives with respect to $b$ and $c$ are
also identically zero.  The function $f(a,b,c)$  is continuously
differentiable whenever $\Delta>0$.  Thus, its directional
derivatives are zero.  Thus, $f(a,b,c)$ is constant on connected
sets of the domain of $\Delta>0$.  Without loss of generality, $a\le b\le c$.  For $a\le t\le b$,  the derivative is non-negative:
$d\Delta(1,1,1,t,b,c)/dt\ge 0$. Hence $f(a,b,c)=f(b,b,c)$. 
Similarly,
 $f(b,b,c)=f(c,c,c)$. 
The last step is to evaluate the constant $f(c,c,c)$
by taking $c$ small.
$\Delta=3c^2-c^3$, $2p= 8-3c$,  $\u_1=\u_2=\u_3 = c -c^2/2$.   Finally,
    $$f(a,b,c)= f(c,c,c) = \lim_{c\mapsto0} f(c,c,c) = 
    3 \arctan(1/\sqrt3)-\pi/2 =0.$$
\end{proof}
\indy{Notation}{ZZdelta@$\Delta$}%






\subsection{spherical triangle inequality}
\indy{Index}{triangle!spherical}%
\indy{Index}{spherical triangle inequality}%

The geodesic length between two points
$\u,\v$ on a unit sphere centered at $\v_0$ is $\arc_V(\v_0,\{\u,\v\})$.
The following lemma is part of the verification that
the function $d(\u,\v) = \arc_V(\v_0,\{\u,\v\})$ is a metric
on the unit sphere.  The lemma excludes the degenerate case when
points on the sphere are antipodal.
\indy{Notation}{d@$d(\u,\v)$ (function)}%

\begin{lemma}\guid{KEITDWB}\label{lemma:sph-tri-ineq}
\oldrating{80}
\rating{0}
\formalauthor{Nguyen Quang Truong}
Let $\{\v_0,\u,\v,\w\}$ be a set of four points in $\ring{R}^3$.
Assume that $\v_0$ is not collinear with any of the other two points.
Then
   $$
   \arc_V(\v_0,\{\u,\w\}) \le \arc_V(\v_0,\{\u,\v\}) + \arc_V(\v_0,\{\v,\w\}).
   $$
Equality occurs if and only if $\v\in\op{aff}_+(\v_0,\{\u,\w\})$.
\end{lemma}

\begin{proof} Let $\v'$ be the projection of $\v$ to the plane
$\op{aff}\{\v_0,\u,\w\}$.  
By the spherical law of cosines, when the triangle is right:
   $$
   \cos\psi = \cos\beta\cos\alpha \le \cos\beta,
   $$
where $\psi = \arc_V(\v_0,\{\u,\v\})$, $\beta = \arc_V(\v_0,\{\u,\v'\})$, $\alpha=\arc_V(\v_0,\{\v,\v'\})$.
Thus, $\arc_V(\v_0,\{\u,\v'\})=\beta\le \psi=\arc_V(\v_0,\{\u,\v\})$.
Similarly, $\arc_V(\v_0,\{\v',\w\}) \le \arc_V(\v_0,\{\v,\w\})$.
Thus, it is enough to show that 
  $$
  \arc_V(\v_0,\{\u,\w\}) \le \arc_V(\v_0,\{\u,\v'\}) + \arc_V(\v_0,\{\v',\w\}).
  $$
The points $\v_0,\u,\w,\v'$ are coplanar.
By the additivity of planar angle (Lemma~\ref{lemma:polar-sum}), if 
$\v'\in \op{aff}_+(\v_0,\{\u,\w\})$, then
   $$
   \arc_V(\v_0,\{\u,\w\}) = \arc_V(\v_0,\{\u,\v'\}) + \arc_V(\v_0,\{\v',\w\}),   
   $$
and otherwise,
   $$
   \arc_V(\v_0,\{\u,\w\}) = \norm{\arc_V(\v_0,\{\u,\v'\}) }{ \arc_V(\v_0,\{\v',\w\})}.
   $$
The inequality follows.

A trace of the argument shows that equality occurs exactly when
$\alpha=0$ and $\v'\in \op{aff}_+(\v_0,\{\u,\w\})$.  Equivalently,
$\v'=\v\in\op{aff}_+(\v_0,\{\u,\w\})$.
\end{proof}

\begin{lemma}\guid{FGNMPAV}\oldrating{40}
\rating{0}
\formalauthor{Nguyen Quang Truong}
\label{lemma:sph-tri-multi}
Let $\{\v_0,\u_0,\u_1,\u_2,\ldots,\u_r\}$ be a set of points in $\ring{R}^3$.
Assume that no triple $\{\v_0,\u_i,\u_{i+1}\}$ is collinear.  Assume
that $\{\v_0,\u_0,\u_r\}$ is not collinear.  Then
$$
  \arc_V(\v_0,\{\u_0,\u_r\}) \le \sum_{i=0}^{r-1} \arc_V(\v_0,\{\u_i,\u_{i+1}\}).
$$
\end{lemma}

\begin{proof} This is an easy induction on $r$ with base
case given by Lemma~\ref{lemma:sph-tri-ineq}.
\end{proof}

\subsection{Lexell's theorem}

\begin{lemma}\guid{UWIPRDV}[Lexell]\rating{0}\oldrating{500}
% was 1000 with old proof including lemma ZHH
Fix two points $\v_1,\v_2$ on a unit sphere  that
are not antipodal.
Let $\u,\u'$ be two other points the sphere in the same open hemisphere determined by the great circle through $\v_1,\v_2$.  Then the two spherical triangles $\{\v_1,\v_2,\u\}$ and $\{\v_1,\v_2,\u'\}$ have the same area if and only if
the four points $\u$, $\u'$, $\v^*_1$, $\v^*_2$ are concircular, where $\v^*_i$ is the point antipodal to $\v_i$.
\end{lemma}
\indy{Index}{Lexell's Theorem}%
\indy{Notation}{1@$\hbox{-}^*$ (antipode)}%



\begin{proof}  By the polarity of triangles mentioned above, it is enough to prove the polar statement.  By Girard's formula, fixing the area fixes the sum of the angles.  The polar triangle has fixed perimeter.  By polarity, Lexell's theorem is a consequence of the following lemma.
\end{proof}
\indy{Index}{Girard's formula}%

\begin{lemma}\guid{ZHHSGTF}\rating{0}  Fix one point $\v$ on the unit sphere, with antipodal point $\v^*$.  Consider two great half-circles $D_i$, $i=1,2$ between $\v$ and $\v^*$ that are not coplanar.  Two great circles $A$ and $B$ cut equi-perimeter triangles with vertex $\v$ along $D_i$ if and only if the great circles $D_i$, $A$, and $B$ are tangent to a common circle $C$.
\end{lemma}
\indy{Index}{great circle}%

\begin{proof} The two tangents to a circle through a given point have the same length.  If $C$ exists, then this fact implies that a great circle $A$ that is tangent to $C$ cuts a triangle with vertex $\v$ along $D_i$ whose perimeter is equal to the sum of the distances from $\v$ to the two points of tangency $C\cap D_i$.  This is independent of $A$.
\indy{Notation}{A@$A,B$ (great circles)}%
\indy{Notation}{D@$D$ (half circle)}%
\indy{Notation}{C@$C$ (circle)}%

Conversely, for $A$ any great circle there is a unique $C$ that inscribes the great circles $D_i$, and $A$.  The perimeter of the triangle is the sum of the distances from $\v$ to the points $C\cap D_i$.
If a second $A$ gives a triangle with the same perimeter, its circle $C'$
must satisfy $C'\cap D_i = C\cap D_i$.  This forces $C=C'$.
\end{proof}

\subsection{regular polygons}
\indy{Index}{polygon}%
\indy{Index}{polygon!regular}%

\begin{lemma}\guid{GOTCJAH}\rating{300}\label{lemma:ngon}
Let $C$ be a circle on the unit sphere with arcradius $a<\pi/2$.  Among all spherical $n$-gons that
contain $C$  (that is, among all $n$-fold intersections of hemispheres containing $C$), that of minimal area is the regular $n$-gon.  
\end{lemma}

In other words, the minimal configuration consists of the intersection of $n$-hemispheres whose bounding great circles are tangent to the circle $C$ at $n$-equally spaced bounds around $C$.

\begin{proof} 
Consider a spherical triangle with sides $a,b,c$ and opposite angles $\alpha,\beta,\gamma$.  If $\gamma=\pi/2$, then by Girard's formula, the area
of the triangle is
$$
\alpha+\beta-\pi/2,
$$
and by the law of cosines 
$$
\cos(\alpha) =\sin(\beta)\cos(a).
$$
This determines the area $g(a,\beta)$ of the triangle 
as a function of $a$ and $\beta$.
\indy{Index}{Girard's formula}%
\indy{Notation}{g@$g$ (triangle area)}%
\indy{Notation}{ZZalpha@$\alpha$ (angle)}%
\indy{Notation}{ZZbeta@$\beta$ (angle)}%
\indy{Notation}{ZZddgamma@$\gamma$ (angle)}%

In the smallest intersection of hemispheres,  every bounding great circle will be tangent to $C$.
The area of the regular $n$-gon circumscribing $C$ is
$$
\sum_{i=1}^n g(a,\beta_i) 2,
$$
with angle sum
$$
\sum_{i=1}^n \beta_i = 2\pi.
$$
With  $a$ fixed, the second partial of $A$ with respect to $\beta$ is
$$
\frac{\partial^2 g(a,\beta)}{\partial \beta^2} = \frac{\cos(a)\sin^2(a)\sin(\beta)}{\sin^2(\alpha)} > 0.
$$
The function is convex.
By convexity, the minimum area occurs when all angles are equal
$\beta_i = \pi/n$.
\end{proof}
\indy{Index}{convex}%

\begin{lemma}\guid{BBEVFIC}\rating{100}\label{lemma:ngon-area}
The minimum area of an intersection of $n$-hemispheres containing a circle $C$ 
of arcradius $a<\pi/2$ is
$$
2\pi - 2 n \,\arcsin\left(\,\cos(a)\sin(\beta)\,\right),
$$
when $\beta = \pi/n$.
\end{lemma}

\begin{proof} This is equal to the area formula
$$
2 n g(a,\beta)
$$
in the previous lemma.
Alternatively, the polygon breaks into $2n$ triangles, each computed by Girard's
formula to have area
$$
\beta - (\pi/2 - \alpha)  = \pi/n - \arcsin(\cos(\alpha)) = 
\pi/n - \arcsin(\cos(a)\sin(\beta)).
$$
\end{proof}


\indy{Index}{Girard's formula}%
\indy{Index}{polygon}%


\section{Coordinate Systems}

This final section of the chapter establishes the existence
and basic properties of the standard coordinate systems
(polar coordinates, spherical coordinates, and cylindrical
coordinates).  The azimuth (or longitudinal) angle of the
spherical coordinate system determines a cyclic permutation,
called the azimuth cycle, on a finite set of points in $\ring{R}^3$, ordered according
to increasing azimuth angle.  The basic
properties of that permutation are developed. 
\indy{Index}{azimuth}%
\indy{Index}{angle!azimuth}%
\indy{Index}{azimuth cycle}%
\indy{Index}{cyclic permutation}%
\indy{Index}{angle}%
\indy{Index}{coordinate systems}%

\subsection{polar coordinates}
\label{sec:polar}
\indy{Index}{polar coordinates}%
\indy{Index}{coordinate systems!polar coordinates}%


For every pair of real numbers $x$ and $y$,  there are real numbers
$r$ and $\theta$ such that
    \begin{equation}\label{eqn:polar}
    x = r\cos\theta,\quad y = r\sin\theta.
    \end{equation}
If $x$ and $y$ are both zero, then take $r=0$, and the
Equations~\ref{eqn:polar} hold for all choices of $\theta$. If $x$
and $y$ are not both zero, then take $0<r$, and $\theta$ is
uniquely determined (up to multiples of $2\pi$).  By convention, 
$0\le\theta < 2\pi$.
\indy{Notation}{r@$r$ (coordinate)}%
\indy{Notation}{ZZtheta@$\theta$ (coordinate)}%

Let $S=\{p_1,\ldots,p_k\}$ be a finite set of
nonzero points in the plane, with
polar coordinates $p_i = (r_i\cos\theta_i,r_i\sin\theta_i)$.
It is useful to order the set of points according to increasing angle.
To deal with degenerate cases when some points have exactly
the same angle, order the points with the lexicographic order on their
polar coordinates.  Write $p_i \prec p_j$ if
$\theta_i < \theta_j$ or ($\theta_i=\theta_j$ and $r_i<r_j$).
This is a total order on the points.  (This book will not ever
actually need the degenerate cases when two angles are equal,
but by defining a total order,  there is never any need to revisit the issue.)
\indy{Index}{order!total}%
There is a cyclic permutation $\sigma:S\to S$ which sends
$p\in S$ to the next larger element with respect to this order,
or back to the first element if $p$ is the largest.
Call $\sigma$ the {\it polar cycle}
of the set $S$.
\indy{Index}{order!lexicographic}%
\indy{Index}{polar cycle}%
\indy{Index}{cyclic permutation}%
\indy{Notation}{ZZsigma@$\sigma$ (permutation)}%




For $\psi\in\ring{R}$, let $T:\ring{R}^2\to\ring{R}^2$ be the
rotation of the plane:
   \begin{equation}
   \label{eqn:rotate}
   (x,y) \mapsto  (x\cos\psi + y\sin\psi,-x\sin\psi+y\cos\psi).
   \indy{Index}{rotation}%
   \end{equation}
Let $\sigma'$ be the polar cycle for $T(S)$.  Then it is easily
checked that
$$
   \sigma'(T p) = T (\sigma p),\quad \text{ for } p\in S. 
$$
\indy{Notation}{ZZpsi@$\psi$}%
\indy{Notation}{T@$T$ (rotation)}%

\begin{lemma}\guid{PDPFQUK}\label{lemma:polar2}
\oldrating{50}
\rating{0}
\formalauthor{Nguyen Quang Truong}
\formal{thetaij\_t}
Let $\theta_i$ be real numbers such that $0\le \theta_i < 2\pi$, for $i=1,2$.
Let $$\theta_{ji} = \theta_i - \theta_j + 2\pi k_{ji},$$
where integers $k_{ij}$ satisfy $0\le \theta_{ji}< 2\pi$.
Then 
$$
  \theta_{12} + \theta_{21} = \begin{cases}
    2\pi, & \text{ if }\theta_i\ne\theta_j\\
    0,    & \text{ if }\theta_i=\theta_j.
    \end{cases}
$$
\end{lemma}
\indy{Notation}{ZZtheta@$\theta$}%

\begin{proof} This is elementary.
\end{proof}

The next lemma gives a precise form to the observation
that given finitely many rays emanating from the origin
in the plane, the sum of the included angles is $2\pi$.
In precise form, the polar cycle is used to place
a cyclic order on the rays.  There is a degenerate case
when there is at most one ray.


\begin{lemma}\guid{ISRTTNZ}\label{lemma:polar-sum}\rating{100}\formal{thetapq\_wind\_t}
Let $S\subset\ring{R}^2$ be a finite set
of cardinality $n$ that does not contain $0$.
Let $\sigma$ be the polar cycle on $S$.  
In polar coordinates,
$$p=\left(\, r(p)\cos\theta(p),\, r(p)\sin\theta(p)\,\right),$$ 
for $p\in S$, with
$0\le\theta(p)<2\pi$.
Write
   $$
   \theta(p,q) = \theta(q) - \theta(p) + 2\pi k_{pq},
   $$
for some integers $k_{pq}$ that satisf $0\le \theta(p,q) < 2\pi$.
Then for all $p\in S$
and all $0\le i \le j < n$,
   $$
   \theta(p,\sigma^i(p)) +\theta(\sigma^i(p),\sigma^j(p)) =
   \theta(p,\sigma^j(p)).
   $$
Moreover, if there exist $p,q\in S$ such that $\theta(p)\ne\theta(q)$,
  $$
  \sum_{i=0}^{n-1} \theta(\sigma^{i}p,\sigma^{i+1} p) = 2\pi.
  $$
(If $\theta(p)=\theta(q)$ for all $p,q\in S$, then all the
summands are zero.)
\end{lemma}
\indy{Notation}{ZZsigma@$\sigma$ (permutation)}%

\begin{proof}
Fix $p\in S$.
For $0\le i<n$, define $\theta_i$ by
   $\theta_0=\theta(p)$ and 
   $$\theta_i = \theta(\sigma^i(p)) + 2\pi \ell_i,$$
where  $\ell_i$ satisfies $\theta_0\le \theta_i < \theta_0+2\pi$.
It follows from the definition of the polar cycle that
$\theta_i \le \theta_j$ for $0\le i\le j < n$.  Then
$\theta(\sigma^i p ,\sigma^j p) = \theta_j - \theta_i$.
The first conclusion of the lemma reduces to
  $$
  (\theta_i-\theta_0) + (\theta_j-\theta_i) = (\theta_j-\theta_0),
  $$
which is certainly true.
The second conclusion reduces to
  $$
  \sum_{i=0}^{n-2} (\theta_{i+1}-\theta_i) + \theta(\sigma^{n-1}p,p)
  = \theta(p,\sigma^{n-1}p) + \theta(\sigma^{n-1}p,p).
  $$
By the previous lemma, this is $0$ or $2\pi$.
\end{proof}

\subsection{spherical coordinates}
\label{sec:spherical}



\begin{definition}[spherical coordinates]
Let $x,y,z$ be any real numbers.  A
triple $(r,\theta,\phi)$ such that
    \begin{equation}
    \label{eqn:spherical}
    x = r\cos\theta\sin\phi,\quad y = r\sin\theta\sin\phi,\quad
    z = r\cos\phi
    \end{equation}
with $0\le r$, $0\le\theta<2\pi$, and $0\le\phi\le\pi$ are called
spherical coordinates of $(x,y,z)$.  (This text follows the variable
naming conventions of American calculus textbooks, which differ
from the international scientific notation.)
\end{definition}
\indy{Index}{spherical coordinates}%
\indy{Index}{coordinate systems!spherical coordinates}%
\indy{Notation}{r@$r$ (coordinate)}%
\indy{Notation}{ZZtheta@$\theta$ (azimuth)}%
\indy{Notation}{ZZphi@$\phi$ (zenith)}%

Any triple $(x,y,z)$ has spherical coordinates.
The radial component is $r = \sqrt{x^2+y^2+z^2}$.  In the degenerate case $r=0$,
the Equations~\ref{eqn:spherical} become independent of $\theta$
and $\phi$. In the degenerate case when $\phi = 0$ or $\phi =
\pi$, the equations become independent of $\theta$. If $0<r$ and $\phi\ne 0,\pi$,  then $\theta$ is uniquely
determined by $x,y,z$. If $0<r$, then $\theta$ is uniquely determined.


%\begin{definition}[azimuth]\label{def:azimuth}
Call $\theta$ the {\it azimuth angle\/} and $\phi$ the {\it
zenith angle\/} of $(x,y,z)$.  The azimuth angle is also known as
the longitude.  The zenith angle is also known as the latitude. The
azimuth angle is a polar coordinate of $(x,y)$:
    $$
    (x,y) = (r'\cos\theta,r'\sin\theta), \quad r' = r\sin\phi.
    $$
\indy{Index}{azimuth}%
\indy{Notation}{azim}%
\indy{Index}{zenith}%
\indy{Index}{latitude}%
\indy{Index}{longitude}%
\indy{Index}{angle!azimuth}%
\indy{Index}{angle!zenith}%


\subsection{general coordinates}

\indy{Index}{coordinate systems}%
The zenith angle, azimuth angle,
spherical coordinates, and cylindrical coordinates 
generalize to arbitrary orthonormal frames.

First consider the zenith angle in a general orthogonal frame.
The following lemma identifies the zenith angle $\phi$ with respect to
a general orthonormal coordinate frame with $\e_3$ as the third
vector in that frame.  As it is easily expressed in terms
of the more basic function $\arc_V$, 
there is little need to refer directly to the zenith angle.
\indy{Index}{orthogonal frame}%

\begin{lemma}\guid{QAFHJNM}[zenith]
\oldrating{50}
\rating{0}
\formalauthor{Nguyen Quang Truong}
Let $(\v,\w)$ be an ordered pair of distinct points in $\ring{R}^3$.
Let $\u\ne \v$.  Set $\phi = \arc_V(\v,\{\u,\w\})\in[0,\pi]$.
Let $\e_3$ be the unit vector $(\w-\v)/\norm{\w}{\v}$.  Let $r = \norm{\u}{\v}$.
Then $\u$
can be expressed in the form
   $$
   \u = \v + \u' +
   r\cos\phi\, \e_3,
   $$
where $\u'\cdot \e_3 = 0$.
\indy{Index}{zenith}%
\indy{Index}{orthonormal frame}%
\indy{Index}{angle!zenith}%
\end{lemma}

\begin{proof} This follows directly from the definition of $\arc_V$:
  $$(\u-\v)\cdot \e_3 = r\cos\phi.$$
\end{proof}



\begin{lemma}\guid{EYFCXPP}[cylindrical coordinates]\oldrating{80}
\rating{0}
\formalauthor{Nguyen Quang Truong}
Let $\v$ and $\w$ be distinct points in 
$\ring{R}^3$.  Let $(\e_1,\e_2,\e_3)$ be positively oriented\footnote{That is, they are mutually orthogonal unit vectors such that $\e_3 = \e_1 \times \e_2$.} orthonormal
vectors such that $\e_3 = (\w-\v)/\norm{\w}{\v}$.
Then every
$\u\in\ring{R}^3$ that is not in the line $\op{aff}(\v,\w)$
can be uniquely expressed in the form
   $$
   \u = \v + r\cos\psi\, \e_1 + r\sin\psi\, \e_2 + h (\w-\v),
   $$
\indy{Notation}{h@$h$ (cylindrical coordinate)}%
\indy{Notation}{\e@$\e_i$ (orthonormal vectors)}%
for some $0< r$, $0\le \psi < 2\pi$, $h\in\ring{R}$.
Furthermore,
assume that $\w_1$ and $\w_2$ do
not lie in the line $\op{aff}(\v,\w)$.
Then there exist unique $\psi,\theta,r_1,r_2,h_1,h_2$
 such
that $0\le\psi<2\pi$, $0\le\theta < 2\pi$, $0 < r_1$, $0 < r_2$, and
  $$
  \begin{array}{lll}
    \w_1 &= \v + r_1\cos\psi\, \e_1 + r_1\sin\psi\, \e_2 + h_1(\w-\v),\\
    \w_2 &= \v + r_2\cos(\psi+\theta)\, \e_1 + r_2\sin(\psi+\theta)\, \e_2 
     + h_2(\w-\v),\\
\end{array}
  $$
Finally, the angle $\theta$ is independent of the choice of $\e_1,\e_2$
satisfying the given properties.
\end{lemma}
\indy{Index}{coordinate systems!cylindrical coordinates}%
\indy{Index}{cylindrical coordinates}%
\indy{Notation}{ZZpsi@$\psi$}%
\indy{Notation}{ZZtheta@$\theta$ (coordinate)}%
\indy{Notation}{r@$r$ (coordinate)}%
\indy{Notation}{h@$h$ (cylindrical coordinate)}%

\begin{definition}[azim] 
Define $\op{azim}(\v,\w,\w_1,\w_2)$, the azimuth angle, 
to be the uniquely determined
angle $\theta$, where $\theta$ is the angle given by the previous
lemma.
\indy{Notation}{azim}%
\indy{Index}{azimuth}%
\indy{Index}{angle!azimuth}%
\end{definition}

\begin{definition}[frame]
Let $\{\v,\w,\u\}\subset\ring{R}^3$ be a set that is not collinear.
Construct orthonormal vectors  $\e_1,\e_2,\e_3$ by setting
$\e_3 = (\v-\w)/\norm{\v}{\w}$; 
$\e_1\in\op{aff}_+^0(\{\v,\w\},\u)$ orthonormal with $\e_3$;
$\e_2 = \e_3\times \e_1$.
 The triple $E=(\e_1,\e_2,\e_3)$ is called
the {\it orthonormal frame} for $(\v,\w,\u)$.
\end{definition}
\indy{Index}{frame}%

\begin{lemma}\guid{JBDNJJB}\rating{ZZ}\label{lemma:sim}
Write $x\sim y$ when there exists $t>0$ such that $x= t y$. 
Then 
$$\sin(\op{azim}(0,\u,\v,\w))\sim (\u \times \v)\cdot \w.$$
\end{lemma}

\begin{proof}
The relation $\sim$ is an equivalence relation.
Let
$$
\begin{array}{rll}
   \e_3 &= \u/\normo{\u}\\
   \v' &= \v - (\e_3\cdot \v) \e_3\\
   \e_1 &= \v'/\normo{\v'}\\
   \e_2 &= \e_3 \times \e_1 \\
\end{array}
$$
Write $\w= r\cos\theta\, \e_1 + r\sin\theta \, \e_2 + h\, \e_3$ in cylindrical coordinates, where $\theta = \op{azim}(0,\u,\v,\w)$.
Then
$$
\begin{array}{rll}
   (\u\times \v)\cdot \w &\sim (\e_3\times \v)\cdot \w\\
   &= (\e_3\times \v')\cdot \w\\
   &\sim (\e_3\times \e_1)\cdot \w\\
   &= \e_2 \cdot \w\\
   &= r\sin\theta \\
   &\sim \sin\theta.
\end{array}
$$
\end{proof}

\begin{lemma}\guid{XPHCPNY}[spherical coordinates]\label{lemma:sph}\rating{60}\formal{spherical\_coord\_t}
Let $\{\v,\w,\u\}$ % and $\{\v,\w,\u'\}$ 
be a non-collinear subset of $\ring{R}^3$.
Let $(\e_1,\e_2,\e_3)$ be the orthonormal frame of $(\v,\w,\u)$.
  Then for any $\u'$,
   \begin{equation}
   \u' = \v + r \cos\theta \sin\phi\, \e_1 + r \sin\theta\sin\phi\, \e_2 +
   r\cos\phi\,\e_3.
   \label{eqn:sph}
   \end{equation}
where
$$
\begin{array}{lll}
r &= \norm{\v }{ \u'}\\
\phi &= \text{ zenith angle of } \u'\\
\theta &=\op{azim}(\v,\w,\u,\u').
\end{array}
$$
\end{lemma}
\indy{Index}{coordinate systems}%
\indy{Index}{coordinate systems!spherical coordinates}%
\indy{Index}{angle!zenith}%
\indy{Index}{angle!azimuth}%
\indy{Index}{spherical coordinates}%
\indy{Notation}{ZZphi@$\phi$ (zenith)}%

\begin{definition}[spherical coordinates]\label{def:sph}
Equation~\ref{eqn:sph} is called the spherical coordinate representation of
$\u'$ with respect to $(\v,\w,\u)$.   
%Write 
%  $$\u' = P(E,r,\theta,\phi)$$
%for Equation~\ref{eqn:sph}.
\end{definition}
\indy{Index}{coordinate systems}%
\indy{Index}{coordinate systems!spherical coordinates}%
\indy{Index}{spherical coordinates}%
\indy{Notation}{E@$E$ (orthonormal frame)}%

%The following gives the existence of polar coordinates on any oriented
%plane in three dimensions, with a general point $\v$ on the plane
%serving as the origin.  A normal vector $n$  orients the plane,
%then polar coordinates appear as the restriction of the
%spherical coordinates $(r,\theta,\phi)$ to the plane.
%The following lemma shows that the value of $\phi$ is fixed, so that
%it may be dropped from the notation.
%\indy{Index}{polar coordinates}%
%\indy{Index}{spherical coordinates}%
%\indy{Notation}{n@$n$ (normal vector)}%
%
%\begin{lemma}\guid{YBXRVTS}\label{lemma:polar-gen}\oldrating{60}
%\rating{0}
%\formalauthor{Nguyen Quang Truong}
%Let $\{\v,\w,\u\}$ be a set of three points in $\ring{R}^3$
%that is not collinear.
%Let $n = (\w-\v) \times (\u-\v)$.
%Then the zenith angle of any $\u'\ne \v$ in the plane $\op{aff}\{\v,\w,\u\}$,
%computed with respect to $(\v,\v+n)$,
%is $\pi/2$.
%\end{lemma}
%\indy{Index}{zenith}%
%\indy{Index}{angle!zenith}%
%
%\begin{definition}[polar coordinate]\label{def:polar}
%Call  the two remaining coordinates, $(r,\theta)$, 
%the polar coordinates of $\u'\in\op{aff}\{\v,\w,\u\}$ with
%respect to $(\v,\w,\u)$.
%\end{definition}
%\indy{Index}{coordinate systems}%
%\indy{Index}{coordinate systems!polar coordinates}%
%\indy{Index}{polar coordinates}%
%\indy{Notation}{r@$r$ (coordinate)}%
%\indy{Notation}{ZZtheta@$\theta$ (coordinate)}%
%
%In the special case that $\op{aff}\{\v,\w,\u\}=\ring{R}^2\subset \ring{R}^3$, this
%construction agrees with the previously defined polar coordinates of a point in
%the plane.


\subsection{Lexell without polarity}

Here is a second proof of Lexell's theorem that does not depend on polar triangles.

\begin{proof}  Select coordinates so that the Lexell circle (through $\u,\v^*_1,\v^*_2$) has constant zenith angle $\phi$.  Without loss of generality,  an appropriate coordinate system gives 
\indy{Notation}{ZZphi@$\phi$}%
\indy{Notation}{ZZtheta@$\theta$}%
$$
\begin{array}{lll}
\v_1 &= \{\cos\theta\sin\phi,+\sin\theta\sin\phi,-\cos\phi\}\\
\v_2 &= \{\cos\theta\sin\phi,-\sin\theta\sin\phi,-\cos\phi\}\\
\u &= \{\cos\alpha\sin\phi,\sin\alpha\sin\phi,\cos\phi\}\\
\end{array}
$$
The area of a triangle is given by Euler's formula (Lemma~\ref{lemma:euler}).  If these coordinates are used in Euler's formula,
then a calculation gives the area $\pi-2\atn(t,1)$, when
$$
t=\cos\phi \tan\theta.
$$
This is independent of $\alpha$, proving that every point on the Lexell circle (except for the degenerate points $\u= \v^*_1,\u=\v^*_2$ with $\Delta=0$) gives the same solid angle.
\indy{Notation}{ZZalpha@$\alpha$}%

To check that points on different Lexell circles give different solid angles,  any convenient point on the circle will do.  For example, there is an isosceles triangle $b=c$.  An easy derivative calculation shows that the function is increasing.  Hence different Lexell circles give different values.
\end{proof}
\indy{Notation}{ZZdelta@$\Delta$}%


\subsection{azimuth cycle}

As already defined, the polar cycle is a cyclic permutation on a set
of vectors in the plane that traverses them in order of increasing
angle.  What follows is the corresponding construction in three dimensional
space.  There is  a cyclic permutation on a set $S$ of vectors in space
that traverses them in order of increasing azimuth angle.  It is called 
the azimuth cycle.  Most of the work for this construction has already been done, because the azimuth cycle may be constructed as the polar cycle on the projection of $S$ to a plane.  However, 
a nondegeneracy condition must be imposed on $S$ to insure that
the projection to the plane is one-to-one.  The following
definition captures this nondegeneracy condition.
\indy{Index}{azimuth cycle}%
\indy{Index}{azimuth}%
\indy{Index}{cyclic permutation}%
\indy{Index}{vector!projection}%


\begin{definition}[cyclic set] Let $(\v,\w)$ be an ordered pair of distinct points in
$\ring{R}^3$.
Let $S$ be a finite set of points in $\ring{R}^3$.
Say that $S$ is cyclic with respect to $(\v,\w)$ if
the following two conditions hold.
\begin{itemize}
\item $p = q + h (\w-\v)$, with $p,q\in S$ and $h\in \ring{R}$
implies that $p=q$.  
\item  The line through $\v$ and $\w$ does not meet $S$.
\end{itemize}
\end{definition}
\indy{Index}{cyclic set}%

A cyclic set $S$ has a well-defined azimuth cycle:

\begin{definition}[azimuth cycle]
Let $\v$ and $\w$ be distinct points in
$\ring{R}^3$.
Let $S$ be a finite set of points in $\ring{R}^3$ that is
cyclic  with respect to $(\v,\w)$.  Pick $\u$ such that $\{\v,\w,\u\}$ is not collinear and let $\{\e_1,\e_2,\e_3\}$ be the corresponding orthonormal frame.
Let $f$ be the projection map:
   $$\v + x\, \e_1 + y\, \e_2 + z\, \e_3 \mapsto
     (x,y).$$
Let $\sigma'$ be the polar cycle on $f(S)$. Define 
$\sigma:S\to S$ by $f\sigma(p) =\sigma'f(p)$.
Call $\sigma$ the {\it azimuth cycle}
on $S$ with respect to $(\v,\w)$.
\indy{Index}{azimuth cycle} %
\indy{Index}{orthonormal frame}%
\indy{Index}{polar cycle}%
\indy{Notation}{f@$f$ (projection map)}%
\indy{Notation}{ZZsigma@$\sigma$ (polar cycle)}%
\indy{Notation}{ZZsigma@$\sigma$ (azimuth cycle)}%
\end{definition}

Facts about the polar cycle lift to facts about the azimuth cycle.
The next few lemmas are easy consequences of this sort.


\begin{lemma}\guid{NLOFMTR}\rating{80} The azimuth cycle $\sigma:S\to S$ on
a cyclic set $S$ with respect to $(\v,\w)$ does not depend
on the choice of $\u\in\ring{R}^3$ (such that $\{\v,\w,\u\}$ is non-collinear).
\end{lemma}
\indy{Index}{azimuth cycle}%
\indy{Index}{cyclic set}%

\begin{proof} This follows from independence of $\sigma\,'$ from
rotations in the $\{\e_1,\e_2\}$ plane  (Equation~\ref{eqn:rotate}).
\end{proof}


\begin{lemma}\guid{YVREJIS}\oldrating{40} 
\rating{0}
\formalauthor{Nguyen Quang Truong}
Let $(\v,\w)$ be an ordered pair of points in $\ring{R}^3$,
with $\v\ne \w$.  Assume that $\{\w_1,\w_2\}$ is cyclic
with respect to $(\v,\w)$.  Then
  $$
  \op{azim}(\v,\w,\w_1,\w_2) + \op{azim}(\v,\w,\w_2,\w_1) 
  = \begin{cases} 2\pi, & \text{if }\op{azim}(\v,\w,\w_1,\w_2)\ne 0,\\
    0, & \text{if }\op{azim}(\v,\w,\w_1,\w_2)=0.
    \end{cases}
    $$
\end{lemma}
\indy{Index}{cyclic}%

\begin{proof} This follows immediately from Lemma~\ref{lemma:polar2}.
\end{proof}

\begin{lemma}\guid{ULEKUUB}\rating{60} \label{lemma:2pi-sum}
Let $(\v,\w)$ be an ordered pair of points in $\ring{R}^3$,
with $\v\ne \w$.  Let $S$ be a finite set in $\ring{R}^3$ of
cardinality $n$ that
is cyclic with respect to $(\v,\w)$,
with azimuth cycle $\sigma$.
Then for all $p\in S$,
and all $0\le i \le j < n$,
   $$
   \op{azim}(\v,\w,p,\sigma^i(p)) +
    \op{azim}(\v,\w,\sigma^i(p),\sigma^j(p)) =
   \op{azim}(\v,\w,p,\sigma^j(p)).
   $$
Moreover, if there exists $q\in S$ such that 
$\op{azim}(\v,\w,p,q)\ne0$,
then
  $$
  \sum_{i=0}^{n-1} \op{azim}(\v,\w,\sigma^ip,\sigma^{i+1}p) = 2\pi.
  $$
(If $\op{azim}(\v,\w,p,q)=0$ for all $q\in S$, then all the
summands are zero.)
\end{lemma}
\indy{Notation}{azim}%
\indy{Index}{azimuth}%
\indy{Index}{azimuth cycle}%
\indy{Notation}{ZZsigma@$\sigma$}%
\indy{Notation}{n@$n$ (cardinality)}%

\begin{proof} This follows immediately from 
Lemma~\ref{lemma:polar-sum}.
\end{proof}


The azimuth and dihedral angles are closely related.   
The azimuth angle takes values between $0$ and $2\pi$, but the dihedral
angle is never greater than $\pi$.  The following lemma reveals that
the azimuth angle is an oriented extension of the dihedral angle, always
equal to $\dih$ or $2\pi - \dih$.
\indy{Index}{angle!azimuth}%
\indy{Index}{angle!dihedral}%
\indy{Notation}{dih}%
\indy{Index}{azimuth}%


\begin{lemma}\guid{QQZKTXU}\label{lemma:dih-azim}
\oldrating{100}
\rating{0}
\formalauthor{Nguyen Quang Truong}
Let $\w\ne \v$ be a nonzero vectors in $\ring{R}^3$.
  Assume that $\v_1$ and $\v_2$ do not lie in the line $\op{aff}(\v,\w)$.
Let
  $$\gamma = \dih_V(\{\v,\w\},\{\v_1,\v_2\}).$$
  Then
    $$
    \cos(\op{azim}(\v,\w,\v_1,\v_2)) = \cos\gamma.
    $$
\end{lemma}

\begin{proof}  For simplicity,  take our base point $\v=0$.
Let $\v_i' = (\w\cdot \w) \v_i - (\w\cdot \v_i) \w$.  
From the assumptions, $\v_1'\ne 0$.  Set $\e_1 = \v_1'/\normo{\v'_1}$.  Choose a unit vector
$\e_2$ so that $\det(\e_1,\e_2,\w)>0$ and $\e_1\cdot \e_2 = \w\cdot \e_2=0$.
Write $\v_i$ in cylindrical coordinates as 
   $$
   \begin{array}{lllll}
     \v_1 &= r_1 \e_1 &    &+h_1 \w\\
     \v_2 &= r_2 \cos\theta\, \e_1 &+ r_2 \sin\theta\, \e_2 &+ h_2 \w.
    \end{array}
   $$
The definition of $\op{azim}$ gives $\op{azim}(\v,\w,\v_1,\v_2)=\theta$.  
By definition, $\cos\gamma$ is the angle between $\v_1'$ and $\v_2'$.
Compute
   $$
   \begin{array}{lll}
     \v_1' &= \normo{\v'_1} \e_1 \\
     \v_2' &= (\w\cdot \w) r_2 \cos\theta\, \e_1 
       &+ (\w\cdot \w) r_2 \sin\theta\, \e_2 \\
     \end{array}
   $$
The result $\cos\theta=\cos\gamma$ 
is now a result of the definition of angle 
(Definition~\ref{def:angle}).
\end{proof}
\indy{Notation}{ZZddgamma@$\gamma$ (angle)}%
\indy{Notation}{ZZtheta@$\theta$ (angle)}%





