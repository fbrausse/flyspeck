\chapter{Trigonometry}
\label{part:trig}
\indy{Index}{trigonometry}%

\begin{summary}
  The first part of this book consists of a series of essays on
  packings.  The second part of this book presents a systematic
  development of foundational material on trigonometry, volume,
  hypermap, and fan.  There is a separate chapter on each of these
  topics.  The purpose of the foundational material is to build a
  bridge between the foundations of mathematics, as presented in
  formal theorem proving systems such as {\tt HOL Light}, and the
  solution to the packing problem.  This chapter is the first of the
  four foundational chapters.

  In this chapter, trigonometry is developed analytically.  The basic
  trigonometric functions are defined by their power series
  representations, and calculus of a single real variable is used to
  develop the basic properties of these functions.  Basic vector
  geometry is presented.
\end{summary}

\section{Background Knowledge}

\subsection{real analysis}
\label{back:analysis}  
  This chapter assumes general facts about
  \hypertarget{back:analysis}{real analysis} at the level of the
  textbook \cite{unknown}. %XX
  In particular, it assumes a general working knowledge of set theory 
and basic properties of the set of natural numbers and the
  field of real numbers.  In real analysis, it assumes basic
  properties of convergence, absolute convergence, limits, and
  differentiation.  In this chapter, the term {\it real analysis} is
  to be interpreted broadly to include even the most elementary facts
  of real arithmetic (by which we mean results in real analysis that
  do not involve limits).
\indy{Index}{real analysis}
\indy{Index}{real arithmetic}


\subsection{Tarski arithmetic}

\label{back:tarski}
  Certain sentences in real arithmetic can be expressed with nothing
  more than the usual logical operations (the operators {\it and},
  {\it or}, {\it implies}, {\it logical negation}), the ring
  operations (addition, subtraction, and multiplication) for the real
  numbers, comparison ($(=)$ and $(>)$) of real numbers, the constants
  $0$ and $1$, real-valued variables, and quantifiers (universal and
  existential) over the real numbers.  Such sentences are said to
  belong to the Tarski arithmetic.  For example, the sentence
\begin{equation}\label{eqn:tarski}
\exists x.~x^7 - 4 x - 3 = 0 ~~\land~~ x > 0.
\end{equation}
falls within the Tarski arithmetic (after expanding the exponent $x^7$
as $x\cdot x\cdot x\cdot x\cdot x\cdot x\cdot x$ and the constants
$4=1+1+1+1$ and $3=1+1+1$).  Starting with Tarski, researchers have
developed algorithms to decide the truth of any sentence in the Tarski
arithmetic \cite{unknown}. %XX
Although these algorithms are generally too slow to be of practical
use, it is useful to identify such sentences.  In this book, we will
assume that the reader has the skill to solve particularly simple
problems in the Tarski arithmetic such as determining that the
sentence \eqref{eqn:tarski} is true.
\indy{Index}{Tarski arithmetic}


\section{Trig Identities}


\subsection{sine and cosine}

The cosine and sine functions are defined by their infinite series:%
%\footformal{sin,\ cos,\ SIN\_0\, COS\_0}%
\begin{equation}\label{eqn:cos-def}\cos(x) = 1 - x^2/2! + x^4/4! \cdots,\qquad
  \sin(x) = x - x^3/3! + x^5/5! \cdots.
  \indy{Notation}{cos}%
  \indy{Index}{cosine}%
  \indy{Notation}{sin}%
  \indy{Index}{sine}%
  \indy{Index}{cosine!series definition}%
  \indy{Index}{sine!series definition}%
\end{equation}
\mar{\guid{FOYTTIX} Eq.~\ref{eqn:cos-def}}
By \hyperref[back:analysis]{real analysis}, convergence is absolute
for every real number $x$.  Each series can be evaluated at $0$:
\begin{equation}\label{eqn:cos0}
  \cos(0) = 1,\qquad \sin(0) = 0.
\end{equation}
\mar{\guid{YIXJNJQ} Eq.~\ref{eqn:cos0}}


These series may be differentiated term-by-term to establish the
identities: \indy{Index}{cosine!derivative}%
\begin{equation}\label{eqn:cos'}
\frac{d\phantom{~}} {dx}\cos(x) 
= -\sin(x),\qquad \frac{ d\phantom{~} }{dx}\sin(x) = \cos(x).
\end{equation}
\mar{\guid{COHWECZ} Eq.~\ref{eqn:cos'}}%
The powers $(\cos(x))^n$ and $(\sin(x))^n$ are conventionally written
$\cos^n(x)$ and $\sin^n(x)$.

Trigonometric identities follow easily from these definitions.  The
next two lemmas are examples.  \indy{Index}{trigonometric identities}%

\begin{lemma}[]\guid{WPMXVYZ}\rz{0}
\label{lemma:circle}\formal{SIN\_CIRCLE} 
\begin{displaymath}
\sin^2(x) + \cos^2(x) = 1.
\end{displaymath}
\end{lemma}
\indy{Index}{trigonometric identities!circle identity}%

\begin{proved}
  By \hyperref[back:analysis]{real analysis} and~\eqref{eqn:cos'}, the
  derivative of the function $f(x) = \cos^2(x) +\sin^2(x)$ is
  identically zero, so the function itself is constant.
  From~\eqref{eqn:cos0}, it follows that $f(x)=f(0)=1$.
  \swallowed\end{proved}


\begin{lemma}[]\guid{WNYVJPE}\rz{0}\label{lemma:sin-add}
\formal{SIN\_ADD,\ COS\_ADD}
\begin{displaymath}\begin{array}{lll}
\sin(x+y) &= \sin(x)\cos(y) + \cos(x)\sin(y)\\
\cos(x+y)  &= \cos(x)\cos(y) - \sin(x)\sin(y).
\end{array}\end{displaymath}
\end{lemma}
\indy{Index}{trigonometric identities!addition}%

\begin{proved}
The proof is an exercise in \hyperref[back:analysis]{real analysis}.
Fix $y$.  Let
\begin{displaymath}\begin{array}{lll}
f(x) = &(\cos(x+y) - \cos(x)\cos(y) +
\sin(x)\sin(y))^2 +\\ & (\sin(x+y) -\sin(x)\cos(y) -
\cos(x)\sin(y))^2.
\end{array}\end{displaymath}
The derivative of $f$ is identically zero.  The function is therefore
constant.  \hyperref[eqn:cos0]{Also}, $f(0)=0$.  Thus, $f$ is
identically zero.  If a sum of real squares is zero, the individual
terms are zero. The identities follow.  \swallowed\end{proved}

\begin{lemma}[]\guid{KGLLRQT}\rz{0}\label{lemma:cos-neg}
\formal{COS\_NEG,\ SIN\_NEG}
  The cosine is an even function.  The sine is an odd function.  That
  is,
\begin{displaymath}
\cos(-x) = \cos(x),\quad\sin(-x) =
    -\sin(x).
\end{displaymath}
\end{lemma}
\indy{Index}{function}%
\indy{Index}{function!even}%
\indy{Index}{function!odd}%


\begin{proved}
By \hyperref[back:analysis]{real analysis}, the derivative of
\begin{displaymath}
(\cos(-x) - \cos(x))^2 + (\sin(-x)
  +\sin(x))^2
\end{displaymath}
is identically zero.  Complete the proof as in the proof of
Lemma~\ref{lemma:sin-add}.  \swallowed\end{proved}

\subsection{periodicity}
\label{sec:pi}
\indy{Index}{periodicity}%

It is known that the cosine function has a unique root between $0$
and $2$. The constant $\pi$ is defined to be twice that root.  Thus, by
definition 
\begin{equation}\label{eqn:cospi2}
\begin{array}{rll}
\cos(\pi/2) &= 0,\\
\cos(x) &>0,\quad \text{when } 0<x<\pi/2\\
\end{array}
\end{equation}
\mar{\guid{CFXEKKP} Eq.~\ref{eqn:cospi2}}
The $\cos$ function is in fact
non-negative on the interval $\leftclosed 0,\pi/2\rightclosed$:
\begin{equation}\label{eqn:cospos}
\cos(x)\ge 0,   \quad 0\le x \le \pi/2.
\end{equation}
\mar{\guid{ZSKECZV} Eq.~\ref{eqn:cospos}}
\indy{Index}{cosine!roots}%

\begin{lemma}[]\guid{CPIREMF}\rz{0}\label{lemma:sin-pi2}
\formal{SIN\_PI2}
$\sin$ is non-negative on $[0,\pi/2]$ and  $\sin (\pi/2) = 1.$
\end{lemma}

\begin{proved}
  The proof is an exercise in \hyperref[back:analysis]{real analysis}.
  The \hyperref[eqn:cos']{derivative of $\sin$} is
  non-\hyperref[eqn:cospos]{negative} between $0$ and $\pi/2$.  The
  value of \hyperref[eqn:cos0]{$\sin$ at $0$} is $0$.  It follows that
  $\sin$ is non-negative on $[0,\pi/2]$.  It is enough to check that
  the squares of the two sides are equal.  Then $\sin^2(\pi/2)
  \hyperref[lemma:circle]{\,=\,} {1-\cos^2(\pi/2)}
  \hyperref[eqn:cospi2]{\,=\,} 1$.  \swallowed\end{proved}

\begin{lemma}[]\guid{SCEZKRH}\rz{0}\label{lemma:cos-sin}
\begin{displaymath}
\begin{array}{rll}
\sin(\pi/2 - x)  &= \cos(x),\\
\cos(\pi/2 - x)&=\sin(x).
\end{array}
\end{displaymath}
\end{lemma}

\begin{proved}
Apply the \hyperref[lemma:sin-add]{addition} law for the sine function,
\begin{displaymath}
\sin(\pi/2 - x) = \sin(\pi/2)\cos(-x) + \cos(\pi/2)\sin(-x)
\end{displaymath}
and use \hyperref[lemma:sin-pi2]{$\sin(\pi/2) = 1$} and
\hyperref[eqn:cospi2]{$\cos(\pi/2) = 0$}.  Then use that $\cos$ is an
\hyperref[lemma:cos-neg]{even} function.  The second identity is
similar.  \swallowed\end{proved}

Similarly,~%
%\footformal{SIN\_COS,\ SIN\_PERIODIC\_PI,\ COS\_PERIODIC\_PI, 
%SIN\_PERIODIC,\ COS\_PERIODIC}%
$\cos(\pi/2 + x) =
-\sin(x)$, $\sin(\pi/2 + x) = \cos(x)$.  Further,
\begin{equation}\label{eqn:periodic}
\begin{array}{lll}
\sin(\pi + x) &= \phantom{-}\cos(\pi/2 + x) &= -\sin(x),\\
\cos(\pi + x) &= -\sin(\pi/2 + x) &= -\cos(x),\\
\sin(2\pi + x) &= -\sin(\pi + x) &= \phantom{-}\sin(x),\\
\cos(2\pi + x) &= -\cos(\pi + x) &= \phantom{-}\cos(x).
\end{array}
\end{equation}
\mar{\guid{LLOYXRK} Eq.~\ref{eqn:periodic}}%
\indy{Index}{function!periodic}%
\indy{Index}{periodicity}%

\begin{lemma}[]\guid{WIBGJRR}\rz{0}\label{lemma:sin-pos}
$\sin$ is non-negative on $[0,\pi]$.
\end{lemma}

\begin{proof} By Lemma~\ref{lemma:sin-pi2}, $\sin$ is non-negative on
  $[0,\pi/2]$.  Furthermore, for $x\in[\pi/2,\pi]$,
\begin{displaymath}
  \sin(x) \hyperref[lemma:cos-neg]{\,=\,} -\sin(-x) 
  \hyperref[eqn:periodic]{\,=\,}  \sin(\pi-x) \hyperref[lemma:sin-pi2]{\,$\ge$\,} 0.
\end{displaymath}
\end{proof}



\subsection{tangent}
\label{sec:tangent}

\begin{definition}[tangent]\guid{BIRXGXP}\rz{0}\label{def:tan}
\formaldef{$\tan$}{tan}
Let $\tan(x) = \sin(x)/\cos(x)$, defined when $\cos(x)\ne0$.
\indy{Index}{tangent}%
\indy{Notation}{tan@$tan$}%
\end{definition}


\begin{lemma}[]\guid{KWYPRWZ}\rz{0}
\label{lemma:tan-add}\formal{TAN\_ADD}
If $\cos(x)\ne 0$, $\cos(y)\ne 0$, and $\cos(x+y)\ne0$ then
\begin{displaymath}\tan(x+y) = \frac{\tan(x) + \tan(y) }{ 1 -
    \tan(x)\tan(y)}\end{displaymath}
\end{lemma}
\indy{Index}{trigonometric identities!tangent}%

\begin{proved}
  Divide the first line of Lemma~\ref{lemma:sin-add} by the second
  line of the same lemma.  Then use the \hyperref[def:tan]{definition}
  of $\tan$.  \swallowed\end{proved}

\begin{lemma}[]\guid{KSQDZSF}\rz{0}\label{lemma:tan-pi4}\formal{TAN\_PI4}
\begin{displaymath}\tan(\pi/4) = 1.\end{displaymath}
\end{lemma}

\begin{proved}  
\begin{displaymath}
\tan(\pi/4) \hyperref[def:tan]{\,=\,} \sin(\pi/2-\pi/4)/\cos(\pi/4) 
  \hyperref[lemma:cos-sin]{\,=\,}
  \cos(\pi/4)/\cos(\pi/4) \hyperref[eqn:cospi2]{\,=\,} 1.
\end{displaymath}
\swallowed\end{proved}

\begin{lemma}[]\guid{UTNKIAC}\rz{0}\label{lemma:tan-monotone}
The function $\tan$ is strictly increasing and one-to-one on the domain
$\leftopen-\pi/2,\pi/2\rightopen$.
\end{lemma}

\begin{proof} By a derivative test, the function $\tan$ is strictly
  increasing on $\leftopen-\pi/2,\pi/2\rightopen$.  By
  \hyperref[back:analysis]{real arithmetic}, a strictly increasing
  function is one-to-one.
\end{proof}

\subsection{arctangent}

This section reviews the properties of the arctangent function.  

\begin{definition}[arctangent]\guid{RIQVMHH}\rz{0}\label{def:arctan}
\formaldef{$\arctan$}{atn}
\formal{atn,\ ATN,\ ATN\_TAN,\ ATN\_BOUNDS,\ TAN\_ATN}
  By the inverse function theorem of \hyperref[back:analysis]{real
    analysis} and \hyperref[lemma:tan-monotone]{properties} of $\tan$,
  there is a unique function $\arctan:\ring{R}\to\ring{R}$ with image
  $(-\pi/2,\pi/2)$ such that
\begin{equation}\label{eqn:tanarctan}\tan(\arctan x) =x.\end{equation}
\mar{\guid{EWITKLU} Eq.~\ref{eqn:tanarctan}}
\indy{Index}{arctangent}%
\end{definition}

Additional properties of the arctangent function are exercises in
\hyperref[back:analysis]{real analysis}.  If $-\pi/2 < x < \pi/2$,
then also $\arctan(\tan(x)) = x$. In particular,%
%\footformal{ATN\_1}
\begin{equation}\label{eqn:arctan-1}\
\arctan(1) \hyperref[lemma:tan-pi4]{\,=\,} \arctan(\tan(\pi/4)) = \pi/4.
\end{equation}
\mar{\guid{YTXXLRB} Eq.~\ref{eqn:arctan-1}}


The function $\arctan$ is differentiable with derivative%
%\footformal{\ ATN\_MONO\_LT,\ ATN\_MONO\_LT\_EQ}
\begin{equation}\label{eqn:deriv-tan}\frac{d\phantom{~}} {dx} \arctan(x) = \frac{1}{1 +
    x^2}.\end{equation}
\mar{\guid{OKENMAM} Eq.~\ref{eqn:deriv-tan}}
The derivative is everywhere positive, and the function $\arctan$ is
strictly increasing \mar{\guid{LQCXGZX} increasing}.
\indy{Index}{arctangent!derivative}%
The proofs in this book often need to use $\arctan(y/x)$ as  $x$ approaches $0$.
For this, the following variant of $\arctan$ is preferable, because it clears the denominator.


\begin{definition}[$\atn$]\guid{GYKGARD}\rz{0}\label{def:atn}
\formaldef{$\atn$}{atn}
\begin{displaymath}
\atn: \ring{R}^2 \to \leftopen-\pi,\pi\rightclosed.
\end{displaymath}
\begin{displaymath}
\atn(x,y) = \begin{cases}
\arctan(y/x) & x > 0\\
\pi/2- \arctan(x/y) & y > 0 \\
\pi + \arctan(y/x) & x< 0,\  y\ge 0\\
-\pi/2- \arctan(x/y) & y< 0 \\
\pi & x= y=0.\\
\end{cases}
\end{displaymath}
\end{definition}
\indy{Notation}{arctan2@$\atn$}%
\indy{Notation}{arctan@$\arctan$}%


There is some overlap between cases. Nevertheless, trig identities
similar to those already established show that this function is
well-defined.  For example, to check the equality of the first two
cases, we compute the tangent of both sides, which is sufficient,
since both sides lie between $\leftopen-\pi/2,\pi/2\rightopen$ and
$\tan$ is \hyperref[lemma:tan-monotone]{one-to-one}:
\begin{displaymath}
  \tan(\arctan(y/x)) \hyperref[def:arctan]{\,=\,} y/x \hyperref[def:arctan]{\,=\,} 
  1/\tan(\arctan(x/y)) \hyperref[lemma:cos-sin]{\,=\,} \tan(\pi/2 - \arctan(x/y)).
\end{displaymath}
The function $\atn$ gives the angular argument of $(x,y)$ with the
branch cut along the negative axis.  That is, $x = r\cos\phi$,
$y=r\sin\phi$, for some $r$, where $\phi=\atn(x,y)$.

The {\tt ANSI C} programming language implements this function as {\it
  arctan2}.  Note that some programming languages implement this
function with the two arguments in reverse: $(y,x)$.
\indy{Index}{arctangent!near 0}%
\indy{Notation}{r@$r$ (coordinate)}%
\indy{Notation}{xy@$(x,y)$ (Cartesian point)}%
\indy{Notation}{ZZphi@$\phi$ (coordinate)}%


\subsection{inverse trig}
\indy{Index}{function!inverse trigonometric}%
Other inverse trigonometric functions will generally be reduced to the
arctangent.  This section defines the $\arccos$ function and show how
it can be expressed in terms of $\atn$.

\begin{definition}[arccos]\guid{QZTBJMH}\rz{0}
\formaldef{$\arccos y$}{acs}
\label{def:arccos}\formal{acs,\ ACS\_COS,\ COS\_ACS}
  By the inverse function theorem of \hyperref[back:analysis]{real
    analysis}, there exists a unique function $\arccos y$ on the
  interval $[-1,1]$ which takes values in $[0,\pi]$ and which is the
  inverse function of $\cos$:
\begin{displaymath}\begin{array}{lll}
y\in [-1,1] &\Rightarrow \cos(\arccos y) = y\\
x\in[0,\pi] &\Rightarrow \arccos(\cos x) = x
\end{array}\end{displaymath}
\indy{Index}{arccosine}%
\indy{Notation}{arccos}%
\end{definition}

\begin{lemma}[]\guid{FMGMALU}\rz{0}\label{lemma:sin-arccos}
\formal{sin\_acs\_t} 
  If $y\in[-1,1]$, then
\begin{displaymath}\sin(\arccos(y)) = \sqrt{1-y^2}.\end{displaymath}
\end{lemma}

\begin{proved}
  The \hyperref[def:arccos]{range} of $\arccos(y)$ is $[0,\pi]$.  On
  this interval, $\sin$ is non-\hyperref[lemma:sin-pos]{negative}.  By
  \hyperref[back:analysis]{real analysis}, it is enough to check that
  the squares of the two non-negative numbers are equal.  It then an
  arithmetic consequence of the circle identity
  (Lemma~\ref{lemma:circle}) and Definition~\ref{def:arccos}.
  \swallowed\end{proved}


Our preference is to remove the $\arccos$ function whenever
possible, by replacing it with the $\atn$ function through the
following identity.  


\begin{lemma}[]\guid{OUIJTWY}\rz{0}\label{lemma:arccos-arctan}
\formal{acs\_atn2\_t}  
  If $y\in [-1,1]$, then
  \begin{displaymath}\arccos(y) = \pi/2 - \atn({
      \sqrt{1-y^2}},{y}).\end{displaymath}
\end{lemma}
\indy{Index}{trigonometric identities!arccos}%
\indy{Index}{trigonometric identities!arctan}%
\indy{Notation}{arccos}%
\indy{Notation}{arctan@$\arctan$}%

\begin{proved}
  The endpoints $y=\pm1$ can be checked directly from definitions.  If
  $y\in (-1,1)$, $x = \arccos(y)$, and \begin{displaymath}z =
    \arctan(y/\sqrt{1-y^2}) \hyperref[def:atn]{\,=\,}
    \atn({\sqrt{1-y^2}},{y}),\end{displaymath} then arithmetic gives
  $-\pi/2 < \pi/2 - x < \pi/2$, and \hyperref[def:arctan]{$-\pi/2 < z
    < \pi/2$}.  By the \hyperref[lemma:tan-monotone]{injectivity} of
  the function $\tan$, it is therefore enough to check that
  $\tan(\pi/2 - x) = \tan(z)$.  But
\begin{displaymath}
\hyperref[def:tan]{$\tan$}(\pi/2-x)
\hyperref[lemma:cos-sin]{\,=\,} 
\frac{\cos(x)}{\sin(x)} 
\hyperref[def:arccos]{\,=\,}
\frac{y}{        \sin(\arccos(y))} 
\hyperref[lemma:sin-arccos]{\,=\,} \frac{y}{ \sqrt{1-y^2}} 
\hyperref[def:arctan]{\,=\,} \tan(z).\end{displaymath}
\swallowed\end{proved}



\section{Vector Geometry}

This section reviews vector geometry in $\ring{R}^N$, including
products (scalar and dot), inequalities (triangle and Cauchy-Schwarz),
and hulls (convex and affine).

\subsection{Euclidean space}

\begin{definition}[$\ring{R}^N$,~vector]\guid{KRZJIAD}\rz{0}
\formaldef{$\ring{R}^N$}{REAL\_RING}
  For any finite set $N$, define $\ring{R}^N$ as the set of functions
  $\v:N\to\ring{R}$. Write $v_i$ for the value of the function $\v$ at
  $i\in N$.  \indy{Index}{real numbers}%
  \indy{Notation}{reals@$\ring{R}^N$}%
  A function in $\ring{R}^N$ is called a \newterm{vector}.  The zero
  vector $\orz$ is the function that is identically zero.
  \indy{Index}{vector}%
\end{definition}
\indy{Index}{vector!zero}%
Vectors are written in a bold face: $\u$, $\v$, $\w$, $\p$, $\q$, and
so forth.  As a general notational practice, there will be a general
tendancy to use $\u$, $\v$, and $\w$ to denote vectors in a some
previously determined subset $V\subset \ring{R}^N$, and to use $\p$
and $\q$ to denote vectors that run without restriction over all of
$\ring{R}^N$.

No distinction is made between vectors and points in $\ring{R}^N$, and
none is made between $\ring{R}^N$ and Euclidean space.  Write
$\ring{R}^n$ as an alias of $\ring{R}^N$, when $n\in\ring{N}$ and
$N=\{0,\ldots,n-1\}$.  \indy{Index}{Euclidean space}

\begin{definition}[vector addition,~scalar multiplication]\guid{WHIAXXC}\rz{0}
\formaldef{vector addition}{(+)}
\formaldef{scalar multiplication}{(\%)}
  Two standard arithmetic operations, addition and scalar
  multiplication, are defined on the set $\ring{R}^N$.  These
  operations are the pointwise addition and scalar multiplication of
  functions:
\begin{equation}
\begin{array}{rll}
(\u + \v)_i &= u_i + v_i.\\
(t \u)_i &= t u_i,\quad t\in\ring{R}.\\  %XX should it be \u \v?
\end{array}
\end{equation}
\indy{Index}{function!addition}%
\indy{Index}{function!multiplication}%
Define the difference of two vectors to be $\u - \v = \u + (-1) \v$.
\indy{Index}{vector space} %
\indy{Index}{vector!difference}%
\end{definition}
The operations on $\ring{R}^N$ 
satisfy the axioms of a vector space~\cite{unknown}. %XX.
In particular, addition is commutative and associative.


\begin{definition}[dot product]\guid{VFPCZBI}\rz{0}
\label{def:dot}
\formaldef{dot product}{dot}
There is a \newterm{dot product}
\begin{displaymath}
(\cdot):\ring{R}^N\to\ring{R}^N\to\ring{R}
\end{displaymath}
defined by
\begin{displaymath}
\u\cdot \v = \sum_{i\in N} u_i v_i.
\end{displaymath}
\indy{Index}{vector!dot product}%
\indy{Notation}{1@$\cdot $ (dot product)}%
\end{definition}


The dot product satisfies the following
properties:
\begin{equation}\label{eqn:dot}
\begin{array}{rll}
\u \cdot (\v + \w) &= \u \cdot \v + \u \cdot \w\\
(\u + \v)\cdot \w &= \u \cdot \w + \v \cdot \w\\
(t \u)\cdot \w &= t(\u \cdot \w) = \u \cdot (t \w)\\
0 &\le \u\cdot \u\\
\end{array}
\end{equation}

\begin{definition}[norm]\guid{XHVXJVB}\rz{0}
\label{def:norm}
\formaldef{norm}{NORM\_POW\_2}
The \newterm{norm} of a vector $\u\in\ring{R}^N$ is
\begin{displaymath}\normo{\u} = \sqrt{\u\cdot \u}.\end{displaymath}
\indy{Index}{vector!norm}%
\end{definition}
%\indy{Notation}{norm@\hbox{$\normo{\u}$} (vector norm)}%

By  real arithmetic,
$\normo{\u}=0$  if and only if $\u=0$.  Moreover,
$\normo{ t \u } = |t| \, \normo{\u}$.   

% The distance function $d(\u,\v) = \norm{ \u }{ \v}$ makes
% $\ring{R}^N$ into a metric space.  \indy{Index}{metric space}%
% \indy{Index}{function!distance}%
% \indy{Notation}{d@$d$ (metric)}%
% The proof that $d$ is indeed a metric depends on the Cauchy-Schwarz
% inequality:


\begin{lemma}[Cauchy-Schwarz~inequality]\guid{JJKJALK}
\formal{Jordan/metric\_spaces.ml:cauchy\_schwartz}
  \begin{displaymath}|\u \cdot \v| \le
    \normo{\u}\,\normo{\v}.\end{displaymath} Furthermore, the case
  $\pm \u\cdot \v = \normo{\u}\,\normo{\v}$ of equality holds exactly
  when $\normo{\v} \u = \pm\normo{\u} \v$ (with matching signs).
\end{lemma}
\indy{Index}{Cauchy-Schwarz inequality}%

\begin{proved}
  This is an exercise in real arithmetic.  Let $\w = \normo{\v} \u \pm
  \normo{\u} \v$.  The expansion of $\w\cdot \w$ gives
  \begin{displaymath}0\le \w\cdot \w = 2\normo{\u}^2\normo{\v}^2 \pm
    2\normo{\u}\, \normo{\v} (\u\cdot \v) = 2\normo{\u}\, \normo{\v}
    (\normo{\u}\, \normo{\v} \pm (\u \cdot \v)).\end{displaymath} If
  $2\normo{\u} \,\normo{\v} = 0$, then $\u$ or $\v$ is zero, and the
  result easily follows.  Otherwise divide both sides of the
  inequality by the positive quantity $2 \normo{\u} \,\normo{\v}$ to
  get the result.  \swallowed\end{proved}

\begin{lemma}[triangle~inequality]\guid{OIPLPTM}\rz{0}
\formal{Jordan/metric\_spaces.ml:norm\_triangle}
\label{lemma:triangle-ineq}
\begin{displaymath}
\normo{\u + \v} \le \normo{\u} + \normo{\v }.
\end{displaymath}
Equality holds exactly when $\normo{\v}\u = \normo{\u}\v$.
\end{lemma}
\indy{Index}{triangle inequality}%

\begin{proved}  This is an exercise in real arithmetic.
Both sides are nonnegative; it is enough to compare the squares of
both sides.  By the Cauchy-Schwarz inequality,
\begin{displaymath}\normo{\u + \v}^2 = \u\cdot \u + 2 \u\cdot \v + \v\cdot \v \le
  \u\cdot \u + 2 \normo{ \u}\,\normo{\v} + \v\cdot \v = (\normo{\u}+\normo{\v})^2.
\end{displaymath}
The case of equality follows from the case of equality in the
Cauchy-Schwarz inequality.
\swallowed\end{proved}



\subsection{affine geometry}




\begin{summary}Most of the following definitions apply to
  $n$-dimensional Euclidean space; however, this book uses them only
  in two and three dimensions.  The first definition gives the affine
  span of a finite set.  For example, the affine span of two distinct
  points is a line; the affine span of three independent points is a
  plane.  By placing additional positivity constraints on the linear
  combinations, the definitions extend to a large assortment of other
  geometric objects such as rays, half-planes, convex hulls, and
  cones.  Each of these comes in two versions: an open version defined
  by strict inequality and a closed version defined by weak
  inequality.  For example, the closed half-plane includes a bounding
  line and the open half-plane does not.  In this chapter, `open' and
  `closed' are not topological notions; rather, they indicate the
  semialgebraic conditions of strict and weak inequality.
\end{summary}

%% No notation is introduced for a general affine hull!
\begin{definition}[affine hull]\guid{KVLZSAQ}\rz{0}
A set $A\subset\ring{R}^N$ is \newterm{affine}, if for
every finite nonempty subset $S\subset A$ and every function $t:S\to\ring{R}$ such that $\sum _{\v\in S} t(\v)=1$, we have
% $\v,\w\in A$ and every $t \in \ring{R}$, 
\begin{displaymath}
 \sum_{\v\in S} t(\v) \v \in A.  % t \v + (1-t) \w \in A.
\end{displaymath}
The \newterm{affine hull}, $\op{aff}(S)$, of a set $S\subset\ring{R}^N$ is the smallest affine set
containing $S$. 
That is, the affine hull of $S$ is the intersection of all affine
sets containing $S$. 
\end{definition}


\begin{definition}[affine]\guid{BYFLKYM}\rz{0}\label{def:aff} 
  If $V = \{\v_1,\v_2,\ldots,\v_k\}$ and $V'=\{\v_{k+1},\ldots,\v_n\}$
  are finite subsets of $\ring{R}^N$, then set
	\begin{eqnarray*}%\begin{array}{lll}
\op{aff}_{\pm} (V,V') &= \{t_1 \v_1 +\cdots t_n \v_n \mid
	t_1 +\cdots+t_n = 1, \pm t_j \ge 0, \text{ for } j>k.\}.\\
\op{aff}^0_{\pm} (V,V') &= \{t_1 \v_1 +\cdots t_n \v_n \mid
	t_1 +\cdots+t_n = 1, \pm t_j > 0, \text{ for } j>k.\}.
%\op{aff}\, V &= \op{aff}_\pm(V,\emptyset).\\
		\end{eqnarray*}
To lighten the notation for singleton sets, abbreviate
$\op{aff}_\pm(\{\v\},V')$ to $\op{aff}_\pm(\v,V')$.
\indy{Notation}{aff@$\op{aff}$}%
\indy{Notation}{aff2@$\op{aff}_{\pm}$}%
\indy{Notation}{aff3@$\op{aff}^0_{\pm}$}%
\indy{Index}{affine}%
\indy{Notation}{V@$V$ (set)}%
\end{definition}



\begin{definition}[convex hull]\guid{OWECYNV}\rz{0} 
A subset $C\subset\ring{R}^N$ is \newterm{convex}, if for
every $\v,\w\in C$ and every $t \in \leftclosed0,1\rightclosed]$,
\begin{displaymath}
t \v + (1-t) \w \in C.
\end{displaymath}
If $S\subset\ring{R}^N$, then let $\op{conv}(S)$ be the smallest convex set
containing $S$.  That is, $\op{conv}(S)$ is the intersection of all convex
sets containing $S$.  It is called the \newterm{convex hull} of $S$.
\end{definition}

When the set is finite, the convex hull takes the following form.

\begin{lemma}[]\guid{GDCZMLO}\rz{0}
If $V = \{\v_1,\v_2,\ldots,\v_n\}\subset\ring{R}^N$, then
	\begin{displaymath}
\op{conv}\, V = \op{aff}_+\, (\emptyset,V)
\end{displaymath}
\indy{Notation}{conv}%
\indy{Index}{convex hull}%
\end{lemma}

\begin{lemma}[]\guid{UIVNNRR}\rz{0}
If $V\subset\ring{R}^N$ is finite, then
$\op{aff}_\pm (V,\emptyset) = \op{aff}^0_\pm(V,\emptyset)$
is the affine hull of $V$.
\end{lemma}

\begin{proof}  Both proofs are left as  exercises for the reader.
\end{proof}

In the following definition of a cone, the point $\v$ serves as apex,
and $V$ is a generating set for the positive directions.  In the
special case that $V$ is a singleton $\{\w\}$, the cone gives a ray
originating at $\v$ and passing through $\w$.  Later chapters call
sets of the form $\op{cone}(\v,\{\u_1,\u_2\})$ \newterm{blades}.
Blades are planar sets bounded by two rays originating at $\v$.
\indy{Notation}{v@$\v$ (apex)}%
\indy{Notation}{V@$V$ (generating set)}%
\indy{Index}{blade}%

\begin{definition}[cone]\guid{LLOUBAX}\rz{0}
Let $V$ be a finite subset of
$\ring{R}^N$ and let $\v\in\ring{R}^N$. Set
\begin{displaymath}
\op{cone}(\v,V) = \op{aff}_+(\{\v\},V)
%\op{cone}^0(\v,V) &= \op{aff}^0_+(\{\v\},V)\\
\end{displaymath}
\indy{Index}{cone}%
\indy{Notation}{cone@$\op{cone}$}%
\end{definition}

% The Voronoi cell is one of the fundamental geometric objects in this
% book.  Earlier chapters have already discussed it at great length.
% Some authors use a weak inequality in the definition, others strict.
% The definition takes strict inequalities.


%\begin{definition}[Voronoi cell $\Omega$]\guid{VOWVHBW}\rz{0}
%Let $V$ be a finite set of points in 
%$\ring{R}^3$.  Let $\v\in\ring{R}^3$. Set
% \begin{displaymath}
%\Omega(\v,V) = 
%\{x \mid \norm{\v}{x} \le \norm{\w}{x}, \forall \w\in V\setminus\{\v\}\}
%\end{displaymath}
%\end{definition}

%% Changed to weak inequality May 14, 2009. -tchales.
	
\begin{definition}[line,~collinear,~parallel]\guid{SWKFLBJ}\rz{0}
  Any set of the form $\op{aff}\{\v,\w\}$ is a \newterm{line} when
  $\v\ne \w$.  A set is that is contained in some $\aff\{\v,\w\}$ is
  \newterm{collinear}.  If $\{\orz,\v,\w\}$ is collinear, then
  $\v$ and $\w$ are said to be \newterm{parallel}. Also, $\{\v,\w\}$
  is said to be a parallel set.
\end{definition}
\indy{Index}{line}%
\indy{Index}{collinear}%

\begin{definition}[plane, half plane, coplanar]\guid{JLWZFBH}\rz{0}\label{def:plane}	
  An affine hull $A=\op{aff}\{\u,\v,\w\}$ is a \newterm{plane} when
  $\{\u,\v,\w\}$ is not collinear.  A set $\op{aff}(\{\u,\v\},\{\w\})$
  is a \newterm{half-plane} when $\{\u,\v,\w\}$ is not collinear. A
  set that is contained in some $\aff\{\u,\v,\w\}$ is \newterm{coplanar}.
\end{definition}
\indy{Index}{plane}%
\indy{Index}{half-plane}%
\indy{Notation}{A@$A$ (plane)}%
\indy{Index}{coplanar}%


\begin{definition}[half space]\guid{OAUVFPS}\rz{0} 
A set
  $\op{aff}_{\pm}(\{\u,\v,\w\},\{\v'\})$ is a \newterm{half-space},
  when $\{\u,\v,\w,\v'\}$ is not coplanar.  Under the substitution of
  $\op{aff}_{\pm}$ for $\op{aff}_{\pm}^0$, it is called an
  \newterm{open half-space}.
\end{definition}
\indy{Index}{half-space}%
\indy{Index}{half-space!open}%

\subsection{parallelepiped}\label{sec:piped}
\indy{Index}{parallelepiped}%



The following polynomial, $\Delta$, appears in many different
functions related to the geometry of three dimensions.  The formula
following the definition shows that it is closely related to the
square of the volume of a parallelepiped.  The interpretation as
volume is not relevant until the next chapter.  Its non-negativity is
immediately relevant.  \indy{Index}{parallelepiped!volume}%

%% WW repeated DEF.
\begin{definition}[$\Delta$]\guid{AVWKGNB}\rz{0}\label{def:delta}
\formal{definitions\_kepler.ml:delta\_x}
  Let
\begin{displaymath}
\begin{array}{lll}
\Delta(x_1,\ldots,x_6) &= x_1 x_4 (- x_1+x_2+x_3- x_4+x_5+x_6)\\
&\qquad+x_2 x_5 (x_1- x_2+x_3+x_4- x_5+x_6)\\
&\qquad+x_3 x_6 (x_1+x_2- x_3+x_4+x_5- x_6)\\
&\qquad- x_2 x_3 x_4- x_1 x_3 x_5- x_1 x_2 x_6- x_4 x_5 x_6.
\end{array}
\end{displaymath}
\end{definition}
\indy{Notation}{ZZdelta@$\Delta$}%
\indy{Index}{determinant!Cayley-Menger}%

\begin{remark}[Cayley-Menger determinant]\guid{DQGHCSH}\label{rem:cayley}\rz{0}
  The polynomial $\Delta$ first appears in the following context.
  Cayley and Menger found a formula for the square of the determinant
  $D$ of the matrix with rows $\v_1-\v_0$, $\ldots,$ $\v_n-\v_0$, for
  arbitrary vectors $\v_i\in\ring{R}^n$.  Set
\begin{equation}\label{eqn:xij}
x_{ij} = \norm{\v_i}{\v_j}^2,
\end{equation}
arranged as entries of a matrix $[x_{ij}]$.
Write $\underbar 1$ for a row vector of length $n$ 
whose entries all equal $1\in\ring{R}$.
They found that elementary matrix manipulations give an identity
of determinants:
\begin{displaymath}
D^2 = \frac{(-1)^{n-1}}{2^n}
\left|\begin{matrix}[x_{ij}]& {}^t{\underbar 1}\\ {\underbar 1}& 0
\end{matrix}\right|.
\end{displaymath}
The right-hand side is a polynomial in the squares of the edge lengths.
% The special case $n=2$ gives the polynomial $\ups$
% (Definition~\ref{def:ups}).

A calculation of the determinant on the right when $n=3$ yields 
the polynomial $\Delta$:
\begin{displaymath}
4 D^2 = \Delta(x_{12},x_{13},x_{14},x_{34},x_{24},x_{23}).
\end{displaymath}
The left-hand side is evidently a square and the polynomial on the
right is non-negative, whenever the variables $x_{ij}$
satisfy~\eqn{eqn:xij} for some vectors
$\v_1,\ldots,\v_4\in\ring{R}^3$.  Moreover, $D$ and hence also
$\Delta$ is positive when the set of four vectors is not
\hyperref[def:plane]{coplanar}.
\end{remark}
\indy{Index}{edge!length}%
\indy{Notation}{ZZups@$\ups$}%
\indy{Notation}{ZZdelta@$\delta$}%
\indy{Notation}{xij@$x_{ij}$}%
%Write $\Delta_j$ for the $j$th partial derivative of $\Delta$. 
%Let $D = \det(\v_2-\v_1,\v_3-\v_1,\v_4-\v_1)$.
\indy{Index}{determinant}%

\begin{background}[matrix theory]\label{back:matrix}
  Very little matrix theory is required in this book.  The next lemma
  is a rare exception.  Its proof requires various very basic facts
  about $3$ by $3$ matrices and determinants.  The determinant of a
  product of two matrices is the product of determinants.  The
  transpose of a matrix $A$ has the same determinant as $A$.  The
  determinant of a matrix $A$ is zero if and only if there exists a
  (row) vector $\u$ such that $\u\, A = \orz$.
\end{background}

\begin{lemma}[]\guid{CTCZHMR}\rz{0}\label{lemma:delta-pos}
  Let $V=\{\v_0,\v_1,\v_2,\v_3\}\subset\ring{R}^3$.  Let $x_{ij} =
  \norm{\v_i}{\v_j}^2$.  Then $\Delta(x_{ij})\ge 0$.  Moreover, the
  set $V$ is coplanar if and only if $\Delta(x_{ij}) = 0$.%
\mar{\guid{LBEVAKV} $\ge$ LEG}  % delta >=0, 
\mar{\guid{POLFLZY} $=$ LEG} % coplanar <=> delta=0.
\mar{more on $\Delta$ in LEG}
\end{lemma}

\begin{proof} The proof is an exercise in
  \hyperref[back:matrix]{matrix} theory and
  \hyperref[back:analysis]{real arithmetic}.  (The statement also
  falls within the scope of \hyperref[back:tarski]{Tarski}
  arithmetic.)  This lemma can be proved directly as follows, without
  recourse to the general Cayley-Menger theorem.

  Let $A$ be the $3$ by $3$ matrix whose rows are $\v_i - \v_0$.  Then
  $D^2 = \det(A)^2 = \det(A \,\hbox{}^t A)$.  Each entry of the
  product $A\,\hbox{}^tA$ is a dot product $(\v_i-\v_0)\cdot
  (\v_j-\v_0)$, which can be expressed in terms of the constants
  $x_{ij}$ by the following dot product law:
\begin{equation}\label{eqn:dot-law}
\begin{array}{lll}
  2 (\v_i-\v_0)\cdot (\v_j-\v_0) 
&= (\v_i-\v_0)\cdot(\v_i-\v_0) + (\v_j-\v_0)\cdot (\v_j-\v_0) \\
  &\qquad - (\v_i-\v_j)\cdot (\v_i-\v_j),
\end{array}
\end{equation}
\hyperref[def:norm]{which is} $x_{i0} + x_{j0} - x_{ij}$.
A computation of the determinant then gives $4D^2=\Delta$.
Thus, $D^2\ge0$ implies $\Delta\ge 0$.

Also $\Delta=0$ if and only if $D=0$, which holds if and only if $\u\,
A = \orz$ for some vector $\u$.  By the
\hyperref[def:plane]{definition} of coplanar, this holds if and only
if $V$ is coplanar.
\end{proof}

\begin{remark}[]\guid{KZVHHBG}\rz{0}
  The volume of a $4$-simplex in $\ring{R}^3$ is zero.  This implies
  that Cayley-Menger determinant for $\v_0,\ldots,\v_4\in\ring{R}^3$
  is zero.%
  \mar{\guid{NUHSVLM} LEG}%
  \mar{\guid{RPFVZDI} LEG}%
  \mar{\guid{GJWYYPS} LEG}%
  \mar{\guid{GDLRUZB} LEG}% 
  \mar{\guid{LTCTBAN} LEG}%
  This gives a polynomial relation between the $10 = \tbinom{5}{2}$
  squared edge lengths $x_{ij}$.  The relation $a x^2 + b x + c=0$ is
  quadratic in the tenth edge, say $x=x_{04}$, in terms of the other
  nine. The leading coefficient $a$ is nonzero if $\{\v_1,\v_2,\v_3\}$
  is not collinear.%
  \textnote{The properties of the Cayley-Menger determinant for five
    points in $\ring{R}^3$ are developed further in
    \cite[tag~cm5-E]{LEG}.  }
\end{remark}

\section{Angle}\label{sec:angle}

Until now, the discussion of trigonometric functions has been purely
analytic.  This section interprets them geometrically.  It covers
fundamental identities in both Euclidean and spherical trigonometry,
including the law of cosines, the law of sines, the spherical law of
cosines, and a beautiful formula due to Euler for the area of a
spherical triangle.

If $\u,\v$ are given vectors with $\u$ and $\v$ nonzero, then by the
Cauchy-Schwarz inequality,
\begin{displaymath}-1 \le \frac{\u\cdot \v}{\normo{\u}\,\normo{\v}}
  \le 1.\end{displaymath} The expression in the middle lies in the
domain of the function $\arccos$. This permits the following
definition.  \indy{Index}{Cauchy-Schwarz inequality}%
\indy{Notation}{uvector@$\u$ (vector)}%
\indy{Notation}{v@$\v$ (vector)}%

\begin{definition}[angle,\ arclength]\guid{WZYUXVC}\rz{0}\label{def:angle}
Let $\u,\v,\w$ be vectors with $\u\ne \v,\w$.
Define 
\begin{displaymath}
  \arc_V(\u,\{\v,\w\}) = \arccos\left(\frac{(\v-\u)\cdot 
(\w-\u)}{\norm{\v}{\u}\,\norm{\w}{\u}}\right).
\end{displaymath}
The value of this function is the \newterm{angle} at $\u$ formed by
$\v$ and $\w$.  \indy{Index}{central angle}%
\indy{Index}{arc}%
\indy{Index}{arclength}%
\indy{Notation}{wz@$\w$ (vector)}%
\indy{Notation}{arcv@$\arc_V$}%
\end{definition}

By the relation between $\arccos$ and $\atn$
(Lemma~\ref{lemma:arccos-arctan}), %if $|\u\cdot \v|\ne
                                   %\normo{\u}\,\normo{\v}$,
%then 
\begin{equation}\label{eqn:angle}
  \arc_V(\orz,\{\v,\w\}) = \frac{\pi}2 - \atn\left ({\sqrt{(\normo{\v}^2\normo{\w}^2 -
        (\v\cdot \w)^2)}}, {\v\cdot \w}\right).
\end{equation}
\mar{\guid{ACNBFRL} Eq.~\ref{eqn:angle}}
\indy{Index}{arclength}%

The notation $\arc_V$ for angle comes from its interpretation as the
length of a geodesic arc on a unit sphere
centered at $\u$ from point $\v$ to $\w$.
\indy{Index}{arc!geodesic}%
The subscript $V$ is a reminder that
the function arguments are vectors.  The function
$\arc$, without the subscript,  gives the angle as a function
of the three edge lengths of a triangle.
\indy{Index}{function!vector}%
\indy{Notation}{V@$V$ (subscript)}%
\indy{Notation}{arc@$\arc$}%

% \begin{definition}[arc length]\guid{WHDSIZT}\rz{0} 
%The arclength of a geodesic arc on a
%   unit sphere centered at $\v_0$ from point $\v_1$ to $\v_2$ is the
%   angle formed by $\v_1$ and $\v_2$ at $\v_0$.
%\end{definition}

\begin{definition}[arc]\guid{PQQDENV}\rz{0}\label{def:arc}
Define
\begin{displaymath}\arc(a,b,c) = \arccos(\frac{a^2 + b^2 - c^2}{2 a
    b}).\end{displaymath}
\indy{Index}{arc}%
\end{definition}

If the triangle inequalities hold:
\begin{displaymath}
a + b \ge c,\quad b + c \ge a, \quad c+a \ge b
\end{displaymath}
and $a,b >0$, then
\begin{displaymath}
  2 a b = (\mp a+b+c)(a \mp b \pm c) \pm (a^2 + b^2 - c^2) 
\ge \pm  (a^2 + b^2 - c^2)
\end{displaymath}
and the argument of $\arccos$ in the definition of $\arc$ falls within
its domain.

\begin{lemma}[law of cosines]\guid{HQTBPCM}\rz{0}\label{lemma:loc}
Let $\u,\v,\w$ be vectors with $\u\ne \w$, $\v\ne \w$.  Let $a
= \norm{\v }{ \w}$, $b = \norm{\u }{ \w}$, and $c = \norm{\u }{ \v}$.
Let $\gamma=\arc_V(\w,\{\u,\v\})$.    Then
\begin{displaymath}c^2 = a^2 + b^2 - 2 a b \cos\gamma.\end{displaymath}
Also,
\begin{displaymath}
\arc_V(\w,\{\u,\v\})= \arc(a,b,c).
\end{displaymath}
%if $\u$, $\v$, and $\w$ are not collinear then

\end{lemma}
\indy{Notation}{ZZddgamma@$\gamma$ (angle)}%
\indy{Index}{arc}%
\indy{Index}{law of cosines} %
\indy{Index}{trigonometric identities!law of cosines}%
\indy{Index}{cosine!law of cosines}%

\begin{proved}
By the \hyperref[def:angle]{definition} of $\arc_V$, the
\hyperref[def:arccos]{definition} of $\arccos$, and~\eqref{eqn:dot-law},
\begin{displaymath}
2 a b \cos \gamma = 2 (\v - \w)\cdot (\u - \w) = a^2 + b^2 - c^2.
\end{displaymath}
This identity can be \hyperref[def:arccos]{solved} for $\gamma$, and
this gives the final statement of the lemma.  \swallowed\end{proved}


\begin{definition}[$\ups$]\guid{OBPIOXD}\rz{0}\label{def:ups}
Let $\ups$ (the symbol is a greek upsilon, which is written with a
wider stroke than a roman vee) be the polynomial
\begin{displaymath}\ups(x,y,z) = -x^2 - y^2 - z^2 + 2 x y + 2 y z + 2
  z x.\end{displaymath}
\indy{Notation}{ZZups@$\ups$}%
\end{definition}



%% WW Repeated def (tarski.tex)
This polynomial is non-negative under certain conditions. (The polynomial
$\ups$, like $\Delta$, 
is the square of a Cayley-Menger determinant.)  


\begin{lemma}[]\guid{QRAAWFS}\rz{0}\label{lemma:ups} Let
  $V=\{\v_0,\v_1,\v_2\}\subset\ring{R}^3$.  Let $x_{ij} =
  \norm{\v_i}{\v_j}^2$.  Then $\ups(x_{01},x_{12},x_{02})\ge 0$.
  Moreover, the set $V$ is collinear if and only if $\ups(x_{ij}) =
  0$.%
\mar{\guid{FHFMKIY} $=$ LEG}
\end{lemma}

\begin{proof}
The polynomial factors
\begin{equation}\label{eqn:ups}
\ups(a^2,b^2,c^2) = 16 s (s-a) (s-b)
  (s-c),
\end{equation}
\mar{\guid{IHIQXLM} Eq.~\ref{eqn:ups}}
where $s = (a+b+c)/2$.  If $a,b,c$ are the sides of a triangle, then
$a,b,c>0$ and the triangle inequality (Lemma~\ref{lemma:triangle-ineq})
holds for all orderings of sides: $(b+c-a)\ge 0$, and so forth.
Non-negativity $0\le \ups(a^2,b^2,c^2)$ follows from the triangle
inequality applied to each factor in the factorization of $\ups$:
$2(s-a) = (b+c-a) \ge0$, and so forth.  The case of equality is the
case of equality in the triangle inequality.
\indy{Index}{Cauchy-Schwarz inequality}%
\indy{Index}{triangle inequality}%
\end{proof}


\indy{Index}{Heron's formula}%
Volume and area are the topics of the next chapter.  Nevertheless, it
is appropriate to consider immediately a formula for the area of a
triangle.  Recall that Heron's formula for the area of a triangle with
sides $a,b,c$
is \begin{displaymath}\sqrt{\ups(a^2,b^2,c^2)}/4.\end{displaymath}

\begin{lemma}[law of sines]\guid{UKBAHKV}\rz{0}\label{lemma:los}
Assume that $a,b>0$ and $a+b\ge c$, $b+c\ge a$, and $c+a\ge b$.
Let $\gamma=\arc(a,b,c)$.  Then
\begin{displaymath}2 a b \sin\gamma =
  \sqrt{\ups(a^2,b^2,c^2)}.\end{displaymath}
\end{lemma}
\indy{Index}{trigonometric identities!law of sines}%
\indy{Index}{law of sines}%
\indy{Index}{sine!law of sines}%
\begin{proved}
  Both sides are non-\hyperref[lemma:sin-pos]{negative}, so it is
  enough to check that their squares are equal.  By the definition of
  $\arc$:
\begin{displaymath}
4 a^2 b^2 \sin^2\gamma 
\hyperref[lemma:circle]{\,=\,} 4 a^2 b^2 (1-\cos^2\gamma) 
\hyperref[lemma:loc]{\,=\,} (4 a^2 b^2 - (a^2 + b^2 -
c^2)^2) 
\hyperref[def:ups]{\,=\,} \ups(a^2,b^2,c^2).\end{displaymath}
% checked 4/4/2008
\swallowed\end{proved}

Another useful relation expresses $\arc$ in terms of $\atn$:
\begin{equation}\label{eqn:arc-atn}
\arc(a,b,c) = 
\pi/2 - \atn({\sqrt{\ups(a^2,b^2,c^2)}},{ a^2 + b^2 - c^2}).
\end{equation}
\mar{\guid{GVWTZKY} Eq.~\ref{eqn:arc-atn}}
This follows directly from Lemma~\ref{lemma:arccos-arctan} and the
\hyperref[def:arc]{definitions} of $\arc$ \hyperref[def:ups]{and
  $\ups$}.



\subsection{cross product} 

This book makes infrequent use of the cross product.
A definition and the most basic properties will suffice.

\begin{definition}[cross product]\guid{FCUAGAJ}\rz{0}\label{def:cross}   
Let $\u =(x,y,z)$ and $\u' = (x',y',z')$.  
Let the cross product be defined
by
\begin{displaymath}
\u \times \u' = (y z' - y' z, z x' - x z', x y' - y x').
\end{displaymath}
\indy{Index}{cross product}%
\indy{Index}{vector!cross product}%
\indy{Notation}{1@$\times$ (cross product)}%
\end{definition}

\begin{lemma}[]\guid{KVVWPNA}\rz{0}  
Any two vectors $\u,\v$ satisfy
\begin{displaymath}\normo{\u \times \v} =
  \normo{\u}\,\normo{\v}\sin\gamma,\end{displaymath}
where $\gamma=\arc_V(\orz,\{\u,\v\})$.
Also $\u \cdot (\u\times \v) = \v\cdot (\u\times \v) = \orz$.
\end{lemma}

\begin{proved} This proof is an exercise in
  \hyperref[back:analysis]{real arithmetic} and basic trigonometry.
  Both the \hyperref[eqn:dot]{left} and
  \hyperref[lemma:sin-pos]{right} sides are non-negative, so it is
  enough to compare the squares of both sides.  The square of the
  left-hand side \hyperref[def:cross]{is}
\begin{displaymath}
\begin{array}{lll}
  &(y z'- y'z)^2 + (z x' - x z')^2 + (x y' - y x')^2 \\
  &\qquad\qquad=
  (x^2 + y^2 + z^2)(x'^2 + y'^2 + z'^2) - (x x' + y y' + z z')^2
  \\&\qquad\qquad \hyperref[def:dot]{=\,} 
  \normo{\u}^2\normo{\v}^2 - (\u\cdot \v)^2 \\
  &\qquad\qquad\hyperref[lemma:loc]{=\,} 
  \normo{\u}^2\normo{\v}^2 ( 1 - \cos^2\gamma)\\
  &\qquad\qquad\hyperref[lemma:circle]{=\,} 
\normo{\u}^2\normo{\v}^2 \sin^2\gamma.
\end{array}
\end{displaymath}
The second assertion of the lemma follows by arithmetic directly from
the definitions of the dot and cross products.  \swallowed\end{proved}


\begin{lemma}[]\guid{BKMUSOX}\rz{0}
\begin{displaymath}
\u\times \v = -\v\times \u,\quad
(\u\times \v)\cdot \w = (\v\times \w)\cdot \u.
\end{displaymath}
\end{lemma}

\begin{proved}
These are arithmetic consequences of the definition of cross product.
\swallowed\end{proved}



\subsection{dihedral angle}

A dihedral angle of a tetrahedron are the angles formed between two of
its faces. In general, the dihedral angle refers to the angle formed
by two half-planes delimited by a common line.  The dihedral angle is
determined by two points $\{\w_0,\w_1\}$ on the delimiting line and
two points $\w_2$ and $\w_3$ on the two half-planes.
\indy{Index}{angle!dihedral}%
\indy{Index}{tetrahedron}%
\indy{Index}{function!vector}%
\indy{Notation}{dihv@$\dih_V$}%
\indy{Index}{vector!projection}%
\indy{Index}{orthogonality} %

\begin{definition}[dihedral angle]\guid{YMHELNF}\rz{0}\label{def:dih} When $\w_0\ne \w_1$,
  write $\dih_V(\{\w_0,\w_1\},\{\w_2,\w_3\})$ for the angle
  $\gamma\in[0,\pi]$ formed by
\begin{displaymath}
\bar \v = (\w\cdot \w) \v - (\w\cdot \v) \w\quad\text{and }\quad \bar \u =
(\w\cdot \w) \u - (\w\cdot \u) \w,
\end{displaymath}
where $\w=\w_1-\w_0$, $\v = \w_2-\w_0$,  and $\u=\w_3-\w_0$.  Call it
the dihedral angle formed by $\w_2$ and $\w_3$ along $\{\w_0,\w_1\}$.
\indy{Notation}{dih}%
\indy{Index}{angle!dihedral}%
\end{definition}
The subscript $V$ is a reminder 
that the dihedral angle takes vector arguments.
Later, a second version, without the subscript, will
compute the angle as a function of the lengths of edges of a 
tetrahedron.
\indy{Index}{edge!length}%
\indy{Notation}{V@$V$ (subscript)}%
As the notation suggests, the dihedral angle depends only
on the unordered pairs $\{\w_0,\w_1\}$, $\{\w_2,\w_3\}$.

The dihedral angle is the planar angle between two rays, obtained by
projection of the two half-planes to a plane orthogonal to both of
them.  Up to positive scalars, $\bar \u$ and $\bar \v$ are the
projections of $\u$ and $\v$ to the plane through the origin
orthogonal to the vector $\w$.  The dihedral angle is the angle
between the projections $\bar \u$ and $\bar \v$ at $\orz$.

\begin{remark}\label{rem:dih}\guid{CODE}\rz{0}
  The dihedral angle is unchanged if $\w$ is replaced with $t \w$ with
  $t\ne0$. The dihedral angle is unchanged if $\v$ is replaced with
  $t_\v \v + t_\w \w$ with $0 < t_\v$ and $t_\w$ arbitrary, because
  such points project along the same ray.  It is unchanged if $\u$ is
  replaced with $t_\u \u + t_\w \w$ with $0 < t_\u$ and $t_\w$
  arbitrary, because such points project along the same ray.  In
  particular, the dihedral angle formed by $\v$ and $\u$ along
  $\{\orz,\w\}$ is the same as that formed by $\v/\normo{\v}$ and
  $\u/\normo{\u}$ along $\w/\normo{\w}$.
\end{remark}

The dihedral angle is degenerate and will not be used when $\w =
\orz$, $\bar \v = \orz$, or $\bar \u = \orz$.

\begin{lemma}[spherical law of cosines]\guid{RLXWSTK}\rz{0}\label{lemma:sloc}
\oldrating{100}
   \formalauthor{Nguyen Quang Truong} Let $\gamma$ be the
  dihedral angle formed by $\v$ and $\u$ along $\{\v_0,\w\}$.  Let
  $a$, $b$, and $c$ be the angle at $\v_0$ between $\u$ and $\w$, $\v$
  and $\w$, and $\v$ and $\u$, respectively. %Assume $\w\ne \v_0$.
  Assume that $\{\v_0,\v,\w\}$ and $\{\v_0,\u,\w\}$ are not collinear.
  Then
  \begin{displaymath}\cos\gamma = \frac{\cos c - \cos a \cos b}{\sin
      a\sin b}.\end{displaymath}
\end{lemma}
\indy{Index}{cosine!spherical law of cosines}%
\indy{Index}{spherical law of cosines}%
\indy{Index}{trigonometric identities!spherical}%

The spherical law of cosines is the most fundamental identity of
spherical trigonometry.  Although spherical triangles do not become a
topic until later in the book, it is noteworthy right here that $a$,
$b$, and $c$ are the arclengths of the sides of a spherical triangle
with vertices $\v/\normo{\v}$, $\u/\normo{\u}$, and $\w/\normo{\w}$,
when $\v_0=\orz$.  Also, $\gamma$ measures the angle of the spherical
triangle opposite the side $c$.  \indy{Index}{spherical geometry}%
\indy{Index}{triangle!spherical}%


\begin{proof} By translation, without loss of generality, we may
  assume that $\v_0=\orz$.  The proof is an exercise based on
  previously established trigonometric identities.  An earlier
  \hyperref[rem:dih]{remark} states that the dihedral angle is
  unchanged if $\v$, $\u$, and $\w$ are replaced by $\v/\normo{\v}$,
  $\u/\normo{\u}$, $\w/\normo{\w}$, respectively.  Hence assume
  without loss of generality that
  $\normo{\v}=\normo{\u}=\normo{\w}=1$.

Let $\bar \v$ and $\bar \u$ be the vectors in Definition~\ref{def:dih}.
The law of cosines gives
\begin{displaymath}\cos\gamma = \frac{\bar \v\cdot \bar \u}
{\normo{\bar \v}\,\normo{\bar \u}}.
\end{displaymath}
The unit normalizations of $\u,\v,\w$ give
\begin{displaymath}
\normo{\bar \v}^2 = \bar \v\cdot \bar \v =
(\v - (\w\cdot \v)\w)\cdot (\v - (\w\cdot \v) \w) =
1 - (\w\cdot \v)^2 = \sin^2 b.
\end{displaymath}
So $\normo{\bar \v} =\sin b$. Similarly, $\normo{\bar \u} = \sin a$.
This gives the denominator in the spherical law of cosines.  An
expansion of the dot product gives the numerator:
\begin{displaymath}
\bar \v\cdot \bar \u = (\v - (\w\cdot \v) \w)\cdot (\u - (\w\cdot \u) \w)
= (\v\cdot \u) - (\w\cdot \v) (\w\cdot \u) = \cos c - \cos
a \cos b.
\end{displaymath}
The identity follows.
\end{proof}

The spherical law of cosines gives the angles of a spherical triangle
as a function of its sides.  In spherical geometry, there is a
polarity between angles and sides of a triangle.  This book does not
go into details about this polarity.%
\footnote{In three dimensionsal Eulidean space, the orthogonal
  complement of a plane through the origin is a line through the
  origin.  This gives a duality between planes and lines through the
  origin.  The intersection of each plane and line with a unit sphere
  at the origin yields a duality between great circles and antipodal
  pairs of points (the poles of the great circle).  The three edges of
  a spherical triangle $ABC$ lie on three great circles which
  determine three antipodal pairs of points.  From each of the three
  pairs, a coherent choice can be made of one of the two poles (by
  choosing the pole closer to the opposite vertex of $ABC$).  These
  three poles are the vertices of the polar triangle $A'B'C'$.  Each
  statement about the triangle $ABC$ can be dualized to a statement
  about $A'B'C'$.  In particular, the edges $a,b,c$ and angles
  $\alpha,\beta,\gamma$ of $ABC$ are related to those $a',b',\ldots$
  of $A'B'C'$ by
\begin{displaymath}
a + \alpha' = \pi,\quad a' + \alpha= \pi,
\end{displaymath}
and so forth.
\indy{Notation}{A@$ABC$ (triangle)}}  %
One
consequence of this polarity is a formula for the sides of
a triangle as a function of its angles.  Up to signs,
it has the same form as the law of cosines.
\indy{Index}{great circle}%

\begin{lemma}[spherical law of cosines - second form]\guid{NLVWBBW}\rz{0}\oldrating{80}
\label{lemma:sloc2} \formalauthor{Nguyen Quang Truong} Let
  $\v,\u,\w$ be three points in $\ring{R}^3$.  Let
  $\alpha,\beta,\gamma$ be the dihedral angles:
\begin{displaymath}
\begin{array}{lll}
\alpha &= \dih_V(\{\v_0,\v\},\{\u,\w\})\\
\beta &= \dih_V(\{\v_0,\u\},\{\v,\w\})\\
\gamma&= \dih_V(\{\v_0,\w\},\{\u,\v\})\\
\end{array}
\end{displaymath}
Let $c$ be the
angle between $\v$ and $\u$ at $\v_0$. 
Assume that $\{\v_0,\v,\w\}$, $\{v_0,\v,\u\}$, and $\{\v_0,\u,\w\}$ are not collinear.
Then
\begin{displaymath}
\cos c = \frac{\cos \gamma + \cos \alpha \cos \beta}
{\sin \alpha\sin \beta}.
\end{displaymath}
\end{lemma}
\indy{Index}{cosine!spherical law of cosines}%
\indy{Index}{spherical law of cosines}%

\begin{proof}  
  Here is a direct computational proof that avoids polarity.  It is an
  application of established trigonometric identities.  Let $a$ be the
  angle between $\u$ and $\w$, and let $b$ be the angle between $\v$
  and $\w$ at $\v_0$.  Let $A=\cos a$, $B=\cos b$, $C=\cos c$,
  $A'=\sin a$, $B'=\sin b$, $C'=\sin c$.  The spherical
  \hyperref[lemma:sloc]{law} of cosines gives
\begin{displaymath}\sin^2\beta = 1-\left(\frac{B-A C}{A' C'}\right)^2
  = \frac{p}{A'^2 C'^2},\end{displaymath}
where $p=1-A^2 - B^2 - C^2 + 2 A B C$.
In particular, $p\ge 0$.
\indy{Notation}{p@$p$ (trigonometric expression)}%
A computation of $\sin^2\alpha$ and the remaining terms in the same way gives
\begin{displaymath}
\begin{array}{lll}
  \sin\alpha\sin\beta &= \frac{\displaystyle p}{\displaystyle A' B' C'^2}\\ 
  \\
  \cos\gamma + \cos\alpha \cos\beta &=
  \frac{\displaystyle C - A B}{\displaystyle A' B'} + 
\frac{\displaystyle A - B C}{\displaystyle B' C'} 
\frac{\displaystyle B - A C}{\displaystyle A' C'}
  = \frac{\displaystyle p C}{\displaystyle A' B' C'^2}.\\
% C &= \frac{\cos\gamma + \cos\alpha \cos\beta}{\sin\alpha \sin\beta}\\
\end{array}
\end{displaymath}
The result follows by \hyperref[back:analysis]{real} arithmetic.
\end{proof}

The following lemma gives a formula for the dihedral angle
of a tetrahedron along an edge in terms of its edge lengths.  The
familiar polynomials $\ups$ and $\Delta$ appear once again.
\indy{Notation}{ZZups@$\ups$}%
\indy{Notation}{ZZdelta@$\Delta$}%


\begin{lemma}[]\guid{OJEKOJF}\rz{0}\label{lemma:dihform}\oldrating{80}
\formalauthor{Nguyen Quang Truong}
Let $\v_0,\v_1,\v_2,\v_3$ 
be vectors with $\{\v_0,\v_1,\v_2\}$ not collinear, 
and $\{\v_0,\v_1,\v_3\}$ not
collinear. 
Let $\gamma$ be the dihedral angle formed
by $\v_2$ and $\v_3$ along $\{\v_0,\v_1\}$. Let
\begin{displaymath}(x_1,\ldots,x_6) = 
(x_{01},x_{02},x_{03},x_{23},x_{13},x_{12}),
\text{ where } x_{ij}=\norm{\v_i}{\v_j}^2.\end{displaymath}
Let $\Delta_4$ be the partial derivative of $\Delta(x_1,\ldots,x_6)$ with
respect to $x_4$.
The dihedral angle $\gamma=\dih_V(\{\v_0,\v_1\},\{\v_2,\v_3\}$
is given by
\begin{displaymath}
\gamma=\arccos(\frac{\Delta_4(x_1,\ldots,x_6)}{\sqrt{
\ups(x_1,x_2,x_6)\ups(x_1,x_3,x_5)}}).
\end{displaymath}
%Assuming that $\gamma\ne 0,\pi$, 
It is also given by
\begin{displaymath}
\gamma=\frac{\pi}{2} - \atn
({\sqrt{4 x_1 \Delta(x_1,\ldots,x_6)}},{\Delta_4(x_1,\ldots,x_6)}).
\end{displaymath}
\end{lemma}
%% pi/ 2. -  arctan(  deltax4/ (sqrt (4. * x1 * delta)))
\indy{Index}{angle!dihedral}%


\begin{proof}
  Let $\beta = \arc_V(\v_0,\{\v_1,\v_2\})$.  The assumptions give
  $\bar \v_2\ne \orz$ and $\bar \v_3 \ne \orz$ (where $\bar \v_2$ and
  $\bar \v_3$ are the projections computed as in
  Definition~\ref{def:dih}).  \indy{Notation}{ZZbeta@$\beta$}%
  By expanding definitions and dot products and by the
  \hyperref[lemma:los]{law} of sines,
\begin{displaymath}
  \bar \v_2\cdot \bar \v_2 = (\v_1\cdot \v_1) ((\v_1\cdot \v_1)(\v_2\cdot \v_2) -
  (\v_1\cdot \v_2)^2) =  x_1^2 x_2 \sin^2 \beta = \frac{1}{4}
  x_1
  \ups(x_1,x_2,x_6).
\end{displaymath}
Similarly,
\begin{displaymath}\bar \v_3 \cdot \bar \v_3 = \frac{1}{4} x_1
  \ups(x_1,x_3,x_5)\end{displaymath}
%Let $y_i = \sqrt{x_i}$. 
and by dot product formula \eqref{eqn:dot-law},
\begin{displaymath}\begin{array}{lll}
    \bar \v_2\cdot \bar \v_3 &= (\v_1\cdot \v_1)((\v_1\cdot \v_1)(\v_2\cdot \v_3) -
    (\v_1\cdot \v_2)(\v_1\cdot \v_3) ) \vspace{6pt} \\  &
    = x_1 \left(\frac{\displaystyle x_1 (x_2 + x_3 -
        x_1)}{2} - \frac{\displaystyle (x_1 + x_2 - x_6)(x_1 + x_3 -
        x_5)}{4} \right)\vspace{6pt}\\&
%= \frac{x_1}{4} (2 x_1 (x_2+x_3-x_4) -
%(x_1+x_2-x_6)(x_1+x_3-x_5)) \vspace{6pt}\\&
= {x_1\Delta_4(x_1,\ldots,x_6)}/{4}.
\end{array}
\end{displaymath}
The result follows in terms of $\arccos$.

The translation to $\atn$ uses the $\arccos$-$\atn$
\hyperref[lemma:arccos-arctan]{identity} and the following polynomial
identity
\begin{displaymath}
  % \frac{16}{x_1^2}(\normo{\bar \v_2}^2 \normo{\bar \v_3}^2 - (\bar
  % \v_2\cdot \bar \v_3)^2) =
\ups(x_1,x_2,x_6)\ups(x_1,x_3,x_5) - \Delta_4(x_1,\ldots,x_6)^2
= 4 x_1 \Delta(x_1,\ldots,x_6).
\end{displaymath}
\end{proof}

\subsection{Euler triangle}

The expression $\alpha_1+\alpha_2+\alpha_3-\pi$ is Girard's
formula (known first to T. Harriot) 
for the area of a spherical triangle with angles
$\alpha_1$, $\alpha_2$, $\alpha_3$.  The following lemma
gives a formula for the area, discovered by
Euler and Lagrange.
% \indy{Index}{Girard, A.}%
% Albert Girard's Book on trigonometry was published in 1626. Harriot
% lived 1560 - 1621.
\indy{Index}{Girard's formula}%
\indy{Index}{geometry!spherical}%
\indy{Index}{triangle!spherical}%
\indy{Index}{ZZalphai@$\alpha_i$}%
\indy{Index}{Harriot, T.}%

\begin{lemma}[Euler triangle]\guid{JLPSDHF}\rz{1100}\label{lemma:euler} %was 600
Let $\v_0,\v_1,\v_2,\v_3$ be points in $\ring{R}^3$. 
Let 
\begin{displaymath}(y_1,\ldots,y_6)
  =(y_{01},y_{02},y_{03},y_{23},y_{13},y_{12}), \text{ where }
  y_{ij}=\norm{\v_i}{\v_j}.\end{displaymath} Set $x_i = y_i^2$.  and
\begin{displaymath}
p = y_1 y_2 y_3 + y_1 (\w_2\cdot \w_3) + y_2 (\w_1\cdot \w_3) + y_3
(\w_1\cdot \w_2).
\end{displaymath}
\indy{Notation}{p@$p$ (Euler solid angle numerator)}%
where $\w_i = \v_i- \v_0$.  Let \begin{displaymath}\alpha_i
  =\dih_V(\{\v_0,\v_i\},\{\v_j,\v_k\})\end{displaymath}
where $\{i,j,k\}=\{1,2,3\}$.
Assume that $\Delta(x_1,\ldots,x_6)>0$. 
Then
\begin{displaymath}
\alpha_1+\alpha_2+\alpha_3 - \pi
= {\pi} - 2\,\atn({\Delta(x_1,\ldots,x_6)^{1/2}},{2 p}).
\end{displaymath}
\end{lemma}
\indy{Index}{triangle!Euler}%

\begin{proof}
%% I checked all the details of this proof in 
%% Math'ca on May12,2007
  This proof is an exercise in \hyperref[back:analysis]{real analysis}
  and established trigonometric identities.  By an earlier
  \hyperref[rem:dih]{remark}, the dihedral angles are unchanged if the
  vectors $\w_i$ are rescaled so that $\normo{\w_i}=1$.  By
  inspection, the given formula is also unchanged under rescalings:
  the factor $a$ is homogeneous of degree $3$ under a change $\w_i
  \mapsto t \w_i$ for $t>0$, and so is $\sqrt{\Delta}$ by the formula
  for $\Delta$.  Thus, without loss of generality, $\normo{\w_i}=1$,
  for $i=1,2,3$.  Consequently, $y_1=y_2=y_3=1$.  It is convenient to
  use different notation $a=x_4$, $b=x_5$, $c=x_6$ for the other
  variables. The expansion of the dot products in $p$ by the dot
  product \hyperref[eqn:dot-law]{law} gives
\begin{displaymath}2 p = 8 - (a+b+c).\end{displaymath}
Also, the definitions of $\Delta$ and $\ups$ give
\begin{displaymath}\Delta(x_1,\ldots,x_6) = \Delta(1,1,1,a,b,c) =
\ups(a,b,c) - a b c.\end{displaymath}
Since $\Delta>0$ by assumption, the arctangent formula
in Lemma~\ref{lemma:dihform} 
applies for the dihedral angles $\alpha_i$.  After
this substitution (and clearing a factor of $3$),  %and clearing the
                                                   %$3$ from the
                                                   %denominator,
the desired identity takes the form $f(a,b,c)=0$, where
\begin{displaymath}
f(a,b,c)= -\pi/2 - \sum_{i=1}^3\arctan(u_i/\sqrt{\Delta}) +
2\arctan(2 p/\sqrt{\Delta}),
\end{displaymath}
for some rational functions $u_i$ of $a,b,c$.  The aim is to prove
this trig identity holds whenever $\Delta>0$.

Fix $b,c$ and differentiate $f$ with respect to $a$.  The partial
derivative $\partial f/\partial a$ has the form
$g(a,b,c)/\sqrt{\Delta}$ for some rational function $g$ of $a,b,c$.
The denominator of $g$ has no real zero.  Algebraic simplification of
this rational function shows that the polynomial numerator of
$g(a,b,c)$ is identically $0$.  (Euler himself did not shun brute
force.  See \cite{Euler}.)

By real analysis, the derivative of $f$ is zero, and the function $f$
is constant along any segment in $\ring{R}^3$ along which $\Delta$ is
positive.  The remaining part of the proof constructs two segments
along which $\Delta$ is positive.  The first connects $f(a,b,c)$ to
$f(a,2,2)$ (provided the variables are ordered appropriately).  The
second connects $(a,2,2)$ to $(2,2,2)$.  From this construction it
follows that $f(a,b,c)=f(2,2,2)$.  The last step is to evaluate the
constant $f(2,2,2)$.  Arithmetic gives $\Delta=4$, $2p= 2$,
$u_1=u_2=u_3 =0$, when $a=b=c=2$.  Finally,
\begin{displaymath}f(a,b,c)= f(2,2,2) = -\pi/2 + 2\arctan(1)
  =0.\end{displaymath}


Let us return to the construction of the two segments.  By the
triangle inequality, $a =\norm{\v_2}{\v_3}^2 \le
(\norm{\v_2}{\v_0}+\norm{\v_3}{\v_0})^2 = 4$.  If equality holds, then
$\{\v_0,\v_2,\v_3\}$ is collinear and $\{\v_0,\ldots,\v_4\}$ is
coplanar.  From this it follows that $\Delta=0$, which is contrary to
assumption.  Similarly, $a=0$ implies that $\Delta=0$.  Hence $0<a<4$.
Similarly, $0<b<4$ and $0<c<4$.  By the well-known pidgeon-hole
principle, two of the real numbers $a,b,c$ must lie in the same
subinterval $[0,2]$ or $[2,4]$.  To fix notation, assume that $b$ and
$c$ lie in the same subinterval.

\claim{$\Delta$ is positive on the linear segment from $(a,b,c)$ to
  $(a,2,2)$.}  Indeed, for $0\le t \le 1$, Tarski
\hyperref[back:tarski]{arithmetic} gives
\begin{displaymath}
\begin{array}{lll}
\Delta(1,1,1,a, b(1-t)+2t,c(1-t)+2t) & \\
\qquad\qquad= \Delta(1,1,1,a,b,c) + 
t (2-t) (a (b-2)(c-2) + (b-c)^2)\\
\qquad \qquad \ge \Delta(1,1,1,a,b,c)\\
\qquad \qquad > 0.
\end{array}
\end{displaymath}

\claim{$\Delta$ is positive on the linear segment from $(a,2,2)$ to
  $(2,2,2)$.}  Indeed,
\begin{displaymath}\Delta(1,1,1,a,2,2) = a(4-a)>0.\end{displaymath}  
The rest of the proof has been sketched above.
\end{proof}
\indy{Notation}{ZZdelta@$\Delta$}%






%\subsection{Lexell's theorem}
%
%\begin{lemma}[Lexell]\guid{UWIPRDV}\rz{0}\oldrating{500}
%% was 1000 with old proof including lemma ZHH
% Fix two points $\v_1,\v_2$ on a unit sphere that are not antipodal.
% Let $\u,\u'$ be two other points the sphere in the same open
% hemisphere determined by the great circle through $\v_1,\v_2$.  Then
% the two spherical triangles $\{\v_1,\v_2,\u\}$ and
% $\{\v_1,\v_2,\u'\}$ have the same area if and only if the four
% points $\u$, $\u'$, $\v^*_1$, $\v^*_2$ are concircular, where
% $\v^*_i$ is the point antipodal to $\v_i$.
%\end{lemma}
%\indy{Index}{Lexell's Theorem}%
%\indy{Notation}{1@$\hbox{-}^*$ (antipode)}%
%
%
%
%\begin{proof} By the polarity of triangles mentioned above, it is
%  enough to prove the polar statement.  By Girard's formula, fixing
%  the area fixes the sum of the angles.  The polar triangle has fixed
%  perimeter.  By polarity, Lexell's theorem is a consequence of the
%  following lemma.
%\end{proof}
%\indy{Index}{Girard's formula}%
%
%\begin{lemma}[]\guid{ZHHSGTF}\rz{0} Fix one point $\v$ on the unit
%  sphere, with antipodal point $\v^*$.  Consider two great
%  half-circles $D_i$, $i=1,2$ between $\v$ and $\v^*$ that are not
%  coplanar.  Two great circles $A$ and $B$ cut equi-perimeter
%  triangles with vertex $\v$ along $D_i$ if and only if the great
%  circles $D_i$, $A$, and $B$ are tangent to a common circle $C$.
%\end{lemma}
%\indy{Index}{great circle}%
%
%\begin{proof} The two tangents to a circle through a given point have
%  the same length.  If $C$ exists, then this fact implies that a
%  great circle $A$ that is tangent to $C$ cuts a triangle with vertex
%  $\v$ along $D_i$ whose perimeter is equal to the sum of the
%  distances from $\v$ to the two points of tangency $C\cap D_i$.
%  This is independent of $A$.  \indy{Notation}{A@$A,B$ (great
%    circles)}%
%  \indy{Notation}{D@$D$ (half circle)}%
%  \indy{Notation}{C@$C$ (circle)}%
%
%Conversely, for $A$ any great circle there is a unique $C$ that
% inscribes the great circles $D_i$, and $A$.  The perimeter of the
% triangle is the sum of the distances from $\v$ to the points $C\cap
% D_i$.  If a second $A$ gives a triangle with the same perimeter, its
% circle $C'$ must satisfy $C'\cap D_i = C\cap D_i$.  This forces
% $C=C'$.
%\end{proof}
%

\section{Coordinates}

This section establishes the existence and basic properties of the
standard coordinate systems (polar coordinates, spherical coordinates,
and cylindrical coordinates).  \indy{Index}{azimuth}%
\indy{Index}{angle!azimuth}%
\indy{Index}{azimuth cycle}%

\subsection{azimuth angle}

\label{sec:polar}
\indy{Index}{polar coordinates}%
\indy{Index}{coordinate systems!polar coordinates}%


For every pair of real numbers $x$ and $y$,  there are real numbers
$r$ and $\theta$ such that
\begin{equation}\label{eqn:polar}
x = r\cos\theta,\quad y = r\sin\theta.
\end{equation}
\mar{\guid{FEVNANL} Eq.~\ref{eqn:polar}}
If $x$ and $y$ are both zero, then take $r=0$, and
the~\eqref{eqn:polar} hold for all choices of $\theta$. If $x$ and $y$
are not both zero, then take $0<r$, and $\theta$ is uniquely
determined (up to multiples of $2\pi$).  By convention, $0\le\theta <
2\pi$.  
\indy{Notation}{r@$r$ (coordinate)}%
\indy{Notation}{ZZtheta@$\theta$ (coordinate)}%




%% XX e3 is defined in terms of v1. The indexing confuses.


\begin{definition}[frame,~positive,~adapted]\guid{AXBTGQX}\rz{0}
A tuple $(\e_1,\e_2,\e_3)$ of vectors in $\ring{R}^3$ is a 
\newterm{frame} if $\e_i\cdot \e_j$ and $\normo{e_i}=1$ 
for all $i$ and $j$.
A tuple $(\e_1,\e_2,\e_3)$ is positive if $(\e_1\times \e_2)\cdot\e_3=1$.
% Let $\{\v_0,\v_1,\v_2\}\subset\ring{R}^3$ be a set that is not
% collinear.
A tuple $(\e_1,\e_2,\e_3)$ is \newterm{adapted} to $(\v_0,\v_1,\v_2)$ if
$\e_3 = (\v_1-\v_0)/\norm{\v_0}{\v_1}$ and
$\e_1\in\op{aff}_+^0(\{\v_0,\v_1\},\v_2)$.
% such that $\normo{\e_1}=1$ and $\e_1\cdot\e_3=0$; $\e_2 = \e_3\times
% \e_1$.  The tuple $E=(\e_1,\e_2,\e_3)$ is \newterm{adapted} to
% $(\v_0,\v_1,\v_2)$.
\end{definition}
\indy{Index}{frame}%
\indy{Index}{adapted}%

\begin{lemma}[orthonormalization]\guid{QAUQIEC}\rz{0}
\label{lemma:frame}
  Assume that $\{\v_0,\v_1,\v_2\}\subset\ring{R}^3$ is not collinear.
  Then the unique positive frame adapted to 
  $\{\v_0,\v_1,\v_2\}$ is $(\e_1,\e_2,\e_3)$, where
\begin{displaymath}
\begin{array}{rll}
\e_3 &= \w_1/\normo{\w_1}\\
\bar{\w}_2 &= \w_2 - (\e_3\cdot \w_2) \e_3\\
\e_1 &= \bar{\w_2}/\normo{\bar{\w}_2}\\
\e_2 &= \e_3 \times \e_1 \\
\end{array}
\end{displaymath}
and where $\w_i = \v_i - \v_0$.
\end{lemma}

\begin{proof} It follows by basic vector arithmetic that
  $(\e_1,\e_2,\e_3)$ is a positive frame adapted to
  $\{\v_0,\v_1,\v_2\}$.  The choices vectors $\e_3$ and $\e_1$ are
  dictated by the definition of adapted frame.  The choice of $\e_2$
  is dictated by the definiton of positive frame.
\end{proof}

\begin{lemma}[cylindrical coordinates]\guid{EYFCXPP}\rz{0}\oldrating{80}
\formalauthor{Nguyen Quang Truong}
Let $\v_0$ and $\v_1$ be distinct points in 
$\ring{R}^3$.  Let $(\e_1,\e_2,\e_3)$ be a positive frame 
such that $\e_3 = (\v_1-\v_0)/\norm{\v_1}{\v_0}$.
Then every
$\p\in\ring{R}^3$ that is not in the line $\op{aff}(\v_0,\v_1)$
can be uniquely expressed in the form
\begin{displaymath}
\p = \v_0 + r\cos\psi\, \e_1 + r\sin\psi\, \e_2 + h (\v_1-\v_0),
\end{displaymath}
\indy{Notation}{h@$h$ (cylindrical coordinate)}%
\indy{Notation}{e@$\e_i$ (orthonormal vectors)}%
for some $0< r$, $0\le \psi < 2\pi$, $h\in\ring{R}$.
Furthermore,
assume that $\w_1$ and $\w_2$ do
not lie in the line $\op{aff}(\v_0,\v_1)$.
Then there exist unique $\psi,\theta,r_1,r_2,h_1,h_2$
such
that $0\le\psi<2\pi$, $0\le\theta < 2\pi$, $0 < r_1$, $0 < r_2$, and
\begin{displaymath}
\begin{array}{lll}
\w_1 &= \v_0 + r_1\cos\psi\, \e_1 + r_1\sin\psi\, \e_2 + h_1(\v_1-\v_0),\\
\w_2 &= \v_0 + r_2\cos(\psi+\theta)\, \e_1 + r_2\sin(\psi+\theta)\, \e_2 
+ h_2(\v_1-\v_0),\\
\end{array}
\end{displaymath}
Finally, the angle $\theta$ is independent of the choice of $\e_1,\e_2$
giving the positive frame.
\end{lemma}
\indy{Index}{coordinate systems!cylindrical coordinates}%
\indy{Index}{cylindrical coordinates}%
\indy{Notation}{ZZpsi@$\psi$}%
\indy{Notation}{ZZtheta@$\theta$ (coordinate)}%
\indy{Notation}{r@$r$ (coordinate)}%
\indy{Notation}{h@$h$ (cylindrical coordinate)}%
(A degenerately situated point $\p\in\op{aff}\{\v_0,\v_1\}$ has a
cylindrical coordinate representation of the form $\p = \v_0 +
h(\v_1-\v_0)$ (with $r=0$).)


\indy{Index}{coordinate systems}%

\begin{definition}[azim]\guid{UJBHGUX}\rz{0}
  Define $\op{azim}(\v_0,\v_1,\w_1,\w_2)$, the \newterm{azimuth} angle
  (or \newterm{longitude}), to be the uniquely determined angle
  $\theta$  given by the previous lemma.
  By convention, let the azimuth angle be $0$ in the degenerate cases
  where $\{\v_0,\v_1,\w_1\}$ or $\{\v_0,\v_1,\w_2\}$ is collinear.
  \indy{Notation}{azim}%
  \indy{Index}{azimuth}%
  \indy{Index}{angle!azimuth}%
\end{definition}

%The azimuth angle is a polar coordinate of the projection 
%$\p -\v_0-r\cos\phi\,\e_3 \in\op{aff}\{\e_1,\e_2\}$:
%    \begin{displaymath}
%    (x,y) = (r'\cos\theta,r'\sin\theta), \quad r' = r\sin\phi.
%    \end{displaymath}

The azimuth and dihedral angles are closely related.  The azimuth
angle takes values between $0$ and $2\pi$, but the dihedral angle is
never greater than $\pi$.  The following lemma reveals that the
azimuth angle is an oriented extension of the dihedral angle, always
equal to $\dih$ or $2\pi - \dih$.  \indy{Index}{angle!azimuth}%
\indy{Index}{angle!dihedral}%
\indy{Notation}{dih}%
\indy{Index}{azimuth}%

\begin{lemma}[]\guid{QQZKTXU}\rz{0}\label{lemma:dih-azim}
  \oldrating{100}  \formalauthor{Nguyen Quang Truong} Let
  $\v_1\ne \v_0$ be a nonzero vectors in $\ring{R}^3$.  Assume that
  $\w_1$ and $\w_2$ do not lie in the line $\op{aff}(\v_0,\v_1)$.  Let
\begin{displaymath}
\gamma = \dih_V(\{\v_0,\v_1\},\{\w_1,\w_2\}).
\end{displaymath}
Then
\begin{displaymath}
\cos(\op{azim}(\v_0,\v_1,\w_1,\w_2)) = \cos\gamma.
\end{displaymath}
\end{lemma}

\begin{proof} For simplicity, take our base point $\v_0=\orz$.  Let
  $\bar{\w_i} = (\v_1\cdot \v_1) \w_i - (\v_1\cdot \w_i) \v_1$.  From
  the assumptions, $\bar{\w_1}\ne 0$.  Set $\e_1 =
  \bar{\w_1}/\normo{\bar{\w_1}}$.  Choose a unit vector $\e_2$ so that
  $(\e_1\times \e_2)\cdot\v_1>0$ and $\e_1\cdot \e_2 = \v_1\cdot
  \e_2=0$.  Write $\w_i$ in cylindrical coordinates as
\begin{displaymath}
\begin{array}{lllll}
\w_1 &= r_1 \e_1 &    &+h_1 \v_1\\
\w_2 &= r_2 \cos\theta\, \e_1 &+ r_2 \sin\theta\, \e_2 &+ h_2 \v_1.
\end{array}
\end{displaymath}
The definition of $\op{azim}$ gives
$\op{azim}(\v_0,\v_1,\w_1,\w_2)=\theta$.  By definition, $\cos\gamma$
is the angle between $\bar{\w_1}$ and $\bar{\w_2}$.  Compute
\begin{displaymath}
\begin{array}{lll}
\bar{\w_1} &= \normo{\bar{\w_1}} \e_1 \\
\bar{\w_2} &= (\v_1\cdot \v_1) r_2 \cos\theta\, \e_1 
&+ (\v_1\cdot \v_1) r_2 \sin\theta\, \e_2 \\
\end{array}
\end{displaymath}
The result $\cos\theta=\cos\gamma$ 
is now a result of the definition of angle 
(Definition~\ref{def:angle}).
\end{proof}
\indy{Notation}{ZZddgamma@$\gamma$ (angle)}%
\indy{Notation}{ZZtheta@$\theta$ (angle)}%

The previous lemma identifies the cosine of the azimuth angle.  The final
lemma of this subsection determines the sign of its sine.

\begin{lemma}[]\guid{JBDNJJB}\rz{120}\label{lemma:sim}
% completion announced by Truong, buggy version in legacy directory.
Write $x\sim y$ when there exists $t>0$ such that $x= t y$. 
Then 
\begin{displaymath}
\sin(\op{azim}(\orz,\v_1,\v_2,\v_3))\sim (\v_1
  \times \v_2)\cdot \v_3.
\end{displaymath}
\end{lemma}

\begin{proof}
  The relation $\sim$ is an equivalence relation.  We may assume that
  $\{\orz,\v_1,\v_2\}$ and $\{\orz,\v_1,\v_3\}$ are not collinear
  sets, for otherwise both sides are zero.  Let $(\e_1,\e_2,\e_3)$ be
  the positive frame adapted to $(\orz,\v_1,\v_2)$.
%\begin{displaymath}
%\begin{array}{rll}
%   \e_3 &= \v_1/\normo{\v_1}\\
%   \v_2' &= \v_2 - (\e_3\cdot \v_2) \e_3\\
%   \e_1 &= \v_2'/\normo{\v_2'}\\
%   \e_2 &= \e_3 \times \e_1 \\
%\end{array}
%\end{displaymath}
Write $\v_3= r\cos\theta\, \e_1 + r\sin\theta \, \e_2 + h\, \e_3$ in
cylindrical coordinates, where $\theta =
\op{azim}(\orz,\v_1,\v_2,\v_3)$.  Then by the explicit formulas for
the positive frame,
\begin{displaymath}
\begin{array}{rll}
(\v_1\times \v_2)\cdot \v_3 &\sim (\e_3\times \v_2)\cdot \v_3\\
%&= (\e_3\times \v_2')\cdot \v_3\\
&\sim (\e_3\times \e_1)\cdot \v_3\\
&= \e_2 \cdot \v_3\\
&= r\sin\theta \\
&\sim \sin\theta.
\end{array}
\end{displaymath}
\end{proof}


\subsection{zenith angle}
\label{sec:spherical}


%
%\begin{definition}[spherical coordinates]\guid{IESAXWY}\rz{0}
%Let $x,y,z$ be any real numbers.  A
%triple $(r,\theta,\phi)$ such that
%    \begin{equation}
%    \label{eqn:spherical}
%    x = r\cos\theta\sin\phi,\quad y = r\sin\theta\sin\phi,\quad
%    z = r\cos\phi
%    \end{equation}
%with $0\le r$, $0\le\theta<2\pi$, and $0\le\phi\le\pi$ are called
%spherical coordinates of $(x,y,z)$. 


%\begin{definition}[azimuth]\guid{OSPVIBZ}\rz{0}\label{def:azimuth}


The following lemma identifies the zenith angle $\phi$.  As the zenith
angle is easily expressed in terms of the more basic function
$\arc_V$, there is little need to refer directly to the zenith angle.
\indy{Index}{orthogonal frame}%

\begin{lemma}[zenith]\guid{QAFHJNM}\rz{0}
  \oldrating{50}  \formalauthor{Nguyen Quang Truong} Let
  $(\v_0,\v_1)$ be an ordered pair of distinct points in $\ring{R}^3$.
  Let $\v_2\ne \v_0$.  Set $\phi =
  \arc_V(\v_0,\{\v_2,\v_1\})\in[0,\pi]$.  Let $\e_3$ be the unit
  vector $(\v_1-\v_0)/\norm{\v_1}{\v_0}$.  Let $r =
  \norm{\v_2}{\v_0}$.  Then $\v_2$ can be expressed in the form
\begin{displaymath}
\v_2 = \v_0 + \bar{\v}_2 +
r\cos\phi\, \e_3,
\end{displaymath}
where $\bar{\v}_2\cdot \e_3 = 0$.  The angle $\phi$ is called the
\newterm{zenith} angle (or \newterm{latitude}) of $\v_2$ along
$(\v_0,\v_1)$.  \indy{Index}{zenith}%
\indy{Index}{angle!zenith}%
\end{lemma}

\begin{proof} This follows directly from the definition of $\arc_V$:
\begin{displaymath}(\v_2-\v_0)\cdot \e_3 = r\cos\phi.\end{displaymath}
\end{proof}

\begin{lemma}[spherical coordinates]\guid{XPHCPNY}\rz{0}\label{lemma:sph}
\formal{SPHERICAL\_COORDINATES}
  Assume that
  $\{\v_0,\v_1,\v_2\}\subset\ring{R}^3$ % and $\{\v_0,\v_1,\p\}$
  is not a collinear set.  Let $(\e_1,\e_2,\e_3)$ be the positive
  frame adapted to $(\v_0,\v_1,\v_2)$.  Then for any $\p$,
\begin{equation}
\p = \v_0 + r \cos\theta \sin\phi\, \e_1 + r \sin\theta\sin\phi\, \e_2 +
r\cos\phi\,\e_3.
\label{eqn:sph}
\end{equation}
where
\begin{displaymath}
\begin{array}{lll}
r &= \norm{\v_0 }{ \p}\\
\phi &= \text{ zenith angle of } \p \text{ along } (\v_0,\v_1)\\
\theta &=\op{azim}(\v_0,\v_1,\v_2,\p).
\end{array}
\end{displaymath}
\end{lemma}

% XX move these items.
\indy{Index}{angle!zenith}%
\indy{Index}{angle!azimuth}%
\indy{Index}{azimuth}%
\indy{Index}{zenith}%
\indy{Index}{latitude}%
\indy{Index}{longitude}%

\indy{Index}{coordinate systems}%
\indy{Index}{coordinate systems!spherical coordinates}%
\indy{Index}{spherical coordinates}%

\indy{Notation}{r@$r$ (coordinate)}%
\indy{Notation}{ZZtheta@$\theta$ (azimuth)}%
\indy{Notation}{ZZphi@$\phi$ (zenith)}%
\indy{Notation}{azim}%
\indy{Notation}{ZZphi@$\phi$ (zenith)}%
\indy{Notation}{E@$E$ (frame)}%

\begin{proof}
Cylindrical coordinates give
\begin{displaymath}
\p = \v_0 + r'\cos\theta\,\e_1 + r'\sin\theta\,\e_2 + h\, \e_3,
\end{displaymath}
for some $h$ and $r'=\normo{\p-\v_0-h\,\e_3}\ge0$.  The zenith angle
puts $\p$ in the form
\begin{displaymath}
\p = \v_0 + r'\cos\theta\,\e_1 + r'\sin\theta\,\e_2 + r\cos\phi\, \e_3,
\end{displaymath}
where
\begin{displaymath}
\begin{array}{lll}
r^2 &= \norm{\p}{\v_0}^2\\ 
&= \normo{\p-\v_0-h\,\e_3}^2 + \normo{h\,\e_3}^2\\
&= (r')^2 + r^2 \cos^2\phi,
\end{array}
\end{displaymath}
Since $\sin\phi$ is non-negative, this implies that $r'=r\sin\phi$, as
desired.
\end{proof}

\begin{definition}[spherical coordinates]\guid{LVDJVFD}\rz{0}\label{def:sph}
  Equation~\eqref{eqn:sph} is called the spherical coordinate
  representation of $\p$ with respect to $(\v_0,\v_1,\v_2)$.
\end{definition}



(This book follows the variable naming conventions $(\theta,\phi)$ of
American calculus textbooks, which reverses the international
scientific notation.)



% Any triple $(x,y,z)$ has spherical coordinates.  The radial
% component is $r = \sqrt{x^2+y^2+z^2}$.  In the degenerate case when
% $r=0$, Equations~\eqref{eqn:spherical} becomes independent of
% $\theta$ and $\phi$. In the degenerate case when $\phi = 0$ or $\phi
% = \pi$, the equations become independent of $\theta$. If $0<r$ and
% $\phi\ne 0,\pi$, then $\theta$ is uniquely determined by $x,y,z$. If
% $0<r$, then $\theta$ is uniquely determined.
%


%The following gives the existence of polar coordinates on any
% oriented plane in three dimensions, with a general point $\v$ on the
% plane serving as the origin.  A normal vector $n$ orients the plane,
% then polar coordinates appear as the restriction of the spherical
% coordinates $(r,\theta,\phi)$ to the plane.  The following lemma
% shows that the value of $\phi$ is fixed, so that it may be dropped
% from the notation.  \indy{Index}{polar coordinates}%
% \indy{Index}{spherical coordinates}%
% \indy{Notation}{n@$n$ (normal vector)}%
%
%\begin{lemma}[]\guid{YBXRVTS}\rz{0}\label{lemma:polar-gen}\oldrating{60}
%  \rz{0} \formalauthor{Nguyen Quang Truong} Let $\{\v,\w,\u\}$ be
%  a set of three points in $\ring{R}^3$ that is not collinear.  Let
%  $n = (\w-\v) \times (\u-\v)$.  Then the zenith angle of any $\p\ne
%  \v$ in the plane $\op{aff}\{\v,\w,\u\}$, computed with respect to
%  $(\v,\v+n)$, is $\pi/2$.
%\end{lemma}
%\indy{Index}{zenith}%
%\indy{Index}{angle!zenith}%
%
%\begin{definition}[polar coordinate]\guid{WNLMGUV}\rz{0}\label{def:polar}
%Call  the two remaining coordinates, $(r,\theta)$, 
%the polar coordinates of $\p\in\op{aff}\{\v,\w,\u\}$ with
%respect to $(\v,\w,\u)$.
%\end{definition}
%\indy{Index}{coordinate systems}%
%\indy{Index}{coordinate systems!polar coordinates}%
%\indy{Index}{polar coordinates}%
%\indy{Notation}{r@$r$ (coordinate)}%
%\indy{Notation}{ZZtheta@$\theta$ (coordinate)}%
%
%In the special case that $\op{aff}\{\v,\w,\u\}=\ring{R}^2\subset
% \ring{R}^3$, this construction agrees with the previously defined
% polar coordinates of a point in the plane.


%\subsection{Lexell without polarity}
%
%Here is a second proof of Lexell's theorem that does not depend on
% polar triangles.
%
%\begin{proof} Select coordinates so that the Lexell circle (through
%  $\u,\v^*_1,\v^*_2$) has constant zenith angle $\phi$.  Without loss
%  of generality, an appropriate coordinate system gives
%  \indy{Notation}{ZZphi@$\phi$}%
%  \indy{Notation}{ZZtheta@$\theta$}%
%\begin{displaymath}
%\begin{array}{lll}
%\v_1 &= \{\cos\theta\sin\phi,+\sin\theta\sin\phi,-\cos\phi\}\\
%\v_2 &= \{\cos\theta\sin\phi,-\sin\theta\sin\phi,-\cos\phi\}\\
%\u &= \{\cos\alpha\sin\phi,\sin\alpha\sin\phi,\cos\phi\}\\
%\end{array}
%\end{displaymath}
%The area of a triangle is given by Euler's formula
% (Lemma~\ref{lemma:euler}).  If these coordinates are used in Euler's
% formula, then a calculation gives the area $\pi-2\atn(t,1)$, when
%\begin{displaymath}
%t=\cos\phi \tan\theta.
%\end{displaymath}
%This is independent of $\alpha$, proving that every point on the
% Lexell circle (except for the degenerate points $\u=
% \v^*_1,\u=\v^*_2$ with $\Delta=0$) gives the same solid angle.
% \indy{Notation}{ZZalpha@$\alpha$}%
%
% To check that points on different Lexell circles give different
% solid angles, any convenient point on the circle will do.  For
% example, there is an isosceles triangle $b=c$.  An easy derivative
% calculation shows that the function is increasing.  Hence different
% Lexell circles give different values.
%\end{proof}
%\indy{Notation}{ZZdelta@$\Delta$}%






\section{Cycle}


The azimuth (or longitudinal) angle of the spherical coordinate system
determines a cyclic permutation, called the azimuth cycle, on a finite
set of points in $\ring{R}^3$, ordered according to increasing azimuth
angle.  The basic properties of that permutation are developed.
\indy{Index}{cyclic permutation}%
\indy{Index}{angle}%
\indy{Index}{coordinate systems}%


\subsection{polar cycle}

Let $V=\{\v_1,\ldots,\v_k\}$ be a finite set of nonzero points in the
plane, with polar coordinates $\v_i =
(r_i\cos\theta_i,r_i\sin\theta_i)$.  It is useful to order the set of
points according to increasing angle.  To deal with degenerate cases
when some points have exactly the same angle, order the points with
the lexicographic order on their polar coordinates.  Write $\v_i \prec
\v_j$ if $\theta_i < \theta_j$ or ($\theta_i=\theta_j$ and $r_i<r_j$).
This is a total order on the points.  (This book will not ever
actually need the degenerate cases when two angles are equal, but by
defining a total order, there is never any need to revisit the issue.)
\indy{Index}{order!total}%

\begin{definition}[polar cycle]\guid{TNZQDCX}\rz{0}
There is a cyclic permutation $\sigma:V\to V$ which sends $\v\in V$ to
the next larger element with respect to this order, or back to the
first element if $\v$ is the largest.  Call $\sigma$ the
\newterm{polar cycle} of the set $V$.
\end{definition}
\indy{Index}{order!lexicographic}%
\indy{Index}{polar cycle}%
\indy{Index}{cyclic permutation}%
\indy{Notation}{ZZsigma@$\sigma$ (permutation)}%




For $\psi\in\ring{R}$, let $T:\ring{R}^2\to\ring{R}^2$ be the
rotation of the plane:
\begin{equation}
\label{eqn:rotate}
(x,y) \mapsto  (x\cos\psi + y\sin\psi,-x\sin\psi+y\cos\psi).
\indy{Index}{rotation}%
\end{equation}
Let $\sigma'$ be the polar cycle for $T(V)$.  Then it is easily
checked that
\begin{displaymath}
\sigma'(T \v) = T (\sigma \v),\quad \text{ for } \v\in V. 
\end{displaymath}
\indy{Notation}{ZZpsi@$\psi$}%
\indy{Notation}{T@$T$ (rotation)}%

\begin{lemma}[]\guid{PDPFQUK}\rz{0}\label{lemma:polar2}
  \oldrating{50}  \formalauthor{Nguyen Quang Truong}
  \formal{thetaij\_t} Let $\theta_i$ be real numbers such that $0\le
  \theta_i < 2\pi$, for $i=1,2$.  Let \begin{displaymath} \theta_{ji}
    = \theta_i - \theta_j + 2\pi k_{ji},
\end{displaymath}
where integers $k_{ij}$ satisfy $0\le \theta_{ji}< 2\pi$.
Then 
\begin{displaymath}
\theta_{12} + \theta_{21} = \begin{cases}
2\pi, & \text{ if }\theta_i\ne\theta_j\\
0,    & \text{ if }\theta_i=\theta_j.
\end{cases}
\end{displaymath}
\end{lemma}
\indy{Notation}{ZZtheta@$\theta$}%

\begin{proof} This is elementary.
\end{proof}

The next lemma gives a precise form to the observation
that given finitely many rays emanating from the origin
in the plane, the sum of the included angles is $2\pi$.
In precise form, the polar cycle is used to place
a cyclic order on the rays.  There is a degenerate case
when there is at most one ray.


\begin{lemma}[]\guid{ISRTTNZ}\rz{0}\label{lemma:polar-sum}
\oldrating{100}
\formalauthor{Nguyen Quang Truong}
%\formal{thetapq\_wind\_t}
  Let $V\subset\ring{R}^2$ be a finite set of cardinality $n$ that
  does not contain $0$.  Let $\sigma$ be the polar cycle on $V$.  In
  polar coordinates,
\begin{displaymath}
\v=\left(\, r(\v)\cos\theta(\v),\, r(\v)\sin\theta(\v)\,\right),
\end{displaymath} 
for $\v\in V$, with
$0\le\theta(\v)<2\pi$.
Write
\begin{displaymath}
\theta(\v,\w) = \theta(\w) - \theta(\v) + 2\pi k_{pq},
\end{displaymath}
for some integers $k_{pq}$ that satisfy $0\le \theta(\v,\w) < 2\pi$.
Then for all $\v\in V$
and all $0\le i \le j < n$,
\begin{displaymath}
\theta(\v,\sigma^i(\v)) +\theta(\sigma^i(\v),\sigma^j(\v)) =
\theta(\v,\sigma^j(\v)).
\end{displaymath}
Moreover, if there exist $\v,\w\in V$ such that $\theta(\v)\ne\theta(\w)$,
\begin{displaymath}
\sum_{i=0}^{n-1} \theta(\sigma^{i}\v,\sigma^{i+1} \v) = 2\pi.
\end{displaymath}
(If $\theta(\v)=\theta(\w)$ for all $\v,\w\in V$, then all the
summands are zero.)
\end{lemma}
\indy{Notation}{ZZsigma@$\sigma$ (permutation)}%

\begin{proof}
Fix $\v\in V$.
For $0\le i<n$, define $\theta_i$ by
$\theta_0=\theta(\v)$ and 
\begin{displaymath}\theta_i = \theta(\sigma^i(\v)) + 2\pi \ell_i,
\end{displaymath}
where  $\ell_i$ satisfies $\theta_0\le \theta_i < \theta_0+2\pi$.
It follows from the definition of the polar cycle that
$\theta_i \le \theta_j$ for $0\le i\le j < n$.  Then
$\theta(\sigma^i \v ,\sigma^j \v) = \theta_j - \theta_i$.
The first conclusion of the lemma reduces to
\begin{displaymath}
(\theta_i-\theta_0) + (\theta_j-\theta_i) = (\theta_j-\theta_0),
\end{displaymath}
which is certainly true.
The second conclusion reduces to
\begin{displaymath}
\sum_{i=0}^{n-2} (\theta_{i+1}-\theta_i) + \theta(\sigma^{n-1}\v,\v)
= \theta(\v,\sigma^{n-1}\v) + \theta(\sigma^{n-1}\v,\v).
\end{displaymath}
By the previous lemma, this is $0$ or $2\pi$.
\end{proof}


\subsection{azimuth cycle}

As already defined, the polar cycle is a cyclic permutation on a set
of vectors in the plane that traverses them in order of increasing
angle.  What follows is the corresponding construction in three
dimensional space.  There is a cyclic permutation on a set $V$ of
vectors in space that traverses them in order of increasing azimuth
angle.  It is called the azimuth cycle.  Most of the work for this
construction has already been done, because the azimuth cycle may be
constructed as the polar cycle on the projection of $V$ to a plane.
However, a nondegeneracy condition must be imposed on $V$ to insure
that the projection to the plane is one-to-one.  The following
definition captures this nondegeneracy condition.
\indy{Index}{azimuth cycle}%
\indy{Index}{azimuth}%
\indy{Index}{cyclic permutation}%
\indy{Index}{vector!projection}%


\begin{definition}[cyclic set]\guid{KFKHLWK}\rz{0} 
Let $(\v_0,\v_1)$ be an ordered pair of
  distinct points in $\ring{R}^3$.  Let $V$ be a finite set of points
  in $\ring{R}^3$.  Say that $V$ is cyclic with respect to
  $(\v_0,\v_1)$ if the following two conditions hold.
\begin{itemize}
\item $\u = \w + h (\v_1-\v_0)$, with $\u,\w\in V$ and $h\in \ring{R}$
implies that $\u=\w$.  
\item  The line through $\v_0$ and $\v_1$ does not meet $V$.
\end{itemize}
\end{definition}
\indy{Index}{cyclic set}%

A cyclic set $V$ has a well-defined azimuth cycle:

\begin{definition}[azimuth cycle]\guid{YESEEWW}\rz{0}
  Let $\v_0$ and $\v_1$ be distinct points in $\ring{R}^3$.  Let $V$
  be a finite set of points in $\ring{R}^3$ that is cyclic with
  respect to $(\v_0,\v_1)$.  Pick $\p\in\ring{R}^3$ such that
  $\{\v_0,\v_1,\p\}$ is not collinear and let $\{\e_1,\e_2,\e_3\}$ be
  the corresponding positive, adapted, frame.  Let $f$ be the
  projection map:
\begin{displaymath}\v_0 + x\, \e_1 + y\, \e_2 + z\, \e_3 \mapsto
(x,y).\end{displaymath}
Let $\sigma'$ be the polar cycle on $f(V)$. Define 
$\sigma:V\to V$ by $f\sigma(\u) =\sigma'f(\u)$.
Call $\sigma$ the \newterm{azimuth cycle}
on $V$ with respect to $(\v_0,\v_1)$.
\indy{Index}{azimuth cycle} %
\indy{Index}{frame}%
\indy{Index}{polar cycle}%
\indy{Notation}{f@$f$ (projection map)}%
\indy{Notation}{ZZsigma@$\sigma$ (polar cycle)}%
\indy{Notation}{ZZsigma@$\sigma$ (azimuth cycle)}%
\end{definition}

Facts about the polar cycle lift to facts about the azimuth cycle.
The next few lemmas are easy consequences of this sort.


\begin{lemma}[]\guid{NLOFMTR}\rz{80} The azimuth cycle $\sigma:V\to V$ on
  a cyclic set $V$ with respect to $(\v_0,\v_1)$ does not depend on
  the choice of $\p\in\ring{R}^3$ (such that $\{\v_0,\v_1,\p\}$ is
  non-collinear).
\end{lemma}
\indy{Index}{azimuth cycle}%
\indy{Index}{cyclic set}%

\begin{proof} This follows from independence of $\sigma\,'$ from
rotations in the $\{\e_1,\e_2\}$ plane  in~\eqref{eqn:rotate}.
\end{proof}


\begin{lemma}[]\guid{YVREJIS}\rz{0}\oldrating{40} 
\formalauthor{Nguyen Quang Truong}
Let $(\v_0,\v_1)$ be an ordered pair of points in $\ring{R}^3$,
with $\v_0\ne \v_1$.  Assume that $\{\w_1,\w_2\}$ is cyclic
with respect to $(\v_0,\v_1)$.  Then
\begin{displaymath}
\op{azim}(\v_0,\v_1,\w_1,\w_2) + \op{azim}(\v_0,\v_1,\w_2,\w_1) 
= \begin{cases} 2\pi, & \text{if }\op{azim}(\v_0,\v_1,\w_1,\w_2)\ne 0,\\
0, & \text{if }\op{azim}(\v_0,\v_1,\w_1,\w_2)=0.
\end{cases}
\end{displaymath}
\end{lemma}
\indy{Index}{cyclic}%

\begin{proof} This follows immediately from Lemma~\ref{lemma:polar2}.
\end{proof}

\begin{lemma}[]\guid{ULEKUUB}\rz{60} \label{lemma:2pi-sum}
Let $(\v_0,\v_1)$ be an ordered pair of points in $\ring{R}^3$,
with $\v_0\ne \v_1$.  Let $V$ be a finite set in $\ring{R}^3$ of
cardinality $n$ that
is cyclic with respect to $(\v_0,\v_1)$,
with azimuth cycle $\sigma$.
Then for all $\u\in V$,
and all $0\le i \le j < n$,
\begin{displaymath}
\op{azim}(\v_0,\v_1,\u,\sigma^i(\u)) +
\op{azim}(\v_0,\v_1,\sigma^i(\u),\sigma^j(\u)) =
\op{azim}(\v_0,\v_1,\u,\sigma^j(\u)).
\end{displaymath}
Moreover, if there exists $\w\in V$ such that 
$\op{azim}(\v_0,\v_1,\u,\w)\ne0$,
then
\begin{displaymath}
\sum_{i=0}^{n-1} \op{azim}(\v_0,\v_1,\sigma^i\u,\sigma^{i+1}\u) = 2\pi.
\end{displaymath}
(If $\op{azim}(\v_0,\v_1,\u,\w)=0$ for all $\w\in V$, then all the
summands are zero.)
\end{lemma}
\indy{Notation}{azim}%
\indy{Index}{azimuth}%
\indy{Index}{azimuth cycle}%
\indy{Notation}{ZZsigma@$\sigma$}%
\indy{Notation}{n@$n$ (cardinality)}%

\begin{proof} This follows immediately from 
Lemma~\ref{lemma:polar-sum}.
\end{proof}


\subsection{spherical triangle inequality} %%
\indy{Index}{triangle!spherical}%
\indy{Index}{spherical triangle inequality}%

The geodesic length between two points
$\u,\v$ on a unit sphere centered at $\v_0$ is $\arc_V(\v_0,\{\u,\v\})$.
The following lemma is part of the verification that
the function $d(\u,\v) = \arc_V(\v_0,\{\u,\v\})$ is a metric
on the unit sphere.  The lemma excludes the degenerate case when
points on the sphere are antipodal.
\indy{Notation}{d@$d(\u,\v)$ (function)}%

\begin{lemma}[]\guid{KEITDWB}\rz{0}\label{lemma:sph-tri-ineq}
\oldrating{80}
\formalauthor{Nguyen Quang Truong}
Let $\{\v_0,\u,\v,\w\}$ be a set of four points in $\ring{R}^3$.
Assume that $\v_0$ is not collinear with any of the other two points.
Then
\begin{displaymath}
  \arc_V(\v_0,\{\u,\w\}) \le \arc_V(\v_0,\{\u,\v\}) + \arc_V(\v_0,\{\v,\w\}).
\end{displaymath}
Equality occurs if and only if $\v\in\op{aff}_+(\v_0,\{\u,\w\})$.
\end{lemma}

\begin{proof} Let $\v'$ be the projection of $\v$ to the plane
$\op{aff}\{\v_0,\u,\w\}$.  
By the spherical law of cosines, when the triangle is right:
\begin{displaymath}
\cos\psi = \cos\beta\cos\alpha \le \cos\beta,
\end{displaymath}
where $\psi = \arc_V(\v_0,\{\u,\v\})$, $\beta =
\arc_V(\v_0,\{\u,\v'\})$, $\alpha=\arc_V(\v_0,\{\v,\v'\})$.  Thus,
$\arc_V(\v_0,\{\u,\v'\})=\beta\le \psi=\arc_V(\v_0,\{\u,\v\})$.
Similarly, $\arc_V(\v_0,\{\v',\w\}) \le \arc_V(\v_0,\{\v,\w\})$.
Thus, it is enough to show that
\begin{displaymath}
  \arc_V(\v_0,\{\u,\w\}) \le \arc_V(\v_0,\{\u,\v'\}) + \arc_V(\v_0,\{\v',\w\}).
\end{displaymath}
The points $\v_0,\u,\w,\v'$ are coplanar.
By the additivity of planar angle (Lemma~\ref{lemma:polar-sum}), if 
$\v'\in \op{aff}_+(\v_0,\{\u,\w\})$, then
\begin{displaymath}
  \arc_V(\v_0,\{\u,\w\}) = \arc_V(\v_0,\{\u,\v'\}) + \arc_V(\v_0,\{\v',\w\}),   
\end{displaymath}
and otherwise,
\begin{displaymath}
  \arc_V(\v_0,\{\u,\w\}) = \norm{\arc_V(\v_0,\{\u,\v'\}) }{ \arc_V(\v_0,\{\v',\w\})}.
\end{displaymath}
The inequality follows.

A trace of the argument shows that equality occurs exactly when
$\alpha=0$ and $\v'\in \op{aff}_+(\v_0,\{\u,\w\})$.  Equivalently,
$\v'=\v\in\op{aff}_+(\v_0,\{\u,\w\})$.
\end{proof}

\begin{lemma}[]\guid{FGNMPAV}\rz{0}
\oldrating{40}
\formalauthor{Nguyen Quang Truong}
\label{lemma:sph-tri-multi}
Let $\{\v_0,\u_0,\u_1,\u_2,\ldots,\u_r\}$ be a set of points in
$\ring{R}^3$.  Assume that no triple $\{\v_0,\u_i,\u_{i+1}\}$ is
collinear.  Assume that $\{\v_0,\u_0,\u_r\}$ is not collinear.  Then
\begin{displaymath}
  \arc_V(\v_0,\{\u_0,\u_r\}) \le \sum_{i=0}^{r-1} \arc_V(\v_0,\{\u_i,\u_{i+1}\}).
\end{displaymath}
\end{lemma}

\begin{proof} This is an easy induction on $r$ with base case given by
  Lemma~\ref{lemma:sph-tri-ineq}.
\end{proof}





