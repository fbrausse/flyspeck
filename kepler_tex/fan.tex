
\chapter{Fan}\label{sec:fan}

A fan is a geometric object that gives a bridge between sphere packings and hypermaps.  A fan is a particular geometric realization of a hypermap.  It is closely related to the notion of planar graph, but relates more directly to sphere packings.  This chapter does not  assume the Jordan curve theorem or Euler formula for planar graphs.  The main result of this chapter gives a simple version of the Euler formula, 
which implies that the hypermap of a fan is planar.
\indy{Index}{fan}
\indy{Index}{hypermap}
\indy{Index}{planar}
\indy{Index}{packing}

%In this chapter,  a choice of base point $\orz\in\ring{R}^3$ serves as the origin.  It does no harm to assume, in fact, that $\orz =0$.


If $S$ is a set of points,
set
  $$
  \begin{array}{lll}
  C(S) &= \op{aff}_+(0,S)\\
  C^0(S) &= \op{aff}^0_+(0,S)\\
  \end{array}
  $$

\begin{definition}[fan]  
Let $(V,E)$ be a pair consisting of a set $V\subset \ring{R}^3$ and a set of pairs of elements of $V$.  The pair is said to be
a {\it fan\/} if the following conditions hold.
    \begin{itemize}
    \item $V$ is finite and nonempty.
    \item $0\not\in V$.
    \item If $\e \in E$, then $\{0\}\cup \e$ is not a collinear set.
    \item 
    For all $\e ,\e '\in E \cup \{\{v\}\mid v\in V\}$, 
 $$C(\e )\cap C(\e ') = C(\e \cap \e ').$$
    \end{itemize}
When $\e\in E$, call $C^0(\e)$ or $C(\e)$ a {\it blade\/} of the fan.
\indy{Index}{fan}
\indy{Notation}{fan@$(V,E)$ (fan)}
\end{definition}

\bigskip\hbox{~}\bigskip


%Repeat an older version of the definition (in use between May 15 2009 and June 18 2009).
%\begin{definition}[retro-fan]  Let $(\orgz,V,E)$ be a triple consisting of a point,
%a set of
%points, and a set of pairs of elements of $V$.  The triple is said to be
%a {\it retro-fan\/} if the following conditions hold.
%    \begin{itemize}
%    \item $V$ is finite and nonempty.
%    \item $\orz\not\in V$.
%    %\item Each element of $E$ has two elements.
%    \item For each $v\in V$, the set
%        $$
%        %% WW changed notation from E_v to E(v) to allow deformations E_t
%        E(v) = \{w\in V\mid \{v,w\}\in E\}
%        $$
%        is cyclic with respect to $(\orz,v)$.
%    \item For each $\e\in E$, $V\cap C^0(\orz,\e)=\emptyset$.
%    \item  Sets $\e,\e'\in E$ give
%        $$C^0(\orz,\e) \cap C^0(\orz,\e')\ne\emptyset\ \Rightarrow (\e = \e').$$
%    \item Sets $v,v'\in V$ give
%     $$\op{aff}^0_+(\orz,v) = \op{aff}^0_+(\orz,v')\ \Rightarrow (v=v').$$
%      %% Added condition May 15, 2009./ killed June 18
%    \end{itemize}
%\end{definition}



\begin{lemma}  Let $(V,E)$ be a fan.
For each $v\in V$, the set
        $$
        E(v) = \{w\in V\mid \{v,w\}\in E\}
        $$
        is cyclic with respect to $(\orz,v)$.
\end{lemma}
\indy{Notation}{E(v) (edge set)}

\begin{proof}  If $w\in E(v)$, then $\{\orz,v,w\}$ is not collinear.
Also, if $w\ne w'\in E(v)$, then
$$
C(\{v,w\})\cap C(\{v,w'\}) = C(\{v\}).
$$
This implies that $E(v)$ is cyclic.
\end{proof}

\begin{remark}\tlabel{rem:fan}\rating{30}
\begin{itemize}
\item The pair $(V,E)$ is a graph with nodes $V$ and edges $E$.  The set
$\{\{v,w\}\mid w\in E(v)\}$ is the set of edges around a fixed node $v$.
Note that $w\in E(v)$ if and only if $v\in E(w)$.   
%
\item The final condition implies that the sets $C^0(\e)$
do not meet.   This condition will eventually yield planar
hypermaps.
\indy{Index}{hypermap}
\indy{Index}{planar}
%
\item
Since $E(v)$ is cyclic,
each $v\in V$ has an azimuth cycle $\sigma(v):E(v)\to E(v)$.
\indy{Index}{azimuth cycle}
It is allowed for $E(v) = \{w\}$ to be a
singleton set. If so,
$\sigma(v)$ is the identity map on $E(v)$.
%
Sometimes,   $\sigma(v,w)$ denotes $\sigma(v)(w)\in E(v)$.
%
\item 
The condition that $\{0\}\cup \{\e\}$ is not a collinear set, when $\e\in
E$, implies no loops: $\{v,v\}\not\in E$.
%
\end{itemize}
\end{remark}


Let $(V,E)$ be a fan.  Define a sets of darts $D$, and
two subsets $D_1,D_2$:
    $$
    \begin{array}{lll}
    D_1 &= \{(v,w)\mid \{v,w\}\in E\}\\
    D_2 &= \{v \mid v\in V,\ \ E(v) = \emptyset\},\\
    D   &= D_1\cup D_2.
    \end{array}
    $$
Darts in $D_2$ are said to be {\it isolated}; and darts in $D_1$ are {\it non-isolated}.
%
\indy{Index}{dart}
\indy{Index}{dart!isolated}
\indy{Index}{dart!non-isolated}
\indy{Index}{isolated}
\indy{Index}{non-isolated}
\indy{Notation}{D@$D$ (darts)}

Define a permutation $n$ on $D_1$ by
    $$n(v,w) = (v,\sigma(v,w)).$$
Define a permutation $f$ on $D_1$ by
    $$
    f (v,w) = (w,\sigma(w)^{-1} v).
    $$
Define a permutation $e$ on $D_1$ by
    $$
    e (v,w) = (w,v).
    $$
Define permutations $e,n,f$ on $D_2$ by making them degenerate on $D_2$:
    $$
    e (v) = n(v) = f(v) = v.
    $$
Write %$\op{hyp}_r(V,E)=(D_1,e,n,f)$ and 
$\op{hyp}(V,E)=(D,e,n,f)$.  Call it %  them the non-isolated hypermap
the hypermap associated with $(V,E)$.  The next
lemma justifies this terminology.



\begin{lemma}\guid{AAUHTVE}\rating{70}
Let $(V,E)$ be a fan.  Let $D = D_1\cup D_2$
and $\op{hyp}(V,E) = (D,e,n,f)$, as constructed above.  Then
    \begin{itemize}
    \item $\op{hyp}(V,E)$ is a plain hypermap.
    \item  $e$ has no fixed
points in $D_1$.
    \item  $f$ has no fixed points on $D_1$.
    \item For every pair of distinct nodes, there is at most one
    edge meeting both.
    \item The two darts of an edge (of $D_1$) lie at different nodes.
    \end{itemize}
\indy{Notation}{hyp@$\op{hyp}$ (plain hypermap)}
\end{lemma}

\begin{proof}  Compute
    $$
\begin{array}{lll}
e(n(f(v,w))) &= e(n(w,\sigma(w)^{-1} v))) &=
        e(w,v)\\ 
&= (v,w).
\end{array}
$$
So it is a hypermap. Compute
    $$e(e(v,w)) = e(w,v) = (v,w).$$
So it is plain. A fixed point in $D_1$ under $e$ would force $v = w\in E(v)$,
but by construction $v\not\in E(v)$.  The argument that $f$ has no
fixed points is similar.

The next step is to show that for every pair of distinct nodes, there is at most one edge
meeting both.
That is,
        $$(n^k e x = e n^\ell x)\Rightarrow (n^\ell x = x).$$
Let $x = (v,w)\in D_1$.  Let $\sigma=\sigma(v)$. Then
    $$
    \begin{array}{lllllll}
    n^\ell x &= (v,\sigma^\ell w)\\
    e n^\ell x &= (\sigma^\ell w,*)\\
    e x &= (w,*)\\
    n^k e x &= (w,*)\\
    n^k e x &= e n^\ell x &\ \Rightarrow (w = \sigma^\ell w) &\ \Rightarrow
    (n^\ell x &= (v,w) = x)
    \end{array}
    $$

Finally,  each dart of an edge lies on a different node.
That is, $e x \ne n^k x$, for $x\in D_1$.   In detail:
    $$
    \begin{array}{lll}
        e(v,w) &= (w,*),\quad w\in E(v)\\
        n^k(v,w) &= (v,*),\quad v\not\in E(v).
    \end{array}
    $$
The result follows.
\end{proof}

\section{Topology}\label{sec:topology}

\subsection{basics}

There is hardly any topology that comes up in this book.  Most of
what is needed appears in this chapter.  This chapter uses some basic
notions in topology such as continuity, connectedness, and compactness.

\begin{remark} The term {\it connected} is now being used in
two different senses: in the topological sense and in a combinatorial
sense for hypermaps.    To reduce the confusion, this book calls the connected components
of a topological space {\it topological components} and the connected
components of a hypermap {\it combinatorial components}.
\end{remark}
\indy{Index}{connected}
\indy{Index}{connected!topological component}
\indy{Index}{connected!combinatorial component}





The set $\ring{R}^3$ is a metric space under the
Euclidean distance function $d(v,w) = \norm{v}{w}$.  Subsets of
$\ring{R}^3$ are a metric space under the restriction of the metric
$d$ to the subset. Subsets carry the metric space topology.
\indy{Index}{metric space} 
If $Y$ is an open set in $\ring{R}^3$, write
$\comp{Y}$ for its set of topological components.
\indy{Notation}{compy@$\comp{Y}$ (topological components)}
If two
points in $\ring{R}^3$ 
can be joined by a continuous path that avoids $X$,
then they lie in the same topological component of $Y$.
\indy{Index}{connected!topological component}
Given any  family of pairwise disjoint nonempty connected open sets in
$Y$, whose union is all of $Y$, then
this family is $\comp{Y}$.
\indy{Notation}{compy@$\comp{Y}$ (topological components)}
%embers of the family are the topological components of $Y$.
Let $$S^2 = \{ v \mid \normo{ v} = 1\}$$ be the unit sphere in
$\ring{R}^3$, centered at $\orz$.  






\subsection{topological component and dart}

Let $(V,E)$ be a fan and let $(D,e,n,f) = \op{hyp}(V,E)$
be the associated hypermap.  Write $D = D_1\cup D_2$ as a union of
non-isolated and isolated darts.
\indy{Index}{fan}
\indy{Index}{dart}
\indy{Index}{hypermap}

\begin{definition}[X,~Y]\label{def:XY}
Let $(V,E)$ be a fan.  Let $X=X(V,E)$ be the union of the
cones
   $$C(\e)$$
as $\e$ ranges over $E$.  Let $Y=Y(V,E)$ be the complement
$Y = \ring{R}^3\setminus X$.
\indy{Notation}{X (fan)}
\indy{Notation}{Y (fan)}
\end{definition}


A wedge $\Wdart(x)$, a subset $\Wdart(x,\epsilon)$,
and an azimuth angle $\op{azim}(x)$ are associated with
with each dart $x=(v,w)\in D$.  Define 
\indy{Index}{wedge}
\indy{Index}{angle!azimuth}
\indy{Index}{azimuth}
\indy{Index}{dart}
\indy{Notation}{Wdart@$\Wdart$ (wedge)}
\indy{Notation}{azim@$\op{azim}$ (azimuth angle of a dart)}
$$
\Wdart(x)=
\begin{cases} 
W(\orz,v,w,\sigma(v,w)),&\text{if }\card(E(v))>1,\\
\ring{R}^3\setminus \op{aff}_+(\{\orz,v\},w),&\text{if } E(v) = \{w\},\\
\ring{R}^3\setminus \op{aff}\{\orz,v\},&\text{if } E(v) = \emptyset.\\
\end{cases}
$$
Define $\op{azim}(x)$ as the azimuth angle of $\Wdart(x)$:
\indy{Notation}{azim@$\op{azim}(x)$}
$$
\op{azim}(x)=\begin{cases}
\op{azim}(\orz,v,w,\sigma(v,w)), &\text{if } \card(E(v)) > 1,\\
2\pi, & \text{otherwise.}\\
\end{cases}
$$
For any $x = (v,\ldots)\in D$, set
    $$
    \Wdart(x,\epsilon) = \Wdart(x) \cap \op{rcone}^0(\orz,v,\cos\epsilon).
    $$

%All the hypermaps in this book are connected. $D_2$ is not needed.


\begin{lemma}\guid{VBTIKLP}\tlabel{lemma:disjoint}\rating{120}
Let $(D,e,n,f)$ be the hypermap attached to a 
fan $(V,E)$.
Let $N$ be a node of $D$.  There exists $v\in V$
such that the darts of $N$ are precisely
the darts of the form $(v,\ldots)$.  Furthermore, there is a 
disjoint sum decomposition of $\ring{R}^3$ given by
  $$
  \ring{R}^3 = 
  \op{aff}\{\orz,v\} \cup
  \bigcup_{x\in N} \Wdart(x)  \cup 
  \bigcup_{\{v,w\}\in E} \op{aff}_+^0(\{\orz,v\},w).
  $$
\end{lemma}
\indy{Index}{disjoint sum decomposition}
\indy{Index}{hypermap}
\indy{Index}{dart}

For $x\in D$, write $v(x)\in V$ for the corresponding vertex.  The lemma identifies $V$ with the set of nodes of $D$.

\begin{proof}
The proof begins with the existence of the disjoint sum decomposition.
First of all, $\ring{R}^3$ is the disjoint union of $\op{aff}\{\orz,v\}$
and its complement.

The case $\card(E(v))\le 1$ follows immediately from the definitions.  
Therefore assume  that $\card(E(v)) >1$.
Fix $u$ such that $\{v,u\}\in E$, and let $\sigma$ be the azimuth
cycle on $E(v)$.  Let $\alpha(i)=\op{azim}(\orz,v,\sigma^i u,\sigma^{i+1}u)$.   See Lemma~\ref{lemma:2pi-sum}.  Every $y\in\ring{R}^3\setminus\op{aff}\{\orz,v\}$ satisfies
$$
\sum_{i=0}^j \alpha(i) <
\op{azim}(\orz,v,u,y) < \sum_{i=0}^{j+1} \alpha(i).
$$
or 
$$
\sum_{i=0}^j \alpha(i) = \op{azim}(\orz,v,u,y)
$$
for a unique $0 \le j < n$, where $n$ is the cardinality of $E(v)$. 
These conditions are exactly the membership conditions for the sets
$
\Wdart(v,\sigma^j u)
$
and $\op{aff}_+^0(\{\orz,v\},\sigma^j u)$, respectively.
The result follows.
\end{proof}

\begin{corollary}\guid{IBZWFFH}\tlabel{cor:W}\rating{40}
Let $x = (v,\ldots)$ be a dart and $w\in E(v)$.
Then $\Wdart(x)\cap C(\{v,w\})=\emptyset$.
\end{corollary}

\begin{proof} The decomposition of Lemma~\ref{lemma:disjoint} is
disjoint.  It follows directly from the definitions that
   $$C(\e)\subset \op{aff}_+^0(\{\orz,v\},w) \cup 
    \op{aff}\{\orz,v\}.$$
\end{proof}

\begin{lemma}\guid{JGIYDLE}\rating{120} 
For each dart $x$, and $\epsilon$ sufficiently small and positive,
$\Wdart(x,\epsilon)$ is nonempty and lies in a single 
topological component of $Y(V,E)$.
\end{lemma}
\indy{Index}{connected!topological component}
\indy{Notation}{Wdart@$\Wdart$ (dart)}

\begin{proof}  The proof first shows that $\Wdart(x,\epsilon)$ lies in $Y$,
for $\epsilon$ small.  Let $x=(v,w)\in D_1$.  
Let $S^2(\orz)$ be the unit sphere centered at $\orz$.
By making $\epsilon$ small enough,
the sets $\Wdart(x,\epsilon)\cap S^2$
avoid the compact sets $C(\e)\cap S^2$ when $v\not\in e$.
Thus, $\Wdart(x,\epsilon)$ also avoids $C(e)$ when $v\not\in e$.
By Corollary~\ref{cor:W}, $\Wdart(x,\epsilon)$ avoids $C(\e)$, when $v\in \e$.
Thus, $\Wdart(x,\epsilon)\subset Y$, for $\epsilon$ small.

To complete the proof, it is enough to show that each $\Wdart(x,\epsilon)$ is
connected.  
The  set
   $$
   R=\{(r,\theta,\epsilon') \in (0,\infty) \times (\theta_1,\theta_2) \times (0,\epsilon)\}
   $$
is connected.
The set $\Wdart(x,\epsilon)$  is the image of $R$
under a spherical coordinate representation (Definition~\ref{def:sph}).
\indy{Index}{spherical coordinates}
It is readily verified that the polar coordinate representation is
a continuous map. As the image of a connected set under a continuous map
is connected, $\Wdart(x,\epsilon)$ is connected.
\end{proof}
\indy{Index}{connected}
\indy{Index}{polar coordinates}

\begin{definition}[leads~into] For each dart $x$, 
there is then a well-defined connected
component $U_x$ of $Y(V,E)$ 
that contains $\Wdart(x,\epsilon)$ (for all
sufficiently small $\epsilon$). Say the dart {\it leads into}
$U_x$.
\end{definition}
\indy{Index}{connected}
\indy{Notation}{ux@$U_x$ (connected component)} 


\section{Planarity}


\subsection{face attributes}

For $x\in D$, let $v(x)\in V$ be the node of $x$.

\begin{lemma}\guid{DHVFGBC}[sweep]\rating{400}\label{lemma:sweep}  
Let $(V,E)$ be a fan, with hypermap $(D,e,n,f)$.  
Suppose that $\op{azim}(x)<\pi$
for all darts $x\in D$.  Fix a dart $x\in D$.
Let $v = v(x)$, $v_0 = v(f x)$,
and $v_1 = v(f^2 x)$.  Let $v_t = (1-t) v_0 + t v_1$, for
$0\le t\le 1$.  Let $C^0(t) = \op{aff}_+^0(\orz,\{v,v_t\})$.
Let $Y = Y(V,E)$ and $X = X(V,E)$.
Then
\begin{itemize}
\item The set $\{\orz,v,v_t\}$ is not collinear for any $t\in[0,1]$.
\item If $0 < t \le 1$, and $C^0(t)$ meets $X$, then $t=1$, $\{v,v_1\}\in E$, and $C^0(1) = C^0(\{v,v_1\})$.
%\item For $0< t < 1$, it follows $C^0(t)\subset Y$.
%item If $\{v,v_1\}\in E$ (that is, if the face of $x$ is a triangle), 
%then $C^0(1)$ is the blade $C^0(\{v,v_1\})$ of the fan.
%\item If $\{v,v_1\}\not\in E$, then $C^0(1)\subset Y$.
\end{itemize}
\end{lemma}


\begin{figure}[htb]
  \centering
  \szincludegraphics[width=50mm]{\pdfp/vt.eps}
  \caption{Adding an edge to the fan.}
  \label{fig:vt}
\end{figure}


\begin{proof}
It follows from the definition of a fan that $\{v,v_0\}\in E$ and
that $\{\orz,v,v_0\}$ is not collinear.  By continuity, $\{\orz,v,v_t\}$
is not collinear for $t>0$ sufficiently small.  If it exists, set $t'$ as
the smallest $t>0$ for which $\{\orz,v,v_t\}$ is a collinear set.  If it exists, let $I=\{t\mid 0< t < t'\}$, otherwise let $I=\{t\mid 0 < t \le 1\}$.  For each $t\in I$, the blade $C^0(t)$ is not a collinear set and is contained in a unique plane $P(t)$ through $\orz$ and $v$.

The following claim holds: if $t\in I$ and $C^0(t)$ meets $X$, then $t=1$, $\{v,v_1\}\in E$, and $C^0(1)= C^0(\{v,v_1\})$.  A consideration of possible intersections with vertices $w\in V$ and blades
$C^0(\e)\subset X$ shows that for $t>0$ sufficiently small,
$C^0(t)$ does not meet $X$, hence $C^0(t)\subset Y$.  Assuming 
that it exists, set $t''$
as the smallest $t\in I$ for which $C^0(t)$ meets $X$.   
$C^0(t'')$ cannot meet $X$ at a vertex $w\in V$, because each azimuth angle
is $<\pi$ at $w$, which means that for any $t$ for which  $C^0(t)$ meets $w$ 
there is a smaller $t'''<t$ for which $C^0(t''')$ meets a blade into $w$.
Thus, $C^0(t'')$ first meets $X$ along a blade $C^0(\e)$. If
the intersection is transversal, again one can find a smaller $t$ that
gives an intersection with the blade.  Hence, assume that
$C^0(t'')$ and $C^0(\e)$ are coplanar.  From the disjointness
properties of blades of a fan, it follows that $\e = \{v,v_1\}\in E$,
that $t''=1$, and that $C^0(1)$ is a blade of the fan.

Now assume for a contradiction that $t'$ exists.  Pick $0<t''<t'$.  Then
$\{\orz,v(t''),v(t'),v\}$ lie in a unique plane $P$.  Since all $v(t)$
are collinear,  $v(t)\in P$ all $t\in I$.  In particular $v_0\in C^0(t'')\cap X$,
contradicting the established disjointness of $X$ from $C^0(t'')$.  Thus, $t'$ does not exist.  This proves the first
claim of the lemma.  

Now $I= \{t\mid 0 < t \le 1\}$ and the other claims follow immediately.
\end{proof}

\begin{lemma}\guid{RWXUYZZ}\rating{100} 
Let $(V,E)$ be a fan with hypermap $(D,e,n,f)$. Let $Y=Y(V,E)$. Assume that $\op{azim}(x)<\pi$ for all darts. Then for every face $F$ of the hypermap, there exists a topological component $U$ of $Y$ such that for every $x\in F$, the dart $x$ leads into $U$. 
\end{lemma}
\indy{Index}{connected!topological component}
\indy{Index}{hypermap}
\indy{Index}{dart}

Write $F\mapsto U_F$ for this map from faces to topological components.

\begin{proof}  Fix any dart $x\in F$ and construct the set $C^0(t)$ as
in the previous lemma.  By the previous lemma, the set $C^0(t)$ lies in a single
component $U$ for all $t>0$ sufficiently small.  For all $\epsilon>0$
sufficiently small, there exists $\delta>0$ such that set $C^0(t)$ meets
both $W(x,\epsilon)$ and $W(f x,\epsilon)$ for all $t<\delta$.  Thus,
$x$ and $f x$ lead into the same component $U$.  By induction, for all
$y\in F$, the dart $y$ leads into $U$.
\end{proof}

\begin{lemma}\guid{JUTSTKG}\rating{120}
Let $(V,E)$ be a fan with hypermap $(D,e,n,f)$. Let $Y=Y(V,E)$. Assume that $\op{azim}(x)<\pi$ for all darts.  For every topological component $U$ of $Y$, there is a dart $x\in D$ that leads into $U$.
\end{lemma}
\indy{Index}{connected!topological component}
\indy{Index}{fan}
\indy{Index}{hypermap}

\begin{proof}  
To show the dependence of the sets $C^0(t)$ on the initial dart $x$, write $C^0(t,x)$.

Let $p\in U$.  Choose a path $\gamma:[0,1]\to \ring{R}^3$
such that $\gamma(t)\in U$ for $t<1$ and $\gamma(1)\not\in U$.  Then
$q=\gamma(1)\in X$.  If $q\in\op{aff}^0_+(\orz,v)$ for some $v\in V$,
then there exists a dart $x$ with node $v = v(x)$ such that for 
all $0\le t < 1$ and all sufficiently
small $\epsilon>0$, it follows that $\gamma(t)\in W(x,\epsilon)$.  Thus,
$x$ leads into $U$.
\indy{Notation}{ZZddgamma@$\gamma$ (path)}

The other possibility is that
$q\in C^0(\{v,w\})$ for some $\{v,w\}\in E$.  There is a unique
edge $\{x,y\}$ of the hypermap such that $v=v(x)$ and $w=v(y)$.  
There
is a small neighborhood of $q$ such that every point $q'$ in that neighborhood
takes one of the following forms:
\begin{itemize} \item $q'\in C^0(\{v,w\})$.
\item $q'\in C^0(s,x)$ for some $0<s<1$.
\item $q'\in C^0(s,y)$ for some $0<s<1$.
\end{itemize}
Points of the first form do not meet $Y$.  Thus for some $t<1$ and $s<1$
it follows that $\gamma(t)\in C^0(s,x)$ or $\gamma(t)\in C^0(s,y)$.  Thus,
$x$ or $y$ leads into $U$.
\end{proof}

\begin{lemma}\guid{KVQWYDL}[triangle attributes]\rating{200} \label{lemma:triangle}
Let $(V,E)$ be a fan with hypermap $(D,e,n,f)$. 
Let $Y=Y(V,E)$.
Assume that $\op{azim}(x)<\pi$
for all darts.  Fix a face $F$ of cardinality three, fix
$x\in F$, and set $x_i = f^i x$. Then
\indy{Index}{triangle attributes}
\begin{itemize}  
\item $U_F$ is equal to the intersection of the three half-spaces
$$H^0(i)=\op{aff}_-^0(\{\orz,v(x_{i+1}),v(x_{i+2})\},v(x_i)),\quad i=0,1,2$$
\item if a dart $y$ leads into $U_F$, then $y\in F$.
\end{itemize}
\end{lemma}
\indy{Index}{half-space}

\begin{proof} The intersection of two half-spaces, $H^0(1)\cap H^0(2)$ is
the wedge $W(x)$.   The sets $C^0(t)\subset W(x)$ sweep out precisely
the intersection of $W(x)$ with $H^0(0)$.  The sets $C^0(t)$ belong to
$U_F$.  Hence the intersection $U'$ of the three half-spaces is a subset of $U_F$.

Suppose for a contradiction 
that $p$ is a point of $U_F$ that does not belong to $U'$.  Choose a path $\gamma:[0,1]\to U_F$ with $\gamma(0)\in U'$ and $\gamma(1)=p$.  Let $t>0$ be the first time such that $\gamma(t)\not\in U'$.  Then $q=\gamma(t)$ lies in the set consisting of the closed intersection of half-spaces $H(i)$ corresponding to $H^0(i)$ and lies
in one of the bounding planes.  Let 
$$
X' = \cup C(i),\quad\text{ where } C(i)=C(\{v(x_i),v(x_{i+1})\}).
$$
Then $q\in X'\subset X$.  Thus,
$q\in X\cap Y = \emptyset$, which is impossible.  Thus, $U'=U_F$.

Let $y$ be any dart that leads into $U_F$ at vertex $v(y)$.  Then
$W(y,\epsilon)$ meets $U_F$ for all $\epsilon>0$ sufficiently small.
This implies that $v(y)$ lies in the intersection of the closed half-spaces $H(i)$.  As previously established, this intersection is the disjoint union of $U_F$ and
$X'$.  As $v(y)\in X$, which does not meet $U_F$, it follows that $v(y)\in X'$.
The set $X'$ is the disjoint union of the rays $\op{aff}_+(\orz,v(x_i))$ and
the three blades $C^0(i)$.  These blades do not meet the vertices, hence
$v(y)=v(x_i)$ for some $i$.  Thus, $y$ and $x_i$ belong to the same
node.  The sets $W(y)$ and $W( x_i)$ are disjoint for distinct darts at the same
node, and this implies that $y=x_i\in F$.
\end{proof}

\begin{corollary}\guid{MOZNWEH}\rating{60}\label{lemma:girard-component}
Let $F$ be a face of size $3$ in in the context of Lemma~\ref{lemma:triangle}.  Then $U_F$ is measurable and eventually radial at $\orz$.
The solid angle of $U_F$ is given by the formula
$$
\sol(U_F) = -\pi + \sum_{x\in F}\op{azim}(x),
$$
\end{corollary}
\indy{Index}{angle}
\indy{Notation}{F@$F$ (face)}
\indy{Notation}{Uf@$U_F$ (component)}

\begin{proof} An intersection of half-spaces is measurable and
eventually radial.  The solid angle is given by Girard's formula for
a spherical triangle.
\end{proof}
\indy{Index}{Girard's formula}

\begin{lemma}\guid{PIIJBJK}[face attributes]\rating{1000}\label{lemma:face}
Let $(V,E)$ be a fan with hypermap $(D,e,n,f)$. 
Let $Y=Y(V,E)$.
Assume that $\op{azim}(x)<\pi$
for all darts $x\in D$.  Then
\begin{itemize}
\item The map $F\mapsto U_F$ is a bijection between faces of the hypermap
and topological components of $Y$.
\item  Each topological component $U_F$ is the intersection of the open
half-spaces $\op{aff}_+^0(\{\orz,v(x),v({f x})\},v(f^2 x))$, as $x$ runs
over $F$.
\item For every $F$, the topological component $U_F$ is measurable and
eventually radial at $\orz$.  The solid angle of $U_F$ is given by the
formula
$$
\sol(U_F) = 2\pi + \sum_{x\in F}(\op{azim}(x)-\pi).
$$
\item If $x,y\in F$, with corresponding vertices $v(x),v(y)\in V$, then
$\{\orz,v(x),v(y)\}$ are not collinear.
Furthermore, 
either $x,y$ are adjacent under the face map, or $C^0(\{v(x),v(y)\})\subset U_F$.  {\it That is, the diagonals of the polygon $U_F$ are all interior.}
\item  Triangulations of $U_F$ exist.
\end{itemize}
\end{lemma}

Before moving to the proof, here are some corollaries.

\begin{corollary}\guid{GINGUAP}\rating{40}
Each topological component $U_F$ is convex.
\end{corollary}
\indy{Index}{component!topological}
\indy{Index}{convex}

\begin{proof} It is the intersection of half-spaces.
\end{proof}

\begin{corollary}\guid{SRPRNPL}\rating{60}  
The hypermap is simple.
\end{corollary}
\indy{Index}{hypermap!simple}

\begin{proof}  Let $x\in F$.  By the intersection of half-spaces property, $U_F$ is contained in the wedge $W(x)$ at $x$.  If there is a second dart $y$ at the same node in $F$, then $U_F$ is also contained in $W(y)$. However, by Lemma~\ref{lemma:disjoint}, the wedges at a given node are disjoint.
\end{proof}

\begin{corollary}\guid{WGVWSKE}\rating{150}  
The hypermap is connected.
\end{corollary}
\indy{Index}{connected}
\indy{Index}{hypermap}
\indy{Index}{component!combinatorial}

\begin{proof} Assume that $x,y$ be any two darts.  After replacing $x$ with $f x$ if necessary, which lies in the same combinatorial component as $x$, 
assume that $\{\orz,v(x),v(y)\}$ is not a collinear set. 
For each blade $C^0(\e)$ of the fan that meets $C=C^0(\{v(x),v(y)\})$
pick one of the two endpoints of $\e$.  This gives a sequence
$$
v(x)=v_0,v_1,\ldots,v_k=v(y)
$$
such that $C^0(\{v_i,v_{i+1}\})$ lies in a single topological component $U_i$.  Each $U_i$ has the form $U_F$ for some face $F=F_i$ of the hypermap.
Thus,  a combinatorial path is constructed from $x$ to $y$, by moving by the face map from dart to dart within each $F_i$ and by the node map from dart to dart around a given node $v_j$.
\end{proof}

\begin{corollary}\guid{GGRLKHP}\rating{100}  
The hypermap is planar.
\end{corollary}
\indy{Index}{planar}
\indy{Index}{hypermap}

\begin{proof}  The solid angle of a sphere is $4\pi$.  The set $X$
has measure zero, so that
$$
4\pi = \sol(Y)= \sum_F \sol(U_F) = 
\sum_F ( 2\pi + \sum_{x\in F} (\op{azim}(x)-\pi) ).
$$
The double sum over faces and darts in a face can be replaced by
a single sum over darts.  
The sum of the azimuth angles of all darts at a node is $2\pi$. Thus,
all the azimuth angle terms give $2\pi\,\#n$.
Thus, the formula becomes
$$
4\pi = 2\pi\, \#f +2\pi\,\#n - \pi\, \#D.
$$
In a plain hypermap in which the edge map has no fixed points, $\#D = 2\,\#e$.
The relation becomes
$$
2 + \#D = \#f + \#e + \#n.
$$
This is the condition of planarity for a connected hypermap.
\end{proof}
\indy{Index}{hypermap!connected}

\subsection{proof of face attributes}

Now turn to the proof of the face-attribute lemma (Lemma~\ref{lemma:face}).  The proof breaks into a series of small lemmas.  The primary proof method is an induction on the following invariant of a fan $(V,E)$.  If $(V,E)$ is a fan,  let $N(V,E)$ be the natural number
$$
\sum_F (n_F - 3),
$$
where the sum runs over faces of the  hypermap, and $n_F$ is the cardinality of the face $F$.
%We prove the conclusion of the lemma, together with the additional
%conclusion:
%\begin{itemize}
%\item If $C^0(\e)$ is any diagonal of $U_F$ (with $\e\not\in E$), then the %fan $(V,E'')$, where $E'' = E\cup\{\e\}$, satisfies
%$N(V,E'')+1 = N(V,E)$.
%\end{itemize}

\begin{lemma} Lemma~\ref{lemma:face} holds under the additional assumption that $N(V,E) = 0$.
\end{lemma}
\indy{Index}{face!attribute}
\indy{Notation}{N@$N$ (face)}
\indy{Notation}{nf@$n_F$ (cardinality of face)}

\begin{proof}
If $N(V,E)=0$, then the hypermap is a triangulation.  Consider this
case first.  By earlier lemmas, every topological component of $Y$ has
the form $U_F$ for some face $F$.  By Lemma~\ref{lemma:triangle}, $U$ uniquely determines the face $F$.  Thus, there is a bijection between faces of the hypermap and topological components.  By Lemma~\ref{lemma:triangle}, the topological component $U_F$ is the intersection of open half-spaces as asserted.  The solid angle formula is given by Corollary~\ref{lemma:girard-component}.  The facts about diagonals and triangulations are trivial for a hypermap that is already a triangulation. This completes the proof in the base case $N(V,E)=0$.
\end{proof}
\indy{Index}{triangulation}

Now consider the case $N(V,E)>0$.  There exists a face $F$ of the hypermap that is not a triangle.  By Lemma~\ref{lemma:sweep}, there is a diagonal in $U_F$. Form a new fan $(V,E')$ on the same vertex set with
$E' = E\cup \{\{v,w\}\}$.   

\begin{lemma} 
$N(V,E')<N(V,E)$.
\end{lemma}


\begin{proof}  There is a uniquely determined edge $\{x,z\}$ of $\op{hyp}(V,E')$ such that $v=v(x)$ and $w=v(z)$.   The hypermap $\op{hyp}(V,E)$ is obtained from $\op{hyp}(V,E')$ by a double walkup transformation on the edge $\{x,z\}$.  The darts belong to different faces $F_x$ and $F_z$ (by Lemma~\ref{lemma:triangle}), one of which (say $F_x$ is a triangle.  Thus, the walkup transformation merges two faces.  Let $n$ be the cardinality of $F_z$. Then 
$$N(V,E) - N(V,E') = ((n+1)-3) ~~-~~ ((n-3) + (3-3)) = 1 >0.$$
\end{proof}

Assume for a contradiction that there exists a fan $(V,E)$ 
satisfying the assumptions of the lemma, but not the conclusion.
Among all such counterexamples with fixed $(V)$,  pick
$E$ to minimize  $N(V,E)$.

By the assumed minimality of $E$, the conclusion of the lemma holds for the
fan $(V,E')$.  Add primes
for quantities associated to the fan $(V,E')$.  The two faces
$F_x$ and $F_z$ merge into a single face $F$ of $\op{hyp}(V,E)$.
Then 
\begin{equation}\label{eqn:U}
U= U_{x}\cup U_{z}\cup C^0(\e)
\end{equation} 
is a connected open set in $Y$.
If $F'\ne F_x,F_z$ is any other face in $\op{hyp}'$, then $U_{F'}$ is
a connected open set in $Y$.  Moreover, the set $U$ and sets $U_{F'}$
are disjoint and exhaust $Y$, so that the are precisely the topological
components of $Y$.  Some dart of $F$ leads into $U$, so $U=U_F$.  It follows
that the number of faces is equal to the number of topological components, so that the map $F\mapsto U_F$ is a bijection.

\begin{lemma} The area formula holds.
\end{lemma}

\begin{proof} Every topological component of $Y$ 
except $U$ is already a topological component of $Y'$ and the conclusion
holds for components of $Y'$.  The component $U$ is a disjoint union of two
components of $Y'$ and a set $C^0(\e)$ of measure zero.  Thus, it
is also measurable and eventually radial.  The solid angle formula is
additive over the disjoint union, so the formula holds for $U$.
\end{proof}
\indy{Index}{component!topological}

\begin{lemma}  For any dart $x$ on the face $F$, and dart $y\in F$ that is not adjacent to $x$ under the face map, 
$$
C^0(\{v(x),v(y)\} \subset U_F.
$$
\end{lemma}

\begin{proof}
By the minimality of $E$, it is enough to consider the merged face $F$.  
If $y=f^2x$, then the diagonal is precisely $C^0(\{v,w\})$,
which has already been established.  Otherwise, $y$ can be identified with
a dart of the face $F_z$ in the hypermap $\op{hyp}'$.  The conclusion holds
already for $U_{z}\subset U$.  
\end{proof}

%Next show the extra conclusion added at the beginning of the lemma.
%If the added diagonal is $\{v,w\}$, then $E''=E'$ and  have already
%checked that $N(V,E')+1=N(V,E)$.  Since $x$ was arbitrary,  may assume
%that $v(x)\in e$.  Let $E''' = E \cup \{e\, \{v,w\}\}$.  By the minimality,
%$N(V,E''') + 1 = N(V,E')$.  Also, $E''' = E''\cup \{\{v,w\}\}$.  The
%same argument that shows $N(V,E')+1=N(V,E)$ shows $N(V,E''')+1 = N(V,E'')$.
%Hence,
%$$
%N(V,E'')+1 = N(V,E''')+2 = N(V,E')+1 = N(V,E).
%$$

\begin{lemma} The given intersection of open half-spaces is equal
to the topological component. 
\end{lemma}
\indy{Index}{component!topological}

\begin{proof}
By the minimality of $E$, it is enough to consider
the merged face $F$ and its topological component $U=U_F$.
It will first be shown that the intersection $U'$ of half-spaces lies in $U$.
Every point in this intersection lies in the plane
$$
\op{aff}(\{\orz,v,w\})
$$
or in one of the two open half-planes bounded by this plane.  The intersection
of this plane with $U'$ is the blade $C^0(\{v,w\})$, which belongs
to $U$. The intersection of the two half-spaces, by the minimality of $E$,
belong to $U_{x}$ and $U_{y}$, which are subsets of $U$.  Thus, $U'\subset U$.

To prove the reverse inclusion, let $y$  be a dart of
the face $F$.  Claim: $U$ is a subset of the half-space with bounding
plane $\{\orz,v(y),v(f y)\}$.  Without loss of generality, assume that the edge $\{x,z\}$ of the
hypermap $\op{hyp}'$ satisfies $v(x) = v(y)$, as $x$ can be chosen at an
arbitrary node.  By the minimality of $E$,  
the partition \eqn{eqn:U} of $U$ gives three pieces
contained respectively in the three parts:
$$
W(x) \cup C^0(\{v,w\}) \cup W(x'),
$$
where $x,x'\in D'$ correspond to the single dart $y\in D$:
$$
\op{azim}(x) + \op{azim}(x') = \op{azim}(y) < \pi.
$$
Thus, $U$ itself is contained in the lune
$$
\op{wedge}(\{\orz,v(y)\},\{v(f y),v(f^{-1} y)\}),
$$
which is contained in the desired half-space.
\end{proof}

\section{Polygon}

This section goes into further detail about certain fans that are isomorphic to $H_{2k}$.
\indy{Notation}{h@$H_{2k}$}

\subsection{cyclic fan}

If $x$ is a dart in a fan's hypermap, set
$$
\bWdart(x) = \{ x\mid 0\le \op{azim}(\orz,v,w,x)\le \op{azim}(\orz,v,w,\sigma(v,w)).
$$
\indy{Notation}{Wdart@$\bWdart$ (closure of $\Wdart$)}
(It is the closure of $\Wdart(x)$, as defined above.)

\begin{definition}[cyclic fan]  A triple $(V,E,F)$ is a {\it cyclic fan} if the following conditions hold.
\begin{itemize} 
\item $(V,E)$ is a fan.
\item Its hypermap $H=\op{hyper}(V,E)$ is isomorphic to $H_{2k}$ for some $k\ge 3$.
\item $F$ is a face of the hypermap $H$ and $\op{azim}(x)\le \pi$ for all $x\in \pi$.
\item $V\subset \bWdart(x)$, for all $x\in F$.
\item If $\{v,w\}\in E$, then $\{0,v,w\}$ is not collinear.
\end{itemize}
\end{definition}
\indy{Index}{fan!cyclic}


\begin{lemma}  Let $(V,E,F)$ be a cyclic fan.  Let $x$ be a dart in the hypermap of $(V,E,F)$.  If for given $v,w\in V$  the triple $\{0,v,w\}$ is not collinear, then $C(\{v,w\}) \subset \bWdart(x)$.
\end{lemma}
\indy{Index}{fan!cyclic}

\begin{proof}  This is an elementary consequence of the definitions and the condition $V\subset \bWdart(x)$.
\end{proof}

\begin{lemma}  Let $(V,E,F)$ be a cyclic fan with hypermap $(D,e,n,f)$.  Then there exists a unique cyclic permutation $\phi:V\to V$ such that
\begin{itemize}
\item $(v,\phi v)\in D$, for all $v\in V$.
\item $f(v,w) = (w,\phi w)$, for all $(v,w)\in D$.
\end{itemize}
\end{lemma}
\indy{Index}{cyclic permutation}

\begin{proof}  This is immediate.
\end{proof}

\begin{definition}[perimeter]\label{lemma:mono}
Let $(V,E,F)$ be a cyclic fan with hypermap $(D,e,n,f)$.  Choose $v\in V$.  Set
$$
P=P(V,E,F) = \sum_{i=0}^{k-1} \arc(0,\phi^i v,\phi^{i+1} v).
$$
This is easily seen to be independent of the choice of $v\in V$.  Call $P$ the perimeter of the cyclic fan.
\end{definition}
\indy{Index}{perimeter!cyclic fan}
\indy{Index}{fan!cyclic}
\indy{Notation}{P@$P$ (spherical perimeter)}

\begin{definition}[generic,~lunar,~circular]
Say that a pair $(V,E)$ is {\it generic}, if for every $\{v,w\}\in E$,
and every $w'\in V$, 
$$
C\{v,w\}\cap \op{aff}_0^-(0,\{w'\}) = \emptyset.
$$
Say that a pair $(V,E)$ is {\it lunar} with poles $v,w\in V$ if $\{0,v,w\}$ is collinear.
Say that $(V,E)$ is {\it circular}, if there exists $w'\in V$ and $\{v,w\}\in E$ such that 
$$
C^0\{v,w\}\cap \op{aff}_0^-(0,\{w'\})\ne \emptyset.
$$
\end{definition}
\indy{Index}{generic}
\indy{Index}{lunar}
\indy{Index}{circular}

\begin{lemma} Let $(V,E,F)$ be a cyclic fan.  Then $(V,E)$ is
generic, lunar, or circular (exclusively).
\end{lemma}
\indy{Index}{fan!cyclic}
\indy{Index}{cyclic fan}
\indy{Index}{generic}
\indy{Index}{lunar}
\indy{Index}{circular}

\begin{proof} If it is not generic,  select find some $\{v,w\}\in E$
and some $w'\in V$ such that
$$
C\{v,w\}\cap \op{aff}_0^-(0,\{w'\}) \ne \emptyset.
$$
Now $C\{v,w\} = C^0\{v,w\} \cup\op{aff}^+(0,\{v\})\cup\op{aff}^+(0,\{w\}$.  
If the intersection meets $C^0\{v,w\}$, then $(V,E)$ is circular.  
If the intersection meets $\op{aff}^+(0,\{v\})\cup\op{aff}^+(0,\{w\}$,
then $(V,E)$ is lunar. 
\end{proof}

\begin{lemma}[monotonicity]  Let $(V,E,F)$ be a cyclic fan with hypermap $(D,e,n,f)$.  Let $k=\card(F)$; $x=(v_0,v_1)\in F$;  $v_r = \phi^r v_0$; $\alpha(r) = \op{azim}(0,v_0,v_1,v_r)$;  $x_r = f^r x = (v_r,v_{r+1})\in F\subset D$, for all $r$.  
One may distinguish three cases according to the manner in which the fan meets the ray $R(v_0) = \op{aff}_0^-(\{0\},\{v_0\})$:
{\bf (circular)~~} If for some $i$, $C^0\{v_i,v_{i+1}\}\cap R(v_0)\ne \emptyset$, then the following conditions hold.
\begin{itemize}
\item $0=\alpha(1)=\cdots \alpha(r);\quad \alpha(r+1)=\cdots\alpha(k-1)=\pi$.
\item $\op{azim}(x)=\pi$, for all $x\in D$.
\item The set $V$ lies in a plane through $0$.
\item The perimeter is $P=2\pi$.
\end{itemize}
{\bf (lunar)~~} If for some $i$, $\op{aff}_0^+(0,v_i) \cap R\ne\emptyset$, then the following conditions hold.
\begin{itemize}
\item $0=\alpha(1)=\cdots \alpha(r) < \alpha(r+1)=\cdots\alpha(k-1)\le\pi$.
\item $\op{azim}(x)=\pi$, for all $x\ne x_0,x_r\in F$.  Also, $0<\op{azim}(x_0)=\op{azim}(x_r)\le \pi$.
\item $\{0,v_0,v_r\}$ is contained in a line $L$, $\{0,v_0,\ldots,v_r\}$ lie in one half-plane bounded by $L$, and $\{v_r,v_{r+1},\ldots,v_0\}$ lie in another half-plane bounded by $L$.
\item The perimeter is $P=2\pi$.
\end{itemize}

{\bf (generic)~~} Now assume that for every choice of $(v,\phi v)\in F$ the previous conditions fail to be satisfied.  That is, the closed blades do not meet any of the rays $R(v)$, for $v\in V$.  Then for every $x=(v_0,v_1)\in F$, the following conclusions hold.
\begin{itemize}
\item $0=\alpha(1)\le \alpha(2)\le \cdots\le \alpha(k-1)\le\pi$.
\item If $\alpha(j)=\alpha(j-1)$, then by elementary geometry either $v_{j-1}\in C\{v_0,v_j\}$ or $v_j\in C\{v_{j-1},v_0\}$.  In the first case,
$\op{azim}(x_i)=\pi$, for $i=0,\ldots,j-1$.  In the second case,
$\op{azim}(x_i)=\pi$, for $i=j,\ldots,k-1$.
\end{itemize}
\end{lemma}

\begin{proof}  The proof procedes according to the case.

{\bf (circular)} Consider a spherical coordinate system $(r,\theta,\phi)$ with coordinates $(r_j,\theta_j,\phi_j)$ for $v_j$.  Without loss of generality, there is a coordinate system in which $\phi_0=0$, $\theta_r=0$, and $\theta_{r+1}=\pi$.  In these coordinates,  $v_0\in\bWdart(x_r)$ implies $\op{azim}(x_r)=\pi$, which in turn implies $\theta_{r-1}=0$.  Continuing by downward induction $v_0\in \bWdart(x_j)$ implies that $\op{azim}(x_j)=\pi$ and $\theta_j=0$.  By a similar induction $\theta_i=\pi$ and $\op{azim}(x_i)=\pi$, for $i=r+1,\ldots,k-1$.  For our choice of coordinates $\alpha(i)=\theta_i$.  This gives the first and second conclusions.  It follows that the points $v_j$ appear in consecutive order around the great circle $\theta=0,\pi$.  The perimeter is thus $2\pi$.

{\bf (lunar)}  The proof here is similar.  Choose coordinates for which $\phi_0=0$, $\phi_r=\pi$, $\theta_{r-1}=0$, $\theta_{r+1}\le\pi$.  Check that $v_0\in \bWdart(x_{r-1})$ implies that $\op{azim}(x_{r-1})=\pi$ and that $\theta_{r-2}=0$, and continue with a downward induction as before.  Similarly, an upward induction gives that $\theta_j=\theta_{r+1}$ and $\op{azim}(x_j)=\pi$, for $j\ge r+1$.  The first and second conclusions follow as before.  The first set of points are consecutive inside the plane $\theta=0$; the second set of points are consecutive inside the plane $\theta=\theta_{r+1}$.  The perimeter consists of two half-circles, and $P=2\pi$.

{\bf (generic)} Now consider the complementary case in which the closed blades do not meet any of the rays $R(v)$.  For the first claim one may assume by induction that $0\le \alpha(1)\ldots\cdots\ldots \alpha(i)$.  Pick spherical coordinates for which $\phi_0=0$, $\theta_1=0$, $\theta_i=\alpha(i)$, for all $i$.  Write the condition
$$
v_0\in \bWdart(x_i)
$$
as a determinant:
$$
\det(v_0,v_i,v_{i+1})\ge 0.
$$
In spherical coordinates, the determinant becomes
$$
\det(\cdots)= r_0r_ir_{i+1}\sin\phi_i\sin\phi_{i+1}\sin(\theta_{i+1}-\theta_i)\ge0.
$$
In this complementary case $\sin\phi_i\ne0$, $\sin\phi_{i+1}\ne0$ (when $i\ne 0,i+1\ne 0$).  From $x_j\in \bWdart(x_0)$, it follows that $0\le\theta_j\le\theta_{k-1}\le\pi$ for all $j$.  These inequalities give $\theta_i\le\theta_{i+1}$ (with a small extra argument for the degenerate case $(\theta_i,\theta_{i+1})=(0,\pi)$).  The first conclusion follows from $\theta_i=\alpha(i)$.

Assume $\alpha(j)=\alpha(j-1)$.  Consider the case $v_{j-1}\in C\{v_0,v_j\}$.    In this case, $\alpha(i)=\theta_i=0$, for $i=0,\ldots,j$.  The points $\{0,v_0,\ldots,v_j\}$ are then coplanar and $\op{azim}(x_i)=0$ for $i=0,\ldots,j-1$.  This gives the second conclusion. The other case $v_j\in C\{v_0,v_{j-1}\}$ follows by similar arguments.
\end{proof}

\begin{lemma}[internal blades]  Let $(V,E,F)$ be a cyclic fan.  Pick a dart $x=(v_0,v_1)\in V$.  Set $v_i = \phi^i v_0$ and $x_i = \phi^i x_i$.  Assume that there are four darts $(y_1,y_2,y_3,y_4)$, $y_j = x_{i(j)}$, with
$0\le i(1) < i(2) < i(3) < i(4)\le k-1$ 
such that $\op{azim}(y_j) < \pi$, for $j=2,4$.  
Then $C^0\{v_{i(1)},v_{i(3)}\} \subset \Wdart(x)$, for all $x\in F$.
\end{lemma}
\indy{Index}{blade!internal}
\indy{Index}{internal blade}

\begin{proof} The first case to consider is $x=y_1$.  Let $j=i(1)$ and $j' = i(3)$. For all $p\in C^0$, 
$$
0 < \op{azim}(0,v_{j},v_{j+1},p) < \op{azim}(0,v_j,v_{j+1},v_{j-1}).
$$  
This implies $p\in \Wdart(x)$ as desired.  The case $x=y_3$ is similar.

Now assume that $x=x_p\ne y_1,y_2$.  Then
$$
\Wdart(x) = \bWdart(x)\setminus (\op{aff}\{0,v_p,v_j\}\cup\op{aff}\{0,v_p,v_{j'}\}).
$$
Also, 
$$
\op{aff}\{0,v_p,v_j\}\cap C_0 \subset \op{aff}\{0,v_p,v_j\}\cap \op{aff}\{0,v_j,v_{j'}\} = \op{aff}\{0,v_j\}.
$$
However, the right-hand side is disjoint from $C_0$.  Thus, $C_0$ is disjoint from $\op{aff}\{0,v_p,v_j\}$ and is similarly disjoint from $\op{aff}\{0,v_p,v_{j'}$.  The result follows.
\end{proof}

\begin{definition} Let $(V,E,F)$ be a cyclic fan.  Pick $v\ne w\in V$.
Let
$$
\begin{array}{lll}
V[v,w] &= \{v,\phi v,\phi^2 v,\ldots,v_j\}\\
E[v,w] &= E \cup \{\{v,w\}\}\\
F[v,w] &= \{(v,\phi v),(\phi v,\phi^2 v),\ldots,(\phi^{-1}w,w)\}.
\end{array}
$$
\end{definition}
\indy{Index}{fan!cyclic}

To allow for more than one cyclic fan $(V,E,F)$,  expand the notation, writing $\op{azim}(H,v)$ for $\op{azim}(x)$, when $x=(v,\phi v)$ is the dart in the hypermap $H$ in the face $F$ at node $v$.  Similarly, write $\Wdart(H,v)$ for $\Wdart(x)$, and so forth.
\indy{Notation}{azimhv@$\op{azim}(H,v)$}
\indy{Notation}{wdart@$\Wdart$}


\begin{lemma}[slicing a cyclic fan]  Let $(V,E,F)$ be a cyclic fan with hypermap $H$.  Let $v,w\in V$ be such that $\{0,v,w\}$ is not collinear.  Assume that $C^0\{v,w\}\subset W(x)$ for all darts $x$ in the fan of $(V,E,F)$. Then
\begin{itemize}
\item $(V[v,w],E[v,w],F[v,w])$ and $(V[w,v],E[w,v],F[w,v])$ are cyclic fans.  
\item Let $H'$ and $H''$ be their hypermaps, respectively.  Let $\rho:V\to\ring{R}$ be any function.  Then
$$
\sum_{v\in V} \rho(v)\op{azim}(H,v) = \sum_{v\in V[v,w]}\rho(v)\op{azim}(H',v) + \sum_{v\in V[w,v]}\rho(v)\op{azim}(H'',v).
$$
\end{itemize}
\end{lemma}
\indy{Index}{slice}
\indy{Index}{fan!cyclic}

\begin{proof}
XX finish

The second claim follows from the following identities.
If $w'\ne v,w$ with $w'\in V[v,w]$, then
$$
\Wdart(H,w')=\Wdart(H',w'),\quad \op{azim}(H,w') = \op{azim}(H',w').
$$
If $w'\in\{v,w\}$, then
$\op{azim}(H,w')=\op{azim}(H',w') +\op{azim}(H'',w')$.
\end{proof}

\subsection{deformation}

This section considers deformations of a cyclic fan $(V,E,F)$.

\begin{definition}
A deformation of a cyclic fan is a family $t\mapsto (V(t),E(t),F(t))$, for $t\in I\subset\ring{R}$, such that $(V(0),E(0),F(0))$ is a cylic fan and such that the combinatorial data remains fixed:
$$
\begin{array}{lll}
\card(V(t)) &= \card(V(0)),\\
E(t)&=\{\{v(t),w(t)\}\mid \{v(0),w(0)\}\in E(0)\},\\
F(t)&= \{(v(t),w(t)) \mid  (v(0),w(0))\in F(0)\}.
\end{array}
$$
\end{definition}
\indy{Index}{deformation}
\indy{Index}{fan!cyclic}

In the definition of a deformation, it is not required that $(V(t),E(t),F(t))$ is a cyclic fan for all $t\in I$, although this this will usually be the case.  Let $H=(D,e,n,f)$ be the hypermap of $(V(0),E(0),F(0))$.  Extend $\phi:V\to V$ to $\phi(t):V(t)\to V(t)$; extend $x=(v,w)\in D$ to $x(t)=(v(t),w(t))$; extend $\op{azim}(x)$, for $x\in D$,  to $\op{azim}(x(t))$; extend $\bWdart(x)$ to $\bWdart(x(t))$, and so forth. 


Consider a lunar cyclic fan $(V,E,F)$ with poles $v_0,v_r\in V$.  (That is, $\{0,v_0,v_r\}$ is a collinear set.)   Pick spherical coordinates such that $\phi_0=0,\phi_r=\pi$.  $\phi_1=0$, $\phi_{k-1}\le\pi$.  Consider the deformation $t\mapsto (V(t),E(t),F(t))$ such that the spherical coordinates of $v_i(t)$ are
$$
r_i(t)=r_i,\quad \phi_i(t)=\phi_i,\quad \theta_i(t) =
\begin{cases} 
   (1-t) \theta_i & 0\le i< r\\ 
   \theta_i & \text{otherwise}
\end{cases}
$$
\indy{Index}{lunar}
\indy{Index}{spherical coordinates}

\begin{lemma} Let $(V,E,F)$ be a lunar cylic fan with poles $v_0,v_r$.  In the particular deformation as described, the triple $(V(t),E(t),F(t))$ is a lunar cyclic fan for all $0\le t< 1$.
\end{lemma}

\begin{proof}  The proof consists of checking off all of the properties of a lunar cyclic fan, one by one.  In brief, it Is fan.  Its hypermap is isomorphic to $H_{2k}$.  The azimuth angles of the darts in $F(t)$ are at most $\pi$.  The set $V(t)$ is contained in $\bWdart(x(t))$ for all darts $x(t)\in F(t)$.
\end{proof}
\indy{Index}{angle!azimuth}

Next  consider a deformation of a generic cyclic fan.



\begin{lemma} Let $I = \{t\mid 0\le t\le t_1\}$ or $I=\{t\mid 0\le t < t_1\}$.  Let $t\mapsto (V(t),E(t),F(t))$, for $t\in I$, be a deformation of a cyclic fan.  Suppose that 
\begin{itemize} 
\item $\op{azim}(x(t))\le \pi$ for all (extensions $x(t)$ of) $x(0)\in D$.
\item $0 < \arc(v_i(t),v_{i+1}(t)) < \pi$, for all $t$ and all $i$.
\item $(V(t),E(t))$ is generic, for $0\le t<t_0$.
\end{itemize}
Then $(V(t),E(t),F(t))$ is a cyclic fan for all $t\in I$.
\end{lemma}
\indy{Index}{fan!cyclic}
\indy{Index}{deformation}

\begin{proof}
XX
\end{proof}

%%%%%%%%%%%





\begin{lemma}\guid{WSEWPCH}\tlabel{lemma:convex-hyper}\rating{400}
Let $(V,E,F)$ be a cyclic fan.  Then the perimeter $P$ of the fan is at most $2\pi$.
\end{lemma}
\indy{Index}{fan!cyclic}
\indy{Index}{perimeter}

\begin{proof} In Lemma~\ref{lemma:mono}, the perimeter has already been shown to be exactly $2\pi$, when the cyclic fan is circular or lunar.  Without loss of generality, assume the generic case.

Suppose for a contradiction that the lemma is false.  Consider all counterexamples with the smallest cardinality $V$.  Among all such counterexamples, pick a counterexample with the largest number of darts $x\in D$ such that $\op{azim}(x) = \pi$.

A cyclic fan $(V,E,F)$ is determined by $V$ and the permutation $\phi:V\to V$:  $E=\{\{v,\phi v\}\mid v\in V\}$ and $F = \{(v,\phi v)\mid v\in V\}$.

In this particular counterexample, if there is any dart $x=(v,w)\in F$ with $\op{azim}(x)=\pi$, then there is a new cyclic fan $(V',E',F')$ with $V' = V\setminus\{v\}$ and $\phi':V'\to V'$ given as 
$$
\phi'(u) = \begin{cases}
\phi(u) & \phi(u)\ne v\\
\phi(v) & \phi(u) = v\\
\end{cases}
$$
This is a cyclic fan with the same perimeter, contrary to the presumed minimality of the counterexample.  Thus $\op{azim}(x) <\pi$, for all $x\in F$.

If $\card(V) <3$, then the cyclic fan is circular or lunar, which has aleady been treated.  If $\card(V)=3$, then $V=\{v_1,v_2,v_3\}$.  By the triangle inequality $\arc_V(0,\{v_2,v_3\}) \le \arc_V(0,\{v_2,-v_1\})+\arc_V(0,\{-v_1,v_3\})$.  Thus,
$$
P \le(\arc_V(0,\{v_1,v_2\})+\arc(0,\{v_2,-v_1\}))+(\arc_V(0,\{v_1,v_3\})+\arc_V(0,\{v_3,-v_1\})) = \pi+\pi.
$$

Now assume that $\card(V)\ge 4$.  Consider a deformation of the cyclic fan $t\mapsto (V(t),E(t),F(t))$ that fixes $v_i$, for $i\ne 0$ and gives motion to $v_0(t)$ along the plane $\{0,v_0,v_1\}$ in the direction to increase $\arc_V(0,\{v_0(t),v_1\})$.  This is increasing in the perimeter.  Eventually, for some $t$ a non-generic cyclic fan is reached (and the perimeter increases to $2\pi$) or some $\op{azim}(x(t))=\pi$ (and the minimality condition fails).  Either way, the proof is complete. 
\end{proof}

\begin{proof} {\bf [polar polygon]} A fan does not have any faces of cardinality less than three.
Every blade of the fan has radian measure less than $\pi$.  
\indy{Index}{polygon!polar}

Consider the case of a spherical triangle.  If the edges of the
the triangle are $a_i$ and the angles of the polar
triangle are $\alpha'_i$, then $\alpha'_i+a_i=\pi$.
The the perimeter is 
$$a_1+a_2+a_3 = 2\pi - (\alpha'_1 -\alpha'_2 - \alpha'_3-\pi) < 2\pi,$$
because the area of the polar triangle is always strictly positive.
\indy{Index}{triangle!spherical}

Similarly, if the sides of the faces of the spherical polygon are
$a_i$, then the angles of the polar polygon are $\alpha'_i = \pi-a_i$.
The perimeter is
$$
a_1+\cdots+a_n  = 2pi- A< 2\pi,
$$
where $A = 2\pi-\sum a_i$ is the area of the polar polygon.
%~\cite[p.261]{williamson:2008}.
\end{proof}



\section{Polyhedron}

This section shows that a polyhedron determines a fan.  It begins by recalling basic terminology about affine and convex sets.


An affine space $A\subset\ring{R}^n$ is a translate $A=v + V$ of
a vector subspace of $\ring{R}^n$.  The dimension of an affine space $A$
is the vector space dimension of $V$.  The
affine hull of $C\subset\ring{R}^n$ is the smallest affine space containing $C$.  The affine dimension of $C$ ($\dimaff(C)$) is the dimension of its affine hull.  By convention, the affine dimension of the emptyset is $-1$.
\indy{Index}{affine}
\indy{Index}{vector space}
\indy{Index}{dimension}
\indy{Index}{vector space!affine}
\indy{Index}{affine hull}

\begin{definition}[relative interior,~relative boundary] Let $C\subset\ring{R}^n$ be a closed convex set with affine hull $A$.   An interior point $p$ of $C$ is a point that contains a neighborhood entirely contained in $C$.  A point $p$ of $C$ is in the relative interior of $C$ if there is a neighborhood $N$ of $p$ such that $N\cap A\subset C$.  Let $\op{ri}(C)$ be the set of relative interior points.  The complement $C\setminus \op{ri}(C)$ is the relative boundary of $C$.
\end{definition}
\indy{Index}{convex}
\indy{Index}{affine hull}
\indy{Index}{interior!relative}
\indy{Index}{relative boundary}

\begin{definition}[face,~facet,~edge,~vertex]
The relative boundary of $C$.  A face $F$ of $C$ is the intersection of $C$ with the bounding hyperplane of a half-space containing $C$.  A face is proper if it is a proper subset of $C$.    A vertex (and edge) is a face of $C$ of affine dimension $0$ (and $1$, respectively).   A facet of $C$ is a proper face of affine dimension $\dimaff(C)-1$.
\indy{Index}{face}
\indy{Index}{facet}
\indy{Index}{edge}
\indy{Index}{vertex}
\indy{Index}{dimension} 
% A point $u\in C$ is an extreme point of $C$, if for every $v,w\in C\setminus\{u\}$, the point $v$ is not of the form $t v + (1-t) w$, with $0\le t\le 1$.
\end{definition}

%\begin{lemma}[Krein-Millman] Every compact convex set $C\subset\ring{R}^n$ is the convex hull of its set of extreme points.
%\end{lemma}
%
%\begin{proof}  See \cite[Theorem~3.3]{barvinok:2002}.
%\end{proof}

\begin{definition}[polyhedron]  A polyhedron is the intersection of
a finite number of closed half-spaces in $\ring{R}^n$.
\end{definition}
\indy{Index}{polyhedron}

A polyhedron is closed and convex.  A face of a polyhedron is a polyhedron. %A bounded polyhedron falls within the scope of the Krein-Millman theorem.  In particular, a bounded polyhedron is the convex hull of its finite set of vertices.
\indy{Index}{closed}

Let $C\subset\ring{R}^n$ be a bounded polyhedron with affine hull $A$. Write 
$$
C = A \cap H^+_1 \cap \cdots \cap H^+_r,
$$
where
$H^+_i = \{x\mid a_i\cdot x \le b_i\}$ with bounding hyperplane
$H_i=\{x\mid \cdot x = b_i\}$. Assume that this representation is minimal in the sense that none of the factors $H^+_i$ may be omitted.  Let $F_i = H_i\cap C$.
\indy{Notation}{C (polyhedron)}


\begin{lemma}\label{lemma:webster}  
Let $C\subset\ring{R}^n$ be a bounded polyhedron.
\indy{Index}{polyhedron}
\begin{itemize}
\item The facets of $C$ are $F_i$, $i=1,\ldots,r$.
\item The relative boundary of $C$ is $F_1\cup\cdots F_r$.
\item Every face $F$ is the intersection of the facets that contain it.
\item Every face of a face of $C$ is a face of $C$.
\end{itemize}
\end{lemma}
\indy{Index}{facet}
\indy{Index}{relative boundary}
\indy{Index}{face}

\begin{proof} See \cite{webster:1994}.
\end{proof}

\begin{definition} Let $C$ be a bounded polyhedron.
Let $V_C$ be the set of vertices of $C$.  Let $E_C$ be the set of pairs $\{v,w\}$ of vertices such that $\op{conv}\{v,w\}$ is an edge of $C$.
\end{definition}
\indy{Index}{polyhedron}
\indy{Notation}{Ec@$E_C$ (edge)}

\begin{lemma}\guid{JLIGZGS}\label{lemma:polyhedron}% \rating{800} including azim<pi.
Let $C$ be a bounded polyhedron with the interior point $0$.
Then $(V_C,E_C)$ is a fan.
\end{lemma}
\indy{Index}{fan}

\begin{proof} The properties of a fan can be checked one by one.
\end{proof}

\begin{lemma} Let $C$ be a bounded polyhedron with $0$ as an interior point.  Let $(V_C,E_C)$ be the associated fan.  There is a bijection between the facets of $C$ and the topological components of $Y(V_C,E_C)$ given by 
$$
F \mapsto W_F = \{t x \mid x\in \op{ri}(F),~t >0\}.
$$
\end{lemma}
\indy{Index}{component!topological}

\begin{proof} It is enough to check that the sets $W_F$ have the following properties:
\begin{itemize}
\item Each $W_F$ is open and connected.
\item The sets $W_F$ are pairwise disjoint.
\item The map $F\mapsto W_F$ is one-to-one.
\item The union of the sets $W_F$ is $Y(V_C,E_C)$.
\end{itemize}
\end{proof}
\indy{Index}{connected}


\begin{lemma} Let $C$ be a bounded polyhedron with $0$ as an interior point.  Let $\op{hyper}(V_C,E_C)$ be the associated hypermap.  For every dart $x$ in the hypermap, $\op{azim}(x) < \pi$.
\end{lemma}
\indy{Index}{polyhedron}
\indy{Index}{interior!point}
\indy{Index}{hypermap}
\indy{Index}{dart}

\begin{proof}   The dart $x=(v,w)$ leads into some topological component $W_F$, attached to some facet $F$ of $C$.  The relative interior of $F$ is contained in $\Wdart(x)$.  The facet $F$ is contained in $\bWdart(x)$. This is a wedge with two bounding half-planes, with union $A$.  The relative interior of $F$ does not meet $A$.   The vertex $v$ is a face of $F$.  The vertex $v$ is the intersection of edges (that is, facets) of $F$ containing $v$.  These edges are contained in $A$.  Each of the two half-plane comprising $A$ contains such an edge. 
\indy{Index}{component!topological}
\indy{Index}{dart}
\indy{Index}{wedge}
\indy{Index}{vertex}
\indy{Index}{interior!relative}

If $\op{azim}(x)>\pi$, the segment between points chosen on the relative interiors of edges (of $F$ meeting $v$) in the two different bounding half-planes is not contained in $\bWdart$.  This is contrary to the convexity of $F$.
\indy{Index}{convex}
\indy{Notation}{azim}

If $\op{azim}(x)=\pi$, then $A$ is a half-plane.  By the definition of face, the intersection $A\cap F$ is a proper face of $F$.  This face contains an edge and must therefore be a single edge.  However, it is already established that $A\cap F$ contains at least two edges.  This is absurd.  Hence $\op{azim}(x)<\pi$.
\end{proof}


