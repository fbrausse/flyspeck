\chapter{Fan}\label{sec:fan}




\begin{summary}
This chapter is the final foundational chapter.  The main concept is
that of a fan.  A fan is a geometric object that bridges the expanse
between sphere packings and hypermaps.  A fan determines a set $V$
of points in $\ring{R}^3$.  Later chapters will interpret the set
$V$ as the set of centers of a packing of congruent balls.  The same
set $V$ can be interpreted as the set of nodes of a hypermap, or as
he set of nodes of a graph.  In fact, a fan might be viewed as a
particular geometric realization of a hypermap.  The main result is
an Euler formula for fans.  This formula implies that the hypermap
of a fan is planar.  The proofs have been carefully organized to
avoid any use of the Jordan curve theorem.


A bridge also connects polyhedra with fans.  This chapter associates
a fan with every bounded polyhedron in $\ring{R}^3$ that contains
the origin in its interior.  A consequence of this association is
the Euler formula for polyhedra.
\end{summary}


\indy{Index}{fan}%
\indy{Index}{hypermap}%
\indy{Index}{planar}%
\indy{Index}{packing}%
\indy{Index}{Jordan curve theorem}%

\section{Definitions}



\begin{remark}
Some may have already encountered other mathematical objects that go
by the name of fan.  The definition of fan here is unrelated to its
definitions in other mathematical contexts.  In particular, a fan in
this book is not a fan from the theory of toric varieties.
\end{remark}

% In this chapter, a choice of base point $\orz\in\ring{R}^3$ serves
% as the origin.  It does no harm to assume, in fact, that $\orz =0$.


If $S\subset\ring{R}^3$ is a set of points,
abbreviate
\begin{displaymath}
\begin{array}{lll}
C_\pm(S) &= \op{aff}_\pm(\orz,S),\\
C^0_\pm(S) &= \op{aff}^0_\pm(\orz,S).\\
\end{array}
\end{displaymath}
When the subscript is absent, the subscript $+$ is implied: $C_+(S)
= C(S)$, and so forth.  The parentheses around $S$ are frequently
omitted:
\begin{displaymath}C^0\{\v,\w\}=C^0_+(\{\v,\w\}) =
\op{aff}^0_+(\{\orz\},\{\v,\w\}).\end{displaymath}

\begin{definition}[fan,~blade]  
Let $(V,E)$ be a pair consisting of a set $V\subset \ring{R}^3$ and
a set $E$ of unordered pairs of distinct elements of $V$.  The pair
is said to be a \newterm{fan\/} if the following properties hold.
\begin{nomerate}
\item \case{cardinality} $V$ is finite and  nonempty,
\item \case{origin} $\orz\not\in V$.
\item \case{non-parallel} If $\{\v,\w\} \in E$, then $\v$ and $\w$
are not parallel.
\item \case{intersection}
For all $\ee ,\ee '\in E \cup \{\{\v\}\mid \v\in V\}$, 
\begin{displaymath}C(\ee )\cap C(\ee ') = C(\ee \cap \ee
').\end{displaymath}
\end{nomerate}
When $\ee\in E$, call $C^0(\ee)$ or $C(\ee)$ a \newterm{blade\/}
of the fan.
\end{definition}
\indy{Index}{fan}%
\indy{Notation}{V@$( V, E ) $ (fan)}%
\indy{Index}{V@\uncase{cardinality}}%
\indy{Index}{origin@\uncase{origin}}%
\indy{Index}{parallel@\uncase{non-parallel}}%
\indy{Index}{intersection@\uncase{intersection}}%
\bigskip\hbox{~}\bigskip


% Repeat an older version of the definition (in use between May 15
% 2009 and June 18 2009).
% \begin{definition}[retro-fan] Let $(\orgz,V,E)$ be a triple
%   consisting of a point, a set of points, and a set of pairs of
%   elements of $V$.  The triple is said to be a \newterm{retro-fan\/}
%   if the following conditions hold.
%    \begin{itemize}
%    \item $V$ is finite and nonempty.
%    \item $\orz\not\in V$.
%    %\item Each element of $E$ has two elements.
%    \item For each $\v\in V$, the set
%        \begin{displaymath}
%        %%          WW changed notation from E_\v to E(\v) to allow
%        %%          deformations E_t
%        E(\v) = \{\w\in V\mid \{\v,\w\}\in E\}
%        \end{displaymath}
%        is cyclic with respect to $(\orz,\v)$.
%    \item For each $\ee\in E$, $V\cap C^0(\orz,\ee)=\emptyset$.
%    \item  Sets $\ee,\ee'\in E$ give
%      \begin{displaymath}C^0(\orz,\ee) \cap
%        C^0(\orz,\ee')\ne\emptyset\ \Rightarrow (\ee =
%        \ee').\end{displaymath}
%    \item Sets $\v,\v'\in V$ give
%      \begin{displaymath}\op{aff}^0_+(\orz,\v) =
%        \op{aff}^0_+(\orz,\v')\ \Rightarrow
%        (\v=\v').\end{displaymath}
%      %% Added condition May 15, 2009./ killed June 18
%    \end{itemize}
%\end{definition}

\begin{lemma}\guid{CTVTAQA}\rating{40}\label{lemma:subset-fan}
If $(V,E)$ is a fan, then for every $E'\subset E$, $(V,E')$ is also
a fan.
\end{lemma}

\begin{proof} This is immediate.
\end{proof}

\begin{lemma}\guid{XOHLED}\rating{ZZ}  Let $(V,E)$ be a fan.
For each $\v\in V$, the set
\begin{displaymath}
E(\v) = \{\w\in V\mid \{\v,\w\}\in E\}
\end{displaymath}
is cyclic with respect to $(\orz,\v)$.
\end{lemma}
\indy{Notation}{E@$E(\v)$ (edge set)}%

\begin{proof}  If $\w\in E(\v)$, then $\v$ and $\w$ are not parallel.
Also, if $\w\ne \w'\in E(\v)$, then
\begin{displaymath}
C\{\v,\w\}\cap C\{\v,\w'\} = C\{\v\}.
\end{displaymath}
This implies that $E(\v)$ is cyclic.
\end{proof}

\begin{remark}\tlabel{rem:fan}\rating{30}
\begin{itemize}
\item The pair $(V,E)$ is a graph with nodes $V$ and edges $E$.  The set
\begin{displaymath}\{\{\v,\w\}\mid \w\in E(\v)\}\end{displaymath} is
the set of edges at node $\v$.  There is an evident symmetry: $\w\in
E(\v)$ if and only if $\v\in E(\w)$.
%
\item
Since $E(\v)$ is cyclic,
each $\v\in V$ has an azimuth cycle $\sigma(\v):E(\v)\to E(\v)$.
It is allowed that $E(\v) = \{\w\}$,  a
\indy{Index}{azimuth cycle}%
singleton set. If so,
$\sigma(\v)$ is the identity map on $E(\v)$.
%
To make the notation less cumbersome, $\sigma(\v,\w)$ denotes the
value of the map $\sigma(\v)$ at $\w$.
%
\item The property \case{non-parallel} implies that the graph has no
loops: $\{\v,\v\}\not\in E$.
%
\item The property \case{intersection} implies that distinct sets
$C^0(\ee)$ do not meet.  This property of fans will eventually be
related to the property of planarity of hypermaps.
\indy{Index}{hypermap}%
\indy{Index}{planar}%
\indy{Index}{edge (graph)}%
\indy{Index}{edge (fan)}
%
\end{itemize}
\end{remark}

\begin{remark}[verifying the fan properties]\label{remark:fan-verify}  
We will often be presented with a pair $(V,E)$ and asked to verify
that it is a fan.  Here are a few tips about how to verify the fan
properties in practice.
\begin{nomerate} 
\item \case{cardinality} If $V$ is defined as a subset of or as the image of a
finite set, then it is evidently finite.  Also, if $V$ is a bounded
subset of $\ring{R}^3$ and if there is a minimum distance between
distinct points of $V$, then $V$ is finite.
Lemma~\ref{lemma:V-finite} gives the finiteness result when the
minimum distance is $2$.\vspace{6pt}
\item \case{origin} If $(V,E)$ is a fan, then any subset of $V$
inherits the property $\orz\not\in V$ from $V$.  \vspace{6pt}
\item \case{non-parallel} \claim{If the property \case{intersection}
is known, then to prove that $\u$ and $\v$ are not parallel, it is
enough to show the strict form of the triangle inequality:}
\begin{equation}\label{eqn:strict-triangle}
\norm{\u}{\v} < \normo{\u} + \normo{\v}.
\end{equation}
Indeed, the strict form of the triangle inequality implies that
$\orz\not\in \op{conv}\{\u,\v\}$.  Also, the intersection property
implies that $C^0\{\v\} \cap C^0\{\u\} = \emptyset$.  These conditions
imply that $\u$ and $\v$ are not parallel.  The inequality~(\ref{eqn:strict-triangle})
is equivalent to
\begin{displaymath}
\arc_V(\orz,\{\u,\v\}) < \pi.
\end{displaymath}
\item \case{intersection} The intersection property is generally the
most difficult to verify in practice.  Some geometrical reasoning
based on additional facts about $(V,E)$ is generally required to
verify the intersection property.  If $(V,E)$ is a fan, then the
intersection property is inherited by subsets of $V$ and $E$.  Also,
note that
\begin{displaymath}
C(\ee\cap \ee') \subset C(\ee) \cap C(\ee')
\end{displaymath}
always holds by elementary geometry.  Hence it is enough to check the
reverse inclusion.  Furthermore, if $\ee = \ee'$, then the
intersection property is a triviality.  The verification comes down to
checking two cases:
\begin{displaymath}
C(\ee) \cap C(\ee') = \{\orz\},
\end{displaymath}
when $\ee\cap \ee' = \emptyset$, and
\begin{displaymath}
C(\ee)\cap C(\ee') = C\{\v\},
\end{displaymath}
when $\ee\cap \ee' = \{\v\}$.
\end{nomerate}
\end{remark}


Let $(V,E)$ be a fan.  Define a set of darts $D$ to be the union of
two subsets $D_1,D_2$:
\begin{displaymath}
\begin{array}{lll}
D_1 &= \{(\v,\w)\mid \{\v,\w\}\in E\}\\
D_2 &= \{(\v,\v) \mid \v\in V,\ \ E(\v) = \emptyset\},\\
D   &= D_1\cup D_2.
\end{array}
\end{displaymath}
Darts in $D_2$ are said to be \newterm{isolated}; and darts in
$D_1$ are \newterm{non-isolated}.
%
\indy{Index}{dart}%
\indy{Index}{dart!isolated}%
\indy{Index}{dart!non-isolated}%
\indy{Index}{isolated}%
\indy{Index}{non-isolated}%
\indy{Notation}{D@$D$ (dart)}%

Define a permutation $n$ on $D_1$ by
\begin{displaymath}n(\v,\w) = (\v,\sigma(\v,\w)).\end{displaymath}
Define a permutation $f$ on $D_1$ by
\begin{displaymath}
f (\v,\w) = (\w,\sigma(\w)^{-1} \v).
\end{displaymath}
Define a permutation $e$ on $D_1$ by
\begin{displaymath}
e (\v,\w) = (\w,\v).
\end{displaymath}
Define permutations $e,n,f$ on $D_2$ by making them degenerate on $D_2$:
\begin{displaymath}
e (\v) = n(\v) = f(\v) = \v.
\end{displaymath}
Set %$\op{hyp}_r(V,E)=(D_1,e,n,f)$ and 
$\op{hyp}(V,E)=(D,e,n,f)$. %for %  them the non-isolated hypermap
%the hypermap associated with $(V,E)$.  
The next lemma shows that $(D,e,n,f)$ is indeed a hypermap.



\begin{lemma}\guid{AAUHTVE}\rating{70}
Let $(V,E)$ be a fan.  Let $D = D_1\cup D_2$
and $\op{hyp}(V,E) = (D,e,n,f)$, as constructed above.  Then
\begin{itemize}
\item $\op{hyp}(V,E)$ is a plain hypermap.
\item  $e$ has no fixed
points in $D_1$.
\item  $f$ has no fixed points in $D_1$.
\item For every pair of distinct nodes, there is at most one
edge meeting both.
\item The two darts of an edge of $D_1$ lie at different nodes.
\end{itemize}
\indy{Notation}{hyp@$\op{hyp}$ (hypermap)}%
\end{lemma}

\begin{proof}  
\begin{displaymath}
\begin{array}{lll}
e(n(f(\v,\w))) &= e(n(\w,\sigma(\w)^{-1} \v))) &=
e(\w,\v)\\ 
&= (\v,\w).
\end{array}
\end{displaymath}
So $\op{hyp}(V,E)$ is a hypermap. 
Plainness is an elementary calculation:
\begin{displaymath}e(e(\v,\w)) = e(\w,\v) = (\v,\w).\end{displaymath}
A fixed point in $D_1$ under $e$ would force $\v = \w\in E(\v)$,
but by construction $\v\not\in E(\v)$.  The argument that $f$ has no
fixed points is similar.

The next step is to show that for every pair of distinct nodes, there
is at most one edge meeting both.  That is,
\begin{displaymath}(n^k e x = e n^\ell x)\Rightarrow (n^\ell x =
x).\end{displaymath} Let $x = (\v,\w)\in D_1$.  Let
$\sigma=\sigma(\v)$. Then
\begin{displaymath}
\begin{array}{lllllll}
n^\ell x &= (\v,\sigma^\ell \w)\\
e n^\ell x &= (\sigma^\ell \w,*)\\
e x &= (\w,*)\\
n^k e x &= (\w,*)\\
n^k e x &= e n^\ell x \\&\ \Rightarrow (\w = \sigma^\ell \w) \\&\ \Rightarrow
(n^\ell x = (\v,\w) = x)
\end{array}
\end{displaymath}

Finally,  each dart of an edge lies on a different node.
That is, $e x \ne n^k x$, for $x\in D_1$.   In detail:
\begin{displaymath}
\begin{array}{lll}
e(\v,\w) &= (\w,*),\quad \w\in E(\v)\\
n^k(\v,\w) &= (\v,*),\quad \v\not\in E(\v).
\end{array}
\end{displaymath}
The result follows.
\end{proof}

\section{Topology}\label{sec:topology}

\subsection{background}

%There is hardly any topology that comes up in this book.  Most of
%what is needed appears in this chapter.  
This chapter uses some basic
notions in topology such as continuity, connectedness, and compactness.

\begin{remark} The term {\it ``connected''} is now being used in two
different senses: in the topological sense and in a combinatorial
sense for hypermaps.  To reduce the confusion, this book calls the
connected components of a topological space \newterm{topological
components} and the connected components of a hypermap
\newterm{combinatorial components}.
\end{remark}
\indy{Index}{connected}%
\indy{Index}{connected!topological component}%
\indy{Index}{connected!combinatorial component}%


Basic facts about the topology of Euclidean space will be assumed.  In
particular, the set $\ring{R}^3$ is a metric space under the Euclidean
distance function $d(\v,\w) = \norm{\v}{\w}$.  Every subset of
$\ring{R}^3$ is a metric space under the restriction of the metric $d$
to the subset.  A subset carries the metric space topology.  In
particular, \begin{displaymath}S^2 = \{ \v \mid \normo{ \v} =
1\},\end{displaymath} the unit sphere in $\ring{R}^3$ centered at
$\orz$, is a metric space and a topological space.
\indy{Index}{metric space} %

If $Y$ is an open set in $\ring{R}^3$, write
$\comp{Y}$ for its set of topological components.
\indy{Notation}{1@$\comp{Y}$ (topological components)}%
The family of topological components of $Y$ has the following properties:
the members are pairwise disjoint, nonempty, connected open sets; and the
union of the family is all of $Y$.
Conversely, any family with these properties must be the
family of topological components of $Y$.
If two
points in $\ring{R}^3$ 
can be joined by a continuous path in $Y$,
then the two points lie in the same topological component of $Y$.
\indy{Index}{path connected}%
\indy{Index}{connected!topological component}%
\indy{Notation}{1@$\comp{Y}$ (topological components)}%







\subsection{topological component and dart}

Let $(V,E)$ be a fan and let $(D,e,n,f) = \op{hyp}(V,E)$
be the associated hypermap.  
\indy{Index}{fan}%
\indy{Index}{dart}%
\indy{Index}{hypermap}%

\begin{definition}[X,~Y]\label{def:XY}
Let $(V,E)$ be a fan.  Let $X=X(V,E)$ be the union of the
blades
\begin{displaymath}C(\ee)\end{displaymath}
as $\ee$ ranges over $E$.  Let $Y=Y(V,E)$ be the complement
$Y = \ring{R}^3\setminus X$.
\indy{Notation}{X@$X$ (fan)}%
\indy{Notation}{Y@$Y$ (fan)}%
\end{definition}


A wedge $\Wdart(x)$, a subset $\Wdart(x,\epsilon)$,
and an azimuth angle $\op{azim}(x)$ are associated with
with each dart $x=(\v,\w)\in D$.  Define 
\indy{Index}{wedge}%
\indy{Index}{angle!azimuth}%
\indy{Index}{azimuth}%
\indy{Index}{dart}%
\indy{Notation}{Wdart@$\Wdart$ (wedge)}%
\indy{Notation}{azim}%
\begin{displaymath}
\Wdart(x)=
\begin{cases} 
W^0(\orz,\v,\w,\sigma(\v,\w)),&\text{if }\card(E(\v))>1,\\
\ring{R}^3\setminus \op{aff}_+(\{\orz,\v\},\w),&\text{if } E(\v) = \{\w\},\\
\ring{R}^3\setminus \op{aff}\{\orz,\v\},&\text{if } E(\v) = \emptyset.\\
\end{cases}
\end{displaymath}
Define
\begin{displaymath}
\bWdart(x) = 
\begin{cases} 
W(\orz,\v,\w,\sigma(\v,\w)),&\text{if }\card(E(\v))>1,\\
\ring{R}^3,&\text{otherwise }.\\
\end{cases}
% \{ \u\mid 0\le \op{azim}(\orz,\v,\w,\u)\le
% \op{azim}(\orz,\v,\w,\sigma(\v,\w)) \}.
\end{displaymath}
\indy{Notation}{Wdart@$\bWdart$ (closure of $\Wdart$)}%
($\bWdart(x)$ is the closure of $\Wdart(x)$.)


Define $\op{azim}(x)$ as the azimuth angle of $\Wdart(x)$:
\indy{Notation}{azim}%
\begin{displaymath}
\op{azim}(x)=\begin{cases}
\op{azim}(\orz,\v,\w,\sigma(\v,\w)), &\text{if } \card(E(\v)) > 1,\\
2\pi, & \text{otherwise.}\\
\end{cases}
\end{displaymath}
For any $x = (\v,\ldots)\in D$, set
\begin{displaymath}
\Wdart(x,\epsilon) = \Wdart(x) \cap \op{rcone}^0(\orz,\v,\cos\epsilon).
\end{displaymath}

%All the hypermaps in this book are connected. $D_2$ is not needed.

\begin{lemma}\label{lemma:node-vertex}
Let $(V,E)$ be a fan with hypermap $H$.  There is a natural bijection between
nodes of $H$ and $V$ that sends the node containing the dart $(\v,\cdot)$
to $\v\in V$.
\end{lemma}

\begin{proof}  This is left as an exercise for the reader.
\end{proof}

\begin{definition}[$\nd$]
Under the identification of nodes of a hypermap $H$ with $V$,
write $\nd(x)\in V$ for the node corresponding to a dart $x\in D$. 
\end{definition}
\indy{Notation}{node@$\nd:D\to V$ (node of a dart)}

\begin{lemma}\guid{VBTIKLP}\tlabel{lemma:disjoint}\rating{120}
Let $(V,E)$ be a fan.  Let $\v\in V$.  
Then
there is a disjoint sum decomposition of $\ring{R}^3$ given by
\begin{displaymath}
\ring{R}^3 = 
\op{aff}\{\orz,\v\} \cup
\bigcup_{\nd(x)=\v} \Wdart(x)  \cup 
\bigcup_{\{\v,\w\}\in E} \op{aff}_+^0(\{\orz,\v\},\w).
\end{displaymath}
\end{lemma}
\indy{Index}{disjoint sum decomposition}%
\indy{Index}{hypermap}%
\indy{Index}{dart}%





\begin{proof}
The proof begins with the existence of the disjoint sum decomposition.
First of all, $\ring{R}^3$ is the disjoint union of $\op{aff}\{\orz,\v\}$
and its complement.

The case when $\card(E(\v))\le 1$ follows immediately from the
definitions.  Therefore assume that $\card(E(\v)) >1$.  Fix $\u$ such
that $\{\v,\u\}\in E$, and let $\sigma$ be the azimuth cycle on
$E(\v)$.  Let $\alpha(i)=\op{azim}(\orz,\v,\sigma^i
\u,\sigma^{i+1}\u)$.  By Lemma~\ref{lemma:2pi-sum}, the sum of the
angles $\alpha(i)$ is $2\pi$.  Every
$\p\in\ring{R}^3\setminus\op{aff}\{\orz,\v\}$ satisfies
\begin{displaymath}
\sum_{i=0}^j \alpha(i) <
\op{azim}(\orz,\v,\u,\p) < \sum_{i=0}^{j+1} \alpha(i).
\end{displaymath}
or 
\begin{displaymath}
\sum_{i=0}^j \alpha(i) = \op{azim}(\orz,\v,\u,\p)
\end{displaymath}
for a unique $0 \le j < n$, where $n$ is the cardinality of $E(\v)$. 
These conditions are exactly the membership conditions for the sets
$
\Wdart(\v,\sigma^j \u)
$
and $\op{aff}_+^0(\{\orz,\v\},\sigma^j \u)$, respectively.
The result follows.
\end{proof}

\begin{corollary}\guid{IBZWFFH}\tlabel{cor:W}\rating{40}
Let $x = (\v,\ldots)$ be a dart and $\w\in E(\v)$.
Then $\Wdart(x)\cap C\{\v,\w\}=\emptyset$.
\end{corollary}

\begin{proof} The decomposition of Lemma~\ref{lemma:disjoint} is
disjoint.  It follows directly from the definitions that
\begin{displaymath}C\{\v,\w\}\subset \op{aff}_+^0(\{\orz,\v\},\w) \cup 
\op{aff}\{\orz,\v\}.\end{displaymath}
\end{proof}

\begin{lemma}\guid{JGIYDLE}\rating{120} 
For each dart $x$, and $\epsilon$ sufficiently small and positive,
$\Wdart(x,\epsilon)$ is nonempty and lies in a single 
topological component of $Y(V,E)$.
\end{lemma}
\indy{Index}{connected!topological component}%
\indy{Notation}{Wdart@$\Wdart$ (dart)}%

\begin{proof} (Beware of the notational subtleties:
$\epsilon\in\ring{R}$ is not $\ee\in E$.)  The proof first shows
that $\Wdart(x,\epsilon)$ lies in $Y$, for $\epsilon$ small.  Let
$x=(\v,\w)\in D_1$.  Let $S^2$ be the unit sphere centered at
$\orz$.  By making $\epsilon$ small enough, the sets
$\Wdart(x,\epsilon)\cap S^2$ avoid the compact sets $C(\ee)\cap S^2$
when $\v\not\in \ee$.  Thus, $\Wdart(x,\epsilon)$ also avoids
$C(\ee)$ when $\v\not\in \ee$.  By Corollary~\ref{cor:W},
$\Wdart(x,\epsilon)$ avoids $C(\ee)$, when $\v\in \ee$.  Thus,
$\Wdart(x,\epsilon)\subset Y$, for $\epsilon$ small.

To complete the proof, it is enough to show that each
$\Wdart(x,\epsilon)$ is connected.  The set
\begin{displaymath}
(0,\infty) \times (\theta_1,\theta_2) \times (0,\epsilon)
\end{displaymath}
is connected.  The set $\Wdart(x,\epsilon)$ is the image of this
product under a spherical coordinate representation
(Definition~\ref{def:sph}).  \indy{Index}{spherical coordinates}%
It is readily verified that the spherical to Cartesian coordinate
transformation is a continuous map. As the image of a connected set
under a continuous map, $\Wdart(x,\epsilon)$ is connected.
\end{proof}
\indy{Index}{connected}%
\indy{Index}{polar coordinates}%

\begin{definition}[leads~into] For each dart $x$, 
there is then a well-defined topological
component $U_x$ of $Y(V,E)$ 
that contains $\Wdart(x,\epsilon)$ (for all
sufficiently small positive $\epsilon$). Say the dart \newterm{leads into}
$U_x$.
\end{definition}
\indy{Index}{connected}%
\indy{Notation}{U@$U_x$ (connected component)} %


\section{Planarity}


\subsection{face attributes}

\begin{definition}[fully surrounded]
A fan $(V,E)$ is \newterm{fully surrounded}, if $\op{azim}(x)<\pi$
for all darts $x$ in the hypermap of $(V,E)$.
\end{definition}
\indy{Index}{fully surrounded}%

\begin{lemma}[sweep]\guid{DHVFGBC}\rating{400}\label{lemma:sweep}  
Let $(V,E)$ be a fan with hypermap $(D,e,n,f)$.  
Suppose that $(V,E)$ is fully surrounded. Fix a dart $x\in D$.
Let $\v = \nd(x)$, $\v_0 = \nd(f x)$,
and $\v_1 = \nd(f^2 x)$.  Let $\w(t) = (1-t) \v_0 + t \v_1$, for
$0\le t\le 1$.  Then
\begin{itemize}
\item  For each $t\in[0,1]$, $\v$ and $\w(t)$ are not parallel.
\item If $0 < t \le 1$, and $C^0(t)$ meets $X$, then $t=1$ and
$\{\v,\v_1\}\in E$.
%\item For $0< t < 1$, it follows $C^0(t)\subset Y$.
%item If $\{\v,\v_1\}\in E$ (that is, if the face of $x$ is a triangle), 
%then $C^0(1)$ is the blade $C^0\{\v,\v_1\}$ of the fan.
%\item If $\{\v,\v_1\}\not\in E$, then $C^0(1)\subset Y$.
\end{itemize}
\end{lemma}


\begin{figure}[htb]
\centering
\szincludegraphics[width=50mm]{\pdfp/vt.eps}
\caption{Sweeping a blade through a fan.}
\label{fig:vt}
\end{figure}


\begin{proof}
Abbreviate $C^0(t) = C^0\{\v,\w(t)\}$.
Let $Y = Y(V,E)$ and $X = X(V,E)$.
It follows from the definition of a fan that $\{\v,\v_0\}\in E$ and
that $\v$ and $\v_0$ are not parallel.  By continuity, $\v$ and $\w(t)$
are not parallel when $t$ is positive and sufficiently small.  
% If it exists, set $t'$ as the smallest $t>0$ for which
% $\{\orz,\v,\w(t)\}$ is a collinear set.  If it exists, let
% $I=\{t\mid 0< t < t'\}$, otherwise let $I=\{t\mid 0 < t \le 1\}$.
% For each $t\in I$, the blade $C^0(t)$ is not a collinear set and is
% contained in a unique plane $A(t)$ through $\orz$ and $\v$.
Let $I\subset\leftopen0,1\rightclosed$ be any interval that contains
$(0,\epsilon)$ for some sufficiently small positive $\epsilon$, and
such that $\v$ and $\w(t)$ are not parallel for all $t\in I$.

\claim{If $t\in I$ and $C^0(t)$ meets $X$, then $t=1$ and
$\{\v,\v_1\}\in E$.}  Indeed, a consideration of possible
intersections with nodes $\w\in V$ and blades $C^0(\ee)\subset X$
shows that for $t>0$ sufficiently small, $C^0(t)$ does not meet $X$,
hence $C^0(t)\subset Y$.  Assuming that $C^0(t)$ meets $X$ for some
$t\in I$, let $a$ be the smallest such $t\in I$.  $C^0(a)$ cannot meet
$X$ at a node $\w\in V$, because $\op{azim}(x)<\pi$ whenever
$\w=\nd(x)$, which means that
%for any $t$ for which  $C^0(t)$ meets $\w$ 
there is a smaller $t<a$ for which $C^0(t)$ meets a blade at $\w$.
Thus, $C^0(a)$ first meets $X$ along a blade $C^0(\ee)$. If the
intersection with this blade is transversal, again one can find a
smaller $t$ that gives an intersection with the blade.  Hence,
$C^0(a)$ and $C^0(\ee)$ are coplanar.  From the disjointness
properties of blades of a fan, it follows that $\ee = \{\v,\v_1\}\in
E$, that $a=1$, and that $C^0(1)$ is a blade of the fan.  The claim
follows.

\claim{$\v$ and $\w(t)$ are not parallel for any
  $t\in\leftopen0,1\rightclosed$.}  Otherwise, let $b\in
\leftopen0,1\rightclosed$ be the least constant for which $\v$ and
$\w(b)$ are parallel.  Set  $I=\leftopen0,b\rightopen$.  
%Now assume for a contradiction that $\v$ and $\w(t)$ are parallel for
%some $t\in\leftopen0,1\rightclosed$.  Let $b\in I$ be the least such
%constant.  
Pick $0<a<b$. 
Then $\{\orz,\w(a),\w(b),\v\}$ lie in a
unique plane $A$.  Since all $\w(t)$ lie in a line, $\w(t)\in A$ all
$t\in I$.  Then $\v_0\in C^0(a)\cap X$, contradicting the established
disjointness of $X$ from $C^0(a)$.  Thus, $b$ does not exist.  This
proves the claim and the first conclusion of the lemma.

Set $I= \{t\mid 0 < t \le 1\}$.  The second conclusion of the lemma
follow immediately from the claim.
\end{proof}

\begin{lemma}\guid{RWXUYZZ}\rating{100} \label{lemma:UF}
Let $(V,E)$ be a fan with hypermap $(D,e,n,f)$.  Assume that $(V,E)$
is fully surrounded.  Then for every face $F$ of the hypermap, there
exists a topological component $U$ of $Y(V,E)$ such that for every
$x\in F$, the dart $x$ leads into $U$.
\end{lemma}
\indy{Index}{connected!topological component}%
\indy{Index}{hypermap}%
\indy{Index}{dart}%

Write $F\mapsto U_F$ for this map from faces to topological components.
\indy{Notation}{UF@$U_F$}%

\begin{proof} Fix any dart $x\in F$ and construct the set $C^0(t)$ as
in the previous lemma.  For all $\epsilon>0$ sufficiently small,
there exists $\delta>0$ such that set $C^0(t)$ meets both
$\Wdart(x,\epsilon)$ and $\Wdart(f x,\epsilon)$ for all
$0<t<\delta$.  By the previous lemma, the set $C^0(t)$ lies in a
single component $U$ when $t$ is positive and sufficiently small.
Thus, $x$ and $f x$ lead into the same component $U$.  By induction,
for all $y\in F$, the dart $y$ leads into $U$.
\end{proof}

\begin{lemma}\guid{DWWUTKW}\rating{ZZ}\label{lemma:add-edge}
Let $(V,E)$ be a fan and let $\v,\w\in V$ be non-parallel.  Suppose
that $C^0\{\v,\w\}\subset U_F$ for some face $F$.  Let $E' =
E\cup\{\{\v,\w\}\}$.  Then $(V,E')$ is a fan.
\end{lemma}

\begin{proof} Each of the defining properties of a fan will be
established in turn.  The node set is unchanged.  It remains finite
and nonempty, and it does not contain $\orz$.  The property
\case{non-parallel} of $E'$ follow from the corresponding property
of $E$ and the assumed non-parallelism for $\{\v,\w\}$.

In the verification of the intersection property:
\begin{displaymath}
C(\ee)\cap C(\ee') = C(\ee \cap \ee'),
\end{displaymath}
it is enough to consider the case $\ee = \{\v,\w\}$ and $\ee' \ne
\ee$, the other cases being trivial.  Then from elementary geometry 
\begin{displaymath}
C\{\v,\w\} = C^0\{\v,\w\}\cup C\{\v\}\cup C\{\w\}
\end{displaymath}
and
known facts
$C^0\{\v,\w\}\subset U_F$, $C(\ee')\subset X(V,E)$, and $X(V,E)\cap
U_F=\emptyset$, it follows that
\begin{displaymath}
\begin{array}{rll}
C\{\v,\w\} \cap C(\ee')  &= (C\{\v\} \cup C\{\w\}) \cap C(\ee') \\
&= C(\{\v\}\cap \ee') \cap C(\{\w\}\cap \ee')\\
&= C(\{\v,\w\}\cap \ee').
\end{array}
\end{displaymath}
(The last equality uses the observation that at most one of the two
intersections $\cdot\cap\ee'$ in the penultimate line is nonzero.)
Thus, $(V,E')$ is a fan.
\end{proof}


\begin{lemma}\guid{JUTSTKG}\rating{120}\label{lemma:lead-exists}
Let $(V,E)$ be a fan with hypermap $(D,e,n,f)$. Let
$Y=Y(V,E)$. Assume that $(V,E)$ is fully surrounded.  For every
topological component $U$ of $Y$, there is a dart $x\in D$ that
leads into $U$.
\end{lemma}
\indy{Index}{connected!topological component}%
\indy{Index}{fan}%
\indy{Index}{hypermap}%

\begin{proof}  
In the notation of Lemma~\ref{lemma:sweep}, to show the dependence
of the sets $C^0(t)$ on the initial dart $x$, write $C^0(t,x)$.

Let $\p\in U$.  Choose a continous path $\varphi:[0,1]\to
\ring{R}^3\setminus\{0\}$ such that $\varphi(t)\in U$ for $t<1$ and
$\varphi(1)\not\in U$.  Then $\q=\varphi(1)\in X$.  If $\q\in
C^0\{\v\}$ for some $\v\in V$, then there exists a dart $x$ with
node $\v = \nd(x)$ such that for all sufficiently small positive
$\epsilon$, there exists some $0\le t < 1$ such that $\varphi(t)\in
\Wdart(x,\epsilon)\subset U_x$.  Thus, $x$ leads into $U$.
\indy{Notation}{ZZddgamma@$\varphi$ (path)}%

The other possibility is that $\q\in C^0\{\v,\w\}$ for some
$\{\v,\w\}\in E$.  In this case, there is a unique edge $\{x,y\}$ of
the hypermap such that $\v=\nd(x)$ and $\w=\nd(y)$.  (That is,
$x=(\v,\w)$ and $y=(\w,\v)$.)  There is also a small neighborhood of
$\q$ such that every point $\q'$ in that neighborhood takes one of
the following forms:
\begin{itemize} \item $\q'\in C^0\{\v,\w\}$;
\item $\q'\in C^0(s,x)\subset U_x$ for some $0<s<1$;
\item $\q'\in C^0(s,y)\subset U_y$ for some $0<s<1$.
\end{itemize}
Points of the first form do not meet $Y$.  Thus, $\varphi(t)\in U_x$
or $\varphi(t)\in U_y$.
\end{proof}

\begin{lemma}[triangle~attributes]\guid{KVQWYDL}\rating{200} \label{lemma:triangle}
Let $(V,E)$ be a fan with hypermap $(D,e,n,f)$.  Let $Y=Y(V,E)$.
Assume that $(V,E)$ is fully surrounded. Fix a face $F$ of
cardinality three, fix $x_0\in F$, and set $x_i = f^i x_0$. Then
\indy{Index}{triangle attributes}%
\begin{itemize}  
\item $U_F$ is equal to the intersection of the three half-spaces:
\begin{displaymath}A^0_+(i)=\op{aff}_+^0(\{\orz,\nd(x_{i+1}),\nd(x_{i+2})\},\nd(x_i)),\quad
i=0,1,2.\end{displaymath}
\item If a dart $y$ leads into $U_F$, then $y\in F$.
\end{itemize}
\end{lemma}
\indy{Index}{half-space}%

\begin{proof} 
\claim{The intersection $U'$ of the three half-spaces is a subset of $U_F$.}
Indeed, the intersection of two half-spaces, $A^0_+(1)\cap
  A^0_+(2)$ is the wedge $\Wdart(x_0)$.  The sets
  $C^0(t,x_0)\subset\Wdart(x_0)$ sweep out precisely the intersection
  of $\Wdart(x_0)$ with $A^0_+(0)$, when $0<t<1$.  The sets
  $C^0(t,x_0)$ belong to $U_F$.  The claim follows.

\claim{$U_F$ is a subset of the intersection $U'$.} Otherwise,
let $\p$ be a point of $U_F$ that does
not belong to $U'$.  Choose a continuous path $\varphi:[0,1]\to U_F$
with $\varphi(0)\in U'$ and $\varphi(1)=\p$.  Let $t>0$ be the first
time such that $\varphi(t)\not\in U'$.  Then $\q=\varphi(t)$ lies in
the set consisting of the closed intersection of half-spaces
$A_+(i)$ corresponding to $A^0_+(i)$ and lies in one of the bounding
planes.  Let
\begin{displaymath}
X' = \bigcup C(i),\quad\text{ where } C(i)=C\{\nd(x_i),\nd(x_{i+1})\}.
\end{displaymath}
Then $\q\in X'\subset X$.  This yields the impossibility:
$\q\in X\cap Y = \emptyset$.   Thus, $U'=U_F$.

Let $y$ be any dart that leads into $U_F$.  Then
$\Wdart(y,\epsilon)$ meets $U_F$ for all $\epsilon>0$ sufficiently
small.  This implies that $\nd(y)$ lies in the intersection of the
closed half-spaces $A_+(i)$.  As previously established, this
intersection is the disjoint union of $U_F$ and $X'$.  As $\nd(y)\in
X$, which does not meet $U_F$, it follows that $\nd(y)\in X'$.  The set
$X'$ is the disjoint union of the rays $C\{\nd(x_i)\}$ and the three
blades $C^0(i)$.  These blades do not meet $V$, hence $\nd(y)=\nd(x_i)$
for some $i$.  Thus, $y$ and $x_i$ belong to the same node.  The sets
$\Wdart(y)$ and $\Wdart( x_i)$ are disjoint for distinct darts at the
same node, and this implies that $y=x_i\in F$.
\end{proof}

\begin{corollary}\guid{MOZNWEH}\rating{60}\label{lemma:girard-component}
Let $F$ be a face of size $3$ in the context of
Lemma~\ref{lemma:triangle}.  Then for $r>0$, $U_F \cap B(\orz,r)$ is
measurable and $r$-radial at $\orz$.  The solid angle of $U_F$ is
given by the formula
\begin{displaymath}
\sol(U_F) = -\pi + \sum_{x\in F}\op{azim}(x),
\end{displaymath}
\end{corollary}
\indy{Index}{angle}%
\indy{Notation}{F@$F$ (face)}%
\indy{Notation}{U@$U_F$ (component)}%

\begin{proof} An intersection of half-spaces through the origin 
with $B(\orz,r)$ is measurable and
$r$-radial.  The solid angle is given by Girard's formula for
a spherical triangle (Lemma~\ref{lemma:prim-volume}).
\end{proof}
\indy{Index}{Girard's formula}%

\subsection{conformance}


The previous subsection shows that in a fully surrounded fan the topological
components of $U_F$ have a particularly simple geometrical description as
an intersection of half-spaces, when $\card(F)=3$.  This subsection defines
a class of fans (Definition~\ref{def:conforming}) in which the faces also have
a  simple geometrical description.

\begin{definition}[conforming]\label{def:conforming}
Let $(V,E)$ be a fan with hypermap $(D,e,n,f)$.  The fan is
\newterm{conforming} if the following conditions hold.
\begin{nomerate}
\item \case{surroundedness} $(V,E)$ is fully surrounded.
\item \case{bijection} The map $F\mapsto U_F$ is a bijection between
faces of the hypermap and topological components of $Y$.
\item \case{half-space} For every face $F$, the topological component
$U_F$ is the intersection of the open half-spaces
$\op{aff}_+^0(\{\orz,\nd(x),\nd({f x})\},\nd(f^{-1} x))$, as $x$ runs over
$F$.
\item \case{solid angle} For every $F$, the intersection
$B(\orz,r)\cap U_F$ is measurable and eventually radial at $\orz$.
Moreover, the solid angle of $U_F$ is given by the formula
\begin{displaymath}
\sol(U_F) = 2\pi + \sum_{x\in F}(\op{azim}(x)-\pi).
\end{displaymath}
\item \case{diagonal} For every face $F$, if $x,y\in F$ are distinct,
with corresponding nodes $\nd(x),\nd(y)\in V$, then $\nd(x)$ and
$\nd(y)$ are not parallel.  Moreover, either $x,y$ are adjacent under
the face map, or $C^0\{\nd(x),\nd(y)\}\subset U_F$.  {\it That is, the
``diagonals'' of $U_F$ are all ``interior.''}
%% \item {\bf [triangulation]~} Triangulations of $U_F$ exist.  More
%%   precisely,
%   there is a fan $(V,E')$ such that $E\subset E'$ and such that
%   every face of $\op{hyp}(V,E')$ has cardinality $3$.
\end{nomerate}
\end{definition}


Conforming fans have several significant properties. 

\begin{lemma}\guid{GINGUAP}\rating{40}
Let $(V,E)$ be a conforming fan.  
Each $U_F$ is convex, where  $F$ is any face of $\op{hyp}(V,E)$.
\end{lemma}
\indy{Index}{component!topological}%
\indy{Index}{convex}%

\begin{proof} By \case{half-space}, $U_F$ is the intersection of
half-spaces.
\end{proof}

\begin{lemma}\guid{SRPRNPL}\rating{60}  
Let $(V,E)$ be a conforming fan.  
Then $\op{hyp}(V,E)$ is simple.
\end{lemma}
\indy{Index}{hypermap!simple}%

\begin{proof} Let $x\in F$.  By the intersection of half-spaces
property, $U_F$ is contained in the wedge $\Wdart(x)$ at $x$.  If
there is a second dart $y$ at the same node in $F$, then $U_F$ is
also contained in $\Wdart(y)$. However, by
Lemma~\ref{lemma:disjoint}, the wedges at a given node are disjoint.
\end{proof}

\begin{lemma}\guid{WGVWSKE}\rating{150}  
Let $(V,E)$ be a conforming fan.  
Then $\op{hyp}(V,E)$ is connected.
\end{lemma}
\indy{Index}{connected}%
\indy{Index}{hypermap}%
\indy{Index}{component!combinatorial}%

% \begin{proof} Let $x,y$ be any two darts.  After replacing $x$ with
%   $f x$ if necessary (which does not change the combinatorial
%   component) assume that $\{\orz,\nd(x),\nd(y)\}$ is not a collinear
%   set.  For each blade $C^0(\ee)$ of the fan that meets
%   $C=C^0\{\nd(x),\nd(y)\}$ pick one of the two endpoints of $\ee$.
%   This gives a sequence
%\begin{displaymath}
%\nd(x)=\v_0,\v_1,\ldots,\v_k=\nd(y)
%\end{displaymath}
%such that $C^0(\{\v_i,\v_{i+1}\})$ lies in a single topological
% component $U_i$.  Each $U_i$ has the form $U_F$ for some face
% $F=F_i$ of the hypermap.  Thus, a combinatorial path is constructed
% from $x$ to $y$ by moving by the face map from dart to dart within
% each $F_i$ and by the node map from dart to dart around a given node
% $\v_j$.
%\end{proof}

\begin{proof} Let $[D]$ denote the set of combinatorial components of
$D$.  There is a well-defined continuous (in fact, locally constant)
function from $Y$ onto $[D]$ given as follows.  For $\p\in Y$,
choose $F$ such that $\p\in U_F$ and send $\p$ to the class of $F$
in $[D]$.  By property \case{bijection}, this map is
well-defined. This map extends continuously to $C^0(\ee)$, for
$\ee\in E$, by sending $\p\in C^0(\ee)$ to the combinatorial
component of $D$ containing the hypermap edge $\{x,y\}$  that
corresponds with $\ee$.  The domain
\begin{displaymath}
Y\cup \bigcup C^0(\ee)
\end{displaymath}
is connected.  The continuous map from this connected set onto the
discrete set is necessarily constant.  As the map is onto, the set
$[D]$ reduces to a singleton.
\end{proof}

\begin{lemma}\guid{GGRLKHP}\rating{100}  
Let $(V,E)$ be a conforming fan.  
Then $\op{hyp}(V,E)$ is planar.
\end{lemma}
\indy{Index}{planar}%
\indy{Index}{hypermap}%

\begin{proof}  The solid angle of a sphere is $4\pi$.  The set $X(V,E)$
has measure zero, so that
\begin{equation}\label{eqn:solid-sum}
4\pi = \sol(Y)= \sum_F \sol(U_F) = 
\sum_F ( 2\pi + \sum_{x\in F} (\op{azim}(x)-\pi) ).
\end{equation}
The double sum over faces and darts in a face can be replaced by
a single sum over all darts.  
The sum of the azimuth angles of all darts at a node is $2\pi$. Thus,
all the azimuth angle terms give $2\pi\,\#n$.
Thus, the formula~(\ref{eqn:solid-sum}) becomes
\begin{displaymath}
4\pi = 2\pi\, \#f +2\pi\,\#n - \pi\, \#D.
\end{displaymath}
In a plain hypermap in which the edge map has no fixed points, $\#D =
2\,\#e$.  The relation becomes
\begin{displaymath}
2 + \#D = \#f + \#e + \#n.
\end{displaymath}
This is the condition of planarity for a connected hypermap.
\end{proof}
\indy{Index}{hypermap!connected}%

\subsection{existence}




This section proves the existence of many conforming fans.  The main result
of this subsection
(Lemma~\ref{lemma:face}) asserts that every fully surrounded fan is conforming.  The
proof breaks into a series of small lemmas.  The primary
method to prove the existence of conforming fans is an induction on
the following invariant of a fan $(V,E)$.

\begin{definition}[$N(V,E)$]
If $(V,E)$ is a fan,  set
\begin{displaymath}
N(V,E) = \sum_F (k_F - 3),
\end{displaymath}
where the sum runs over faces of the hypermap, and $k_F$ is the
cardinality of the face $F$.
\end{definition}
%We prove the conclusion of the lemma, together with the additional
%conclusion:
%\begin{itemize}
%\item If $C^0(\ee)$ is any diagonal of $U_F$ (with $\ee\not\in E$),
%  then the %fan $(V,E'')$, where $E'' = E\cup\{\ee\}$, satisfies
%  $N(V,E'')+1 = N(V,E)$.
%\end{itemize}

\begin{lemma}\guid{DWFBRQY}\rating{ZZ}\label{lemma:N=0}
Let $(V,E)$ be a fully surrounded fan with hypermap $(D,e,n,f)$. 
Assume that $N(V,E)=0$.
Then $(V,E)$ is conforming.
\end{lemma}
\indy{Index}{face!attribute}%
\indy{Notation}{N@$N$ (face)}%
\indy{Notation}{kfz@$k_F$ (cardinality of face)}%

\begin{proof}
If $N(V,E)=0$, then the hypermap is a triangulation.  By
Lemmas~\ref{lemma:UF} and \ref{lemma:lead-exists}, every topological
component of $Y$ has the form $U_F$ for some face $F$.  By
Lemma~\ref{lemma:triangle}, $U$ uniquely determines the face $F$.
Thus, there is a bijection between faces of the hypermap and
topological components.  By Lemma~\ref{lemma:triangle}, the
topological component $U_F$ is the intersection of open half-spaces
as asserted.  The solid angle formula is given by
Corollary~\ref{lemma:girard-component}.  The assertion of the lemma
about diagonals
%and triangulations 
is trivial for a hypermap that is already a triangulation. This
completes the proof in the base case $N(V,E)=0$.
\end{proof}
%\indy{Index}{triangulation}%

\begin{definition}[minimally non conforming fan]
A fan $(V,E)$ is said to be \newterm{minimally non conforming} if
the following conditions hold.
\begin{itemize}
\item $(V,E)$ is fully surrounded.
\item $(V,E)$ is not conforming.
\item $N(V,E)>0$.
\item If $(V,E')$ is any other fully surrounded fan on the same node
set $V$, and if $N(V,E') < N(V,E)$, then $(V,E')$ is conforming.
\end{itemize}
\end{definition}
\indy{Index}{minimally non conforming fan}%

% In the proof of Lemma~\ref{lemma:face}, assume for a contradiction
% that there exists a fan $(V,E)$ satisfying the assumptions of the
% lemma, but not the conclusion.  Among all such counterexamples with
% fixed node set $V$, pick $E$ to minimize $N(V,E)$.  Refer to this
% fan as a minimal counterexample (to Lemma~\ref{lemma:face}).

% By the assumed minimality of $N(V,E)$, the conclusions of
% Lemma~\ref{lemma:face} holds for the modified fan $(V,E')$.  The
% strategy of the proof of Lemma~\ref{lemma:face} will be to use the
% modified fan $(V,E')$ to show that the conclusions of the
% Lemma~\ref{lemma:face} hold for $(V,E)$ as well.  These conclusions
% will be established for $(V,E)$ through a series of lemmas.  The
% result will contradict the assumption that $(V,E)$ is a
% counterexample.

\begin{remark}[reduction data]\label{remark:reduction}
  When $N(V,E)>0$, choose a dart $x$ that lies in a face $F$ of the
  hypermap that is not a triangle.  By Lemma~\ref{lemma:sweep},
  $C^0\{\v,\w\}\subset U_F$, where $\v=\nd(x)$, $\w=\nd(y)$, and
  $y=f^2 x$.  Form a new fan $(V,E')$ on the same node set with $E' =
  E\cup \{\{\v,\w\}\}$.  (See Lemma~\ref{lemma:add-edge}.)

The following notation is useful.  Add primes to symbols
denoting objects related to $(V,E')$.
%Write
%$\v=\nd(x)$ and $\w=\nd(y)$.  
Let $x'=(\v,\w)$ and $y'=(\w,\v)\in D'$, where $D'$ is the set of darts of $\op{hyp}(V,E')$.
The darts $x',y'$ lead into topological components
$U(x')$ and $U(y')$ of $Y'=Y(V,E')$ and belong to faces $F(x')$,
$F(y')$ of $H'=\op{hyp}(V,E')$.
\end{remark}

\begin{lemma}\guid{ZSZIUQE}\rating{ZZ}\label{lemma:lessN}
  Let $(V,E)$ be a fully surrounded fan.  Assume that $N(V,E)>0$.  Let
  $x$ be a dart in $\op{hyp}(V,E)$ such that the face $F$ of $x$ is
  not a triangle.  Let $E'=E\cup \{\{\v,\w\}\}$, $x',y',\ldots$ be the reduction data
  as above associated with $x$.  Then the faces $F(x')$ and $F(y')$ are distinct, and
  $F(y')$ is a
  triangle. Moreover, $\op{hyp}(V,E)$ is obtained by a double walkup along the
  edge $\{x',y'\}$ of $\op{hyp}(V,E')$ that merges the two faces $F(x')$ and $F(y')$.
  Finally, $N(V,E')<N(V,E)$.
\end{lemma}


\begin{proof} Let $H'=(D',e',n',f')$ be the hypermap of $(V,E')$.
Write $x = (\v,\u)$, $f x = (\u,\w)$, $f^2 x = y = (\w,*)$.
Then it follows directly from the definition of the face map on $\op{hyp}(V,E')$
and an inspection of the cylic order $\sigma$ that
\begin{displaymath}
(f')^3 y' = (f')^3 (\w,\v) = (f')^2(\v,\u) = f' (\u,\w) = (\w,\v) = y'.
\end{displaymath}
It follows that $F(y')$ is a triangle.

The hypermap $H=\op{hyp}(V,E)$ is obtained from
$H'=\op{hyp}(V,E')$ by a double walkup transformation on the edge
$\{x',y'\}$.  The faces $F(x')$ and $F(y')$ are distinct (by
Lemma~\ref{lemma:triangle}, which asserts that $x'$ does not lead
into $U(y')$).  Thus, the walkup transformation merges two faces by Lemma~\ref{lemma:merge-split}.
Then
\begin{displaymath}N(V,E) - N(V,E') = ((k+1)-3) ~~-~~ ((k-3) +
(3-3)) = 1 >0,\end{displaymath} where $k$ is the cardinality of
$F(x')$.
\end{proof}


\begin{lemma}\guid{OBHTHCD}\rating{ZZ}
The property \case{bijection} of conforming fans holds for any
minimally non conforming fan: $F\mapsto U_F$ is a bijection
\end{lemma}

\begin{proof} Let $(V,E)$ be a minimally non conforming fan.  
Choose $x$ to obtain reduction data
for $(V,E)$.  
 The bijection property holds
for $(V,E')$ by the minimality assumption.  The proof will establish a bijection by showing
that $(V,E)$ has one more face
and one more topological component than $(V,E')$.

The
two faces $F(x')$ and $F(y')$ merge into a single face $F$ of
$\op{hyp}(V,E)$.  Then
\begin{equation}\label{eqn:U}
U= U(x')\cup U(y')\cup C^0(\ee)
\end{equation} 
is a connected open set in $Y$.  If $F'\ne F(x'),F(y')$ is any other
face in $H'$, then $U_{F'}$ is a connected open set in $Y$.  Moreover,
the set $U$ and sets $U_{F'}$ are pairwise disjoint and exhaust $Y$,
so that they are precisely the topological components of $Y$.  Some
dart of $F$ leads into $U$, so $U=U_F$. 
It follows that the number of
faces is equal to the number of topological components for $(V,E)$, so that the
map $F\mapsto U_F$ is a bijection.
\end{proof}


\begin{lemma}\guid{TXFBALB}\rating{ZZ} Let $(V,E)$ be any minimally
non conforming fan.  Then it has property \case{solid angle} of
conforming fans.
\end{lemma}

\begin{proof} Choose reduction data for $(V,E)$.  Every topological
component of $Y=Y(V,E)$ except $U=U_F$ is already a topological
component of $Y'$ and the conclusion holds for components of $Y'$.
The topological component $U$ is a disjoint union of two components
of $Y'$ and a set $C^0(\ee)$ of measure zero.  Thus, it is also
measurable and eventually radial.  The solid angle formula is
additive over the disjoint union in~(\ref{eqn:U}), so the formula
holds for $U$.
\end{proof}
\indy{Index}{component!topological}%


\begin{lemma}\guid{GGZWYRM}\rating{ZZ} Let $(V,E)$ be any minimally
non conforming fan.  For any dart $x$ on any face $F$ and dart $z\in
F$ that is not adjacent to $x$ under the face map,
\begin{displaymath}
C^0(\{\nd(x),\nd(z)\} \subset U_F.
\end{displaymath}
\end{lemma}

\begin{proof}  
  By excluding trivial cases of the proof, the dart $x$ can be the
  choice of dart used to construct reduction data $E'$, $x',y'$, etc. We may
  assume that $F(y')$ is a triangle.  If $z=f^2x$, then the diagonal
  is precisely $C^0\{\v,\w\}$, for which the conclusion has already
  been established.  Otherwise, $z$ can be identified with a dart
  $z'\in F(x')$.  Then by minimality,
\begin{displaymath}
C^0\{\nd(x),\nd(z)\} = C^0\{\nd(x'),\nd(z')\} \subset U(x') \subset U_F.
\end{displaymath}
\end{proof}

% Next show the extra conclusion added at the beginning of the lemma.
% If the added diagonal is $\{\v,\w\}$, then $E''=E'$ and have already
% checked that $N(V,E')+1=N(V,E)$.  Since $x$ was arbitrary, may
% assume that $\nd(x)\in e$.  Let $E''' = E \cup \{e\, \{\v,\w\}\}$.
% By the minimality, $N(V,E''') + 1 = N(V,E')$.  Also, $E''' = E''\cup
% \{\{\v,\w\}\}$.  The same argument that shows $N(V,E')+1=N(V,E)$
% shows $N(V,E''')+1 = N(V,E'')$.  Hence,
%\begin{displaymath}
%N(V,E'')+1 = N(V,E''')+2 = N(V,E')+1 = N(V,E).
%\end{displaymath}

\begin{lemma}\guid{HYUAZSE}\rating{ZZ} Let $(V,E)$ be a minimally non
conforming fan.  Then property \case{half-space} of conforming fans
holds for $(V,E)$.
\end{lemma}
\indy{Index}{component!topological}%

\begin{proof}
  Choose a dart $x$ to give reduction data for $(V,E)$.  By the non
  conformance of $(V,E)$, it is enough to consider the face $F$
  containing $x$ (Indeed, the other faces of $\op{hyp}(V,E)$ can be
  identified with faces of $\op{hyp}(V,E')$ and these cases are easily
  treated.)  

\claim{The given intersection $U_1$ of half-spaces lies in $U=U_F$.}
Indeed,  every
  point in $\ring{R}^3$ lies in the plane
\begin{displaymath}
A=\op{aff}\{\orz,\v,\w\}
\end{displaymath}
or in one of the two open half-spaces bounded by this plane.  These
half-spaces, $A(x')$ and $A(y')$, contain $U(x')$ and $U(y')$
respectively, by the minimality of $(V,E)$.  Also,
\begin{displaymath}
A(x')\cap U_1 \subset U(x')\subset U.
\end{displaymath}
Similarly, $A(y')\cap U_1 \subset U$.  Also,
\begin{displaymath}
A \cap U_1 \subset A \cap \Wdart(x) \cap \Wdart(y) \subset C^0\{\v,\w\} \subset U.
\end{displaymath}
Thus,
$U_1\subset U$.

\claim{For any dart $z$ of $F$, the set $U$ is a subset of the
half-space with bounding plane $\{\orz,\nd(z),\nd(f z)\}$.} Indeed,
if the reduction data for the dart $z$ is used, the claim does not change.
Without loss of generality, assume that $z=x$.By the minimality of $(V,E)$, the
partition \eqn{eqn:U} of $U$ gives three pieces contained respectively
in the three parts:
\begin{displaymath}
\Wdart(x') \cup C^0\{\v,\w\} \cup \Wdart(x''),
\end{displaymath}
where $x',x''\in D'$ correspond to the single dart $x$ in $D$:
\begin{displaymath}
\op{azim}(x') + \op{azim}(x'') = \op{azim}(x) < \pi.
\end{displaymath}
Thus, $U$ itself is contained in the lune
\begin{displaymath}
W^0(\{\orz,\nd(x)\},\{\nd(f x),\nd(f^{-1} x)\}),
\end{displaymath}
which is contained in the desired half-space.  This proves the claim.

The reverse inclusion $U\subset U_1$ follows immediately from the claim.
\end{proof}

%\begin{lemma}\guid{YQWIVOS}\rating{ZZ}
%  Let $(V,E)$ be any minimally non conforming fan.  Then a
%  triangulation of $(V,E)$ exists.
%\end{lemma}
%
%\begin{proof} A triangulation of $(V,E')$ exists by the minimality of
%  $(V,E)$.  A triangulation of $(V,E')$ is also a triangulation of
%  $(V,E)$.
%\end{proof}


\begin{lemma}[conformance]\guid{PIIJBJK}\rating{1000}\label{lemma:face}
Every fully surrounded fan is conforming.
\end{lemma}

\begin{proof}
Suppose for a contradiction that a fully surrounded fan $(V,*)$
exists that is not conforming.  Among all fully surrounded
conforming fans $(V,*)$ on the same node set, pick one $(V,E)$
that minimizes $N(V,E)$.  In fact, $N(V,E)>0$, for otherwise $(V,E)$
is conforming by Lemma~\ref{lemma:N=0}.

This is a minimally non conforming fan.  The preceding lemmas show
that a minimally non conforming fan satisfies all of the properties
of a conforming fan.  This is contrary to the definition of
minimally non conforming.  This contradiction gives the proof.
\end{proof}



\section{Polyhedron}\label{sec:poly}

This section shows that a polyhedron determines a fan.  It begins by
recalling basic terminology about affine and convex sets.



\begin{definition}[affine~set,~affine~hull,~affine~dimension,~affinely~independent,~hyperplane]\label{def:affine}
Recall that a set $A\subset\ring{R}^N$ is \newterm{affine}, if for
every $\v,\w\in A$ and every $t \in \ring{R}$, 
\begin{displaymath}
  t \v + (1-t) \w \in A.
\end{displaymath}
Recall that
the \newterm{affine hull} of $P\subset\ring{R}^n$ (denoted $\affhull(P)$) 
is the smallest affine set
containing $P$.  The \newterm{affine dimension} of $P$ (written $\dimaff(P)$) is
$\card(S)-1$, where $S$ is a set of smallest cardinality such that
\begin{displaymath}
P \subset \op{aff}(S).
\end{displaymath}
\end{definition}
In particular, the affine dimension of the empty set is $-1$.
A finite set $S$ is \newterm{affinely independent} if $\dimaff(S) = \card(S)-1$.
A \newterm{hyperplane } in $\ring{R}^N$ is any set of the form
\begin{displaymath}
\{p\mid u\cdot \p = b\},
\end{displaymath}
where $\orz\ne\u\in\ring{R}^N$.
\indy{Notation}{dimaff@$\dimaff$ (affine dimension)}%
\indy{Notation}{affhull@$\affhull$ (affine hull)}%



\begin{definition}[relative interior,~closure,~relative boundary] Let
$A$ be the affine hull of a set $P\subset\ring{R}^n$.  An interior
point $\p$ of $P$ is a point that contains an open ball $B(\p,r)$
entirely contained in $P$.  A point $\p$ of $P$ belongs to the
relative interior of $P$ if there is an open ball such that $B(\p,r)
\cap A\subset P$.  Let $\op{ri}(P)$ be the set of relative interior
points.  The closure of $P$ (denoted $\op{cl}(P)$) is the set
\begin{displaymath}
\op{cl}(P) = \{\p \mid \forall\,r >0.~ B(\p,r) \cap P \ne \emptyset\}.
\end{displaymath}
The complement $\op{cl}(P)\setminus \op{ri}(P)$ is the
\newterm{relative boundary} of $P$.
\end{definition}
\indy{Notation}{ri (relative interior)}%
\indy{Notation}{cl (closure)}%
\indy{Index}{convex}%
\indy{Index}{affine hull}%
\indy{Index}{closure}%
\indy{Index}{interior!relative}%
\indy{Index}{relative boundary}%

\begin{definition}[face,~facet,~edge,~extreme~point]
Let $P$ be a convex set.  A \newterm{face} of $P$ is a convex set
$F$ such that the conditions
\begin{displaymath}
\v,\w\in P,\quad s \v + t \w \in F,\quad s>0,\quad t>0,\quad s+t = 1,
\end{displaymath} 
imply that $\v,\w\in F$.  A face $F$ is \newterm{proper} if $F\ne
\emptyset,P$.  An \newterm{extreme point} is an element $\v\in P$ such that
$\{\v\}$ is a face (of affine dimension $0$).  An  \newterm{edge} is a face of $P$ of
affine dimension $1$.  A \newterm{facet} of $P$ is a \newterm{proper}
face of affine dimension $\dimaff(P)-1$.  \indy{Index}{face}%
\indy{Index}{dimension} %
% A point $\u\in P$ is an extreme point of $P$, if for every $\v,\w\in
% P\setminus\{\u\}$, the point $\v$ is not of the form $t \v + (1-t)
% \w$, with $0\le t\le 1$.
\end{definition}

\begin{remark}[convex background]\label{rem:convex-background}
We will assume as background knowledge various basic facts about convex sets.
For example,
if $P$ is convex and $P = \bigcup_{i=1}^r P_i$, where $P_i$ is convex, then
\begin{displaymath}
\op{conv}(A\cup P ) = \bigcup_{i=1}^r\op{conv}(A\cup P_i).
\end{displaymath}
Also, $\op{conv}(A\cup \op{conv}(B)) = \op{conv}(A \cup B)$.
Furthermore, if $A$ is convex, then $A = \op{conv}(A)$.
\end{remark}


\begin{remark}[affine background]\label{rem:affine-background}
Various particular facts about affine sets that will come up.
If $U\subset\ring{R}^N$ is open, then $\dimaff(U) = \card(N)$.  In particular,
$\dimaff(\ring{R}^n) = n$.  At the other extreme $\dimaff(\{\p\}) = 0$.
If $S_1\subset S_2\subset\ring{R}^N$, then $\dimaff(S_1) \le \dimaff(S_2)$.
If $A$ is an affine set and $\p\not\in A$, then $\dimaff(A) +1 = \dimaff(A\cup\{p\})$.
If $A$ is affine of affine dimension $k$ and if $B$ is a hyperplane such that $A\cap B\ne\emptyset$, then $\dimaff (A\cap B)\ge k-1$.
If $C$ is a convex set, $A$ is an affine set and $U\subset \ring{R}^N$ 
is a neighborhood of $\p\in C\cap A$ such that $C\cap U = A\cap U$, then
$A=\affhull(C)$.
\end{remark}


\begin{remark}\label{remark:face} 
The term \newterm{face} occurs in this book with two meanings: the
face of a hypermap and the face of a convex set.  The two contexts
are sufficiently different that we hope to avoid misunderstanding.
Graphs, digraphs, hypermaps, fans, and polyhedra all have \newterm{edges}.
Fans and hypermaps have \newterm{nodes}, while digraphs and polygons 
have \newterm{vertices}.  Polyhedra have \newterm{extreme points}.
\end{remark}

\begin{lemma}[Krein-Milman]\guid{MUGGQUF}\rating{0} Every compact
convex set $P\subset\ring{R}^n$ is the convex hull of its set of
extreme points.
\end{lemma}

\begin{proof}  See \cite[Theorem~2.6.16]{webster:1994}.
\end{proof}


\begin{definition}[polyhedron] A \newterm{polyhedron} is the
intersection of a finite number of closed half-spaces in
$\ring{R}^n$.  
%An extreme point of a polyhedron is also called a \newterm{vertex}.
\end{definition}
\indy{Index}{polyhedron}%

\begin{lemma}\guid{LTHQIAA}\rating{ZZ}\label{lemma:aff-poly}
An affine set in $\ring{R}^n$ is a polyhedron.
\end{lemma}

\begin{proof} See \cite[Cor~1.4.2]{webster:1994}.
\end{proof}

\begin{lemma}\label{lemma:aff-u}
If $A$ is a proper affine set in $\ring{R}^n$, then there exists $\u\in \ring{R}^n$, with
$\u\ne\orz$, and $b\in\ring{R}$ 
such that $\u\cdot\p = b$, for all $\p\in A$.  That is, every proper affine set
is contained in a hyperplane.
\end{lemma}

\begin{proof}
By Lemma~\ref{lemma:aff-poly},
the affine set $A$ is a polyhedron, hence contained in a closed half-space defined by an
inequality $\u\cdot\p \le c$, for some $\u\ne \orz$ and $c$.  If $\u\cdot\p$ assumes
at least two distinct values, then the image of the affine set $A$ 
is the entire affine line $\ring{R}$, and the inequality is violated.
Hence $\u\cdot\p$ is constant on $A$.
\end{proof}

A polyhedron is closed and convex.  An intersection of faces of a
convex set is again a face.  A bounded polyhedron falls within the
scope of the Krein-Milman theorem.  In particular, a bounded
polyhedron is the convex hull of its set of extreme points.
\indy{Index}{closed}%

Let $P\subset\ring{R}^n$ be a bounded polyhedron with affine hull
$A$. Write
\begin{equation}\label{eqn:polyrep}
P = A \cap A^+_1 \cap \cdots \cap A^+_r,
\end{equation}
where $A^+_i = \{\p\mid \u_i\cdot \p \le a_i\}$ with bounding
hyperplane $A_i=\{\p\mid \u_i \cdot \p = a_i\}$, for some $\u_i\in
\ring{R}^n$ and $a_i\in\ring{R}$.  Assume that this representation is
minimal in the sense that none of the factors $A^+_i$ may be omitted.
Let $F_i = A_i\cap P$.  \indy{Notation}{P@$P$ (polyhedron)}%


\begin{lemma}\guid{CZZHBLI}\rating{ZZ}\label{lemma:webster}  
Let $P\subset\ring{R}^n$ be a bounded polyhedron.  Then
\indy{Index}{polyhedron}%
\begin{enumerate}
\item The facets of $P$ are $F_i$, $i=1,\ldots,r$.
\item The relative boundary of $P$ is $F_1\cup\cdots \cup F_r$.
\item Every proper face is the intersection of the facets that contain it.
\item Every face of a face of $P$ is a face of $P$.
\item A point is an extreme point of a face $F$ if and only if it is an extreme point of $P$
that is contained in $F$.
\item If $F$ and $F'$ are two faces of $P$ whose relative interiors
meet, then $F=F'$.
\end{enumerate}
\end{lemma}
\indy{Index}{facet}%
\indy{Index}{relative boundary}%
\indy{Index}{face}%

\begin{proof} See \cite[Thm~3.2.1]{webster:1994} for the first three
conclusions.  See \cite[Th~2.6.5]{webster:1994} for the proof of the
next conclusion,

Turn to the fifth conclusion.  An extreme point singleton of $F$ is a face of $P$ (of
dimension $0$) by the fourth conclusion.  Hence every extreme point of $F$
is an extreme point of $P$.  Conversely, a face of $P$ contained in $F$ is a
fortiori a face of $F$.

See \cite[Cor~2.6.7]{webster:1994} for the final conclusion.
\end{proof}

\begin{corollary}\guid{QOEPBJD}\rating{ZZ}
A face of a polyhedron is a polyhedron.  
\end{corollary}

\begin{proof} By Lemma~\ref{lemma:webster}, each facet is defined by a
system of linear inequalities.  (See Lemma~\ref{lemma:aff-poly}.)  A
proper face is an intersection of finitely many facets, and is
therefore given by the conjunction of the inequalities defining the
various facets.
\end{proof}

\begin{lemma}\label{lemma:facet-partition}
  If $P$ is a bounded polyhedron of positive affine dimension with
  facets $F_1,\ldots,F_r$ and if $\emptyset\ne A\subset P$, then
\begin{displaymath}
P = \bigcup_{i=1}^r \op{conv}(A\cup F_i).
\end{displaymath}
\end{lemma}

\begin{proof}
Choose $\u\in A$.   Then
\begin{displaymath}
\bigcup_{i=1}^r \op{conv}(\{\u\}\cup F_i) \subset \bigcup_{i=1}^r \op{conv}(A\cup F_i)\ subset P.
\end{displaymath}
Hence, it is enough to show that any $\u\ne\v\in P$ lies in one of the sets on the left.
By the boundedness of $P$, the ray $\op{aff}_+\{u,\{\v\})$ meets $P$ in an interval
$\op{conv}\{\u,\w\}$, where $\w$ lies on the relative boundary of $P$.  By Lemma~\ref{lemma:webster}, in fact, $\w$ lies in a facet $F_i$.  This gives
\begin{displaymath}
 \v\in \op{conv}\{\u,\w\}\subset \op{conv}(\{u\}\cup F_i).
\end{displaymath}
\end{proof}


\begin{lemma}\label{lemma:simplex-poly}
  Let $S\subset\ring{R}^N$ be a finite set.  Then $P=\op{conv}(S)$ is
  a polyhedron.  Assume moreover that $S$ is an affinely independent
  set with cardinality at least $2$.  Then $S$ is the set of extreme
  points of $P$. Furthermore,   $F$ is a facet of $P$ if and only if $F =
  S\setminus \{\u\}$ for some $u\in S$.
\end{lemma}

\begin{proof}
\end{proof}

\begin{lemma}\guid{NEHRQPR}\rating{ZZ} \label{lemma:scale} 
Let $P$ be a bounded polyhedron with $\orz$ as an interior point.
Suppose that there are proper faces $F,F'$ of $P$, points $\p\in F$,
$\p'\in F'$, and positive scalars $t,t' >0$ such that $t \p = t' \p'$.
Then $t=t'$.
\end{lemma}

\begin{proof} The faces $F,F'$ are subsets of facets of $P$.  It does
no harm to assume that $F$ and $F'$ are themselves facets.  Without
loss of generality, assume for a contradiction that $t>1$ and $t'=1$.
Then $t\p = \p'\in P$.
By Lemma~\ref{lemma:webster}, $F = A \cap P$, where $A= \{\q
\mid \q\cdot \u = a\}$ for some $\u$ and $a$.  Also,
\begin{displaymath}
C\{\p\}\cap P = \op{conv}\{\orz,\p\} = \{\q \mid \orz\le \q\cdot \u \le a\}.
\end{displaymath}
In particular, $t \p\not\in P$, for $t>1$.  This contradiction gives
$s = t$.
\end{proof}





\begin{definition}[$(V_P,E_P)$] Let $P$ be a bounded polyhedron.  Let
$V_P$ be the set of extreme points of $P$.  Let $E_P$ be the set of pairs
$\{\v,\w\}$ of extreme points such that $\op{conv}\{\v,\w\}$ is an edge of
$P$.
\end{definition}
\indy{Index}{polyhedron}%
\indy{Notation}{E@$E_P$ (edge)}%

\begin{lemma}\guid{JLIGZGS}\label{lemma:polyhedron}% \rating{800}
% including
% azim<pi.
Let $P$ be a bounded polyhedron in $\ring{R}^3$ with the interior
point $\orz$.  Then $(V_P,E_P)$ is a fan.
\end{lemma}
\indy{Index}{fan}%

\begin{proof} The properties of a fan can be checked one by one.  By
the Krein-Milman lemma, the set of extreme points is non-empty.  By
Lemma~\ref{lemma:webster}, there are finitely many faces, so that
$V_P$ is finite.  Since $\orz$ is an interior point, it does not
meet any proper face.  In particular, $\orz\not\in V_P$.  In particular,
for all $\ee\in E_P$, $\orz\not\in \op{conv}(\ee)$.

Suppose for a contradiction that $\{\v,\w\}\in E_P$ and that $\v$
and $\w$ are parallel.  As $\orz\not\in \op{conv}(\ee)$, some
relation has the form $s \v = t \w$, for some $s, t>0$.  By
Lemma~\ref{lemma:scale}, $s=t$ and $\v=\w$, which is contrary to the
definition of edge as a face of dimension $1$.

Finally, the intersection property $C(\ee)\cap C(\ee') = C(\ee \cap
\ee')$ can be checked.  By Lemma~\ref{lemma:scale},
\begin{displaymath}
C(\ee) \cap C(\ee') = \{t \p \mid \p\in \op{conv}(\ee) \cap \op{conv}(\ee') \text{ and } t \ge 0\}.
\end{displaymath}
$\op{conv}(\ee)$ and $\op{conv}(\ee')$ are both faces of $P$.  The
intersection is again a face of $P$.  The intersection is the convex
hull of its set of extreme points, that is, the convex hull of $\ee \cap \ee'$.
Thus,
\begin{displaymath}
C(\ee)\cap C(\ee') = \{t \p \mid \p\in \op{conv}(\ee\cap \ee')\} = C(\ee \cap \ee').
\end{displaymath}
Thus, all the defining conditions of a fan are satisfied.
\end{proof}


\begin{lemma}\guid{AMHFNXP}\rating{ZZ}\label{lemma:WF} 
Let $P$ be a bounded polyhedron in $\ring{R}^3$ with $\orz$ as an
interior point.  Let $(V_P,E_P)$ be the associated fan.  There is a
bijection between the facets of $P$ and the topological components
of $Y(V_P,E_P)$ given by
\begin{displaymath}
F \mapsto W_F = \{t \p \mid \p\in \op{ri}(F),~t >0\}.
\end{displaymath}
\end{lemma}
\indy{Index}{component!topological}%

\begin{proof} It is enough to check that the following four claims
about $W_F$.

\claim { $W_F$ is connected.} Indeed, by Lemma~\ref{lemma:webster},
the relative interior of a convex polyhedron is the intersection of
an affine set with open half-spaces, which is the intersection of
convex sets, and is therefore convex. The set $\op{ri}(F)$ is
convex, hence connected.  The positive half-line $I=\{t\mid t>0\}$
is connected.  The continuous image of the connected set
$\op{ri}(F)\times I$ of these two sets is $W_F$.  Hence $W_F$ is
connected.

\claim { $W_F$ is open.}  Indeed, this is a standard
$\epsilon$-argument.  Let $A$ be the affine hull of $F$.  For any
$\p\in \op{ri}(F)$, pick $r>0$ such that $B(\p,r)\cap A\subset
\op{ri}(F)$.  Pick $r'>0$ and $0<\epsilon<1$ such that for all
$\q\in B(\p,r')$, there exists $t$ such that $|t|<\epsilon$ and
$(1+t)\q\in A$.  After shrinking $r'$, if $\q\in B(\p,r')$, then
$(1+t)\q \in B(\p,r)\cap A \subset \op{ri}(F)$.  That is,
$B(\p,r')\subset W_F$.  Hence $W_F$ is open.

\claim { The sets $W_F$ are pairwise disjoint, and the map $F\mapsto
W_F$ is one-to-one.}  Indeed, select any two facets $F,F'$ for
which $W_F\cap W_{F'}\ne \emptyset$.  That is, there exist $\p\in
\op{ri}(F)$, $\q\in \op{ri}(F')$, and $s,t>0$ such that $s \p = t
\q$.  By Lemma~\ref{lemma:scale}, $s=t$ and $\p=\q\in \op{ri}(F)\cap
\op{ri}(F')$.  By the final statement of Lemma~\ref{lemma:webster},
this implies that $F=F'$.

\claim { The union of the sets $W_F$ is $Y(V_P,E_P)$.}  Indeed,
select any $\p\in Y(V_P,E_P)$.  As $\orz$ lies in the interior of
the bounded polyhedron, we may rescale $\p$ by a positive scalar $t$
so that $t \p$ lies in the boundary of $P$, and hence (by
Lemma~\ref{lemma:webster}) in a facet $F$.  If $t \p \in
\op{ri}(F)$, then $\p\in W_F$, as desired.  Otherwise, $t \p$ lies
in the relative boundary of $F$.  The facets of a three dimensional
polyhedron have dimension $2$; and the facets forming the relative
boundary of $F$ have dimension $1$.  These faces are edges of $P$.
Thus, $t \p$ lies in an edge of $P$, so that $\p\in X(V_P,E_P)$,
which is contrary to the assumption that $\p\in Y(V_P,E_P)$.  The
conclusion follows.

From these claims, it follows that the sets $W_F$ are the
topological components of $Y(V_P,E_P)$.
\end{proof}
\indy{Index}{connected}%

\begin{lemma}\guid{WBLARHH}\rating{ZZ}\label{lemma:facet-bi}
Let $P\subset\ring{R}^3$ be a bounded polyhedron with interior point
$\orz$.  The facets of $P$ are in bijection with the faces of
$\op{hyp}(V_P,E_P)$, under the correspondence
\begin{displaymath}
F\leftrightarrow F' \text{ if and only if } W_F = U_{F'}.
\end{displaymath}
\end{lemma}

\begin{proof} The faces of the hypermap are in bijection with the set
$[Y]$ of topological components of $Y(V_P,E_P)$.  The facets of $P$
are also in bijection with $[Y]$.
\end{proof}

\begin{lemma}\guid{BSXAQBQ}\rating{ZZ} Let $P$ be a bounded polyhedron
with $\orz$ as an interior point.  Then $\op{azim}(x) < \pi$ for
every dart $x$ in the hypermap $\op{hyp}(V_P,E_P)$.
\end{lemma}
\indy{Index}{polyhedron}%
\indy{Index}{interior!point}%
\indy{Index}{hypermap}%
\indy{Index}{dart}%

\begin{proof} The dart $x=(\v,\w)$ leads into some topological
component $U_x$, which is equal to $W_F$, for some facet $F$ of $P$.
The relative interior of $F$ is contained in $W_F\subset \Wdart(x)$.
The facet $F$ is contained in $\bWdart(x)$. Now
\begin{displaymath}
\bWdart(x) = \Wdart(x)\cup A,
\end{displaymath}
where $A$ is the union of the two bounding half-planes.  The relative
interior of $F$ does not meet $A$.

By Lemma~\ref{lemma:scale}, the extreme point singleton $\{\v\}$ is a face of $F$.  The
singleton $\{\v\}$ is the intersection of edges (that is, facets) of $F$
containing $\v$.  These edges are contained in $A$.  Each of the two
half-planes forming $A$ contains such an edge. (In fact, each contains
exactly one edge.)  \indy{Index}{component!topological}%
\indy{Index}{dart}%
\indy{Index}{wedge}%
\indy{Index}{interior!relative}%

If $\op{azim}(x)>\pi$, the segment between points chosen on the
relative interiors of edges (of $F$ meeting $\v$) in the two different
bounding half-planes is not contained in $\bWdart(x)$.  This is
contrary to the convexity of $F$.  \indy{Index}{convex}%
\indy{Notation}{azim}%

If $\op{azim}(x)=\pi$, then $A$ is a plane.  It is the bounding plane
of a half-space containing $F$.  Directly from the definition of face,
it can be checked that the intersection $A\cap F$ is a proper face of
$F$.  This face contains an edge (which is a facet of $F$) and must
therefore be a single edge.  This contradicts the observation that
$A\cap F$ contains at least two edges.  Hence $\op{azim}(x)<\pi$.
\end{proof}


