\chapter{Fan}\label{sec:fan}




\begin{summary}
  This chapter is the final foundational chapter.  The main concept is
  that of a fan, a geometric object that is related both to sphere
  packings and to hypermaps.  A fan determines a set $V$ of points in
  $\ring{R}^3$, which later chapters interpret as the set of centers
  of a packing of congruent balls.  The same set $V$ can be
  interpreted as the set of nodes of a hypermap or as the set of
  nodes of a graph.  In fact, a fan is a graph and a geometric
  realization of a hypermap.  The main result of this chapter, an
  Euler formula for fans,  implies that the hypermap of a
  fan is planar.  To make the material in this chapter as self-contained
 as possible, the planarity results in this chapter have been carefully
  organized to avoid any use of the Jordan curve theorem.

  Fans are also closely related to polyhedra.  This chapter associates
  a fan with every bounded polyhedron in $\ring{R}^3$ with nonempty
  interior.  Polyhedra inherit various properties from fans, such
  as an Euler formula for polyhedra.
\end{summary}


\indy{Index}{fan}%
\indy{Index}{hypermap}%
\indy{Index}{planar}%
\indy{Index}{packing}%
\indy{Index}{Jordan curve theorem}%

\section{Definitions}




% In this chapter, a choice of base point $\orz\in\ring{R}^3$ serves
% as the origin.  It does no harm to assume, in fact, that $\orz =0$.


If $S\subset\ring{R}^3$ is a set of points,
abbreviate
\begin{align*}
C_\pm(S) &= \op{aff}_\pm(\orz,S),\\
C^0_\pm(S) &= \op{aff}^0_\pm(\orz,S).\\
\end{align*}
When the subscript is absent, the subscript $+$ is implied: $C_+(S)
= C(S)$, and so forth.  The parentheses around the set are frequently
omitted:
\[ C^0\{\v,\w\}=C^0_+(\{\v,\w\}) =
\op{aff}^0_+(\{\orz\},\{\v,\w\}).\] 
\indy{Notation}{C@$C_\pm,~C^0_\pm$ (blade)}%
\indy{Notation}{zze1@$\ee$ (edge of a fan)}%

The following definition gives the main object of study in this
chapter (Figure~\ref{fig:fan}).  The separate defining properties of a
fan are given by name because we need to make frequent reference to
them.

\begin{definition}[fan,~blade]\guid{DSKAGVP}\label{def:fan}
\formaldef{fan}{FAN}  
Let $(V,E)$ be a pair consisting of a set $V\subset \ring{R}^3$ and
a set $E$ of unordered pairs of distinct elements of $V$.  The pair
is said to be a \newterm{fan\/} if the following properties hold.
\begin{enumerate}
\item \firstcase{cardinality} $V$ is finite and  nonempty.
\formaldef{cardinality}{fan1}
\item \firstcase{origin} $\orz\not\in V$.
\formaldef{origin}{fan2}
\item \firstcase{nonparallel} If $\{\v,\w\} \in E$, then $\v$ and $\w$
are not parallel.
\formaldef{nonparallel}{fan6}
\item \firstcase{intersection}
For all $\ee ,\ee '\in E \cup \{\{\v\}\mid \v\in V\}$, 
\formaldef{intersection}{fan7}
\[ C(\ee )\cap C(\ee ') = C(\ee \cap \ee
').\] 
\end{enumerate}
When $\ee\in E$, call $C^0(\ee)$ or $C(\ee)$ a \newterm{blade}
of the fan.
\end{definition}
\indy{Index}{fan}%
\indy{Notation}{V@$(V,E)$ (fan)}%
\indy{Notation}{E@$E$ (edge set of a fan)}%

\figIIAHJXI % fig:fan

\begin{remark}
  In the mathematical literature, other objects go by
  the name of fan.  The definition of fan given below is not the same
  as definitions in other mathematical contexts.  In particular, a fan
  in this book is not a fan from the theory of toric
  varieties.\footnote{According to
    Fulton~\cite{Fulton}, % Introduction to toric varieties
    a toric variety fan is a family $\Delta$ of rational strongly
    convex polyhedral cones in $N_{\ring{R}}$ (the vector space
    generated by a lattice $N$) such that (1) each face of a cone in
    the family is again in the family, and (2) the intersection of two
    cones in the family is a face of each cone.  For our purposes, a
    fan determines a set of strongly convex polyhedral cones $\Delta =
    \{ C(\ee)\mid \ee\in E\cup \{ \{v \} \} \cup \{ \{ \orz\} \} \}$,
    which satisfies conditions (1) and (2).  Hence, a fan in our sense
    bears some relation to a toric variety fan.}
\end{remark}




% Repeat an older version of the definition (in use between May 15
% 2009 and June 18 2009).
% \begin{definition}[retro-fan]\guid{EWHEZJT}
% Let $(\orgz,V,E)$ be a triple
%   consisting of a point, a set of points, and a set of pairs of
%   elements of $V$.  The triple is said to be a \newterm{retro-fan\/}
%   if the following conditions hold.
%    \begin{enumerate}\wasitemize 
%    \item $V$ is finite and nonempty.
%    \item $\orz\not\in V$.
%    %\item Each element of $E$ has two elements.
%    \item For each $\v\in V$, the set
%        \[ 
%        %%          WW changed notation from E_\v to E(\v) to allow
%        %%          deformations E_t
%        E(\v) = \{\w\in V\mid \{\v,\w\}\in E\}
%        \] 
%        is cyclic with respect to $(\orz,\v)$.
%    \item For each $\ee\in E$, $V\cap C^0(\orz,\ee)=\emptyset$.
%    \item  Sets $\ee,\ee'\in E$ give
%      \[ C^0(\orz,\ee) \cap
%        C^0(\orz,\ee')\ne\emptyset\ \Rightarrow (\ee =
%        \ee').\] 
%    \item Sets $\v,\v'\in V$ give
%      \[ \op{aff}^0_+(\orz,\v) =
%        \op{aff}^0_+(\orz,\v')\ \Rightarrow
%        (\v=\v').\] 
%      %% Added condition May 15, 2009./ killed June 18
%    \end{enumerate}\wasitemize 
%\end{definition}

\subsection{basic properties}

The rest of the chapter develops the properties of fans.  We begin with
a completely trivial consequence of the definition.

\begin{lemma}[]\guid{CTVTAQA}\label{lemma:subset-fan}
If $(V,E)$ is a fan, then for every $E'\subset E$, $(V,E')$ is also
a fan.
\end{lemma}

\begin{proof} This proof is elementary.
\end{proof}

\begin{lemma}[fan cyclic]\guid{XOHLED}\cutrate{}  
\formaldef{$E(v)$}{set\_of\_edge}
Let $(V,E)$ be a fan.
For each $\v\in V$, the set
\[ 
E(\v) = \{\w\in V\mid \{\v,\w\}\in E\}
\] 
is cyclic with respect to $(\orz,\v)$.
\end{lemma}
%\indy{Notation}{E@$E(\v)$ (edge set)}%
\indy{Notation}{E3@$E(\v)$ (set of edges adjacent to $\v$)}%

\begin{proof}  If $\w\in E(\v)$, then $\v$ and $\w$ are not parallel.
Also, if $\w\ne \w'\in E(\v)$, then
\[ 
C\{\v,\w\}\cap C\{\v,\w'\} = C\{\v\}.
\] 
This implies that $E(\v)$ is cyclic.
\end{proof}

\begin{remark}[easy consequences of the definition]\guid{WCXASPV}\label{rem:fan}
Let $(V,E)$ be a fan.
%\hfill\break
\begin{enumerate}\wasitemize 
\item The pair $(V,E)$ is a graph with nodes $V$ and edges $E$.  The set
\[ \{\{\v,\w\}\mid \w\in E(\v)\}\]  is
the set of edges at node $\v$.  There is an evident symmetry: $\w\in
E(\v)$ if and only if $\v\in E(\w)$.
%
\item \formaldef{$\sigma$}{sigma\_fan}%
  \formaldef{$\sigma(v)^{-1}$}{inverse1\_sigma\_fan}%
  Since $E(\v)$ is cyclic, each $\v\in V$ has an azimuth cycle
  $\sigma(\v):E(\v)\to E(\v)$.  The set $E(\v)$ can reduce to a
  \indy{Index}{azimuth cycle}%
  singleton. If so, $\sigma(\v)$ is the identity map on $E(\v)$.
%
To make the notation less cumbersome, $\sigma(\v,\w)$ denotes the
value of the map $\sigma(\v)$ at $\w$.
%
\item The property \case{nonparallel} implies that the graph has no
loops: $\{\v,\v\}\not\in E$.
%
\item The property \case{intersection} implies that distinct sets
$C^0(\ee)$ do not meet.  This property of fans is eventually
related to the  planarity of hypermaps.
%
\indy{Index}{hypermap}%
\indy{Index}{planar}%
\indy{Index}{edge!graph}%
\indy{Index}{edge!fan}%
%
\end{enumerate}\wasitemize 
\end{remark}

\begin{remark}[verifying the fan properties]\guid{GMLWKPK}\label{remark:fan-verify}  
We are often given a pair $(V,E)$ and asked to verify
that it is a fan.  Here are a few tips about how to verify the fan
properties in practice.
\begin{enumerate} 
\item \case{cardinality} If $V$ is defined as a subset or image of a
finite set, then it is evidently finite.  Also, if $V$ is a bounded
subset of $\ring{R}^3$ and if $V$ has no limit point,  then $V$ is finite.
Lemma~\ref{lemma:V-finite} gives a finiteness result when the
minimum distance is $2$.\vspace{6pt}
\item \case{origin} If $(V,E)$ is a fan, then any subset of $V$
inherits the property $\orz\not\in V$ from $V$.  \vspace{6pt}
\item \case{nonparallel} \claim{If the property \case{intersection}
is known, then to prove that $\u$ and $\v$ are not parallel, it is
enough to show the strict form of the triangle inequality:}
\begin{equation}\label{eqn:strict-triangle}
\norm{\u}{\v} < \normo{\u} + \normo{\v}.
\end{equation}
Indeed, the strict form of the triangle inequality implies that
$\orz\not\in \op{conv}\{\u,\v\}$.  Also, the intersection property
implies that $C^0\{\v\} \cap C^0\{\u\} = \emptyset$.  These conditions
imply that $\u$ and $\v$ are not parallel.  Inequality~\eqref{eqn:strict-triangle}
is equivalent to
\[ 
\arc_V(\orz,\{\u,\v\}) < \pi.
\] 
\item \case{intersection} The intersection property is generally the
most difficult to verify in practice.  Some geometrical reasoning
based on additional facts about $(V,E)$ is generally required to
verify the intersection property.  If $(V,E)$ is a fan, then the
intersection property is inherited by subsets of $V$ and $E$.  Also,
note that
\[ 
C(\ee\cap \ee') \subset C(\ee) \cap C(\ee')
\] 
always holds by elementary geometry.  Hence, it is enough to check the
reverse inclusion.  Furthermore, if $\ee = \ee'$, then the
intersection property is a triviality.  The verification comes down to
checking two cases:
\[ 
C(\ee) \cap C(\ee') = \{\orz\},
\] 
when $\ee\cap \ee' = \emptyset$, and
\[ 
C(\ee)\cap C(\ee') = C\{\v\},
\] 
when $\ee\cap \ee' = \{\v\}$.
\end{enumerate}
\end{remark}

\subsection{hypermap}
One of the main uses of a fan in this book is to provide a link between sphere
packings and hypermaps.  Next, we associate a hypermap
with a fan.   We define a set of darts and permutations on that set of darts as follows.

Let $(V,E)$ be a fan.  Define a set of darts $D$ to be the disjoint union of
two sets $D_1,D_2$:
\formaldef{$D_1$}{d1\_fan}
\formaldef{$D_2$}{d2\_fan}
\begin{align*}
D_1 &= \{(\v,\w)\mid \{\v,\w\}\in E\},\\
D_2 &= \{(\v,\v) \mid \v\in V,\ \ E(\v) = \emptyset\},\textand \\
D\phantom{_2}   &= D_1\cup D_2.
\end{align*}
Darts in $D_2$ are said to be \newterm{isolated} and darts in
$D_1$ are \fullterm{nonisolated}{isolated}.
%
\indy{Index}{dart}%
\indy{Index}{dart!isolated}%
\indy{Index}{isolated}%
\indy{Notation}{D@$D$ (dart set)}%
\formaldef{$n$}{n\_fan}
\formaldef{$f$}{f1\_fan}
\formaldef{$e$}{e\_fan}
Define permutations $n$, $e$, and $f$ on $D_1$ by
\begin{align*}n(\v,\w) &= (\v,\sigma(\v,\w)),\\
f (\v,\w) &= (\w,\sigma(\w)^{-1} \v),\\
e (\v,\w) &= (\w,\v).
\end{align*}
Define permutations $n,e,f$ on $D_2$ by making them degenerate on $D_2$:
\[ 
n (\v) = e(\v) = f(\v) = \v.
\] 
Set %$\op{hyp}_r(V,E)=(D_1,e,n,f)$ and 
$\op{hyp}(V,E)=(D,e,n,f)$. %for %  them the nonisolated hypermap
%the hypermap associated with $(V,E)$.  
The next lemma shows that $(D,e,n,f)$ is indeed a hypermap.



\begin{lemma}[]\guid{AAUHTVE}\label{lemma:fan-plain}
Let $(V,E)$ be a fan.  Let $D = D_1\cup D_2$
and $\op{hyp}(V,E) = (D,e,n,f)$, as constructed above.  Then
\begin{enumerate}\wasitemize 
\item $\op{hyp}(V,E)$ is a plain hypermap.
\item  $e$ has no fixed
points in $D_1$.
\item  $f$ has no fixed points in $D_1$.
\item For every pair of distinct nodes,  at most one
edge  meets both.
\item The two darts of an edge of $D_1$ lie at different nodes.
\end{enumerate}\wasitemize 
\indy{Notation}{hyp@$\op{hyp}$ (hypermap)}%
\end{lemma}

\begin{proof}  
\begin{alignat*}{6}
e(n(f(\v,\w))) &= e(n(\w,\sigma(\w)^{-1} \v)) &&=
e(\w,\v)\\ 
&= (\v,\w).
\end{alignat*}
So $\op{hyp}(V,E)$ is a hypermap. 
Plainness is an elementary calculation:
\[ e(e(\v,\w)) = e(\w,\v) = (\v,\w).\] 
There is no fixed point in $D_1$ under $e$, because otherwise, $\v = \w\in E(\v)$
but by construction $\v\not\in E(\v)$.  The argument that $f$ has no
fixed points is similar.

The next step is to show that for every two distinct nodes, there
is at most one edge meeting both.  That is,
\[ (n^i e x = e n^j x)\Rightarrow (n^j x =
x).\]  Let $x = (\v,\w)\in D_1$.  Let
$\sigma=\sigma(\v)$. Then
\begin{align*}
n^j x &= (\v,\sigma^j \w)\\
e n^j x &= (\sigma^j \w,\wild )\\
e x &= (\w,\wild )\\
n^i e x &= (\w,\wild )\\
n^i e x &= e n^j x \\&\,\Rightarrow (\w = \sigma^j \w) \\&\,\Rightarrow
(n^j x = (\v,\w) = x).
\end{align*}

Finally,  each dart of an edge lies on a different node.
That is, $e x \ne n^i x$ for $x\in D_1$.   In detail:
\begin{align*}
e(\v,\w) &= (\w,\wild ),\quad \w\in E(\v)\\
n^i(\v,\w) &= (\v,\wild ),\quad \v\not\in E(\v).
\end{align*}
The lemma ensues.
\end{proof}

\section{Topology}\label{sec:topology}

\subsection{background}

%There is hardly any topology that comes up in this book.  Most of
%what is needed appears in this chapter.  
This chapter uses some basic
notions from topology such as continuity, connectedness, and compactness.

\begin{remark}  We use the term \newterm{connected} in two
different senses: in the topological sense and in a combinatorial
sense for hypermaps.  To reduce the confusion, this book calls a
connected component of a topological space a \newterm{topological
component} and a connected component of a hypermap
a \newterm{combinatorial component}.
\end{remark}
\indy{Index}{connected!topological component}%
\indy{Index}{connected!combinatorial component}%


We assume basic facts about the topology of Euclidean space.  In
particular, the set $\ring{R}^3$ is a metric space under the Euclidean
distance function $d(\v,\w) = \norm{\v}{\w}$.  Every subset of
$\ring{R}^3$ is a metric space under the restriction of the metric $d$
to the subset.  A subset carries the metric space topology.  In
particular, \[ S^2 = \{ \v \mid \normo{ \v} =
1\},\]  the unit sphere in $\ring{R}^3$ centered at
$\orz$, is a metric space and a topological space.
\indy{Index}{metric space} %
\indy{Index}{sphere} %
\indy{Notation}{S@$S^2(r)$ (sphere of radius $r$)}%

If $Y$ is an open set in $\ring{R}^3$, write
$\comp{Y}$ for its set of topological components.
The family of topological components of $Y$ has the following properties:
the members are pairwise disjoint, nonempty, connected open sets; and the
union of the family is all of $Y$.
Conversely, any family with these properties must be the
family of topological components of $Y$.
If two
points in $\ring{R}^3$ 
can be joined by a continuous path in $Y$,
then the two points lie in the same topological component of $Y$.
\indy{Index}{path connected}%
\indy{Index}{connected!topological component}%
\indy{Notation}{1@$\comp{Y}$ (topological components)}%







\subsection{topological component and dart}

The next series of definitions and lemmas introduce terminology to
refer to the different geometric features of a fan.  A major theme of
this chapter is the correspondence between the geometric features of a
fan and the combinatorial properties of the hypermap.  For example, we
show that the set of nodes of the hypermap is in natural bijection
with the set of nodes $V$ of the fan $(V,E)$
(Lemma~\ref{lemma:node-vertex}).  We describe when the set of faces of
the hypermap is in bijection with the topological components of the
following
set $Y(V,E)$.

\begin{definition}[X,~Y]\guid{ZQHYZQI}\label{def:XY}
\formaldef{$X(V,E)$}{xfan}
\formaldef{$Y(V,E)$}{yfan}
\formaldef{$\Wdarto(x)$}{w\_dart\_fan}
\formaldef{$\Wdart(x)$}{cw\_dart\_fan}
Let $(V,E)$ be a fan.  Let $X=X(V,E)$ be the union of the
blades
\[ C(\ee)\] 
as $\ee$ ranges over $E$.  Let $Y=Y(V,E)$ be the complement
$Y = \ring{R}^3\setminus X$.
\indy{Notation}{X@$X(V,E)\subset\ring{R}^3$ (union of fan blades)}%
\indy{Notation}{Y@$Y(V,E)\subset\ring{R}^3$ (fan complement)}%
\end{definition}

\begin{definition}[$\Wdarto$,~$\Wdart$]\guid{OTAOLKZ}
\formaldef{$\op{rcone}^0(\orz,\v,h)$}{rcone\_fan}
\formaldef{$\Wdarto(x,\epsilon)$}{rw\_dart\_fan}
\hspace{-4pt}
Let $(V,E)$ be a fan and let $(D,e,n,f) = \op{hyp}(V,E)$
be the associated hypermap.  
A wedge $\Wdarto(x)$ and a subset $\Wdarto(x,\epsilon)$ are associated with
 each dart $x=(\v,\w)\in D$.  (See Figure~\ref{fig:Wdart}.)  Define 
\indy{Index}{fan}%
\indy{Index}{dart}%
\indy{Index}{hypermap}%
\indy{Index}{wedge}%
\indy{Index}{angle!azimuth}%
\indy{Index}{azimuth}%
\indy{Index}{dart}%
\indy{Notation}{Wdart@$\Wdarto$ (wedge)}%
\indy{Notation}{azim}%
\indy{Notation}{zze@$\epsilon\in\ring{R}$}%
\[ 
\Wdarto(x)=
\begin{cases} 
W^0(\orz,\v,\w,\sigma(\v,\w)),&\text{if }\card(E(\v))>1,\\
\ring{R}^3\setminus \op{aff}_+(\{\orz,\v\},\w),&\text{if } E(\v) = \{\w\},\\
\ring{R}^3\setminus \op{aff}\{\orz,\v\},&\text{if } E(\v) = \emptyset.\\
\end{cases}
\] 
Define
\[ 
\Wdart(x) = 
\begin{cases} 
W(\orz,\v,\w,\sigma(\v,\w)),&\text{if }\card(E(\v))>1,\\
\ring{R}^3,&\text{otherwise}.\\
\end{cases}
% \{ \u\mid 0\le \op{azim}(\orz,\v,\w,\u)\le
% \op{azim}(\orz,\v,\w,\sigma(\v,\w)) \}.
\] 
($\Wdart(x)$ is the closure of $\Wdarto(x)$.)
For any $x = (\v,\ldots)\in D$, set
\[ 
\Wdarto(x,\epsilon) = \Wdarto(x) \cap \op{rcone}^0(\orz,\v,\cos\epsilon).
\] 
\indy{Notation}{Wdart@$\Wdart$ (closure of $\Wdarto$)}%
\end{definition}

\figSCDMRGM % fig:Wdart

\begin{definition}[$\op{azim}$]\guid{QEIQZZH}
\formaldef{$\op{azim}(x)$}{azim\_fan}
Define $\op{azim}(x)$ as the azimuth angle of $\Wdarto(x)$:
\indy{Notation}{azim}%
\[ 
\op{azim}(x)=\begin{cases}
\op{azim}(\orz,\v,\w,\sigma(\v,\w)), &\text{if } \card(E(\v)) > 1,\\
2\pi, & \text{otherwise.}\\
\end{cases}
\] 
\end{definition}

%All the hypermaps in this book are connected. $D_2$ is not needed.

\begin{lemma}[]\guid{ETSBAGK}\label{lemma:node-vertex}
Let $(V,E)$ be a fan with hypermap $H$.  There is a natural bijection between
nodes of $H$ and $V$ that sends the node containing the dart $(\v,\wild)$
to $\v\in V$.
\end{lemma}

\begin{proof}  This is left as an exercise for the reader.
\end{proof}

\begin{definition}[$\nd$]\guid{VGNBFSH}
Write $\nd(x)\in V$ for the node corresponding to a dart $x\in D$,
under the identification of nodes of a hypermap $H$ with $V$.
\end{definition}
\indy{Notation}{node@$\nd:D\to V$ (node of a dart)}%

\begin{lemma}[node partition]\guid{VBTIKLP}\label{lemma:disjoint}
  Let $(V,E)$ be a fan.  Let $\v\in V$.  Then  a disjoint sum
  decomposition of $\ring{R}^3$ is given by
\[ 
\ring{R}^3 = 
\op{aff}\{\orz,\v\} \cup
\bigcup_{\nd(x)=\v} \Wdarto(x)  \cup 
\bigcup_{\{\v,\w\}\in E} \op{aff}_+^0(\{\orz,\v\},\w).
\] 
\end{lemma}
\indy{Index}{disjoint sum decomposition}%
\indy{Index}{hypermap}%
\indy{Index}{dart}%





\begin{proof}
We start the proof with the existence of the disjoint sum decomposition.
First of all, $\ring{R}^3$ is the disjoint union of $\op{aff}\{\orz,\v\}$
and its complement.

The case when $\card(E(\v))\le 1$ follows immediately from the
definitions.  Therefore, assume that $\card(E(\v)) >1$.  Fix $\u$ such
that $\{\v,\u\}\in E$, and let $\sigma$ be the azimuth cycle on
$E(\v)$.  Let $\alpha(i)=\op{azim}(\orz,\v,\sigma^i
\u,\sigma^{i+1}\u)$.  By Lemma~\ref{lemma:2pi-sum}, the sum of the
angles $\alpha(i)$ is $2\pi$.  Every
$\p\in\ring{R}^3\setminus\op{aff}\{\orz,\v\}$ satisfies either
\[ 
\sum_{i=0}^j \alpha(i) <
\op{azim}(\orz,\v,\u,\p) < \sum_{i=0}^{j+1} \alpha(i).
\] 
or 
\[ 
\sum_{i=0}^j \alpha(i) = \op{azim}(\orz,\v,\u,\p)
\] 
for a unique $0 \le j < n$, where $n$ is the cardinality of $E(\v)$. 
These conditions are exactly the membership conditions for the sets
$
\Wdarto(\v,\sigma^j \u)
$
and $\op{aff}_+^0(\{\orz,\v\},\sigma^j \u)$, respectively.
The result ensues.
\end{proof}

\begin{corollary}[disjointness]\guid{IBZWFFH}\label{cor:W}
  Let $(V,E)$ be a fan, let $x = (\v,\ldots)$ be a dart in the
  hypermap of $(V,E)$ and let $\w\in E(\v)$.  Then $\Wdarto(x)\cap
  C\{\v,\w\}=\emptyset$.
\end{corollary}

\begin{proof} The decomposition established in
  Lemma~\ref{lemma:disjoint} is disjoint.  It follows directly from
  the definitions that
\[ C\{\v,\w\}\subset \op{aff}_+^0(\{\orz,\v\},\w) \cup 
\op{aff}\{\orz,\v\}.\] 
\end{proof}

The next lemma gives an important map from a combinatorial structure (the
set of darts) to a topological object  (the set $[Y(V,E)]$).  After presenting the
proof, we  codify the map in a definition.

\begin{lemma}[dart and topological component]\guid{JGIYDLE} 
Let $(V,E)$ be a fan.
For each dart $x$ in the hypermap of $(V,E)$
and for every $\epsilon$ sufficiently small and positive,
$\Wdarto(x,\epsilon)$ is nonempty and lies in a single 
topological component of $Y(V,E)$.
\end{lemma}
\indy{Index}{connected!topological component}%
\indy{Notation}{Wdart@$\Wdarto$ (wedge)}%

\begin{proof} The proof first shows that $\Wdarto(x,\epsilon)$ lies in
  $Y$ for $\epsilon$ small.  Let $x=(\v,\w)\in D_1$.  Let $S^2$ be
  the unit sphere centered at $\orz$.  By making $\epsilon$ small
  enough, the sets\footnote{Beware of the notational subtleties:
    $\epsilon\in\ring{R}$ is not $\ee\in E$.}  
  $\Wdarto(x,\epsilon)\cap
  S^2$ avoid the compact sets $C(\ee)\cap S^2$ when $\v\not\in \ee$.
  Thus, $\Wdarto(x,\epsilon)$ also avoids $C(\ee)$ when $\v\not\in
  \ee$.  By Corollary~\ref{cor:W}, $\Wdarto(x,\epsilon)$ avoids
  $C(\ee)$, when $\v\in \ee$.  Thus, $\Wdarto(x,\epsilon)\subset Y$ for $\epsilon$ small.

To complete the proof, it is enough to show that each
$\Wdarto(x,\epsilon)$ is connected.  The product of intervals
\[ 
\{(r,\theta,\phi) \mid r\in (0,\infty),
~\theta\in (\theta_1,\theta_2),~\phi\in (0,\epsilon)\}
\] 
is connected.  The set $\Wdarto(x,\epsilon)$ is the image of this
product under a spherical coordinate representation
(Definition~\ref{def:sph}).  
It is readily verified that the spherical to Cartesian coordinate
transformation is a continuous map. As the image of a connected set
under a continuous map, $\Wdarto(x,\epsilon)$ is connected.
\end{proof}
\indy{Index}{connected}%
\indy{Index}{polar!coordinate}%
\indy{Index}{spherical!coordinates}%



\begin{definition}[lead~into]\guid{DZYIUPU}
  Let $(V,E)$ be a fan.  For each dart $x$ in the hypermap of $(V,E)$,
  there exists a well-defined topological component $U_x$ of $Y(V,E)$
  that contains $\Wdarto(x,\epsilon)$ (for all sufficiently small
  positive $\epsilon$). The dart $x$ is said to \newterm{lead into} $U_x$.
\end{definition}
\indy{Index}{connected}%
\indy{Notation}{U@$U_x$ (topological component)} %


\section{Planarity}

One of the main results of this chapter holds that the hypermaps
associated with certain fans are planar (Lemma~\ref{lemma:cfplanar}).
Recall that a hypermap is defined to be planar if Euler's formula
holds for the hypermap.  Every fan is a graph and is \newterm{plane} in
the sense of being embedded in a sphere.  The proof of hypermap
planarity ultimately reduces to the Euler formula for the fan, viewed
as a plane graph.

There are many proofs of Euler's formula for a graph.  We may pick our
favorite and translate it into the language of
hypermaps.
%\footnote{Beware!  Most proofs of Euler's formula for plane
%  graphs rely on the Jordan curve theorem, either explicitly or
%  implicitly.  Our proof carefully avoids the Jordan curve theorem.}
The graph has special properties that allow us to simplify the proof
of Euler's formula: it is embedded in the sphere with edges formed by
geodesic arcs, and the faces are all geodesically convex polygons.

We prove Euler's formula as follows.  A geodesically convex polygon
has a diagonal (Lemma~\ref{lemma:sweep}).  The diagonal, which breaks
a polygon into two smaller ones, permits an induction on the number of
sides for the area of each polygonal face of the hypermap,
generalizing Girard's formula for the area of a triangles.  An identity, which
equates the sum of these areas with the total surface area of a sphere, is
equivalent to Euler's formula.  This proof can be recognized as a special
case of the Gauss--Bonnet formula, which relates the Euler characteristic to
the area of a surface of constant curvature.


The reader who is ready to believe Euler's formula for plane graphs
and to accept that the hypermaps of fans are planar may safely skip
this section.

\subsection{face attributes}

To simplify the proofs in this section,  we generally assume that fans 
satisfy the following  convexity condition.

\begin{definition}[fully surrounded]\guid{EOUATJI}
\formaldef{fully surrounded}{fan80}
\hspace{-8pt}
A fan $(V,E)$ is \newterm{fully surrounded}, if $\op{azim}(x)<\pi$
for all darts $x$ in the hypermap of $(V,E)$.
\end{definition}
\indy{Index}{fully surrounded}%

The following lemma proves the existence of a diagonal to a nontriangular
face.  A diagonal  divides a face into two faces, each with fewer sides
than the original.  The existence of the diagonal occurs in induction arguments
to reduce statements about a face to statements about faces with fewer sides.
The following lemma is thus the key technical lemma for many of the results
in this section.

\begin{lemma}[sweep]\guid{DHVFGBC}\label{lemma:sweep}  
Let $(V,E)$ be a fan with hypermap $(D,e,n,f)$.  
Suppose that $(V,E)$ is fully surrounded. Fix a dart $x\in D$.
Let $\v = \nd(x)$, $\v_0 = \nd(f x)$,
and $\v_1 = \nd(f^2 x)$.  Let $\w(t) = (1-t) \v_0 + t\, \v_1$ for
$0\le t\le 1$.  Then
\begin{enumerate}\wasitemize 
\item  For each $t\in[0,1]$, $\v$ and $\w(t)$ are not parallel.
\item If $0 < t \le 1$, and $C^0\{\v,\w(t)\}$ meets $X$, then $t=1$ and
$\{\v,\v_1\}\in E$.  (See Figure~\ref{fig:vt}.)
%\item For $0< t < 1$, it follows $C^0(t)\subset Y$.
%item If $\{\v,\v_1\}\in E$ (that is, if the face of $x$ is a triangle), 
%then $C^0(1)$ is the blade $C^0\{\v,\v_1\}$ of the fan.
%\item If $\{\v,\v_1\}\not\in E$, then $C^0(1)\subset Y$.
\end{enumerate}\wasitemize 
\end{lemma}

\figJCAEBKL % fig:vt

%\begin{figure}[htb]
%\centering
%\szincludegraphics[width=50mm]{\pdfp/vt.eps}
%\caption{Sweeping a blade through a fan}
%\label{fig:vt}
%\end{figure}


\begin{proof}
Abbreviate $C^0(t) = C^0\{\v,\w(t)\}$.
Let $Y = Y(V,E)$ and $X = X(V,E)$.
It follows from the definition of a fan that $\{\v,\v_0\}\in E$ and
that $\v$ and $\v_0$ are not parallel.  By continuity, $\v$ and $\w(t)$
are not parallel when $t$ is sufficiently small and positive.  
% If it exists, set $t'$ as the smallest $t>0$ for which
% $\{\orz,\v,\w(t)\}$ is a collinear set.  If it exists, let
% $I=\{t\mid 0< t < t'\}$, otherwise let $I=\{t\mid 0 < t \le 1\}$.
% For each $t\in I$, the blade $C^0(t)$ is not a collinear set and is
% contained in a unique plane $A(t)$ through $\orz$ and $\v$.
Let $I\subset\leftopen0,1\rightclosed$ be any interval that contains
$(0,\epsilon)$ for some sufficiently small positive $\epsilon$, with the
property that $\v$ and $\w(t)$ are not parallel for all $t\in I$.

\claim{We claim that if $t\in I$ and $C^0(t)$ meets $X$, then $t=1$ and
$\{\v,\v_1\}\in E$.}  Indeed, an inspection of possible
intersections with nodes $\u\in V$ and blades $C^0(\ee)\subset X$
shows that for $t>0$ sufficiently small, $C^0(t)$ does not meet $X$;
hence, $C^0(t)\subset Y$.  Assuming that $C^0(t)$ meets $X$ for some
$t\in I$, let $a$ be the smallest such $t\in I$.  $C^0(a)$ cannot meet
$X$ at a node $\u\in V$ because $\op{azim}(y)<\pi$ whenever
$\u=\nd(y)$, which means that
%for any $t$ for which  $C^0(t)$ meets $\u$ 
there exists a smaller $t<a$ for which $C^0(t)$ meets a blade at $\u$.
Thus, $C^0(a)$ first meets $X$ along a blade $C^0(\ee)$. If the
intersection with this blade is transversal, again one can find a
smaller $t$ that gives an intersection with the blade.  Hence,
$C^0(a)$ and $C^0(\ee)$ are coplanar.  From the disjointness
properties of blades of a fan, it follows that $\ee = \{\v,\v_1\}\in
E$, that $a=1$, and that $C^0(1)$ is a blade of the fan.  The claim
ensues.

\claim{The vectors $\v$ and $\w(t)$ are not parallel for any
  $t\in\leftopen0,1\rightclosed$.}  Otherwise, let $b\in
\leftopen0,1\rightclosed$ be the least constant for which $\v$ and
$\w(b)$ are parallel.  Set  $I=\leftopen0,b\rightopen$.  
%Now assume for a contradiction that $\v$ and $\w(t)$ are parallel for
%some $t\in\leftopen0,1\rightclosed$.  Let $b\in I$ be the least such
%constant.  
Select $a$ such that $0<a<b$.  Then $\{\orz,\w(a),\w(b),\v\}$ lie in a unique plane
$A$.  Since all $\w(t)$ lie in a line, $\w(t)\in A$ all $t\in I$.
Then $\v_0\in C^0(a)\cap X$, contradicting the established
disjointness of $X$ from $C^0(a)$.  Thus, $b$ does not exist, proving
 the claim and the first conclusion of the lemma.

Set $I= \{t\mid 0 < t \le 1\}$.  The second conclusion of the lemma
follows immediately from the claim.
\end{proof}


\begin{lemma}[face to component]\guid{RWXUYZZ} \label{lemma:UF}
Let $(V,E)$ be a fan and let $(D,e,n,f)$ be its hypermap.  Assume that $(V,E)$
is fully surrounded.  Then for every face $F$ of the hypermap, there
exists a topological component $U$ of $Y(V,E)$ such that for every
$x\in F$, the dart $x$ leads into $U$.
\end{lemma}
\indy{Index}{connected!topological component}%
\indy{Index}{hypermap}%
\indy{Index}{dart}%

This lemma strengthens the relationship between the
combinatorics of hypermaps and the topology of fans by showing that there exists a
well-defined map from faces to topological components.  Write
$F\mapsto U_F$ for this map.
\indy{Notation}{UF@$U_F$ (topological component)}%

\begin{proof} Fix any dart $x\in F$ and construct the set $C^0(t)$ as
in the previous lemma.  For all $\epsilon>0$ sufficiently small,
there exists $\delta>0$ such that set $C^0(t)$ meets both
$\Wdarto(x,\epsilon)$ and $\Wdarto(f x,\epsilon)$ for all
$0<t<\delta$.  By the previous lemma, the set $C^0(t)$ lies in a
single component $U$ when $t$ is sufficiently small and positive.
Thus, $x$ and $f x$ lead into the same component $U$.  By induction,
for all $y\in F$, the dart $y$ leads into $U$.
\end{proof}
\indy{Notation}{zzd@$\delta\in\ring{R}$}%
\indy{Notation}{zze@$\epsilon\in\ring{R}$}%

The following lemma appears in induction arguments to show
that a statement about one fan $(V,E)$ can be reduced to a statement
about a simpler fan $(V,E')$.

\begin{lemma}[fan diagonal]\guid{DWWUTKW}\cutrate{}\label{lemma:add-edge}
  Let $(V,E)$ be a fully surrounded fan and let $\v,\w\in V$ be
  nonparallel.  Suppose that $C^0\{\v,\w\}\subset U_F$ for some face
  $F$.  Let $E' = E\cup\{\{\v,\w\}\}$.  Then $(V,E')$ is a fan.
\end{lemma}

\begin{proof} We establish each of the defining properties of a fan in
  turn.  The node set is unchanged,  remains finite and nonempty,
  and does not contain $\orz$.  The property \case{nonparallel} of
  $E'$ follow from the corresponding property of $E$ and the assumed
  nonparallelism for $\{\v,\w\}$.

In the verification of the intersection property
\[ 
C(\ee)\cap C(\ee') = C(\ee \cap \ee'),
\] 
it is enough to consider the case $\ee = \{\v,\w\}$ and $\ee' \ne
\ee$, the other cases being trivial.  Then from elementary geometry 
\[ 
C\{\v,\w\} = C^0\{\v,\w\}\cup C\{\v\}\cup C\{\w\}
\] 
and
known facts
$C^0\{\v,\w\}\subset U_F$, $C(\ee')\subset X(V,E)$, and $X(V,E)\cap
U_F=\emptyset$, it follows that
\begin{align*}
C\{\v,\w\} \cap C(\ee')  &= (C\{\v\} \cup C\{\w\}) \cap C(\ee') \\
&= C(\{\v\}\cap \ee') \cap C(\{\w\}\cap \ee')\\
&= C(\{\v,\w\}\cap \ee').
\end{align*}
(The last equality uses the observation that at most one of the two
intersections $\wild\cap\ee'$ in the penultimate line is nonzero.)
Thus, $(V,E')$ is a fan.
\end{proof}

The following lemma further strengthens the relationship between
combinatorics and topology by showing that the map $F\mapsto U_F$
is onto.

\begin{lemma}[]\guid{JUTSTKG}\label{lemma:lead-exists}
Let $(V,E)$ be a fan with hypermap $(D,e,n,f)$. %Let $Y=Y(V,E)$. 
Assume that $(V,E)$ is fully surrounded.  For every
topological component $U$ of $Y(V,E)$, there exists a dart $x\in D$ that
leads into $U$.
\end{lemma}
\indy{Index}{connected!topological component}%
\indy{Index}{fan}%
\indy{Index}{hypermap}%

\begin{proof}  
The sets $C^0(t)$ of Lemma~\ref{lemma:sweep} depend on the initial dart $x$.
Write $C^0(t,x)$ to make the dependence explicit.

Let $\p\in U$.  Choose a continuous path $\varphi:[0,1]\to
\ring{R}^3\setminus\{0\}$ such that $\varphi(t)\in U$ for $t<1$ and
$\varphi(1)\not\in U$.  Then $\q=\varphi(1)\in X$.  If $\q\in
C^0\{\v\}$ for some $\v\in V$, then there exists a dart $x$ with
node $\v = \nd(x)$ such that for all sufficiently small positive
$\epsilon$, there exists some $0\le t < 1$ such that $\varphi(t)\in
\Wdarto(x,\epsilon)\subset U_x$.  Thus, $x$ leads into $U$.
\indy{Notation}{zzuvar@$\varphi$ (path)}%

The other possibility is that $\q\in C^0\{\v,\w\}$ for some
$\{\v,\w\}\in E$.  In this case, there exists a unique edge $\{x,y\}$ of
the hypermap such that $\v=\nd(x)$ and $\w=\nd(y)$.  (That is,
$x=(\v,\w)$ and $y=(\w,\v)$.)  There is also a small neighborhood of
$\q$ such that every point $\q'$ in that neighborhood takes one of
the following forms.
\begin{enumerate}\wasitemize  \item $\q'\in C^0\{\v,\w\}$,
\item $\q'\in C^0(s,x)\subset U_x$ for some $0<s<1$,
\item $\q'\in C^0(s,y)\subset U_y$ for some $0<s<1$.
\end{enumerate}\wasitemize 
Points of the first form do not meet $Y(V,E)$.  Thus, $\varphi(t)\in U_x$
or $\varphi(t)\in U_y$, in the second and third forms respectively.
\end{proof}
\indy{Notation}{s@$s$ (real variable)}%

As the introduction to this section mentioned, the primary aim of the chapter
is to prove that the hypermaps of certain fans are planar.  The proof is a long
induction.  The base case of the induction consists of fans in which every face
is a triangle.  The following lemma gives the properties of triangles that are
needed in the base case of an induction.

\begin{lemma}[triangle~attributes]\guid{KVQWYDL} \label{lemma:triangle}
\hspace{-5pt}
Let $(V,E)$ be a fan with hypermap $(D,e,n,f)$.  Let $Y=Y(V,E)$.
Assume that $(V,E)$ is fully surrounded. Let  $F$ be a face of
cardinality three, let $x_0\in F$ and  $x_i = f^i x_0$. Then
\indy{Index}{triangle attributes}%
\begin{enumerate}\wasitemize   
\item $U_F$ is equal to the intersection of the three half-spaces:
\[ A^0_+(i)=\op{aff}_+^0(\{\orz,\nd(x_{i+1}),\nd(x_{i+2})\},\nd(x_i)),\quad
i=0,1,2.\] 
\item If a dart $y$ leads into $U_F$, then $y\in F$.
\end{enumerate}\wasitemize 
\end{lemma}
\indy{Index}{half-space}%

\begin{proof} 
\claim{The intersection $U'$ of the three half-spaces is a subset of $U_F$.}
Indeed, the intersection of two half-spaces, $A^0_+(1)\cap
  A^0_+(2)$, is the wedge $\Wdarto(x_0)$.  The sets
  $C^0(t,x_0)\subset\Wdarto(x_0)$ sweep out precisely the intersection
  of $\Wdarto(x_0)$ with $A^0_+(0)$, when $0<t<1$.  The sets
  $C^0(t,x_0)$ belong to $U_F$.  The claim ensues.

  \claim{$U_F$ is a subset of the intersection $U'$.} Otherwise, let
  $\p$ be a point of $U_F$ that does not belong to $U'$.  Choose a
  continuous path $\varphi:[0,1]\to U_F$ with $\varphi(0)\in U'$ and
  $\varphi(1)=\p$.  Let $t>0$ be the first time such that
  $\varphi(t)\not\in U'$.  Then $\q=\varphi(t)$ lies in the set
  consisting of the closed intersection of half-spaces $A_+(i)$
  corresponding to $A^0_+(i)$.  The point $\q$ also lies in one of the
  bounding planes.  Let
\[ 
X' = \bigcup C(i),\quad\text{ where } C(i)=C\{\nd(x_i),\nd(x_{i+1})\}.
\] 
Then $\q\in X'\subset X$.  This yields an impossibility:
$\q\in X\cap Y = \emptyset$.   Thus, $U'=U_F$.

Let $y$ be any dart that leads into $U_F$.  Then
$\Wdarto(y,\epsilon)$ meets $U_F$ for all $\epsilon>0$ sufficiently
small, implying that $\nd(y)$ lies in the intersection of the
closed half-spaces $A_+(i)$.  As previously established, this
intersection is the disjoint union of $U_F$ and $X'$.  As $\nd(y)\in
X$ and as $X$ does not meet $U_F$, it follows that $\nd(y)\in X'$.  The set
$X'$ is the disjoint union of the rays $C\{\nd(x_i)\}$ and the three
blades $C^0(i)$.  These blades do not meet $V$; hence, $\nd(y)=\nd(x_i)$
for some $i$.  Thus, $y$ and $x_i$ belong to the same node.  The sets
$\Wdarto(y)$ and $\Wdarto( x_i)$ are disjoint for distinct darts at the
same node, and this implies that $y=x_i\in F$.
\end{proof}

\begin{corollary}[triangle solid angle]\guid{MOZNWEH}\label{lemma:girard-component}
Let $F$ be a face of cardinality three in the context of
Lemma~\ref{lemma:triangle}.  Then for $r>0$, $U_F \cap B(\orz,r)$ is
measurable and $r$-radial at $\orz$.  The solid angle of $U_F$ is
given by the formula
\[ 
\sol(U_F) = -\pi + \sum_{x\in F}\op{azim}(x).
\] 
\end{corollary}
\indy{Index}{angle}%
\indy{Notation}{F@$F$ (hypermap face)}%
\indy{Notation}{UF@$U_F$ (topological component)}%

\begin{proof} An intersection of half-spaces through the origin 
with $B(\orz,r)$ is measurable and
$r$-radial.  The solid angle is given by Girard's formula for
a spherical triangle (Lemma~\ref{lemma:prim-volume}).
\end{proof}
\indy{Index}{Girard's formula}%

\subsection{conformance}\label{sec:conformance}


The previous subsection shows that in a fully surrounded fan, the topological
components of $U_F$ have a particularly simple geometrical description as
an intersection of half-spaces, when $\card(F)=3$.  This subsection defines
a class of fans (Definition~\ref{def:conforming}) in which the faces also have
a  simple geometrical description.

Lemma~\ref{lemma:face} shows any fan that is fully surrounded is
conforming.  We consider the definition of conforming to be
useful only until Lemma~\ref{lemma:face} becomes available.
Thereafter, properties of conforming fans may be applied to all fully
surrounded fans.

\begin{definition}[conforming]\guid{UVPFEEP}\label{def:conforming}
Let $(V,E)$ be a fan with hypermap $(D,e,n,f)$.  The fan is
\newterm{conforming} if the following properties hold.
\begin{enumerate}
\item \firstcase{surroundedness} $(V,E)$ is fully surrounded.
\item \firstcase{bijection} The map $F\mapsto U_F$ is a bijection between
the faces of the hypermap and the topological components of $Y$.
\item \firstcase{half-space} For every face $F$, the topological component
$U_F$ is the intersection of the open half-spaces
$\op{aff}_+^0(\{\orz,\nd(x),\nd({f x})\},\nd(f^{-1} x))$ as $x$ runs over
$F$.\label{halfspace:conformance}
\item \firstcase{solid angle} For every $F$, the intersection
$B(\orz,r)\cap U_F$ is measurable and eventually radial at $\orz$.
Moreover, the solid angle of $U_F$ is given by the formula
\[ 
\sol(U_F) = 2\pi + \sum_{x\in F}(\op{azim}(x)-\pi).
\] 
\item \firstcase{diagonal} For every face $F$, if $x,y\in F$ are distinct
with corresponding nodes $\nd(x),\nd(y)\in V$, then $\nd(x)$ and
$\nd(y)$ are not parallel.  Moreover, either $x$ and $y$ are adjacent under
the face map, or 
\[
C^0\{\nd(x),\nd(y)\}\subset U_F.
\]  
{\it That is, the
``diagonals'' of $U_F$ are all ``interior.''}
\end{enumerate}
\end{definition}


Conforming fans have several significant properties.   They
(together with the fact that every fully surrounded fan is conforming) constitute
the main conclusion of this section.  

\begin{lemma}[]\guid{GINGUAP}
Let $(V,E)$ be a conforming fan.  
Each $U_F$ is convex, where  $F$ is any face of $\op{hyp}(V,E)$.
\end{lemma}
\indy{Index}{component!topological}%
\indy{Index}{convex}%

\begin{proof} By \case{half-space}, $U_F$ is the intersection of
half-spaces.
\end{proof}

\begin{lemma}[]\guid{SRPRNPL} \label{lemma:conform-simple} 
Let $(V,E)$ be a conforming fan.  
Then $\op{hyp}(V,E)$ is simple.
\end{lemma}
\indy{Index}{hypermap!simple}%

\begin{proof} Let $x\in F$.  By the intersection of half-spaces
property, $U_F$ is contained in the wedge $\Wdarto(x)$ at $x$.  If
 a second dart $y$ sits at the same node in $F$, then $U_F$ is
also contained in $\Wdarto(y)$. However, by
Lemma~\ref{lemma:disjoint}, the wedges at a given node are disjoint.
\end{proof}

\begin{lemma}[]\guid{WGVWSKE}  
Let $(V,E)$ be a conforming fan.  
Then $\op{hyp}(V,E)$ is connected.
\end{lemma}
\indy{Index}{connected}%
\indy{Index}{hypermap}%
\indy{Index}{component!combinatorial}%

% \begin{proof} Let $x,y$ be any two darts.  After replacing $x$ with
%   $f x$ if necessary (which does not change the combinatorial
%   component) assume that $\{\orz,\nd(x),\nd(y)\}$ is not a collinear
%   set.  For each blade $C^0(\ee)$ of the fan that meets
%   $C=C^0\{\nd(x),\nd(y)\}$ select one of the two endpoints of $\ee$.
%   This gives a sequence
%\[ 
%\nd(x)=\v_0,\v_1,\ldots,\v_k=\nd(y)
%\] 
%such that $C^0(\{\v_i,\v_{i+1}\})$ lies in a single topological
% component $U_i$.  Each $U_i$ has the form $U_F$ for some face
% $F=F_i$ of the hypermap.  Thus, a combinatorial path is constructed
% from $x$ to $y$ by moving by the face map from dart to dart within
% each $F_i$ and by the node map from dart to dart around a given node
% $\v_j$.
%\end{proof}

\begin{proof} Let $[D]$ denote the set of combinatorial components of
  $\op{hyp}(V,E)$.  There is a well-defined, continuous (in fact, locally
  constant) function from $Y$ onto $[D]$ given as follows.  For $\p\in
  Y$, choose $F$ such that $\p\in U_F$ and send $\p$ to the class of
  $F$ in $[D]$.  By property \case{bijection}, this map is
  well-defined.  The map extends continuously to $C^0(\ee)$ for
  $\ee\in E$ by the following construction: for every $\p\in
  C^0(\ee)$, we choose the edge $\{x,y\}$ of the hypermap associated
  with the edge $\ee$ and send $\p$ to the combinatorial component
  containing $\{x,y\}$. The domain
\[ 
Y\cup \bigcup C^0(\ee)
\] 
is connected.  The continuous map from this connected set onto the
discrete set is necessarily constant.  As the map is onto, the set
$[D]$ reduces to a singleton.
\end{proof}

The following lemma is the promised result on planarity.

\begin{lemma}[]\guid{GGRLKHP}  
\label{lemma:cfplanar}
Let $(V,E)$ be a conforming fan.  
Then $\op{hyp}(V,E)$ is planar.
\end{lemma}
\indy{Index}{planar}%
\indy{Index}{hypermap}%

\begin{proof}  The solid angle of a sphere is $4\pi$.  The set $X(V,E)$
has measure zero, so that
\begin{equation}\label{eqn:solid-sum}
4\pi = \sol(Y)= \sum_F \sol(U_F) = 
\sum_F \Big( 2\pi + \sum_{x\in F} (\op{azim}(x)-\pi) \Big).
\end{equation}
In the rightmost expression, the double sum over faces and darts in a
face can be replaced by a single sum over all darts.  The sum of the
azimuth angles of all darts at a node is $2\pi$. Thus, the sum over all azimuth
angles is $2\pi\,\#n$.  Thus, the formula~\eqref{eqn:solid-sum}
becomes
\[ 
4\pi = 2\pi\, \#f +2\pi\,\#n - \pi\, \#D.
\] 
In a plain hypermap in which the edge map has no fixed points, $\#D =
2\,\#e$.  The relation \eqref{eqn:solid-sum} simplifies to
\[ 
2 + \#D = \#f + \#e + \#n.
\] 
This is the condition of planarity for a connected hypermap.
\end{proof}
\indy{Index}{hypermap!connected}%

\subsection{existence}




This section proves the existence of many conforming fans.  The main result
of this subsection
(Lemma~\ref{lemma:face}) asserts that every fully surrounded fan is conforming.  The
proof breaks into a series of small lemmas.  The primary
method to prove the existence of conforming fans is an induction on
the following invariant of a fan $(V,E)$.

\begin{definition}[$N(V,E)$]\guid{GBNIUVV}
Let
\[ 
N(V,E) = \sum_F (k_F - 3),
\] 
where $(V,E)$ is a fan, the sum runs over faces $F$, and $k_F$ is the
cardinality of the face $F$.
\end{definition}
%We prove the conclusion of the lemma, together with the additional
%conclusion.
%\begin{enumerate}\wasitemize 
%\item If $C^0(\ee)$ is any diagonal of $U_F$ (with $\ee\not\in E$),
%  then the %fan $(V,E'')$, where $E'' = E\cup\{\ee\}$, satisfies
%  $N(V,E'')+1 = N(V,E)$.
%\end{enumerate}\wasitemize 

The following lemma gives the base case of an induction.

\begin{lemma}[]\guid{DWFBRQY}\cutrate{}\label{lemma:N=0}
Let $(V,E)$ be a fully surrounded fan such that $N(V,E)=0$.
Then $(V,E)$ is conforming.
\end{lemma}
\indy{Index}{face!attribute}%
\indy{Notation}{N@$N$ (integer invariant of a fan)}%
\indy{Notation}{k@$k$ (cardinality of a face)}%

\begin{proof}
  We run through the defining properties of a conforming fan
  (page~\pageref{def:conforming}).  If $N(V,E)=0$, then the hypermap
  is a triangulation.  By Lemmas~\ref{lemma:UF} and
  \ref{lemma:lead-exists}, every topological component of $Y$ has the
  form $U_F$ for some face $F$.  By Lemma~\ref{lemma:triangle}, $U$
  uniquely determines the face $F$.  Thus, there is a bijection
  between faces of the hypermap and topological components.  By
  Lemma~\ref{lemma:triangle}, the topological component $U_F$ is the
  intersection of open half-spaces, as expressed in the property \case{half-space}.  
  The solid angle
  formula is given by Corollary~\ref{lemma:girard-component}.  The
  assertion of the lemma about diagonals
%and triangulations 
is trivial for a hypermap that is already a triangulation. This
completes the proof in the base case $N(V,E)=0$.
\end{proof}
%\indy{Index}{triangulation}%

To carry out proofs by induction, we assume the existence of a minimal
counterexample and then argue by contradiction.  The proofs are so
long that it is necessary to break them into a series of lemmas.  To
organize an extended proof by contradiction, we formulate the
properties of a minimal counterexample as a definition.  We eventually
show that minimally nonconforming fans do not exist.

\begin{definition}[minimally nonconforming fan]\guid{JKYFSUP}
A fan $(V,E)$ is said to be \fullterm{minimally nonconforming}{conforming} if
the following properties hold.
\begin{enumerate}\wasitemize 
\item $(V,E)$ is fully surrounded.
\item $(V,E)$ is not conforming.
\item $N(V,E)>0$.
\item If $(V,E')$ is any other fully surrounded fan on the same node
set $V$ and if $N(V,E') < N(V,E)$, then $(V,E')$ is conforming.
\end{enumerate}\wasitemize 
\end{definition}


% In the proof of Lemma~\ref{lemma:face}, assume for a contradiction
% that there exists a fan $(V,E)$ satisfying the assumptions of the
% lemma, but not the conclusion.  Among all such counterexamples with
% fixed node set $V$, select $E$ to minimize $N(V,E)$.  Refer to this
% fan as a minimal counterexample (to Lemma~\ref{lemma:face}).

% By the assumed minimality of $N(V,E)$, the conclusions of
% Lemma~\ref{lemma:face} holds for the modified fan $(V,E')$.  The
% strategy of the proof of Lemma~\ref{lemma:face} is to use the
% modified fan $(V,E')$ to show that the conclusions of the
% Lemma~\ref{lemma:face} hold for $(V,E)$ as well.  These conclusions
% are established for $(V,E)$ through a series of lemmas.  The
% result  contradicts the assumption that $(V,E)$ is a
% counterexample.

\begin{remark}[reduction data]\guid{OEQAFJW}\label{remark:reduction}
  When $N(V,E)>0$, choose a dart $x$ that lies in a face $F$ of the
  hypermap that is not a triangle.  By Lemma~\ref{lemma:sweep},
  $C^0\{\v,\w\}\subset U_F$, where $\v=\nd(x)$, $\w=\nd(y)$, and
  $y=f^2 x$.  Form a new fan $(V,E')$ on the same node set with $E' =
  E\cup \{\{\v,\w\}\}$.  (See Figure~\ref{fig:reduction} and Lemma~\ref{lemma:add-edge}.)

\figRNMBPJD % fig:reduction.

The following notation is used to relate the two fans $(V,E)$ and $(V,E')$.  
Add primes to symbols
denoting objects related to $(V,E')$.
%Write
%$\v=\nd(x)$ and $\w=\nd(y)$.  
Let $x'=(\v,\w)$ and $y'=(\w,\v)\in D'$, where $D'$ is the set of darts of $\op{hyp}(V,E')$.
The darts $x',y'$ lead into topological components
$U(x')$ and $U(y')$ of $Y'=Y(V,E')$ and belong to faces $F(x')$,
$F(y')$ of $H'=\op{hyp}(V,E')$.
\end{remark}

The following lemma is used to prove that if $(V,E)$ is minimally nonconforming,
then the fan $(V,E')$ is conforming.

\begin{lemma}[]\guid{ZSZIUQE}\cutrate{}\label{lemma:lessN}
  Let $(V,E)$ be a fully surrounded fan.  Assume that $N(V,E)>0$.  Let
  $x$ be a dart in $\op{hyp}(V,E)$ such that the face $F$ of $x$ is
  not a triangle.  Let $E'=E\cup \{\{\v,\w\}\}$, $x',y',\ldots$ be the reduction data
  as above associated with $x$.  Then the faces $F(x')$ and $F(y')$ are distinct, and
  $F(y')$ is a
  triangle. Moreover, $\op{hyp}(V,E)$ is obtained by a double walkup along the
  edge $\{x',y'\}$ of $\op{hyp}(V,E')$ that merges the two faces $F(x')$ and $F(y')$.
  Finally, $N(V,E')<N(V,E)$.
\end{lemma}


\begin{proof} Let $H'=(D',e',n',f')$ be the hypermap of $(V,E')$.
Write $x = (\v,\u)$, $f x = (\u,\w)$, $f^2 x = y = (\w,\wild )$.
Then it follows directly from the definition of the face map on $\op{hyp}(V,E')$
and an inspection of the cyclic order $\sigma$ that
\[ 
(f')^3 y' = (f')^3 (\w,\v) = (f')^2(\v,\u) = f' (\u,\w) = (\w,\v) = y'.
\] 
It follows that $F(y')$ is a triangle.

The hypermap $H=\op{hyp}(V,E)$ is obtained from $H'=\op{hyp}(V,E')$ by
a double walkup transformation on the edge $\{x',y'\}$.  The faces
$F(x')$ and $F(y')$ are distinct by Lemma~\ref{lemma:triangle}, which
asserts that $x'$ does not lead into $U(y')$.  Thus, the walkup
transformation merges two faces by Lemma~\ref{lemma:merge-split}.
Then
\[ N(V,E) - N(V,E') = ((k+1)-3) ~~-~~ ((k-3) +
(3-3)) = 1 >0,\]  where $k$ is the cardinality of
$F(x')$.
\end{proof}

The task of the rest of the section is now clear.  We run through each
of the properties of a conforming fan, one by one, and show that the
conformance of $(V,E')$ implies the conformance of $(V,E)$.  However,
if $(V,E)$ is minimally nonconforming, this is an impossible
situation: it cannot both conform and not conform.  Hence, no minimal
nonconforming fan can exist (Lemma~\ref{lemma:face}).

\begin{lemma}[bijection]\guid{OBHTHCD}\cutrate{}
The property \case{bijection} of conforming fans (on page~\pageref{def:conforming}) 
holds for any
minimally nonconforming fan: $F\mapsto U_F$ is a bijection.
\end{lemma}

\begin{proof} Let $(V,E)$ be a minimally nonconforming fan.  Choose
  $x$ to obtain reduction data for $(V,E)$.  The bijection property
  holds for $(V,E')$ by the minimality assumption.  The proof 
  establishes a bijection by showing that $(V,E)$ has one more face and
  one more topological component than $(V,E')$.

The
two faces $F(x')$ and $F(y')$ merge into a single face $F$ of
$\op{hyp}(V,E)$.  Then
\begin{equation}\label{eqn:U}
U= U(x')\cup U(y')\cup C^0(\ee)
\end{equation} 
is a connected open set in $Y$.  If $F'\ne F(x')$ and $F(y')$ is any other
face in $H'$, then $U_{F'}$ is a connected open set in $Y$.  Moreover,
the set $U$ and sets $U_{F'}$ are pairwise disjoint and exhaust $Y$,
so that they are precisely the topological components of $Y$.  Some
dart of $F$ leads into $U$, so $U=U_F$. 
It follows that the number of
faces is equal to the number of topological components for $(V,E)$, so that the
map $F\mapsto U_F$ is a bijection.
\end{proof}


\begin{lemma}[]\guid{TXFBALB}\cutrate{} Let $(V,E)$ be any minimally
nonconforming fan.  Then it has property \case{solid angle} of
conforming fans (page~\pageref{def:conforming}).
\end{lemma}

\begin{proof} Choose reduction data for $(V,E)$.  Every topological
component of $Y=Y(V,E)$ except $U=U_F$ is already a topological
component of $Y'$ and the conclusion holds for components of $Y'$.
The topological component $U$ is a disjoint union of two components
of $Y'$ and a set $C^0(\ee)$ of measure zero.  Thus, $U$ is also
measurable and eventually radial.  The solid angle formula is
additive over the disjoint union in~\eqref{eqn:U}, so the formula
holds for $U$.
\end{proof}
\indy{Index}{component!topological}%


\begin{lemma}[]\guid{GGZWYRM}\cutrate{} 
  Let $(V,E)$ be any minimally nonconforming fan.  Then the fan has property
  \case{diagonal} of conforming fans (page~\pageref{def:conforming}).
  That is, for any dart $x$ on any face $F$ and dart $z\in F$ that is
  not adjacent to $x$ under the face map,
\[ 
C^0(\{\nd(x),\nd(z)\}) \subset U_F.
\] 
\end{lemma}

\begin{proof}  
  By excluding trivial cases of the proof, we may assume that the dart $x$ 
  is used to construct reduction data $E'$, $x',y'$, etc. We may
  assume that $F(y')$ is a triangle.  If $z=f^2x$, then the diagonal
  is precisely $C^0\{\v,\w\}$, for which the conclusion has already
  been established.  Otherwise, $z$ can be identified with a dart
  $z'\in F(x')$.  Then, by minimality,
\[ 
C^0\{\nd(x),\nd(z)\} = C^0\{\nd(x'),\nd(z')\} \subset U(x') \subset U_F.
\] 
\end{proof}

% Next show the extra conclusion added at the beginning of the lemma.
% If the added diagonal is $\{\v,\w\}$, then $E''=E'$ and have already
% checked that $N(V,E')+1=N(V,E)$.  Since $x$ was arbitrary, may
% assume that $\nd(x)\in e$.  Let $E''' = E \cup \{e\, \{\v,\w\}\}$.
% By the minimality, $N(V,E''') + 1 = N(V,E')$.  Also, $E''' = E''\cup
% \{\{\v,\w\}\}$.  The same argument that shows $N(V,E')+1=N(V,E)$
% shows $N(V,E''')+1 = N(V,E'')$.  Hence,
%\[ 
%N(V,E'')+1 = N(V,E''')+2 = N(V,E')+1 = N(V,E).
%\] 

\begin{lemma}[]\guid{HYUAZSE}\cutrate{} Let $(V,E)$ be a minimally nonconforming fan.  Then property \case{half-space} of conforming fans  (on page \pageref{halfspace:conformance})
holds for $(V,E)$.
\end{lemma}
\indy{Index}{component!topological}%

\begin{proof}
  Choose a dart $x$ to give reduction data for $(V,E)$.  By the non
  conformance of $(V,E)$, it is enough to consider the face $F$
  containing $x$.  (Indeed, the other faces of $\op{hyp}(V,E)$ can be
  identified with faces of $\op{hyp}(V,E')$ and these cases are easily
  treated.)  

  \claim{The intersection $U_1$ of half-spaces given by property
    \case{half-space} lies in $U=U_F$.}  Indeed, every point in
  $\ring{R}^3$ lies in the plane
\[ 
A=\op{aff}\{\orz,\v,\w\}
\] 
or in one of the two open half-spaces bounded by this plane.  These
half-spaces, $A^0(x')$ and $A^0(y')$, contain $U(x')$ and $U(y')$
respectively, by the minimality of $(V,E)$ and the conformance of $(V,E')$.  Also,
\[ 
A^0(x')\cap U_1 \subset U(x')\subset U.
\] 
Similarly, $A^0(y')\cap U_1 \subset U$.  We have a sequence of subsets
\[ 
A \cap U_1 \subset A \cap \Wdarto(x) \cap \Wdarto(y) \subset C^0\{\v,\w\} \subset U.
\] 
Thus,
$U_1\subset U$.

\claim{For any dart $z$ of $F$, the set $U$ is a subset of the
half-space with bounding plane $\{\orz,\nd(z),\nd(f z)\}$.} Indeed,
if the reduction data for the dart $z$ is used, the claim does not change.
Without loss of generality, assume that $z=x$.  By the minimality of $(V,E)$, the
partition \eqref{eqn:U} of $U$ gives three pieces contained respectively
in the three sets:
\[ 
\Wdarto(x'),\quad C^0\{\v,\w\},\quad \Wdarto(x''),
\] 
where $x',x''\in D'$ correspond to the single dart $x$ in $D$:
\[ 
\op{azim}(x') + \op{azim}(x'') = \op{azim}(x) < \pi.
\] 
Thus, $U$ itself is contained in the lune
\[ 
W^0(\{\orz,\nd(x)\},\{\nd(f x),\nd(f^{-1} x)\}),
\] 
which is contained in the desired half-space.  This proves the claim.

The reverse inclusion $U\subset U_1$ follows immediately from the claim.
\end{proof}

%\begin{lemma}[]\guid{YQWIVOS}\cutrate{}
%  Let $(V,E)$ be any minimally nonconforming fan.  Then a
%  triangulation of $(V,E)$ exists.
%\end{lemma}
%
%\begin{proof} A triangulation of $(V,E')$ exists by the minimality of
%  $(V,E)$.  A triangulation of $(V,E')$ is also a triangulation of
%  $(V,E)$.
%\end{proof}


\begin{lemma}[conformance]\guid{PIIJBJK}\label{lemma:face}
Every fully surrounded fan is conforming.
\end{lemma}

\begin{proof}
Suppose for a contradiction that a fully surrounded fan $(V,\wild )$
exists that is not conforming.  Among all fully surrounded
nonconforming fans $(V,\wild )$ on the same node set, select one $(V,E)$
that minimizes $N(V,E)$.  In fact, $N(V,E)>0$ because otherwise $(V,E)$
is conforming by Lemma~\ref{lemma:N=0}.

This is a minimally nonconforming fan.  However, the preceding lemmas show
that a minimally nonconforming fan actually satisfies all of the properties
of a conforming fan.   This contradiction gives the proof.
\end{proof}



\section{Polyhedron}\label{sec:poly}

This section shows that a bounded polyhedron in $\ring{R}^3$ with
nonempty interior determines a fan.  The construction is elementary.
Choose a point in the interior, which for convenience we take to be
the origin $\orz$.  The set $V_P$ is defined as the set of extreme
points of the polyhedron.  The set $E_P$ consists of pairs of extreme
points that are joined by an edge of the polyhedron.  The pair
$(V_P,E_P)$ is a fan (Figure~\ref{fig:polyfan}).  This section describes this construction in
 detail.



\subsection{background on convex sets}

We begin with a review of basic terminology about affine and convex
sets.  The material in this subsection appears in standard textbooks
on convexity~\cite{barvinok:2002}, \cite{webster:1994}.

\begin{definition}[affine~set,~affine~hull,~affine~dimension,~affinely~independent, hyperplane]\guid{AJXYAWK}\label{def:affine} 
Recall that a set $A\subset\ring{R}^n$ is \newterm{affine} if for
every $\v,\w\in A$ and every $t \in \ring{R}$, 
\[ 
  t\, \v + (1-t) \w \in A.
\] 
Recall that
the \fullterm{affine hull}{affine!hull} of $P\subset\ring{R}^n$ (denoted $\aff(P)$) 
is the smallest affine set
containing $P$.  The \fullterm{affine dimension}{affine!dimension} of $P$ (written $\dimaff(P)$) is
$\card(S)-1$, where $S$ is a set of smallest cardinality such that
\[ 
P \subset \op{aff}(S).
\] 
\end{definition}
In particular, the affine dimension of the empty set is $-1$.
A finite set $S$ is 
\fullterm{affinely independent}{affine!independence} if $\dimaff(S) = \card(S)-1$.
A \newterm{hyperplane } in $\ring{R}^n$ is any set of the form
\[ 
\{\p\mid \u\cdot \p = b\},
\] 
where $\orz\ne\u\in\ring{R}^n$.
\indy{Notation}{dimaff@$\dimaff$ (affine dimension)}%
\indy{Notation}{aff@$\aff$ (affine hull)}%



\begin{definition}[relative interior,~closure,~relative boundary]\guid{EDANAOL}
Let
$A$ be the affine hull of a set $P\subset\ring{R}^n$.  A point $\p$ is an 
\newterm{interior point} of $P$ if some nonempty open ball $B(\p,r)$ is
contained in $P$.  A point $\p$ of $P$ belongs to the
\newterm{relative interior} of $P$ if there is an open ball such that $B(\p,r)
\cap A\subset P$.  Let $\op{ri}(P)$ be the set of relative interior
points.  The \newterm{closure} of $P$ is the set
\[ 
\{\p \mid \forall\,r >0.~ B(\p,r) \cap P \ne \emptyset\}.
\] 
The complement of $\op{ri}(P)$ in the closure of $P$ is the 
%$\op{cl}(P)\setminus \op{ri}(P)$ is the
\newterm{relative boundary} of $P$.
\end{definition}
\indy{Notation}{ri (relative interior)}%
\indy{Notation}{cl (closure)}%
\indy{Index}{convex}%
\indy{Index}{affine!hull}%
\indy{Index}{hull!affine}%
\indy{Index}{closure}%
\indy{Index}{interior!relative}%
\indy{Index}{relative boundary}%
\indy{Index}{boundary!relative}%

\begin{definition}[face,~facet,~edge,~extreme~point]\guid{QLITJET}\label{def:face}
Let $P$ be a convex set.  A \newterm{face} of $P$ is a convex set
$F$ such that for all $\v,\w\in P$, the condition
\[ 
\exists~s~t.\quad s\, \v + t\, \w \in F,\quad s>0,\quad t>0,\quad s+t = 1
\]  
implies that $\v,\w\in F$.  A face $F$ is \newterm{proper} if $F\ne
\emptyset,P$.  An \newterm{extreme point} is an element $\v\in P$ such that
$\{\v\}$ is a face (of affine dimension zero).  An  \newterm{edge} is a face of $P$ of
affine dimension one.  A \newterm{facet} of $P$ is a \newterm{proper}
face of affine dimension $\dimaff(P)-1$.  \indy{Index}{face}%
\indy{Index}{dimension} %
% A point $\u\in P$ is an extreme point of $P$, if for every $\v,\w\in
% P\setminus\{\u\}$, the point $\v$ is not of the form $t\, \v + (1-t)
% \w$, with $0\le t\le 1$.
\end{definition}


\begin{remark}[convex background]\guid{IMZOOUB}\label{rem:convex-background}
We  assume as background knowledge various basic facts about convex sets.
For example,
if $P$ is convex and $P = \bigcup_{i=1}^r P_i$, where $r\ge 1$, then
\[ 
\op{conv}(A\cup P ) = \bigcup_{i=1}^r\op{conv}(A\cup P_i).
\] 
Also, $\op{conv}(A\cup \op{conv}(B)) = \op{conv}(A \cup B)$.
Furthermore, if $A$ is convex, then $A = \op{conv}(A)$.
 An intersection of faces of a
convex set is again a face.
\end{remark}


\begin{remark}[affine background]\guid{XHAZTVI}\label{rem:affine-background}
Various particular facts about affine sets  come up.
If $U\subset\ring{R}^n$ is open, then $\dimaff(U) = n$.  In particular,
we have
$\dimaff(\ring{R}^n) = n$.  At the other extreme $\dimaff(\{\p\}) = 0$.
If $S_1\subset S_2\subset\ring{R}^n$, then $\dimaff(S_1) \le \dimaff(S_2)$.
If $A$ is an affine set and $\p\not\in A$, then $\dimaff(A) +1 = \dimaff(A\cup\{p\})$.
If $A$ is affine of affine dimension $k$ and if $B$ is a hyperplane such that $A\cap B\ne\emptyset$, then $\dimaff (A\cap B)\ge k-1$.
If $C$ is a convex set, $A$ is an affine set and $U\subset \ring{R}^n$ 
is a neighborhood of $\p\in C\cap A$ such that $C\cap U = A\cap U$, then
$A=\aff(C)$.
\end{remark}


\begin{remark}[polysemes]\label{remark:face} 
The term \newterm{face} occurs in this book with two meanings: the
face of a hypermap and the face of a convex set.  The two contexts
are sufficiently different that  misunderstandings should be avoidable.
Graphs,  hypermaps, fans, and polyhedra all have \fullterm{edges}{edge}.
Fans and hypermaps have \fullterm{nodes}{node}, while polygons 
have \newterm{vertices}.  Polyhedra have \fullterm{extreme points}{extreme point}.
\end{remark}
\indy{Index}{polysemes (face, edge, node)}%

\begin{lemma}[Krein--Milman]\guid{MUGGQUF} Every compact
convex set $P\subset\ring{R}^n$ is the convex hull of its set of
extreme points.
\end{lemma}

\begin{proof}  See \cite[Theorem~2.6.16]{webster:1994}.
\end{proof}

\subsection{background on polyhedra}


The material in this subsection appears in standard textbooks on polyhedra.
We follow~\cite{webster:1994}.

\begin{definition}[polyhedron]\guid{QSRHLXB}
A \newterm{polyhedron} is the
intersection of a finite number of closed half-spaces in
$\ring{R}^n$.  
%An extreme point of a polyhedron is also called a \newterm{vertex}.
\end{definition}
\indy{Index}{polyhedron}%

\begin{lemma}[]\guid{LTHQIAA}\cutrate{}\label{lemma:aff-poly}
An affine set in $\ring{R}^n$ is a polyhedron.
\end{lemma}

\begin{proof} See \cite[Cor~1.4.2]{webster:1994}.
\end{proof}

\begin{lemma}[]\guid{TZPUXZL}\label{lemma:aff-u}
If $A$ is a proper affine set in $\ring{R}^n$, then there exists $\u\in \ring{R}^n$, with
$\u\ne\orz$, and $b\in\ring{R}$ 
such that $\u\cdot\p = b$ for all $\p\in A$.  That is, every proper affine set
is contained in a hyperplane.
\end{lemma}

\begin{proof}
By Lemma~\ref{lemma:aff-poly},
the affine set $A$ is a polyhedron and is thus contained in a closed half-space defined by an
inequality $\u\cdot\p \le c$ for some $\u\ne \orz$ and $c$.  If $\u\cdot\p$ assumes
at least two distinct values, then the image of the affine set $A$ 
under the map $\p\mapsto \u\cdot \p$
is the entire affine line $\ring{R}$, and the inequality is violated.
Hence, $\u\cdot\p$ is constant on $A$.
\end{proof}

A polyhedron is closed and convex.  A bounded polyhedron falls within
the scope of the Krein--Milman theorem and is thus the convex hull of
its set of extreme points.  \indy{Index}{closed}%

Let $P\subset\ring{R}^n$ be a bounded polyhedron with affine hull
$A$. Write
\begin{equation}\label{eqn:polyrep}
P = A \cap A^+_1 \cap \cdots \cap A^+_r,
\end{equation}
where $A^+_i = \{\p\mid \u_i\cdot \p \le a_i\}$ with bounding
hyperplane $A_i=\{\p\mid \u_i \cdot \p = a_i\}$ for some $\u_i\in
\ring{R}^n$ and $a_i\in\ring{R}$.  Assume that this representation is
minimal in the sense that none of the factors $A^+_i$ may be omitted from
the intersection~\eqref{eqn:polyrep}.
Let $F_i = A_i\cap P$.  \indy{Notation}{P@$P$ (polyhedron)}%


\begin{lemma}[]\guid{CZZHBLI}\cutrate{}\label{lemma:webster}  
Let $P\subset\ring{R}^n$ be a bounded polyhedron.  Then
\indy{Index}{polyhedron}%
\begin{enumerate}
\item The facets of $P$ are $F_i$, $i=1,\ldots,r$.
\item The relative boundary of $P$ is $F_1\cup\cdots \cup F_r$.
\item Every proper face is the intersection of the facets that contain it.
\item Every face of a face of $P$ is a face of $P$.
\item A point is an extreme point of a face $F$ if and only if it is an extreme point of $P$
that is contained in $F$.
\item If $F$ and $F'$ are two faces of $P$ with meeting relative interiors, then $F=F'$.
\end{enumerate}
\end{lemma}
\indy{Index}{facet}%
\indy{Index}{relative boundary}%
\indy{Index}{face}%

\begin{proof} See \cite[Thm~3.2.1]{webster:1994} for the first three
conclusions.  See \cite[Th~2.6.5]{webster:1994} for the proof of the
fourth conclusion.

An extreme point singleton of $F$ is a face of $P$ (of
dimension zero) by the fourth conclusion.  Hence, every extreme point of $F$
is an extreme point of $P$.  Conversely, a face of $P$ in $F$ is {\it a
fortiori} a face of $F$.  This gives the fifth conclusion.
See \cite[Cor~2.6.7]{webster:1994} for the final conclusion.
\end{proof}

\begin{corollary}\guid{QOEPBJD}\cutrate{}
A face of a polyhedron is itself a polyhedron.  
\end{corollary}

\begin{proof} By Lemma~\ref{lemma:webster}, each facet is defined by a
system of linear inequalities.  (See Lemma~\ref{lemma:aff-poly}.)  A
proper face is an intersection of finitely many facets, and is
therefore given by the conjunction of the inequalities defining the
various facets.
\end{proof}

\begin{lemma}[]\guid{HNHTBYW}\label{lemma:facet-partition}
  If $P$ is a bounded polyhedron of positive affine dimension with
  facets $F_1,\ldots,F_r$ and if $\emptyset\ne A\subset P$, then
\[ 
P = \bigcup_{i=1}^r \op{conv}(A\cup F_i).
\] 
\end{lemma}

\begin{proof}
Choose $\u\in A$.   Then
\[ 
\bigcup_{i=1}^r \op{conv}(\{\u\}\cup F_i) \subset \bigcup_{i=1}^r \op{conv}(A\cup F_i)\subset P.
\] 
Hence, it is enough to show that any $\v\in P$, with $\v\ne \u$, 
lies in one of the sets on the left.
By the boundedness of $P$, the ray $\op{aff}_+\{\u,\{\v\})$ meets $P$ in an interval
$\op{conv}\{\u,\w\}$, where $\w$ lies on the relative boundary of $P$.  By Lemma~\ref{lemma:webster}, in fact, $\w$ lies in a facet $F_i$.  This gives
\[ 
 \v\in \op{conv}\{\u,\w\}\subset \op{conv}(\{\u\}\cup F_i).
\] 
\end{proof}


\begin{lemma}[]\guid{LRXWHZC}\label{lemma:simplex-poly}
  Let $S\subset\ring{R}^n$ be a finite set.  Then $P=\op{conv}(S)$ is
  a polyhedron.  Assume moreover that $S$ is an affinely independent
  set with cardinality at least two.  Then $S$ is the set of extreme
  points of $P$. Furthermore,   $F$ is a facet of $P$ if and only if $F =
  \op{conv}(S\setminus \{\u\})$ for some $\u\in S$.
\end{lemma}

\begin{proof} The proof is left to the reader.
\end{proof}

\begin{lemma}[]\guid{NEHRQPR}\cutrate{} \label{lemma:scale} 
Let $P$ be a bounded polyhedron with $\orz$ as an interior point.
Let $F$ and $F'$ be proper faces of $P$; let $\p\in F$ and
$\p'\in F'$; and let  $t$ and $t'$ be  positive scalars such that $t\, \p = t' \p'$.
Then $t=t'$.
\end{lemma}

\begin{proof} The faces $F,F'$ are subsets of facets of $P$.  We may assume
without loss of generality that $F$ and $F'$ are themselves facets.  Without
loss of generality, assume for a contradiction that $t>1$ and $t'=1$.
Then $t\, \p = \p'\in P$.
By Lemma~\ref{lemma:webster}, $F = A \cap P$, where $A= \{\q
\mid \q\cdot \u = a\}$ for some $\u$ and $a$.  Also,
\[ 
C\{\p\}\cap P = \op{conv}\{\orz,\p\} = \{\q \mid \orz\le \q\cdot \u \le a\}.
\] 
In particular, $t\, \p\not\in P$ for $t>1$.  This contradiction gives
$t = t'$.
\end{proof}

The following lemma is similar.

\begin{lemma}[]\guid{ODIGPXU}\cutrate{} \label{lemma:scale2} 
% added Oct 20, 2010.
Let $P$ be a bounded polyhedron with facets $F$ and $F'$.
Let $\p\in F$,
$\p'\in F'$, 
$\p_0\in P$, and $\p_0\not\in F\cup F'$; and let  $t$ and $t'$ be  positive scalars such that 
\[
(1-t)\, \p_0 + t\, \p = (1-t')\, \p_0 + t' \p'.
\]
Then $t=t'$.
\end{lemma}


\subsection{fan and polyhedron}

We finally deliver our promise of showing that a fan can be associated with
a bounded polyhedron (Figure~\ref{fig:polyfan}).  Here is the definition
of the set $V_P$ of nodes and set $E_P$ of edges.

\figLSGYGPA % fig:polyfan

\begin{definition}[$V_P,E_P$]\guid{ZMQQFUP}
Let $P$ be a bounded polyhedron.  Let
$V_P$ be the set of extreme points of $P$.  Let $E_P$ be the set of pairs
$\{\v,\w\}$ of extreme points such that $\op{conv}\{\v,\w\}$ is an edge of
$P$.
\end{definition}
\indy{Index}{polyhedron}%
\indy{Notation}{E2@$E_P$ (edge)}%

\begin{lemma}[fan of a polyhedron]\guid{JLIGZGS}\label{lemma:polyhedron}% 
% including
% azim<pi.
Let $P$ be a bounded polyhedron in $\ring{R}^3$ with the interior
point $\orz$.  Then $(V_P,E_P)$ is a fan.
\end{lemma}
\indy{Index}{fan}%

\begin{proof} The properties of a fan can be checked one by one.  By
the Krein--Milman lemma, the set $V_P$ of extreme points is nonempty.  By
Lemma~\ref{lemma:webster}, the polyhedron has finitely many faces, so that
$V_P$ is finite.  Since $\orz$ is an interior point, it does not
meet any proper face.  This implies that $\orz\not\in V_P$ and that
for all $\ee\in E_P$, $\orz\not\in \op{conv}(\ee)$.

Suppose for a contradiction that $\{\v,\w\}\in E_P$ and that $\v$
and $\w$ are parallel.  As $\orz\not\in \op{conv}(\ee)$, some
relation has the form $s\, \v = t\, \w$ for some $s, t>0$.  By
Lemma~\ref{lemma:scale}, $s=t$ and $\v=\w$, which is contrary to the
definition of edge as a face of dimension one.

Finally, we check the intersection property $C(\ee)\cap C(\ee') = C(\ee \cap
\ee')$.  By Lemma~\ref{lemma:scale},
\[ 
C(\ee) \cap C(\ee') =
 \{\orz\}\cup \{t\, \p \mid \p\in \op{conv}(\ee) \cap \op{conv}(\ee') 
\textand  t \ge 0\}.
\] 
The sets $\op{conv}(\ee)$ and $\op{conv}(\ee')$ are both faces of $P$.  The
intersection is again a face of $P$ and hence the convex
hull of its set of extreme points; that is, the convex hull of $\ee \cap \ee'$.
Thus,
\[ 
C(\ee)\cap C(\ee') = \{\orz\}\cup \{t\, \p \mid \p\in 
\op{conv}(\ee\cap \ee')\} = C(\ee \cap \ee').
\] 
Thus, all the defining properties of a fan are satisfied.
\end{proof}

We can relate the combinatorial properties of polyhedron to the topological
properties of the fan.

\begin{lemma}[]\guid{AMHFNXP}\cutrate{}\label{lemma:WF} 
Let $P$ be a bounded polyhedron in $\ring{R}^3$ with $\orz$ as an
interior point.  Let $(V_P,E_P)$ be the associated fan.  There is a
bijection between the facets of $P$ and the topological components
of $Y(V_P,E_P)$, given by
\[ 
F \mapsto W_F = \{t\, \p \mid \p\in \op{ri}(F),~t >0\}.
\] 
\end{lemma}
%
\indy{Index}{component!topological}%
\indy{Notation}{W3@$W_F$ (topological component of a facet)}%

\begin{proof} It is enough to check the following claims
about $W_F$.

\claim { $W_F$ is connected.} Indeed, by Lemma~\ref{lemma:webster},
the relative interior of a convex polyhedron is the intersection of
an affine set with open half-spaces, which is the intersection of
convex sets, and is therefore convex. The set $\op{ri}(F)$ is
convex and is therefore connected.  The positive half-line $I=\{t\mid t>0\}$
is also connected.  The continuous image of the connected set
$\op{ri}(F)\times I$ of these two sets is $W_F$.  Hence, $W_F$ is
connected.

\claim {The set $W_F$ is open.}  Indeed, this is a standard
$\epsilon$-argument.  Let $A$ be the affine hull of $F$.  For any
$\p\in \op{ri}(F)$, select $r>0$ such that $B(\p,r)\cap A\subset
\op{ri}(F)$.  Select $r'>0$ and $0<\epsilon<1$ such that for all
$\q\in B(\p,r')$, there exists $t$ such that $|t|<\epsilon$ and
$(1+t)\q\in A$.  After shrinking $r'$, if $\q\in B(\p,r')$, then
$(1+t)\q \in B(\p,r)\cap A \subset \op{ri}(F)$.  That is,
$B(\p,r')\subset W_F$.  Hence, $W_F$ is open.

\claim {The sets $W_F$ are pairwise disjoint, and the map $F\mapsto
W_F$ is one-to-one.}  Indeed, select any two facets $F,F'$ for
which $W_F\cap W_{F'}\ne \emptyset$.  That is, there exist $\p\in
\op{ri}(F)$, $\p'\in \op{ri}(F')$, and $t,t'>0$ such that $t\, \p = t'\,
\p'$.  By Lemma~\ref{lemma:scale}, $t=t'$ and $\p=\p'\in \op{ri}(F)\cap
\op{ri}(F')$.  By the final statement of Lemma~\ref{lemma:webster},
this implies that $F=F'$.

\claim {The union of the sets $W_F$ is $Y(V_P,E_P)$.}  Indeed,
select any $\p\in Y(V_P,E_P)$.  As $\orz$ lies in the interior of
the bounded polyhedron, we may rescale $\p$ by a positive scalar $t$
so that $t\, \p$ lies in the boundary of $P$, and hence (by
Lemma~\ref{lemma:webster}) in a facet $F$.  If $t\, \p \in
\op{ri}(F)$, then $\p\in W_F$, as desired.  Otherwise, $t\, \p$ lies
in the relative boundary of $F$.  The facets of a three dimensional
polyhedron have dimension two, and the facets forming the relative
boundary of $F$ have dimension one.  These faces are edges of $P$.
Thus, $t\, \p$ lies in an edge of $P$, so that $\p\in X(V_P,E_P)$,
which is contrary to the assumption that $\p\in Y(V_P,E_P)$.  The
claim ensues.

It follows that the sets $W_F$ are the
topological components of $Y(V_P,E_P)$.
\end{proof}
\indy{Index}{connected}%


The following lemma shows that the fan $(V_P,E_P)$ is completely
surrounded.  Hence, by Lemma~\ref{lemma:face}, all of the properties
of conforming fans from the previous section apply to this fan.

\begin{lemma}[]\guid{BSXAQBQ}\cutrate{} 
Let $P$ be a bounded polyhedron
with $\orz$ as an interior point.  Then $\op{azim}(x) < \pi$ for
every dart $x$ in the hypermap $\op{hyp}(V_P,E_P)$.
\end{lemma}
\indy{Index}{polyhedron}%
\indy{Index}{interior!point}%
\indy{Index}{hypermap}%
\indy{Index}{dart}%

\begin{proof}  The result is a consequence of the
lemma that follows.
\end{proof}

\begin{lemma}[]\guid{FLVNSME}
  Let $P$ be a bounded polyhedron with interior point $\orz$.
  Let $\v$ be an extreme point of $P$.  Let $A$ be an open half space
  whose bounding plane contains $\orz$ and $\v$.  Then there exists an
  extreme point $\w$ of $P$, such that $\w\in A$ and
  $\op{conv}\{\v,\w\}$ is an edge of $P$.
\end{lemma}

\begin{proof}  Use the definition of extreme point, to choose a half space
\[
\{ \p \mid \u_1\cdot \p \le b_1\} \supset P,
\]
where equality holds for a point $\p\in P$ if and only if $\p=\v$.
Since $\orz$ is an interior point of $P$, we may assume that $b_1 >0$.

Let $V_P$ be the set of extreme points of $P$.
Select $b_1'$ with $0<b_1'<b_1$ such that
\[
\{\p \mid \u_1\cdot \p \ge b_1' \} \cap V_P = \{\v\}.
\]
Let $P'$ be the polyhedron 
$P \cap \{\p \mid \u_1 \cdot \p = b_1'\}$.  

{\it We claim that there exists an extreme point $\w'$ of $P'$
in $A$.}  Indeed, near $\orz$ we can find a point 
\[
\p \in A \cap P \cap \{ \p \mid \u_1\cdot \p < b_1'\}.
\]
Then $\op{conv}\{\p,\v\}\cap P'$ is a nonempty subset of $A$.  In
particular, $P'$ meets $A$.  Since $P'$ is the convex hull of its
extreme points, some extreme point $\w'$ of $P'$ is an element of $A$.

Use the definition of extreme point, to choose a half space
\[
\{ \p \mid \u_2 \cdot \p \le b_2\} \supset P',
\]
where equality holds for a point $\p\in P'$ if and only if $\p=\w'$.
By adjusting the parameters $(\u_2,b_2)$ by a multiple of
$(\u_1,b'_1)$, we may assume without loss of generality that $\u_2\cdot
\v = b_2$.

If $\p\in P$, there  exists $\p'\in P'$ and $t\ge0$ such that $\p
= \v + t (\p'-\v)$.  Then
\begin{align*}
\u_2\cdot \p &= \u_2\cdot (\v + t (\p'-\v))\\
&= b_2 + t (\u_2\cdot \p' - b_2) \le b_2,
\end{align*}
where equality holds if and only if $\p = \v + t (\w' - \v)$.   It
follows that
\[
\{\p \mid \u_2 \cdot \p = b_2\} \cap P
\]
is an edge of $P$ containing $\v$ and $\w'$.  Let $\w\ne\v$ be an
extreme point of this edge.  This extreme point satisfies the
conclusions of the lemma.
\end{proof}

We can relate the combinatorial properties of the polyhedron to the
combinatorial properties of the hypermap.

\begin{lemma}[]\guid{WBLARHH}\cutrate{}\label{lemma:facet-bi}
Let $P\subset\ring{R}^3$ be a bounded polyhedron with interior point
$\orz$.  The facets of $P$ are in bijection with the faces of
$\op{hyp}(V_P,E_P)$, under the correspondence
\[ 
F\leftrightarrow F' \text{ if and only if } W_F = U_{F'}.
\] 
\end{lemma}

\begin{proof} By the \case{bijection} property of conforming fans,
the faces of the hypermap are in bijection with the set
$[Y]$ of topological components of $Y(V_P,E_P)$.  The facets of $P$
are also in bijection with $[Y]$, by Lemma~\ref{lemma:WF}.
\end{proof}

\begin{lemma}[]\guid{CFYXFTY}\rating{600}\label{lemma:edge-bi}
Let $P\subset \ring{R}^3$ be a bounded polyhedron with interior point
$\orz$.  Under the bijection $F\leftrightarrow F'$ of Lemma~\ref{lemma:facet-bi},
there are bijections among the following three sets:
\begin{enumerate}
\item the set of edges of the facet $F$;
\item the face $F'$ of $\op{hyp}(V_P,E_P)$;
\item a subset $E_1$ of edges of the fan $(V_P,E_P)$:
\[
E_1 = \{ \ee \in E_P \mid C^0(\ee) \text{ meets the closure of }  U_{F'}  \}.
\]
\end{enumerate}
\end{lemma}

\begin{proof}
  It is sufficient to give bijections of the first two sets onto
  $E_1$.  Let $\op{hyp}(V_P,E_P) = (D,e,n,f)$.  Let $F$ be a facet of
  $P$ and let $F'$ be the corresponding face of
  $\op{hyp}(V_p,E_P)$. Write $\bar U$ for the closure of
  $W_{F}=U_{F'}$.  As the closure of a convex set, $\bar U$ is convex.
  In fact, whenever $\v,\w\in \bar U$, then $C\{\v,\w\}\subset \bar
  U$.

  By the construction of $E_P$, there is an injective map from the set
  of edges of $F$ to $E_P$ that sends each edge of $P$ to its set
  $\ee =\{\v,\w\}$ of extreme points.  \claim {We claim that this
    injection sends (1) into $E_1$.}  Indeed, the extreme points 
  $\v,\w$ belong to $F\subset\bar U$ and by convexity and rescaling,
  $C^0\{\v,\w\}\subset\bar U$ as well.

  \claim {We claim that this map sends (1) onto $E_1$.}  Indeed, let
  $\ee'\in E_1$ and let $\p\in C^0(\ee')\cap\bar U$.  Let
  $\q:\ring{N}\to W_{F}$ be a sequence converging to $\p$.  By
  rescaling the sequence, we may assume that $\q':\ring{N}\to
  \op{ri}(F)$ converges to $\p' \in F \cap C^0(\ee')\cap \bar U$.
  This limit lies in $X(V_P,E_P)$, and thus in the boundary of $F$,
  which is a union of edges.  We obtain $\p' \in\op{conv}\,\ee\cap
  C^0(\ee')$, where $\ee$ is the set of extreme points of an edge of
  $F$.  By the {\case{intersection}} property of fans, $\ee = \ee'$.
  This shows that the map sends (1) onto $E_1$.

  Next, we construct a bijection from $F'$ to $E_1$.  There is a map
  from $F'$ to $E_P$ given by $x = (\v,\w) \mapsto \{\v,\w\}$. 

  \claim {This map is injective}.  Otherwise, $y = e x\in F'$ for some
  $x\in F'$.  By the simplicity of conforming fans
  (Lemma~\ref{lemma:conform-simple}), the two darts $y$ and $f x$ in
  the same face and the same node are equal: $f x = e x = e^{-1} x = n
  f x$, giving a fixed point $f x$ under the node map $n$.  By the
  definition of the node map on $\op{hyp}(V_P,E_P)$, this forces edge
  set $E(\w)$ to contain at most one element, which is contrary to the
  fact that every azimuth angle of the dart is less than $\pi$ in a
  conforming fan.

  \claim {The image is contained in $E_1$.}  Indeed, if $x=(\v,\w)\in F'$,
  then $x$ at node $\v$ leads into $U_{F'}$ and $f x$ at node $\w$ leads
  into $U_{F'}$, which gives $\v,\w\in \bar U$ and by convexity and rescaling, 
  $C^0\{\v,\w\}\subset \bar U$.

  \claim {Finally, we claim that the map from (2) to $E_1$ is onto}.
  Let $\{\v,\w\}\in E_1$ and write $x = (\v,\w)$ and $y = (\w,\v)$.
  Fix $\q\in C^0\{\v,\w\}\cap \bar U$.  The proof of
  Lemma~\ref{lemma:lead-exists} constructs a neighborhood of $\q$ that
  is a subset of $U_x\cup U_y\cup C^0\{\v,\w\}$.  The topological
  component $U_{F'}$ meets that neighborhood, forcing it to equal a
  topological component $U_x$ or $U_y$.  Say $U_x = U_{F'}$.  By the
  property \case{bijection} of conforming fans
  (Definition~\ref{def:conforming}), $x\in F'$. It follows that
  $\{\v,\w\}\in E_1$ is the image of $x\in F'$.
\end{proof}



