
\chapter{Fan}\label{sec:fan}




\begin{summary}
This chapter is the final foundational chapter.  The main concept is that of a fan.
A fan is a geometric object that bridges the expanse between sphere packings and hypermaps.  A fan determines a set $V$ of points in $\ring{R}^3$.  Later chapters will interpret the set $V$ as the set of centers of a packing of congruent balls.   The same set $V$ can be interpreted as the set of nodes of a hypermap, or as he set of nodes of a graph.  In fact, a fan might be viewed as  a particular geometric realization of a hypermap.    The main result  is an Euler formula for fans.  This formula  implies that the hypermap of a fan is planar.  The proofs have been carefully organized to avoid any use of the Jordan curve theorem.

At various times, it is useful to focus attention on a single face in a fan.  This leads to a construction of a what is called the localization of a fan along a face.  The localization is again a fan.  Special properties of the localized fan are captured in the notion of a cyclic fan.  The upper bound $2\pi$ on the perimeter of a cyclic fan is established.

A theory of deformations of cyclic fans is developed.  Sufficient conditions are stated for the deformation of a cyclic fan to remain a cyclic fan.

A bridge  also connects polyhedra with fans.  This chapter associates a fan with every bounded polyhedron in $\ring{R}^3$ that contains the origin in its interior.  A consequence of this association is the Euler formula for polyhedra.
\end{summary}


\indy{Index}{fan}%
\indy{Index}{hypermap}%
\indy{Index}{planar}%
\indy{Index}{packing}%
\indy{Index}{Jordan curve theorem}%

\section{Definitions}



\begin{remark}
Some may have already encountered other mathematical objects that go by the name of fan.
The definition of fan here is unrelated to its definitions in other mathematical contexts.   In particular, a fan in this book is not a fan from the theory of toric varieties.
\end{remark}

%In this chapter,  a choice of base point $\orz\in\ring{R}^3$ serves as the origin.  It does no harm to assume, in fact, that $\orz =0$.


If $S$ is a set of points,
abbreviate
  $$
  \begin{array}{lll}
  C_\pm(S) &= \op{aff}_\pm(\orz,S),\\
  C^0_\pm(S) &= \op{aff}^0_\pm(\orz,S).\\
  \end{array}
  $$
When the subscript is absent, the subscript $+$ is implied: $C_+(S) = C(S)$, and
so forth.  The parentheses around $S$ are frequently omitted: 
$$C^0\{\v,\w\}=C^0_+(\{\v,\w\}) = \op{aff}^0_+(\{\orz\},\{\v,\w\}).$$

\begin{definition}[fan,~blade]  
Let $(V,E)$ be a pair consisting of a set $V\subset \ring{R}^3$ and a set of pairs of elements of $V$.  The pair is said to be
a {\it fan\/} if the following properties hold.
    \begin{nomerate}
    \item \case{V} $V$ is finite and  nonempty,
    \item \case{origin} $\orz\not\in V$.
    \item \case{independence} If $\{\v,\w\} \in E$, then $\v$ and $\w$ are independent.
    \item \case{intersection}
    For all $\ee ,\ee '\in E \cup \{\{\v\}\mid \v\in V\}$, 
 $$C(\ee )\cap C(\ee ') = C(\ee \cap \ee ').$$
    \end{nomerate}
When $\ee\in E$, call $C^0(\ee)$ or $C(\ee)$ a {\it blade\/} of the fan.
\end{definition}
\indy{Index}{fan}%
\indy{Notation}{V@$( V, E ) $ (fan)}%
\indy{Index}{V@\uncase{V}}%
\indy{Index}{origin@\uncase{origin}}%
\indy{Index}{indepen@\uncase{independence}}%
\indy{Index}{intersection@\uncase{intersection}}%
\bigskip\hbox{~}\bigskip


%Repeat an older version of the definition (in use between May 15 2009 and June 18 2009).
%\begin{definition}[retro-fan]  Let $(\orgz,V,E)$ be a triple consisting of a point,
%a set of
%points, and a set of pairs of elements of $V$.  The triple is said to be
%a {\it retro-fan\/} if the following conditions hold.
%    \begin{itemize}
%    \item $V$ is finite and nonempty.
%    \item $\orz\not\in V$.
%    %\item Each element of $E$ has two elements.
%    \item For each $\v\in V$, the set
%        $$
%        %% WW changed notation from E_\v to E(\v) to allow deformations E_t
%        E(\v) = \{\w\in V\mid \{\v,\w\}\in E\}
%        $$
%        is cyclic with respect to $(\orz,\v)$.
%    \item For each $\ee\in E$, $V\cap C^0(\orz,\ee)=\emptyset$.
%    \item  Sets $\ee,\ee'\in E$ give
%        $$C^0(\orz,\ee) \cap C^0(\orz,\ee')\ne\emptyset\ \Rightarrow (\ee = \ee').$$
%    \item Sets $\v,\v'\in V$ give
%     $$\op{aff}^0_+(\orz,\v) = \op{aff}^0_+(\orz,\v')\ \Rightarrow (\v=\v').$$
%      %% Added condition May 15, 2009./ killed June 18
%    \end{itemize}
%\end{definition}

\begin{lemma}\guid{CTVTAQA}\rating{40}\label{lemma:subset-fan}
If $(V,E)$ is a fan, then for every $E'\subset E$,  $(V,E')$ is also a fan.
\end{lemma}

\begin{proof} This is immediate.
\end{proof}

\begin{lemma}\guid{XOHLED}\rating{ZZ}  Let $(V,E)$ be a fan.
For each $\v\in V$, the set
        $$
        E(\v) = \{\w\in V\mid \{\v,\w\}\in E\}
        $$
        is cyclic with respect to $(\orz,\v)$.
\end{lemma}
\indy{Notation}{E@$E(\v)$ (edge set)}%

\begin{proof}  If $\w\in E(\v)$, then $\v$ and $\w$ are independent.
Also, if $\w\ne \w'\in E(\v)$, then
$$
C\{\v,\w\}\cap C\{\v,\w'\} = C\{\v\}.
$$
This implies that $E(\v)$ is cyclic.
\end{proof}

\begin{remark}\tlabel{rem:fan}\rating{30}
\begin{itemize}
\item The pair $(V,E)$ is a graph with nodes $V$ and edges $E$.  The set
$$\{\{\v,\w\}\mid \w\in E(\v)\}$$ is the set of edges at node $\v$.
There is an evident symmetry:  $\w\in E(\v)$ if and only if $\v\in E(\w)$.   
%
\item
Since $E(\v)$ is cyclic,
each $\v\in V$ has an azimuth cycle $\sigma(\v):E(\v)\to E(\v)$.
It is allowed that $E(\v) = \{\w\}$,  a
\indy{Index}{azimuth cycle}%
singleton set. If so,
$\sigma(\v)$ is the identity map on $E(\v)$.
%
To make the notation less cumbersome, $\sigma(\v,\w)$ denotes the value of the map $\sigma(\v)$ at $\w$.
%
\item 
The property \case{independence} implies that the graph has no loops: $\{\v,\v\}\not\in E$.
%
\item The property \case{intersection} implies that distinct sets $C^0(\ee)$
do not meet.   This property of fans will eventually be related to  the property of planarity of hypermaps.
\indy{Index}{hypermap}%
\indy{Index}{planar}%
%
\end{itemize}
\end{remark}


Let $(V,E)$ be a fan.  Define a set of darts $D$ to be the union of
two subsets $D_1,D_2$:
    $$
    \begin{array}{lll}
    D_1 &= \{(\v,\w)\mid \{\v,\w\}\in E\}\\
    D_2 &= \{\v \mid \v\in V,\ \ E(\v) = \emptyset\},\\
    D   &= D_1\cup D_2.
    \end{array}
    $$
Darts in $D_2$ are said to be {\it isolated}; and darts in $D_1$ are {\it non-isolated}.
%
\indy{Index}{dart}%
\indy{Index}{dart!isolated}%
\indy{Index}{dart!non-isolated}%
\indy{Index}{isolated}%
\indy{Index}{non-isolated}%
\indy{Notation}{D@$D$ (dart)}%

Define a permutation $n$ on $D_1$ by
    $$n(\v,\w) = (\v,\sigma(\v,\w)).$$
Define a permutation $f$ on $D_1$ by
    $$
    f (\v,\w) = (\w,\sigma(\w)^{-1} \v).
    $$
Define a permutation $e$ on $D_1$ by
    $$
    e (\v,\w) = (\w,\v).
    $$
Define permutations $e,n,f$ on $D_2$ by making them degenerate on $D_2$:
    $$
    e (\v) = n(\v) = f(\v) = \v.
    $$
Set %$\op{hyp}_r(V,E)=(D_1,e,n,f)$ and 
$\op{hyp}(V,E)=(D,e,n,f)$. %for %  them the non-isolated hypermap
%the hypermap associated with $(V,E)$.  
The next lemma shows that $(D,e,n,f)$ is indeed a hypermap.



\begin{lemma}\guid{AAUHTVE}\rating{70}
Let $(V,E)$ be a fan.  Let $D = D_1\cup D_2$
and $\op{hyp}(V,E) = (D,e,n,f)$, as constructed above.  Then
    \begin{itemize}
    \item $\op{hyp}(V,E)$ is a plain hypermap.
    \item  $e$ has no fixed
points in $D_1$.
    \item  $f$ has no fixed points in $D_1$.
    \item For every pair of distinct nodes, there is at most one
    edge meeting both.
    \item The two darts of an edge of $D_1$ lie at different nodes.
    \end{itemize}
\indy{Notation}{hyp@$\op{hyp}$ (hypermap)}%
\end{lemma}

\begin{proof}  Plainness is an elementary calculation:
    $$
\begin{array}{lll}
e(n(f(\v,\w))) &= e(n(\w,\sigma(\w)^{-1} \v))) &=
        e(\w,\v)\\ 
&= (\v,\w).
\end{array}
$$
So $\op{hyp}(V,E)$ is a hypermap. Compute
    $$e(e(\v,\w)) = e(\w,\v) = (\v,\w).$$
A fixed point in $D_1$ under $e$ would force $\v = \w\in E(\v)$,
but by construction $\v\not\in E(\v)$.  The argument that $f$ has no
fixed points is similar.

The next step is to show that for every pair of distinct nodes, there is at most one edge
meeting both.
That is,
        $$(n^k e x = e n^\ell x)\Rightarrow (n^\ell x = x).$$
Let $x = (\v,\w)\in D_1$.  Let $\sigma=\sigma(\v)$. Then
    $$
    \begin{array}{lllllll}
    n^\ell x &= (\v,\sigma^\ell \w)\\
    e n^\ell x &= (\sigma^\ell \w,*)\\
    e x &= (\w,*)\\
    n^k e x &= (\w,*)\\
    n^k e x &= e n^\ell x \\&\ \Rightarrow (\w = \sigma^\ell \w) \\&\ \Rightarrow
    (n^\ell x = (\v,\w) = x)
    \end{array}
    $$

Finally,  each dart of an edge lies on a different node.
That is, $e x \ne n^k x$, for $x\in D_1$.   In detail:
    $$
    \begin{array}{lll}
        e(\v,\w) &= (\w,*),\quad \w\in E(\v)\\
        n^k(\v,\w) &= (\v,*),\quad \v\not\in E(\v).
    \end{array}
    $$
The result follows.
\end{proof}

\section{Topology}\label{sec:topology}

\subsection{basics}

%There is hardly any topology that comes up in this book.  Most of
%what is needed appears in this chapter.  
This chapter uses some basic
notions in topology such as continuity, connectedness, and compactness.

\begin{remark} The term {\it ``connected''} is now being used in
two different senses: in the topological sense and in a combinatorial
sense for hypermaps.    To reduce the confusion, this book calls the connected components
of a topological space {\it ``topological components''} and the connected
components of a hypermap {\it ``combinatorial components''}.
\end{remark}
\indy{Index}{connected}%
\indy{Index}{connected!topological component}%
\indy{Index}{connected!combinatorial component}%


Basic facts about the topology of Euclidean space will be assumed.  In particular,
the set $\ring{R}^3$ is a metric space under the
Euclidean distance function $d(\v,\w) = \norm{\v}{\w}$.  Every subset of
$\ring{R}^3$ is a metric space under the restriction of the metric
$d$ to the subset.  A subset carries the metric space topology.
In particular, $$S^2 = \{ \v \mid \normo{ \v} = 1\},$$ the unit sphere in
$\ring{R}^3$ centered at $\orz$, is a metric space and a topological space.
\indy{Index}{metric space} %

If $Y$ is an open set in $\ring{R}^3$, write
$\comp{Y}$ for its set of topological components.
\indy{Notation}{1@$\comp{Y}$ (topological components)}%
The family of topological components of $Y$ has the following properties:
the members are pairwise disjoint, nonempty, connected open sets; and the
union of the family is all of $Y$.
Conversely, any family with these properties must be the
family of topological components of $Y$.
If two
points in $\ring{R}^3$ 
can be joined by a continuous path in $Y$,
then the two points lie in the same topological component of $Y$.
\indy{Index}{path connected}%
\indy{Index}{connected!topological component}%
\indy{Notation}{1@$\comp{Y}$ (topological components)}%
 






\subsection{topological component and dart}

Let $(V,E)$ be a fan and let $(D,e,n,f) = \op{hyp}(V,E)$
be the associated hypermap.  
\indy{Index}{fan}%
\indy{Index}{dart}%
\indy{Index}{hypermap}%

\begin{definition}[X,~Y]\label{def:XY}
Let $(V,E)$ be a fan.  Let $X=X(V,E)$ be the union of the
blades
   $$C(\ee)$$
as $\ee$ ranges over $E$.  Let $Y=Y(V,E)$ be the complement
$Y = \ring{R}^3\setminus X$.
\indy{Notation}{X@$X$ (fan)}%
\indy{Notation}{Y@$Y$ (fan)}%
\end{definition}


A wedge $\Wdart(x)$, a subset $\Wdart(x,\epsilon)$,
and an azimuth angle $\op{azim}(x)$ are associated with
with each dart $x=(\v,\w)\in D$.  Define 
\indy{Index}{wedge}%
\indy{Index}{angle!azimuth}%
\indy{Index}{azimuth}%
\indy{Index}{dart}%
\indy{Notation}{Wdart@$\Wdart$ (wedge)}%
\indy{Notation}{azim}%
$$
\Wdart(x)=
\begin{cases} 
W^0(\orz,\v,\w,\sigma(\v,\w)),&\text{if }\card(E(\v))>1,\\
\ring{R}^3\setminus \op{aff}_+(\{\orz,\v\},\w),&\text{if } E(\v) = \{\w\},\\
\ring{R}^3\setminus \op{aff}\{\orz,\v\},&\text{if } E(\v) = \emptyset.\\
\end{cases}
$$
Define
$$
\bWdart(x) = 
\begin{cases} 
W(\orz,\v,\w,\sigma(\v,\w)),&\text{if }\card(E(\v))>1,\\
\ring{R}^3,&\text{otherwise }.\\
\end{cases}
%\{ \u\mid 0\le \op{azim}(\orz,\v,\w,\u)\le \op{azim}(\orz,\v,\w,\sigma(\v,\w)) \}.
$$
\indy{Notation}{Wdart@$\bWdart$ (closure of $\Wdart$)}%
($\bWdart(x)$ is the closure of $\Wdart(x)$.)


Define $\op{azim}(x)$ as the azimuth angle of $\Wdart(x)$:
\indy{Notation}{azim}%
$$
\op{azim}(x)=\begin{cases}
\op{azim}(\orz,\v,\w,\sigma(\v,\w)), &\text{if } \card(E(\v)) > 1,\\
2\pi, & \text{otherwise.}\\
\end{cases}
$$
For any $x = (\v,\ldots)\in D$, set
    $$
    \Wdart(x,\epsilon) = \Wdart(x) \cap \op{rcone}^0(\orz,\v,\cos\epsilon).
    $$

%All the hypermaps in this book are connected. $D_2$ is not needed.


\begin{lemma}\guid{VBTIKLP}\tlabel{lemma:disjoint}\rating{120}
Let $(V,E)$ be a fan with hypermap $(D,e,n,f)$.  Let $N$ be a node of the hypermap.  There exists $\v\in V$
such that the darts of $N$ are precisely
the darts of the form $(\v,\ldots)$.  Furthermore, there is a 
disjoint sum decomposition of $\ring{R}^3$ given by
  $$
  \ring{R}^3 = 
  \op{aff}\{\orz,\v\} \cup
  \bigcup_{x\in N} \Wdart(x)  \cup 
  \bigcup_{\{\v,\w\}\in E} \op{aff}_+^0(\{\orz,\v\},\w).
  $$
\end{lemma}
\indy{Index}{disjoint sum decomposition}%
\indy{Index}{hypermap}%
\indy{Index}{dart}%

\begin{definition}
Under the identification of nodes of $D$ with $V$,
write $\v(x)\in V$ for the vertex corresponding to a dart $x\in D$. 
\end{definition}

\begin{proof}
The proof begins with the existence of the disjoint sum decomposition.
First of all, $\ring{R}^3$ is the disjoint union of $\op{aff}\{\orz,\v\}$
and its complement.

The case when $\card(E(\v))\le 1$ follows immediately from the definitions.  
Therefore assume  that $\card(E(\v)) >1$.
Fix $\u$ such that $\{\v,\u\}\in E$, and let $\sigma$ be the azimuth
cycle on $E(\v)$.  Let $\alpha(i)=\op{azim}(\orz,\v,\sigma^i \u,\sigma^{i+1}\u)$.   By Lemma~\ref{lemma:2pi-sum}, the sum of the angles $\alpha(i)$ is $2\pi$.  Every $\p\in\ring{R}^3\setminus\op{aff}\{\orz,\v\}$ satisfies
$$
\sum_{i=0}^j \alpha(i) <
\op{azim}(\orz,\v,\u,\p) < \sum_{i=0}^{j+1} \alpha(i).
$$
or 
$$
\sum_{i=0}^j \alpha(i) = \op{azim}(\orz,\v,\u,\p)
$$
for a unique $0 \le j < n$, where $n$ is the cardinality of $E(\v)$. 
These conditions are exactly the membership conditions for the sets
$
\Wdart(\v,\sigma^j \u)
$
and $\op{aff}_+^0(\{\orz,\v\},\sigma^j \u)$, respectively.
The result follows.
\end{proof}

\begin{corollary}\guid{IBZWFFH}\tlabel{cor:W}\rating{40}
Let $x = (\v,\ldots)$ be a dart and $\w\in E(\v)$.
Then $\Wdart(x)\cap C\{\v,\w\}=\emptyset$.
\end{corollary}

\begin{proof} The decomposition of Lemma~\ref{lemma:disjoint} is
disjoint.  It follows directly from the definitions that
   $$C\{\v,\w\}\subset \op{aff}_+^0(\{\orz,\v\},\w) \cup 
    \op{aff}\{\orz,\v\}.$$
\end{proof}

\begin{lemma}\guid{JGIYDLE}\rating{120} 
For each dart $x$, and $\epsilon$ sufficiently small and positive,
$\Wdart(x,\epsilon)$ is nonempty and lies in a single 
topological component of $Y(V,E)$.
\end{lemma}
\indy{Index}{connected!topological component}%
\indy{Notation}{Wdart@$\Wdart$ (dart)}%

\begin{proof}  (Beware of the notational subtleties: $\epsilon\in\ring{R}$ is not $\ee\in E$.)  The proof first shows that $\Wdart(x,\epsilon)$ lies in $Y$,
for $\epsilon$ small.  Let $x=(\v,\w)\in D_1$.  
Let $S^2$ be the unit sphere centered at $\orz$.
By making $\epsilon$ small enough,
the sets $\Wdart(x,\epsilon)\cap S^2$
avoid the compact sets $C(\ee)\cap S^2$ when $\v\not\in \ee$.
Thus, $\Wdart(x,\epsilon)$ also avoids $C(\ee)$ when $\v\not\in \ee$.
By Corollary~\ref{cor:W}, $\Wdart(x,\epsilon)$ avoids $C(\ee)$, when $\v\in \ee$.
Thus, $\Wdart(x,\epsilon)\subset Y$, for $\epsilon$ small.

To complete the proof, it is enough to show that each $\Wdart(x,\epsilon)$ is
connected.  
The  set
   $$
    (0,\infty) \times (\theta_1,\theta_2) \times (0,\epsilon)
   $$
is connected.
The set $\Wdart(x,\epsilon)$  is the image of this product
under a spherical coordinate representation (Definition~\ref{def:sph}).
\indy{Index}{spherical coordinates}%
It is readily verified that the spherical to Cartesian coordinate transformation is
a continuous map. As the image of a connected set under a continuous map, $\Wdart(x,\epsilon)$ is connected.
\end{proof}
\indy{Index}{connected}%
\indy{Index}{polar coordinates}%

\begin{definition}[leads~into] For each dart $x$, 
there is then a well-defined topological
component $U_x$ of $Y(V,E)$ 
that contains $\Wdart(x,\epsilon)$ (for all
sufficiently small positive $\epsilon$). Say the dart {\it leads into}
$U_x$.
\end{definition}
\indy{Index}{connected}%
\indy{Notation}{U@$U_x$ (connected component)} %


\section{Planarity}


\subsection{face attributes}


\begin{lemma}[sweep]\guid{DHVFGBC}\rating{400}\label{lemma:sweep}  
Let $(V,E)$ be a fan with hypermap $(D,e,n,f)$.  
Suppose that $\op{azim}(x)<\pi$
for all darts $x\in D$.  Fix a dart $x\in D$.
Let $\v = \v(x)$, $\v_0 = \v(f x)$,
and $\v_1 = \v(f^2 x)$.  Let $\w(t) = (1-t) \v_0 + t \v_1$, for
$0\le t\le 1$.  Then
\begin{itemize}
\item $\v$ and $\w(t)$ are independent for each $t\in[0,1]$.
\item If $0 < t \le 1$, and $C^0(t)$ meets $X$, then $t=1$ and $\{\v,\v_1\}\in E$.
%\item For $0< t < 1$, it follows $C^0(t)\subset Y$.
%item If $\{\v,\v_1\}\in E$ (that is, if the face of $x$ is a triangle), 
%then $C^0(1)$ is the blade $C^0\{\v,\v_1\}$ of the fan.
%\item If $\{\v,\v_1\}\not\in E$, then $C^0(1)\subset Y$.
\end{itemize}
\end{lemma}


\begin{figure}[htb]
  \centering
  \szincludegraphics[width=50mm]{\pdfp/vt.eps}
  \caption{Adding an edge to the fan.}
  \label{fig:vt}
\end{figure}


\begin{proof}
Abbreviate $C^0(t) = C^0\{\v,\w(t)\}$.
Let $Y = Y(V,E)$ and $X = X(V,E)$.
It follows from the definition of a fan that $\{\v,\v_0\}\in E$ and
that $\v$ and $\v_0$ are independent.  By continuity, $\v$ and $\w(t)$
are independent when $t$ is positive and sufficiently small.  
%If it exists, set $t'$ as
%the smallest $t>0$ for which $\{\orz,\v,\w(t)\}$ is a collinear set.  If it exists, let $I=\{t\mid 0< t < t'\}$, otherwise let $I=\{t\mid 0 < t \le 1\}$.  For each $t\in I$, the blade $C^0(t)$ is not a collinear set and is contained in a unique plane $A(t)$ through $\orz$ and $\v$.
Let $I\subset\leftopen0,1\rightclosed$ be an interval that contains $(0,\epsilon)$ for some sufficiently small positive $\epsilon$, and such that $\v$ and $\w(t)$ are independent for all $t\in I$.

\claim{If $t\in I$ and $C^0(t)$ meets $X$, then $t=1$ and $\{\v,\v_1\}\in E$.} 
Indeed,  a consideration of possible intersections with vertices $\w\in V$ and blades
$C^0(\ee)\subset X$ shows that for $t>0$ sufficiently small,
$C^0(t)$ does not meet $X$, hence $C^0(t)\subset Y$.  Assuming 
that $C^0(t)$ meets $X$ for some $t\in I$, let $a$
be the smallest such $t\in I$.
$C^0(a)$ cannot meet $X$ at a vertex $\w\in V$, because $\op{azim}(x)<\pi$ whenever $\w=\v(x)$, 
which means that 
%for any $t$ for which  $C^0(t)$ meets $\w$ 
there is a smaller $t<a$ for which $C^0(t)$ meets a blade at $\w$.
Thus, $C^0(a)$ first meets $X$ along a blade $C^0(\ee)$. If
the intersection with this blade is transversal, again one can find a smaller $t$ that
gives an intersection with the blade.  Hence, 
$C^0(a)$ and $C^0(\ee)$ are coplanar.  From the disjointness
properties of blades of a fan, it follows that $\ee = \{\v,\v_1\}\in E$,
that $a=1$, and that $C^0(1)$ is a blade of the fan.  The claim follows.

Now assume for a contradiction that $\v$ and $\w(t)$ are dependent for some $t\in\leftopen0,1\rightclosed$.  Let $b\in I$ be the least such constant.  
Pick $0<a<b$.  Then
$\{\orz,\w(a),\w(b),\v\}$ lie in a unique plane $A$.  Since all $\w(t)$
lie in a line,  $\w(t)\in A$ all $t\in I$.  Then $\v_0\in C^0(a)\cap X$,
contradicting the established disjointness of $X$ from $C^0(a)$.  Thus, $b$ does not exist.  This proves the first conclusion of the lemma.  

Now $I= \{t\mid 0 < t \le 1\}$ and the second conclusion of the lemma follow immediately from the claim.
\end{proof}

\begin{lemma}\guid{RWXUYZZ}\rating{100} \label{lemma:UF}
Let $(V,E)$ be a fan with hypermap $(D,e,n,f)$.   Assume that $\op{azim}(x)<\pi$ for all darts $x\in D$. Then for every face $F$ of the hypermap, there exists a topological component $U$ of $Y(V,E)$ such that for every $x\in F$, the dart $x$ leads into $U$. 
\end{lemma}
\indy{Index}{connected!topological component}%
\indy{Index}{hypermap}%
\indy{Index}{dart}%

Write $F\mapsto U_F$ for this map from faces to topological components.
\indy{Notation}{UF@$U_F$}%

\begin{proof}  Fix any dart $x\in F$ and construct the set $C^0(t)$ as
in the previous lemma.  
For all $\epsilon>0$
sufficiently small, there exists $\delta>0$ such that set $C^0(t)$ meets
both $\Wdart(x,\epsilon)$ and $\Wdart(f x,\epsilon)$ for all $0<t<\delta$.  
By the previous lemma, the set $C^0(t)$ lies in a single
component $U$ when $t$ is positive and sufficiently small.  
Thus,
$x$ and $f x$ lead into the same component $U$.  By induction, for all
$y\in F$, the dart $y$ leads into $U$.
\end{proof}

\begin{lemma}\guid{DWWUTKW}\rating{ZZ}\label{lemma:add-edge}
Let $(V,E)$ be a fan and let $\v,\w\in V$ be independent.   Suppose that
$C^0\{\v,\w\}\subset U_F$ for some face $F$.  Let $E' = E\cup\{\{\v,\w\}\}$.  Then
$(V,E')$ is a fan.
\end{lemma}

\begin{proof} Each of the defining properties of a fan will be established in turn.
The vertex set is unchanged.  It remains finite and nonempty, and it does not contain $\orz$.  The property \case{independence} of $E'$ follow from the corresponding property of $E$
and the assumed independence for $\{\v,\w\}$.  

In the verification of the intersection property:
$$
C(\ee)\cap C(\ee') = C(\ee \cap \ee'),
$$
it is enough to consider the case $\ee = \{\v,\w\}$ and $\ee' \ne \ee$, the other cases being trivial.  Then from the known facts $C\{\v,\w\} = C^0\{\v,\w\}\cup C\{\v\}\cup C\{\w\}$, $C^0\{\v,\w\}\subset U_F$,   $C(\ee')\subset X(V,E)$, and $X(V,E)\cap U_F=\emptyset$, it follows that
$$
\begin{array}{rll}
C\{\v,\w\} \cap C(\ee')  &= (C\{\v\} \cup C\{\w\}) \cap C(\ee') \\
  &= C(\{\v\}\cap \ee') \cap C(\{\w\}\cap \ee')\\
  &= C(\{\v,\w\}\cap \ee').
\end{array}
$$
(The last equality uses the observation that at most one of the two intersections $\cdot\cap\ee'$ in the penultimate line is nonzero.)
Thus, $(V,E')$ is a fan.
\end{proof}


\begin{lemma}\guid{JUTSTKG}\rating{120}\label{lemma:lead-exists}
Let $(V,E)$ be a fan with hypermap $(D,e,n,f)$. Let $Y=Y(V,E)$. Assume that $\op{azim}(x)<\pi$ for all darts $x$.  For every topological component $U$ of $Y$, there is a dart $x\in D$ that leads into $U$.
\end{lemma}
\indy{Index}{connected!topological component}%
\indy{Index}{fan}%
\indy{Index}{hypermap}%

\begin{proof}  
In the notation of Lemma~\ref{lemma:sweep}, to show the dependence of the sets $C^0(t)$ on the initial dart $x$, write $C^0(t,x)$.

Let $\p\in U$.  Choose a continous path $\varphi:[0,1]\to \ring{R}^3\setminus\{0\}$
such that $\varphi(t)\in U$ for $t<1$ and $\varphi(1)\not\in U$.  Then
$\q=\varphi(1)\in X$.  If $\q\in C^0\{\v\}$ for some $\v\in V$,
then there exists a dart $x$ with node $\v = \v(x)$ such that for all sufficiently small positive $\epsilon$, there exists some $0\le t < 1$ such that  $\varphi(t)\in \Wdart(x,\epsilon)\subset U_x$.  
Thus, $x$ leads into $U$.
\indy{Notation}{ZZddgamma@$\varphi$ (path)}%

The other possibility is that
$\q\in C^0\{\v,\w\}$ for some $\{\v,\w\}\in E$.  In this case, there is a unique
edge $\{x,y\}$ of the hypermap such that $\v=\v(x)$ and $\w=\v(y)$.   (That is, $x=(\v,\w)$ and $y=(\w,\v)$.)
There
is also a small neighborhood of $\q$ such that every point $\q'$ in that neighborhood
takes one of the following forms:
\begin{itemize} \item $\q'\in C^0\{\v,\w\}$;
\item $\q'\in C^0(s,x)\subset U_x$ for some $0<s<1$;
\item $\q'\in C^0(s,y)\subset U_y$ for some $0<s<1$.
\end{itemize}
Points of the first form do not meet $Y$.  Thus,  $\varphi(t)\in U_x$ or $\varphi(t)\in U_y$.  
\end{proof}

\begin{lemma}[triangle~attributes]\guid{KVQWYDL}\rating{200} \label{lemma:triangle}
Let $(V,E)$ be a fan with hypermap $(D,e,n,f)$. 
Let $Y=Y(V,E)$.
Assume that $\op{azim}(x)<\pi$
for all darts $x\in D$.  Fix a face $F$ of cardinality three, fix
$x_0\in F$, and set $x_i = f^i x_0$. Then
\indy{Index}{triangle attributes}%
\begin{itemize}  
\item $U_F$ is equal to the intersection of the three half-spaces:
$$A^0_+(i)=\op{aff}_+^0(\{\orz,\v(x_{i+1}),\v(x_{i+2})\},\v(x_i)),\quad i=0,1,2.$$
\item If a dart $y$ leads into $U_F$, then $y\in F$.
\end{itemize}
\end{lemma}
\indy{Index}{half-space}%

\begin{proof} The intersection of two half-spaces, $A^0_+(1)\cap A^0_+(2)$ is
the wedge $\Wdart(x_0)$.   The sets $C^0(t,x_0)\subset\Wdart(x_0)$ sweep out precisely
the intersection of $\Wdart(x_0)$ with $A^0_+(0)$.  The sets $C^0(t,x_0)$ belong to
$U_F$.  Hence the intersection $U'$ of the three half-spaces is a subset of $U_F$.

Suppose for a contradiction 
that $\p$ is a point of $U_F$ that does not belong to $U'$.  Choose a continuous path $\varphi:[0,1]\to U_F$ with $\varphi(0)\in U'$ and $\varphi(1)=\p$.  Let $t>0$ be the first time such that $\varphi(t)\not\in U'$.  Then $\q=\varphi(t)$ lies in the set consisting of the closed intersection of half-spaces $A_+(i)$ corresponding to $A^0_+(i)$ and lies
in one of the bounding planes.  Let 
$$
X' = \bigcup C(i),\quad\text{ where } C(i)=C\{\v(x_i),\v(x_{i+1})\}.
$$
Then $\q\in X'\subset X$.  This yields the impossibility:
$\q\in X\cap Y = \emptyset$.   Thus, $U'=U_F$.

Let $y$ be any dart that leads into $U_F$ at vertex $\v(y)$.  Then
$\Wdart(y,\epsilon)$ meets $U_F$ for all $\epsilon>0$ sufficiently small.
This implies that $\v(y)$ lies in the intersection of the closed half-spaces $A_+(i)$.  As previously established, this intersection is the disjoint union of $U_F$ and
$X'$.  As $\v(y)\in X$, which does not meet $U_F$, it follows that $\v(y)\in X'$.
The set $X'$ is the disjoint union of the rays $C\{\v(x_i)\}$ and
the three blades $C^0(i)$.  These blades do not meet $V$, hence
$\v(y)=\v(x_i)$ for some $i$.  Thus, $y$ and $x_i$ belong to the same
node.  The sets $\Wdart(y)$ and $\Wdart( x_i)$ are disjoint for distinct darts at the same
node, and this implies that $y=x_i\in F$.
\end{proof}

\begin{corollary}\guid{MOZNWEH}\rating{60}\label{lemma:girard-component}
Let $F$ be a face of size $3$ in the context of Lemma~\ref{lemma:triangle}.  Then for $r>0$, $U_F \cap B(\orz,r)$ is measurable and $r$-radial at $\orz$.
The solid angle of $U_F$ is given by the formula
$$
\sol(U_F) = -\pi + \sum_{x\in F}\op{azim}(x),
$$
\end{corollary}
\indy{Index}{angle}%
\indy{Notation}{F@$F$ (face)}%
\indy{Notation}{U@$U_F$ (component)}%

\begin{proof} An intersection of half-spaces through the origin 
with $B(\orz,r)$ is measurable and
$r$-radial.  The solid angle is given by Girard's formula for
a spherical triangle (Lemma~\ref{lemma:prim-volume}).
\end{proof}
\indy{Index}{Girard's formula}%

\begin{lemma}[face attributes]\guid{PIIJBJK}\rating{1000}\label{lemma:face}
Let $(V,E)$ be a fan with hypermap $(D,e,n,f)$. 
Assume that $\op{azim}(x)<\pi$
for all darts $x\in D$.  Then
\begin{nomerate}
\item \case{bijection} The map $F\mapsto U_F$ is a bijection between faces of the hypermap
and topological components of $Y$.
\item \case{half-space} The topological component $U_F$ is the intersection of the open
half-spaces $\op{aff}_+^0(\{\orz,\v(x),\v({f x})\},\v(f^2 x))$, as $x$ runs
over $F$.
\item \case{solid angle} For every $F$, the intersection $B(\orz,r)\cap U_F$ is measurable and
eventually radial at $\orz$.  The solid angle of $U_F$ is given by the
formula
$$
\sol(U_F) = 2\pi + \sum_{x\in F}(\op{azim}(x)-\pi).
$$
\item \case{diagonal}  If $x,y\in F$ are distinct, with corresponding vertices $\v(x),\v(y)\in V$, then
$\v(x)$ and $\v(y)$ are independent.
Furthermore, 
either $x,y$ are adjacent under the face map, or $C^0\{\v(x),\v(y)\}\subset U_F$.  {\it That is, the ``diagonals'' of the polygon $U_F$ are all interior.}
%%\item  {\bf [triangulation]~} Triangulations of $U_F$ exist.  More precisely,
%there is a fan $(V,E')$ such that $E\subset E'$ and such that every face of
%$\op{hyp}(V,E')$ has cardinality $3$.
\end{nomerate}
\end{lemma}

This lemma has several significant corollaries.  The corollaries all hold under the assumptions of the lemma: $(V,E)$ is a fan such that $\op{azim}(x)<\pi$ for all darts $x$ in its hypermap.  The proof of Lemma~\ref{lemma:face} appears after the corollaries.

\begin{corollary}\guid{GINGUAP}\rating{40}
Each topological component $U_F$ is convex.
\end{corollary}
\indy{Index}{component!topological}%
\indy{Index}{convex}%

\begin{proof} It is the intersection of half-spaces.
\end{proof}

\begin{corollary}\guid{SRPRNPL}\rating{60}  
The hypermap of the fan $(V,E)$ is simple.
\end{corollary}
\indy{Index}{hypermap!simple}%

\begin{proof}  Let $x\in F$.  By the intersection of half-spaces property, $U_F$ is contained in the wedge $\Wdart(x)$ at $x$.  If there is a second dart $y$ at the same node in $F$, then $U_F$ is also contained in $\Wdart(y)$. However, by Lemma~\ref{lemma:disjoint}, the wedges at a given node are disjoint.
\end{proof}

\begin{corollary}\guid{WGVWSKE}\rating{150}  
The hypermap of the fan $(V,E)$ is connected.
\end{corollary}
\indy{Index}{connected}%
\indy{Index}{hypermap}%
\indy{Index}{component!combinatorial}%

%\begin{proof} Let $x,y$ be any two darts.  After replacing $x$ with $f x$ if necessary (which does not change the combinatorial component)
%assume that $\{\orz,\v(x),\v(y)\}$ is not a collinear set. 
%For each blade $C^0(\ee)$ of the fan that meets $C=C^0\{\v(x),\v(y)\}$
%pick one of the two endpoints of $\ee$.  This gives a sequence
%$$
%\v(x)=\v_0,\v_1,\ldots,\v_k=\v(y)
%$$
%such that $C^0(\{\v_i,\v_{i+1}\})$ lies in a single topological component $U_i$.  Each $U_i$ has the form $U_F$ for some face $F=F_i$ of the hypermap.
%Thus,  a combinatorial path is constructed from $x$ to $y$ by moving by the face map from dart to dart within each $F_i$ and by the node map from dart to dart around a given node $\v_j$.
%\end{proof}

\begin{proof}  Let $[D]$ denote the set of combinatorial components of $D$.
There is a well-defined continuous (in fact, locally constant) function from $Y$ onto $[D]$ given as follows.  For $\p\in Y$, choose $F$ such that $\p\in U_F$ and send $\p$ to the class of $F$ in $[D]$.  By Lemma~\ref{lemma:face} \case{bijection}, this map is well-defined. This map extends continuously to $C^0(\ee)$, for $\ee\in E$, by sending $\p\in C^0(\ee)$ to the the combinatorial component of $D$ containing the edge $\{x,y\}$ of the hypermap that corresponds with $\ee$.  The domain
$$
Y\cup \bigcup C^0(\ee)
$$
is connected.  The continuous map from this connected set onto the discrete set is necessarily constant.  As the map is onto, the set $[D]$ reduces to a singleton.
\end{proof}

\begin{corollary}\guid{GGRLKHP}\rating{100}  
The hypermap of the fan $(V,E)$ is planar.
\end{corollary}
\indy{Index}{planar}%
\indy{Index}{hypermap}%

\begin{proof}  The solid angle of a sphere is $4\pi$.  The set $X(V,E)$
has measure zero, so that
\begin{equation}\label{eqn:solid-sum}
4\pi = \sol(Y)= \sum_F \sol(U_F) = 
\sum_F ( 2\pi + \sum_{x\in F} (\op{azim}(x)-\pi) ).
\end{equation}
The double sum over faces and darts in a face can be replaced by
a single sum over all darts.  
The sum of the azimuth angles of all darts at a node is $2\pi$. Thus,
all the azimuth angle terms give $2\pi\,\#n$.
Thus, the formula~(\ref{eqn:solid-sum}) becomes
$$
4\pi = 2\pi\, \#f +2\pi\,\#n - \pi\, \#D.
$$
In a plain hypermap in which the edge map has no fixed points, $\#D = 2\,\#e$.
The relation becomes
$$
2 + \#D = \#f + \#e + \#n.
$$
This is the condition of planarity for a connected hypermap.
\end{proof}
\indy{Index}{hypermap!connected}%

\subsection{proof of face attributes}

Now turn to the proof of the face-attribute lemma (Lemma~\ref{lemma:face}).  The proof breaks into a series of small lemmas.  The primary proof method is an induction on the following invariant of a fan $(V,E)$.  If $(V,E)$ is a fan,  let $N(V,E)$ be the natural number
$$
\sum_F (k_F - 3),
$$
where the sum runs over faces of the  hypermap, and $k_F$ is the cardinality of the face $F$.
%We prove the conclusion of the lemma, together with the additional
%conclusion:
%\begin{itemize}
%\item If $C^0(\ee)$ is any diagonal of $U_F$ (with $\ee\not\in E$), then the %fan $(V,E'')$, where $E'' = E\cup\{\ee\}$, satisfies
%$N(V,E'')+1 = N(V,E)$.
%\end{itemize}

\begin{lemma}\guid{DWFBRQY}\rating{ZZ} Lemma~\ref{lemma:face} holds under the additional assumption that $N(V,E) = 0$.
\end{lemma}
\indy{Index}{face!attribute}%
\indy{Notation}{N@$N$ (face)}%
\indy{Notation}{kfz@$k_F$ (cardinality of face)}%

\begin{proof}
If $N(V,E)=0$, then the hypermap is a triangulation.  By Lemmas~\ref{lemma:UF} and \ref{lemma:lead-exists}, every topological component of $Y$ has
the form $U_F$ for some face $F$.  By Lemma~\ref{lemma:triangle}, $U$ uniquely determines the face $F$.  Thus, there is a bijection between faces of the hypermap and topological components.  By Lemma~\ref{lemma:triangle}, the topological component $U_F$ is the intersection of open half-spaces as asserted.  The solid angle formula is given by Corollary~\ref{lemma:girard-component}.  The assertion of the lemma about diagonals 
%and triangulations 
is trivial for a hypermap that is already a triangulation. This completes the proof in the base case $N(V,E)=0$.
\end{proof}
%\indy{Index}{triangulation}%

When $N(V,E)>0$,  there exists a face $F$ of the hypermap that is not a triangle.  By Lemma~\ref{lemma:sweep}, there are $x,y\in F$ such that $C^0\{\v,\w\}\subset U_F$, where $\v = \v(x)$ and $\w = \v(y)$. Form a new fan $(V,E')$ on the same vertex set with
$E' = E\cup \{\{\v,\w\}\}$.   (See Lemma~\ref{lemma:add-edge}.)  The construction of $E'$ depends on choices: $F$, $x\in F$, and $y\in F$.   The following notation is useful.  Add primes to symbols denoting objects related to $(V,E')$.  
%Write
%$\v=\v(x)$ and $\w=\v(y)$.  
Let $x',y'\in D'$ be the darts such that $\{x',y'\}$ is the edge in the hypermap corresponding to $\{\v,\w\}\in E'$.  In other words, $x'=(\v,\w)$ and $y'=(\w,\v)$, $x=(\v,\cdot)$ and $y=(\w,\cdot)$. The darts $x',y'$ lead into topological components $U(x')$ and $U(y')$ of $Y'=Y(V,E')$  and belong to faces $F(x')$, $F(y')$ of $H'=\op{hyp}(V,E')$.

\begin{lemma}\guid{ZSZIUQE}\rating{ZZ} 
Assume that $N(V,E)>0$.  Let $E'=E\cup \{\{\v,\w\}\}$, as above.  Assume that $F(x')$  is a triangle. Then $N(V,E')<N(V,E)$.
\end{lemma}


\begin{proof}    The hypermap $H=\op{hyp}(V,E)$ is obtained from $H'=\op{hyp}(V,E')$ by a double walkup transformation on the edge $\{x',y'\}$.    The faces $F(x')$ and $F(y')$ are distinct (by Lemma~\ref{lemma:triangle}, which asserts that $y'$ does not lead into $U(x')$).  Thus, the walkup transformation merges two faces.   Then 
$$N(V,E) - N(V,E') = ((k+1)-3) ~~-~~ ((k-3) + (3-3)) = 1 >0,$$
where $k$ is the cardinality of $F(y')$.
\end{proof}

In the proof of Lemma~\ref{lemma:face},
assume for a contradiction that there exists a fan $(V,E)$ 
satisfying the assumptions of the lemma, but not the conclusion.
Among all such counterexamples with fixed vertex set $V$,  pick
$E$ to minimize  $N(V,E)$.  Refer to this fan as a minimal counterexample (to
Lemma~\ref{lemma:face}).  

By the assumed minimality of $N(V,E)$, the conclusions of Lemma~\ref{lemma:face} holds for the
modified fan $(V,E')$.  The strategy of the proof of Lemma~\ref{lemma:face} will
be to use the modified fan $(V,E')$ to show that the conclusions of the Lemma~\ref{lemma:face} hold for $(V,E)$ as well.   These conclusions will be established for $(V,E)$ through a series of lemmas.  The result will contradict the assumption that
$(V,E)$ is a counterexample.

\begin{lemma}\guid{OBHTHCD}\rating{ZZ}
The conclusion \case{bijection} of Lemma~\ref{lemma:face}  holds for any minimal counterexample:
$F\mapsto U_F$ is a bijection
\end{lemma}

\begin{proof}
Assume that $F(x')$ is a triangle.
The two faces $F(x')$ and $F(y')$ merge into a single face $F$ of $\op{hyp}(V,E)$.
Then 
\begin{equation}\label{eqn:U}
U= U(x')\cup U(y')\cup C^0(\ee)
\end{equation} 
is a connected open set in $Y$.
If $F'\ne F(x'),F(y')$ is any other face in $H'$, then $U_{F'}$ is
a connected open set in $Y$.  Moreover, the set $U$ and sets $U_{F'}$
are pairwise disjoint and exhaust $Y$, so that they are precisely the topological
components of $Y$.  Some dart of $F$ leads into $U$, so $U=U_F$.  It follows
that the number of faces is equal to the number of topological components, so that the map $F\mapsto U_F$ is a bijection.
\end{proof}


\begin{lemma}\guid{TXFBALB}\rating{ZZ}  The conclusion \case{solid angle} of Lemma~\ref{lemma:face} holds for every minimal counterexample $(V,E)$.
\end{lemma}

\begin{proof} Every topological component of $Y$ 
except $U$ is already a topological component of $Y'$ and the conclusion
holds for components of $Y'$.  The topological component $U$ is a disjoint union of two
components of $Y'$ and a set $C^0(\ee)$ of measure zero.  Thus, it
is also measurable and eventually radial.  The solid angle formula is
additive over the disjoint union in~(\ref{eqn:U}), so the formula holds for $U$.
\end{proof}
\indy{Index}{component!topological}%


\begin{lemma}\guid{GGZWYRM}\rating{ZZ}  Let $(V,E)$ be a minimal counterexample.  For any dart $x$ on any face $F$ and dart $z\in F$ that is not adjacent to $x$ under the face map, 
$$
C^0(\{\v(x),\v(z)\} \subset U_F.
$$
\end{lemma}

\begin{proof}  By excluding trivial cases of the proof,  the set $F$ and the dart $x\in F$ can be the choices used to construct $E'$.
We may assume that $F(x')$ is a triangle.
If $z=f^2x$, then the diagonal is precisely $C^0\{\v,\w\}$,
for which the conclusion has already been established.  Otherwise, $z$ can be identified with
a dart $z'\in F(y')$.  Then by minimality,
$$
C^0\{\v(x),\v(z)\} = C^0\{\v(x'),\v(z')\} \subset U(y') \subset U_F.
$$
\end{proof}

%Next show the extra conclusion added at the beginning of the lemma.
%If the added diagonal is $\{\v,\w\}$, then $E''=E'$ and  have already
%checked that $N(V,E')+1=N(V,E)$.  Since $x$ was arbitrary,  may assume
%that $\v(x)\in e$.  Let $E''' = E \cup \{e\, \{\v,\w\}\}$.  By the minimality,
%$N(V,E''') + 1 = N(V,E')$.  Also, $E''' = E''\cup \{\{\v,\w\}\}$.  The
%same argument that shows $N(V,E')+1=N(V,E)$ shows $N(V,E''')+1 = N(V,E'')$.
%Hence,
%$$
%N(V,E'')+1 = N(V,E''')+2 = N(V,E')+1 = N(V,E).
%$$

\begin{lemma}\guid{HYUAZSE}\rating{ZZ}  The property \case{half-space} of Lemma~\ref{lemma:face} holds for for every minimal counterexample.
\end{lemma}
\indy{Index}{component!topological}%

\begin{proof}
By the minimality of the counterexample $(V,E)$, it is enough to consider
the face $F$ used in the construction of $E'$.  (Indeed, the other faces of $\op{hyp}(V,E)$ can be identified with faces of $\op{hyp}(V,E')$ and these cases are easily treated.) Take $F(x')$ to be a triangle.
It will first be shown that the intersection $U_1$ of half-spaces lies in $U=U_F$.
Every point in $\ring{R}^3$ lies in the plane
$$
A=\op{aff}\{\orz,\v,\w\}
$$
or in one of the two open half-spaces bounded by this plane.  These half-spaces, $A(x')$ and $A(y')$, 
contain $U(x')$ and $U(y')$ respectively, by the minimality of $(V,E)$.  Also,
$$
A(x')\cap U_1 \subset U(x')\subset U.
$$
Similarly, $A(y')\cap U_1 \subset U$.  Also,
$$
A \cap U_1 \subset A \cap \Wdart(x) \cap \Wdart(y) \subset C^0\{\v,\w\} \subset U.
$$
Thus,
$U_1\subset U$.

\claim{For any dart $z$ of $F$, the set $U$ is a subset of the half-space with bounding
plane $\{\orz,\v(z),\v(f z)\}$.} Indeed, without loss of generality, assume that $z=x$, 
as $x$ can be chosen to be an
arbitrary dart of $F$.  By the minimality of $(V,E)$,  
the partition \eqn{eqn:U} of $U$ gives three pieces
contained respectively in the three parts:
$$
\Wdart(x') \cup C^0\{\v,\w\} \cup \Wdart(x''),
$$
where $x',x''\in D'$ correspond to the single dart $x$ in $D$:
$$
\op{azim}(x') + \op{azim}(x'') = \op{azim}(x) < \pi.
$$
Thus, $U$ itself is contained in the lune
$$
W^0(\{\orz,\v(x)\},\{\v(f x),\v(f^{-1} x)\}),
$$
which is contained in the desired half-space.  This proves the claim.

The reverse inclusion $U\subset U_1$ follows immediately from the claim.
\end{proof}

%\begin{lemma}\guid{YQWIVOS}\rating{ZZ}
%Let $(V,E)$ be a minimal counterexample.  Then a triangulation of $(V,E)$ exists.
%\end{lemma}
%
%\begin{proof}  A triangulation of $(V,E')$ exists by the minimality of $(V,E)$.  A triangulation
%of $(V,E')$ is also a triangulation of $(V,E)$.
%\end{proof}

The preceding lemmas show that a minimal counterexample satisfies all of the conclusions of Lemma~\ref{lemma:face}.  Hence it is not a countexample at all, and the conclusion of Lemma~\ref{lemma:face} holds.  This completes the proof.

\section{Cyclic fan}

\begin{summary}
To focus attention on a particular face $F$ of a fan $(V,E)$, it is useful to disregard all the vertices
and edges of the fan, except for the vertices and edges that constitute $F$.  This pared down fan
is an example of a {\it cyclic fan}, which is defined below.  It can be viewed as a ``localization'' of
the fan along a face $F$.  
\end{summary}
%In this example, the hypermap of the cyclic fan  is isomorphic to $H_{2k}$, where $k=\card(F)$.  This, in fact, becomes one of the defining properties of a cyclic fan.
%Restricted to $F$, the face permutation$f$ extends to a cyclic
%permutation $\rho$ of the set of vertices of $F$.
%This section goes into further detail about certain fans that are isomorphic to $H_{2k}$, for some $k$.
\indy{Notation}{h@$H_{2k}$}%

\subsection{basics}


\begin{definition}[cyclic fan]  A triple $(V,E,F)$ is a {\it cyclic fan} if the following conditions hold.
\begin{nomerate} 
\item \case{fan} $(V,E)$ is a fan;
\item \case{face} $F$ is a face of $H = \op{hyp}(V,E)$;
\item \case{cyclic hypermap} $H$ is isomorphic to $H_{2k}$, where $k = \card(F)$;
\item \case{angle} $\op{azim}(x)\le \pi$ for all darts $x\in F$; and
\item \case{wedge} $V\subset \bWdart(x)$ for all $x\in F$.
%\item If $\{\v,\w\}\in E$, then $\{\orz,\v,\w\}$ is not collinear. %% part of def of fan.
\end{nomerate}
\end{definition}
\indy{Index}{fan!cyclic}%

The intersection of $X(V,E)$ with the unit sphere is a spherical polygon, when $(V,E,F)$ is a cyclic fan.  The spherical polygon gives a visual representation of the cyclic fan. The choice of $F$ distinguishes the ``interior'' of the polygon from its exterior.  The final two conditions are convexity constraints.

\begin{lemma}\guid{PGSQVBL}\rating{ZZ}  Let $(V,E,F)$ be a cyclic fan.   If $\v,\w\in V$ are independent, then $C\{\v,\w\} \subset \bWdart(x)$ for any dart $x\in F$.
\end{lemma}
\indy{Index}{fan!cyclic}%

\begin{proof}  This is an elementary consequence of the definitions, the cone shape of $\bWdart(x)$,  and the condition $V\subset \bWdart(x)$.
\end{proof}

\begin{lemma}\guid{WRGCVDR}\rating{ZZ}  Let $(V,E,F)$ be a cyclic fan with hypermap $(D,e,n,f)$.  Then there exists a unique cyclic permutation $\rho:V\to V$ such that
%\begin{itemize}
%\item $(\v,\rho \v)\in D$, for all $\v\in V$; and
%\item 
$f(\v,\w) = (\w,\rho \w)$ for all $(\v,\w)\in F$.
%\end{itemize}
\end{lemma}
\indy{Index}{cyclic permutation}%

\begin{proof}  This is immediate.
\end{proof}

\begin{definition}[interior angle,~$\angle$]
For any cyclic fan, there is a bijection from $F$ onto $V$ given by
$$x\mapsto \v(x)\in V;\quad\text{that is, }  x = (\v,\w) \mapsto \v.$$  
Write $\v\mapsto x(\v)$ for the inverse map $x:V\to F$.  Write
$$
\angle(\v) = \op{azim}(x(\v)),
$$
where $\v\in V$.  This is the {\it interior} angle of the cyclic fan at $\v$.
\indy{Notation}{1@$\angle$}%
\indy{Notation}{\v@$\v(x)$}%
\end{definition}


\begin{definition}[localization]  Let $(V,E)$ be a fan, and let $F$ be a face of $\op{hyp}(V,E)$.  
Let 
$$
\begin{array}{rll}
V' &= \{\v\in V \mid \exists~\w\in V.~(\v,\w)\in F\}.\\
E' &= \{\{\v,\w\} \in E\mid (\v,\w)\in F\}.
\end{array}
$$
The pair $(V',E')$ is called the {\it localization} of $(V,E)$ along $F$.
\end{definition}
\indy{Index}{localization}%


\begin{lemma}[localization]\guid{LVDUCXU}\rating{ZZ}\label{lemma:localization}  
Let $(V,E)$ be any fan, and let $F$ be a face of its hypermap.  
Then the localization $(V',E')$ is a fan, and $F$ is a face of $\op{hyp}(V',E')$.  Moreover, the hypermap $\op{hyp}(V',E')$ is isomorphic
to $H_{2k}$, where $k= \card(F)$.
 Finally, the values $\op{azim}(x)$ and $\Wdart(x)$  do not depend
whether they computed relative to $\op{hyp}(V,E)$ or to $\op{hyp}(V',E')$, for all $x\in F$.
%That is, 
%$$
%\begin{array}{lll}
%\op{azim}(V,E,x) &=\op{azim}(V',E',x)\\
%\Wdart(V,E,x) &=\Wdart(V',E',x)\\
%\end{array}
%$$
\end{lemma}



\begin{proof}
The proof that  $(V',E')$ is a fan is a sequence of simple verifications.
\case{V}: The set $V'$ is a subset of $V$, hence is finite, and $\orz\not\in V$.  \case{origin}: The face has at least one dart $x$, and this implies that $V'$ is nonempty: $\v(x)\in V'$.  \case{independence}: As $E'\subset E$, the independence property of the edges is inherited from $E$.  \case{intersection}: Similarly, the intersection property of fans is inherited from $(V,E)$:
$$
C(\ee)\cap C(\ee') = C(\ee\cap \ee').
$$

The dart set $D'$ of $\op{hyp}(V',E')$ is naturally identified with the disjoint union $F\cup F'$, where
$F = \{(\v,\w) \in F\}$ and $F'=\{(\w,\v) \mid (\v,\w)\in F\}$.  Under this identification, $F$ is a face of $\op{hyp}(V',E')$.  The edge map $e(\v,\w)= (\w,\v)$ is a bijection of $F$ onto $F'$.   Pick any $x\in F$ and
define a bijection from the disjoint union of two copies of the cyclic group $Z_k$ onto $D'$  by 
the pair of maps
$$
i \mapsto f^i x,\quad\text{ and } i\mapsto e f^i x.
$$
This bijection extends to an isomorphism of hypermaps $H_{2k}$ onto $\op{hyp}(V',E')$.

The proof that the $\op{azim}(x)$ and $\Wdart(x)$ do not depend on the choice of fan is a consequence of their definitions:
$$
\begin{array}{lll}
\op{azim}(x) &= \op{azim}(\orz,\v,\w,\sigma(\v,\w)),\\
\Wdart(x) &= \Wdart(\orz,\v,\w,\sigma(\v,\w)).\\
\end{array}
$$
where $x = (\v,\w)$.    It is enough to check that $\sigma(\v,\w)\in E'(\v)$. 
But $\{\sigma(\v,\w),\v\}\in F$, so this is indeed the case.
%In particular $\op{azim}(x)\le\pi$ follow by the assumptions of the lemma.
\end{proof}

\begin{lemma} \guid{RNSYJXM}\rating{ZZ}
Let $(V,E)$ be any fan, and let $F$ be a face of its hypermap.  Let $(V',E')$ is
the localization of $(V,E)$ along $F$.
Assume that $\op{azim}(x)<\pi$, for every dart $x\in F$.
Then $(V',E',F)$ is a cyclic fan. 
\end{lemma}

\begin{proof}
Lemma~\ref{lemma:localization} gives all the properties of a cyclic fan except for property \case{wedge}:
$V'\subset \bWdart(x)$ for every dart
$x\in F$.    By Lemma~\ref{lemma:face},  $U_F \subset \Wdart(x)$. 
The wedge $\bWdart(x)$ is closed and contains $\Wdart(x)$. Hence, the
closure $\bar U_F$ is contained in $\bWdart(x)$.  Let $\v\in V'$ and choose
$\w\in V$ such that $y=(\v,\w)\in F$.
%There is a dart of $F$ of the form $y=(\v,\rho \v)$.  Since $y$ leads into 
Since the dart $y$ leads into
$U_F$, every neighborhood of
$\v$ meets $U_F$.  Thus, $\v\in \bar U_F\subset \bWdart(x)$.  This completes
the proof.
\end{proof}

\subsection{perimeter}

\begin{definition}[perimeter]\label{lemma:perim}
Let $(V,E,F)$ be a cyclic fan.    Set
$$
\op{per}(V,E,F) = \sum_{i=0}^{k-1} \arc_V(\orz,\{\rho^i \v,\rho^{i+1} \v\}), 
$$
where  $k=\card(F)$.
This is easily seen to be independent of the choice of $\v\in V$.  Call $\op{per}$ the perimeter of the cyclic fan.
If $\v,\w\in V$ are distinct vertices, define the partial perimeter 
$$
\op{per}(V,E,F,\v,\w) = \sum_{i=0}^{r-1} \arc_V(\orz,\{\rho^i \v,\rho^{i+1} \v\}), 
$$
where $r$ is chosen so that $\w=\rho^r \v$ and $0<r\le k-1$.
\end{definition}
\indy{Index}{perimeter!cyclic fan}%
\indy{Index}{fan!cyclic}%
\indy{Notation}{per@$\op{per}$ (perimeter)}%

\subsection{geometric types}\label{sec:types}

\begin{definition}[generic,~lunar,~circular]
A cyclic fan $(V,E)$ is {\it generic} when for every $\{\v,\w\}\in E$
and every $\u\in V$, 
$$
C\{\v,\w\}\cap C^0_-\{\u\} = \emptyset.
$$
The cyclic fan is {\it circular} if there exists $\u\in V$ and $\{\v,\w\}\in E$ such that 
$$
C^0\{\v,\w\}\cap C^0_-\{\u\}\ne \emptyset.
$$
The cyclic fan is {\it lunar} with dependency $\v,\w$ if it is not circular and if $\v$ and $\w$ are distinct and dependent elements of $V$.
\end{definition}
\indy{Index}{generic}%
\indy{Index}{lunar}%
\indy{Index}{circular}%

\begin{lemma}\guid{CIZMRRH}\rating{ZZ} Every cyclic fan is
generic, lunar, or circular.  Moreover, these three properties are mutually exclusive.
\end{lemma}
\indy{Index}{fan!cyclic}%
\indy{Index}{cyclic fan}%
\indy{Index}{generic}%
\indy{Index}{lunar}%
\indy{Index}{circular}%

\begin{proof} If $(V,E,F)$ is not generic,  select some $\{\v,\w\}\in E$
and some $\u\in V$ such that
\begin{equation}\label{eqn:non-generic}
C\{\v,\w\}\cap C^0_-\{\u\} \ne \emptyset.
\end{equation}
Now $C\{\v,\w\} = C^0\{\v,\w\} \cup C\{\v\}\cup C\{\w\}$.  
If, for some such triple $(\u,\v,\w)$, the intersection~(\ref{eqn:non-generic}) meets $C^0\{\v,\w\}$, then the cyclic fan is circular.  
Otherwise, the cyclic fan is lunar. 
\end{proof}

\begin{lemma}\guid{LDURDPN}\rating{ZZ}  \label{lemma:coplanar}
Assume that $\u$ and $\w\in\ring{R}^3$ are independent, as well as $\u$ and $\v$.  Then $\op{azim}(\orz,\u,\v,\w)=\pi$
if and only if there exists a plane $A$ such that
$S=\{\orz,\u,\v,\w\}\subset A$ and such that the line $\op{aff}\{\orz,\u\}$ separates $\v$ from $\w$ in $A$.
\end{lemma}

\begin{proof}  The given azimuth angle is $\pi$ if and only if $\dih(\{\orz,\u\},\{\v,\w\})=\pi$.  This holds
exactly when $S$ is coplanar and the line $\op{aff}\{\orz,\u\}$ separates $\v$ from $\w$ in $A$.
\end{proof}

\begin{lemma}\guid{KOMWBWC}\rating{ZZ}
%Moreover, assuming these equivalent conditions, 
%let $\e_3$ be the unit vector in direction $\v\times \u$ (or in the direction $\u\times \w$).  Then
%$\{\u,\v,\w\}$ is cyclic with respect to $\{\orz,\e_3\}$, and the azimuth cycle $\sigma$ on $S$ satisfies $\sigma \v = \u$; $\sigma \u = \w$.  
Let $(V,E,F)$ be a cyclic fan.  Let $k=\card(F)$.  Assume that for some $0<r\le k-1$ and some $\v\in V$, the set $W=\{\v,\rho \v,\ldots,\rho^r \v\}$ is contained in a plane $A$ passing through $\orz$.  Let $\e$ be the unit normal to $A$ in the direction $\v\times \rho \v$.  Then 
the set $W$ is cyclic with respect to $(\orz,\e)$, and the azimuth cycle $\sigma$ on $W$ is 
$$
\sigma \u = \begin{cases} \rho \u, & \u\ne \rho^r\v,\\ \v, & \u = \rho^r\v.\end{cases}
$$
\end{lemma}

\begin{proof} 
Write $\v_i = \rho^i \v$, for $i=0,\ldots,r$.

\claim{ 
$(\v_i \times \v_{i+1})\cdot \e > 0$, for all $i\le r-1$. }
Indeed, the base case of an induction  $(\v_0\times \v_1)\cdot \e > 0$ holds by assumption.    
Assume for a contradiction that the inequality holds for $i$, but not for $i+1$.
Then 
$$\op{aff}^0_+(\{\orz,\v_{i+1}\},\v_i) = \op{aff}^0_+(\{\orz,\v_{i+1}\},\v_{i+2}).$$ 
This forces $C^0\{\v_i,\v_{i+1}\}$ to meet $C^0\{\v_{i+1},\v_{i+2}\}$, which
is contrary to the definition of a fan.  Thus, the claim holds.

The fact that $W$ is cyclic follows trivially from the fact that $W$ is contained in a plane $A$ through $\orz$ and that $\e$ is orthogonal to $A$.

\claim{For all $0\le i \le r-1$,  $\sigma \v_i = \v_{i+1}$.}
Otherwise, there is some 
$$\u \in (W\setminus \{\v_i,\v_{i+1}\}) \cap W^0(\orz,\e,\v_i,\v_{i+1}) \cap A.
%  ~~\subset~~ 
$$
However, this intersection is a subset of $C^0\{\v_i,\v_{i+1}\}$,
and $\u\in C^0\{\v_i,\v_{i+1}\}$ is contrary to the property \case{intersection} of fans.  The result follows.
%The membership of $\u$ in the rightmost term is contrary to the definition of fan.  
%Let $\e_3$ be the unit vector in the direction $\v\times \u$.  Let $\e_1$ be the unit vector in the direction $\u$.
%Let $\e_2 = \e_3 \times \e_1$.  The coordinates of $\u,\v,\w$ with respect to the orthonormal frame $(\e_1,\e_2,\e_3)$ take the form
%$$
%\begin{array}{rllrl}
%\v &= * \e_1 + a \e_2,  &\quad & a &< 0\\
%\u &= a' \e_1, &\quad & a' &>0\\
%\w&= * \e_1 + a'' \e_2, &\quad & a'' &>0\\
%\end{array}
%$$
%From this representation it is clear that $\v\times \u$ points in the same direction as $\u\times \w$.
%The set $\{\v,\u,\w\}$ is clearly cyclic and the counterclockwise cycle $\sigma$ in the $\{\e_1,\e_2\}$ plane
%takes $\v$ to $\u$ and $\u$ to $\w$.
\end{proof}

\begin{lemma}\guid{OZQVSFF}\rating{ZZ} \label{lemma:A}  Let $(V,E,F)$ be a cyclic fan and let
$\u,\v,\w\in V$ such that
\begin{itemize}
\item $\{\orz,\u,\v,\w\}$ is contained in a plane $A$; \vspace{3pt}
\item $\u,\w\not\in\op{aff}\{\orz,\v\}$; and \vspace{3pt}
\item $\op{aff}^0_+(\{\orz,\v\},\u) \ne \op{aff}^0_+(\{\orz,\v\},\w)$.
\end{itemize}
Then $\angle(\v) = \pi$.  Moreover, $\rho \v,\rho^{-1} \v\in A$.
\end{lemma}

\begin{proof} Let $x = x(\v)\in F$.  The first conclusion follows from the first part of Lemma~\ref{lemma:coplanar}.  
%By the assumptions, $\dih(\{\orz,\v\},\{\u,\w\})=\pi$.  Since
%$\u,\w\in \bWdart(x)$, it follows that
%$$\pi = \dih(\{\orz,\v\},\{\u,\w\}) \le \op{azim}(x) = \angle(\v) \le \pi.$$
%The first conclusion follows.

Also,
$$
\pi=\op{azim}(x) = \op{azim}(\orz,\v,\rho \v,\rho^{-1}\v),
$$
so that $\{\orz,\v,\rho \v,\rho^{-1} \v\}$ is coplanar.  The condition
 $\u,\w\in \bWdart(x)$ implies that this plane is $A$.
\end{proof}

If Lemma~\ref{lemma:A} can be applied once, then it can often be applied repeatedly along a chain.  For example, the conclusion of the lemma implies
that $\rho^{-1} \v \in A$.  In fact, by the definition of fan, 
$$\rho^{-1}\v \in A \setminus \op{aff}\{\orz,\v\} = \op{aff}^0_+(\{\orz,\v\},\u) \cup \op{aff}^0_+(\{\orz,\v\},\w).$$
Suppose that $\rho^{-1} \v$ lies in the first term of the union.  If $\u\ne \rho^{-1}\v$, then the assumptions of the lemma
are met for $\{\u,\rho^{-1} \v,\v\}$, giving the conclusion $\angle(\rho^{-1} \v)=\pi$ and $\rho^{-2}\v\in A$.  Repeating, we obtain a chain
$$
\pi=\angle(\v) = \angle(\rho^{-1} \v) = \cdots,
$$
with $\v,\rho^{-1}\v,\ldots\in A$.  Another chain can be constructed in the other direction $\v,\rho \v,\ldots$.
This process of chaining gives the following lemma.

\begin{lemma}[circular geometry]\guid{KCHMAMG}\rating{ZZ}\label{lemma:circular}
Let $(V,E,F)$ be a circular fan. Then
\begin{itemize}
\item $\angle(\v)=\pi$, for all $\v\in V$.
\item The set $V$ lies in a plane $A$ through $\orz$.
\item For some choice of unit vector $\e$ orthogonal to $A$, the set $V$ is cyclic with respect to
$(\orz,\e)$, and the azimuth cycle on $V$ coincides with $\rho:V\to V$.
%\item $0=\beta(1)=\cdots \beta(r);\quad \beta(r+1)=\cdots\beta(k-1)=\pi$.
\item The perimeter is $\op{per}(V,E,F) =2\pi$.
\end{itemize}
\end{lemma}

\begin{proof}  Let $\v\in V$ and $\u,\rho \u\in V$ be such that $C^0\{\u,\rho \u\}$ meets $C^0_-\{\v\}$.  Apply
Lemma~\ref{lemma:A} to $\{\u,\v,\rho \u\}$ to conclude that $\angle(\v)=\pi$ and some plane $A$ contains
$\{\orz,\u,\rho\u,\v,\rho \v,\rho^{-1} \v\}$.  If 
$$
\{\orz,\u,\rho \u,\v,\rho \v,\rho^{-1} \v\} \subset V\cap A,
$$
and $\w\in V\cap A$, then there exists $\w_1,\w_2\in (V\cap A)\setminus\{\w\}$ for which
the assumptions of Lemma~\ref{lemma:A} hold.  Then $\angle(\w)=\pi$ and
$\rho \w \in V\cap A$.  The set $V\cap A$ is therefore preserved by $\rho$.
By observing that $V$ is the only nonempty subset of $V$ that is preserved by $\rho$,
 it follows that $V\subset A$.  


By Lemma~\ref{lemma:coplanar}, $V$ is cyclic with respect to a unit vector $\e$ orthogonal to $A$.  The
azimuth cycle on $V$ is $\v \mapsto \rho \v$.
%
%Pick an orthogonal frame for which $\phi(\v)=\orz$ and $\theta(\rho^i) = \beta(i)$.
%Since $\rho \v,\ldots,\rho^{-1} \w$ lie in the same half-plane, it follows that
%$$\beta(1)=\cdots =\beta(r-1).$$ 
%Similarly,
%$$0 < \beta(r+1) =\cdots =\beta(k-1)\le\pi.$$

The arcs making up the perimeter all lie in a common plane.   The sum of the terms in the formula defining the perimeter is the sum of the azimuth angles in the azimuth cycle.  The sum is $2\pi$ by Lemma~\ref{lemma:2pi-sum}.
\end{proof}

\begin{lemma}[lunar geometry]\guid{HKIRPEP}\rating{ZZ}\label{lemma:lunar}
Let $(V,E,F)$ be a lunar fan with dependent vectors $\v,\w\in V$.  
Assume that $\rho^r \v = \w$, for
some $0< r < k$.
Then
\begin{itemize}
\item $\angle(\u) = \pi$, for all $\u\in V\setminus \{\v,\w\}$; \vspace{3pt}
\item $0< \angle(\v) = \angle(\w)\le \pi$; \vspace{3pt}
\item $V\cap \op{aff}_+(\{\orz,\v\},\rho \v) = \{\v,\rho \v,\ldots, \w\}$; \vspace{3pt}
\item $V \cap \op{aff}_+(\{\orz,\v\},\rho^{-1} \v) = \{\w,\rho \w,\ldots \v\}$;  \vspace{3pt}
%\item $0\le \beta(1)=\cdots =\beta(r-1) < \beta(r+1) =\cdots =\beta(k-1)\le\pi$.
\item $\op{per}(V,E,F) = 2\pi$.
\end{itemize}
\end{lemma}

\begin{proof}   Set $V_1 = \{\v,\rho \v,\ldots,\w\}$ and $V_2 = \{\w,\rho \w,\ldots,\v\}$. 
Let $\u\in V\setminus\{\v,\w\}$ be arbitrary.
Apply Lemma~\ref{lemma:A} to the set $\{\u,\v,\w\}$ to find that $\angle(\u)=\pi$ and
that $\{\orz,\u,\rho \u,\rho^{-1} \u\}$ belongs to a plane $A(\u)$.  Now $A(\u)$ and $A(\rho \u)$ are both the unique plane containing $\{\orz,\u,\rho \u\}$, hence $A(\u) = A(\rho \v)$.  
when $\rho \u\not\in \{\v,\w\}$.  By induction, there are planes $A_1, A_2$ such that $V_i\subset A_i$.  There is
an azimuth cycle $\sigma_i$ on $V_i$ such that $\sigma_i \u = \rho \u$, when $\rho \in A_i\setminus \{\v,\w\}$.  

The angles $\angle(\v)$ and $\angle(\w)$ are both equal to the dihedral angle between these two half-planes.  In particular, $0<\angle(\v)=\angle(\w)\le\pi$.
%
%Pick an orthogonal frame for which $\phi(\v)=\orz$ and $\theta(\rho^i) = \beta(i)$.
%Since $\rho \v,\ldots,\rho^{-1} \w$ lie in the same half-plane, it follows that
%$$\beta(1)=\cdots =\beta(r-1).$$ 
%Similarly,
%$$0 < \beta(r+1) =\cdots =\beta(k-1)\le\pi.$$

The perimeter is the sum of arcs in a half-circle in the first half-plane plus
the sum of arcs in a half-circle in the second half-plane. This sum is $2\pi$.
\end{proof}




\begin{lemma}[monotonicity]\guid{EGHNAVX}\rating{ZZ}  \label{lemma:monotone}
Let $(V,E,F)$ be a cyclic fan. Fix $\v_0\in V$.  Assume that $\v_0$ and $\u$ are independent for all $\u\in V\setminus\{\v_0\}$.  For all $i$, set $\v_i = \rho^i \v_0$ and $\beta(i) = \op{azim}(\orz,\v_0,\v_1,\v_i)$.
Then
$$0=\beta(1)\le \beta(2)\le \cdots\le \beta(k-1)\le\pi.$$
%One may distinguish three cases according to the manner in which the fan meets the ray $R(\v_0) = \op{aff}^0_-(\{\orz\},\{\v_0\})$:
%{\bf (lunar)~~} If for some $i$, $\op{aff}^0_+(\orz,\v_i) \cap R\ne\emptyset$, then the following conditions hold.
%\begin{itemize}
%\item $0=\beta(1)=\cdots \beta(r) < \beta(r+1)=\cdots\beta(k-1)\le\pi$.
%\item $\op{azim}(x)=\pi$, for all $x\ne x_0,x_r\in F$.  Also, $0<\op{azim}(x_0)=\op{azim}(x_r)\le \pi$.
%\item $\{\orz,\v_0,\v_r\}$ is contained in a line $L$, $\{\orz,\v_0,\ldots,\v_r\}$ lie in one half-plane bounded by $L$, and $\{\v_r,\v_{r+1},\ldots,\v_0\}$ lie in another half-plane bounded by $L$.
%\item The perimeter is $\op{per}=2\pi$.
%\end{itemize}
%
%\begin{itemize}
%\item If for some $i\ge 2$, equality holds: $\beta(i)=\beta(i-1)$, then 
%\begin{itemize}
%  \item {\it either} $\v_{i-1}\in C^0\{\v_0,\v_i\}$ and $\angle(\v_j)=\pi$, for $0\le j\le i-1$;
%  \item {\it or} $\v_i\in C^0\{\v_{i-1},\v_0\}$ and $\angle(\v_j)=\pi$, for $i\le j \le k-1$.
%\end{itemize}
%\end{itemize}
\end{lemma}

\begin{proof}  
%The proof procedes according to the three cases.
%
%{\bf (circular)} Consider a spherical coordinate system $(r,\theta,\phi)$ with coordinates $(r_j,\theta_j,\phi_j)$ for $\v_j$.  Without loss of generality, there is a coordinate system in which $\phi_0=0$, $\theta_r=0$, and $\theta_{r+1}=\pi$.  In these coordinates,  $\v_0\in\bWdart(x_r)$ implies $\op{azim}(x_r)=\pi$, which in turn implies $\theta_{r-1}=0$.  Continuing by downward induction, $\v_0\in \bWdart(x_j)$ implies that $\op{azim}(x_j)=\pi$ and $\theta_j=0$.  By a similar induction, $\theta_i=\pi$ and $\op{azim}(x_i)=\pi$, for $i=r+1,\ldots,k-1$.  For our choice of coordinates, $\beta(i)=\theta_i$.  This gives the first and second conclusions.  It follows that the points $\v_j$ appear in consecutive order around the great circle $\theta=0,\pi$.  The perimeter is thus $2\pi$.
%
%{\bf (lunar)}  The proof here is similar.  Choose coordinates for which $\phi_0=0$, $\phi_r=\pi$, $\theta_{r-1}=0$, $\theta_{r+1}\le\pi$.  Check that $\v_0\in \bWdart(x_{r-1})$ implies that $\op{azim}(x_{r-1})=\pi$ and that $\theta_{r-2}=0$, and continue with a downward induction as before.  Similarly, an upward induction gives that $\theta_j=\theta_{r+1}$ and $\op{azim}(x_j)=\pi$, for $j\ge r+1$.  The first and second conclusions follow as before.  The first set of points are consecutive inside the plane $\theta=0$; the second set of points are consecutive inside the plane $\theta=\theta_{r+1}$.  The perimeter consists of two half-circles, and $\op{per}=2\pi$.
%
Pick an orthonormal frame and write the points $\v_j$ in spherical coordinates $(r_j,\theta_j,\phi_j)$.  In an appropriate orthonormal frame, $\phi_0=0$, and $\theta_i=\beta(i)$, for all $i$.  From $\v_j\in \bWdart(x(\v_0))$ and $\angle(\v_0)\le\pi$, it follows that $0\le\theta_j\le\theta_{k-1}\le\pi$ for all $j$.

 One may assume by induction that $0\le \beta(1)\le\cdots\le \beta(i)$.  The condition
$$
\v_0\in \bWdart(x(\v_i))
$$
implies that
$$
0 \le \op{azim}(\orz,\v_i,\v_{i+1},\v_0)\le \op{azim}(\orz,\v_i,\v_{i+1},\v_{i-1})\le\pi.
$$
By Lemma~\ref{lemma:sim}, the resulting inequality
$$
\sin(\op{azim}(\orz,\v_i,\v_{i+1},\v_0))\ge 0
$$
reduces to a triple-product:
$$
(\v_0 \times \v_i)\cdot \v_{i+1}\ge 0.
$$
In spherical coordinates, this becomes
$$
r_0r_ir_{i+1}\sin\phi_i\sin\phi_{i+1}\sin(\theta_{i+1}-\theta_i)\ge0.
$$
Under the independence assumption, $\sin\phi_i\ne0$, $\sin\phi_{i+1}\ne0$ (when $0< i < k-1$).    These inequalities give $\theta_i\le\theta_{i+1}$ (with a small extra argument to exclude the degenerate case $\theta_{i+1}=0,\theta_i=\pi$).  The conclusion follows by induction.
%
%Assume $\beta(i)=\beta(i-1)$.  This implies that $\{\orz,\v_0,\v_{i-1},\v_i\}$ are coplanar.  By genericity, any pair of vectors in $V$ is independent.  This gives
%$$
%\op{aff}^0_+(\{\orz,\v_0\},\v_{i-1}) = \op{aff}^0_+(\{\orz,\v_0\},\v_{i}).
%$$
%By elementary real arithmetic,
%$$
%\v_{i-1}\in C^0\{\v_0,\v_i\},\quad\text{or}\quad \v_{i}\in C^0\{\v_0,\v_{i-1}\}.
%$$
%Consider the case $\v_{i-1}\in C^0\{\v_0,\v_i\}$.    In this case, $\beta(j)=\theta_j=0$, for $j=0,\ldots,i$.  The points $\{\orz,\v_0,\ldots,\v_i\}$ are then coplanar and $\op{azim}(x_j)=0$ for $j=0,\ldots,i-1$.  This gives the second conclusion. The other case $\v_i\in C\{\v_0,\v_{i-1}\}$ follows by similar arguments.
\end{proof}


\subsection{slicing}

\begin{lemma}[internal blades]\guid{YOLCBTG}\rating{ZZ}  
Let $(V,E,F)$ be a cyclic fan. 
Let $\v,\w\in V$ be independent.  Suppose that there exists $\v',\w'$ such
that $\angle(\v'),\angle(\w')<\pi$, where $\v,\v',\w,\w'$ are four distinct elements of
$V$ that appear in cyclic order.
Then $C^0\{\v,\w\}\subset \Wdart(x)$ for all $x\in F$.
%Pick a dart $x=(\v_0,\v_1)\in V$.  Set $\v_j = \rho^j \v_0$.  Assume that there are four darts $(y_1,y_2,y_3,y_4)$, $y_j = x_{j(j)}$, with
%$0\le j(1) < j(2) < j(3) < i(4)\le k-1$ 
%such that $\op{azim}(y_j) < \pi$, for $j=2,4$.  
%Then $C^0\{\v_{i(1)},\v_{i(3)}\} \subset \Wdart(x)$, for all $x\in F$.
\end{lemma}
\indy{Index}{blade!internal}%
\indy{Index}{internal blade}%
\indy{Index}{cyclic order}%

(To say that a sequence $\v_i$ of elements is in {\it cyclic order} means that
$\v_i = \rho^{j (i)}\v_0$, for some increasing function $j$ with range $\{0,\ldots,k-1\}$.)

\begin{proof}  Abbreviate $C^0 = C^0\{\v,\w\}$.  The first case to consider is $\v(x)=\v$.  For all $\p\in C^0\cap \bWdart(x)$, 
$$
0 \le \op{azim}(\orz,\v,\rho \v,\p) \le \op{azim}(\orz,\v,\rho \v,\rho^{-1} \v).
$$  
These inequalities are in fact strict.  If, for example $0 = \op{azim}(\orz,\v,\rho \v,\p)$, then
the set $\{\orz,\v,\rho \v,\w\}$ is coplanar.  Repeated application of Lemma~\ref{lemma:A} gives
$$
\angle(\v) = \angle(\rho \v) = \cdots = \angle(\rho^{-1} \w) = \pi,
$$
which is contrary to $\angle(\v') = \pi$.  
The strict inequalities imply $\p\in \Wdart(x)$ as desired.  The case $\v(x)=\w$ is similar.

Now assume that $\u=\v(x)\ne \v,\w$.  
By Lemma~\ref{lemma:A},  one may assume that $\{\orz,\u,\v,\w\}$ is not coplanar. 
(Otherwise, the contradiction $\angle(\v')=\pi$ or $\angle(\w')=\pi$ is reached.) Then
$$
\op{aff}\{\orz,\u,\v\}\cap C^0 \subset \op{aff}\{\orz,\u,\v\}\cap \op{aff}\{\orz,\v,\w\} \cap C^0 = \op{aff}\{\orz,\v\} \cap C^0 = \emptyset.
$$
Thus, $C^0$ is disjoint from $\op{aff}\{\orz,\u,\v\}$ and is similarly disjoint from $\op{aff}\{\orz,\u,\w\}$.  

We have the following facts:
$$
\v,\w\in W(\orz,\u,\v,\w),\quad C^0\{\v,\w\} \subset W(\orz,\u,\v,\w).
$$
Also,
$$
\begin{array}{rll}
C^0 &= C^0\cap W(\orz,\u,\v,\w) \\
     &\subset C^0 \cap (W^0(\orz,\u,\v,\w) \cup \op{aff}\{\orz,\u,\v\} \cup \op{aff}\{\orz,\u,\w\})\\
     &\subset C^0 \cap W^0(\orz,\u,\v,\w)\\
     &\subset \Wdart(x).
%\v,\w\in \barW &= \{\p \mid 0 \le \op{azim}(\orz,\u,\v,\p) \le \op{azim}(\orz,\u,\v,\w)\}.\\
%C^0 &\subset \barW\\
%\bar W &\subset W(\orz,\u,\v,\w) \cup \op{aff}\{\orz,\u,\v\} \cup \op{aff}\{\orz,\u,\w\}\\
%W(\orz,\u,\v,\w) & \subset \Wdart(x),
\end{array}
$$
%$$
%\Wdart(x) = \bWdart(x)\setminus (\op{aff}\{\orz,\u,\v\}\cup\op{aff}\{\orz,\u,\w\}).
%$$
\end{proof}


\begin{definition}[slice] Let $(V,E,F)$ be a cyclic fan.  Assume that $\v,\w\in V$ are
independent and that $C^0\{\v,\w\}\subset U_F$.  By Lemma~\ref{lemma:add-edge},
$(V,E')=(V,E\cup \{\{\v,\w\}\})$ is a fan.  Let $F'$ be the face of $\op{hyp}(V,E')$ 
containing the dart $(\w,\v)$.  Write
$$(V[\v,\w],E[\v,\w],F[\v,\w])$$
for the localization of $(V,E')$ along $F'$.  Explicitly,
$$
\begin{array}{lll}
V[\v,\w] &= \{\v,\rho \v,\rho^2 \v,\ldots,\w\};\\
E[\v,\w] &= \{\{\v,\rho \v\},\ldots,\{\rho^{-1}\w,\w\},\{\w,\v\}\};\\
F[\v,\w] &= \{(\v,\rho \v),(\rho \v,\rho^2 \v),\ldots,(\rho^{-1}\w,\w),(\w,\v)\}.
\end{array}
$$
\end{definition}
\indy{Index}{fan!cyclic}%

To allow for more than one cyclic fan $(V,E,F)$,  expand the notation, writing $\angle(H,\v)$ for $\angle(\v)$ in the hypermap $H$.  Similarly, write $\Wdart(H,\v)$ for $\Wdart(x)$, and so forth.
\indy{Notation}{azimhv@$\op{azim}(H,\v)$}%
\indy{Notation}{wdart@$\Wdart$}%


\begin{lemma}[slicing]\guid{EJRCFJD}\rating{ZZ}\label{lemma:slice}  Let $(V,E,F)$ be a cyclic fan with hypermap $H$.  Pick $\v,\w\in V$. For each $\u\in \{\v,\w\}$, assume that $\u$ is independent of all elements of $V\setminus\{\u\}$.    Assume that $C^0\{\v,\w\}\subset \Wdart(x)$ for all darts $x\in F$.  Then
\begin{itemize}
\item $(V[\v,\w],E[\v,\w],F[\v,\w])$ and $(V[\w,\v],E[\w,\v],F[\w,\v])$ are cyclic fans.  
\item Let $H[\v,\w]$ and $H[\w,\v]$ be their hypermaps, respectively.  Let $g:V\to\ring{R}$ be any function.  Then
$$
\sum_{\v\in V} g(\v)\angle(H,\v) = \sum_{\v\in V[\v,\w]}g(\v)\angle(H[\v,\w],\v) + \sum_{\v\in V[\w,\v]}g(\v)\angle(H[\w,\v],\v).
$$
\end{itemize}
\end{lemma}
\indy{Index}{slice}%
\indy{Index}{fan!cyclic}%

\begin{proof} 
\claim{$(V,E')$ is a fan, where $E' = E\cup \{\{\v,\w\}\}$.}
 Indeed, except for the intersection property, all of the properties of a fan follow trivially from the fact that $(V,E)$ is a fan and
that $\v$ and $\w$ are independent.  (Note the similarity with Lemma~\ref{lemma:add-edge}.)
The intersection property also is trivial except in the case $\ee=\{\v,\w\}$ and $\ee'\setminus \ee\ne \emptyset$.  Pick $\u\in \ee'\setminus\ee$.  It follows from the node
partition of Lemma~\ref{lemma:disjoint} that
$$
\begin{array}{lll}
C(\ee) \cap C(\ee') &= (C(\v) \cap C(\ee')) \cup (C(\w)\cap C(\ee')) \\
 &= C(\{\v\}\cap \ee') \cup C(\{\w\}\cap \ee') \\
 &= C(\{\v,\w\}\cap \ee').
\end{array}
$$
The intersection property thus holds and $(V,E')$ is a fan.

It follows by Lemma~\ref{lemma:localization} that $(V[\v,\w],E[\v,\w])$ is a fan.

The second conclusion of the lemma follows from the following identities.
If $\u\ne \v,\w$ with $\u\in V[\v,\w]$, then $\u\not\in V[\w,\v]$ and 
\begin{equation}
\Wdart(H,\u)=\Wdart(H[\v,\w],\u),\quad \angle(H,\u) = \angle(H[\v,\w],\u).
\end{equation}
If $\u\in\{\v,\w\}$, then 
$\angle(H,\u)=\angle(H[\v,\w],\u) +\angle(H[\w,\v],\u)$.

Finally, it remains to be seen that the fan is cyclic.  Lemma~\ref{lemma:localization} already shows that the hypermap is isomorphic to $H_{2k}$. and that $F[\v,\w]$ can be identified with a face.  The condition $V[\v,\w]\subset \bWdart(x)$ follows from the fact that the angles $\beta(i)$ are increasing in Lemma~\ref{lemma:monotone}.
\end{proof}

\subsection{deformation}\label{sec:deformation}

This section considers deformations of a cyclic fan $(V,E,F)$.

\begin{definition}[deformation,~flat]
A {\it deformation} of a cyclic fan $(V,E,F)$ over an interval $I\subset\ring{R}$
is a 
continuous function $\varphi:V\times I \to\ring{R}^3$ (in the discrete topology on $V$ and the product topology on $V\times I$).
The deformation is {\it flat} if whenever
$$\{\orz,\varphi(\rho^{-1}\v,t),\varphi(\v,t),\varphi(\rho \v,t)\}$$
is coplanar for $t=a\in I$, then also the set is coplanar for all $t\in I$ such
that $t\ge a$.
\end{definition}
\indy{Index}{deformation}%
\indy{Index}{fan!cyclic}%
\indy{Index}{flat}%

That is, a flat deformation is a deformation in which certain linear
dependencies are ``sticky;''  once the dependency is formed, the dependency endures.

Write $\v(t)$ as an abbreviation of $\varphi(\v,t)$, for $t\in I$.  
Also, set
$$
\begin{array}{lll}
V(t)&=\{\v(t) \mid \v\in V\},\\
E(t)&=\{\{\v(t),\w(t)\}\mid \{\v,\w\}\in E\},\\
F(t)&= \{(\v(t),\w(t)) \mid  (\v,\w)\in F\}.
\end{array}
$$


A deformation does not require $(V(t),E(t),F(t))$ to be a cyclic fan for all $t\in I$, although this will often be the case. The permutation $\rho:V\to V$ gives $\varphi(\rho \v,t)\in V(t)$, for every $\v\in V$.  

% $\rho(t):V(t)\to V(t)$; extend $x=(\v,\w)\in D$ to $x(t)=(\v(t),\w(t))$; extend $\op{azim}(x)$, for $x\in D$,  to $\op{azim}(x(t))$; extend $\bWdart(x)$ to $\bWdart(x(t))$, and so forth. 

\begin{example}[lunar deformation]
Consider a lunar cyclic fan $(V,E,F)$ with dependent $\v,\w\in V$.   Pick and orthonormal frame and spherical coordinates such that $\phi(\v)=0$, $\phi(\w)=\pi$.  $\theta(\rho \v)=0$, and $\theta(\rho^{-1} \v)=\theta_{k-1}\le\pi$.  Consider the deformation $\varphi$ over 
$I = \{t \mid 0 \le t < 1\}$
such that radial $r$ and zenith $\phi$ coordinates of $\varphi(\u,t)$ remain fixed,
and the azimuth angle $\theta$ of $\varphi(\u,t)$ equals

$$
\begin{cases} 
   (1-t) \theta_{k-1} & \text{if } \u\in \{\rho \w,\rho^2 \w,\ldots, \rho^{-1} \v\};\\
   0 & \text{if } \u\in \{\rho \v,\rho^2 \v,\ldots,\rho^{-1} \w\}.\\
\end{cases}
$$
%This deformation $(V(t),E(t),F(t))$ is a cyclic fan for all $t\in I$.
%The cardinality of $V$ is independent of $t\in I$.
Note that $(V(0),E(0),F(0)) = (V,E,F)$.
\end{example}
\indy{Index}{lunar}%
\indy{Index}{spherical coordinates}%

\begin{lemma}\guid{HZIYFIZ}\rating{ZZ}\label{lemma:lunar-deform} 
Let $(V,E,F)$ be a lunar cylic fan with dependency $\v,\w\in V$.  In the deformation described above, the triple $(V(t),E(t),F(t))$ is a lunar cyclic fan for all $t\in I$.  The cardinality of $V$ is independent of $t\in I$.
\end{lemma}

\begin{proof}  The proof consists of checking  the properties of a lunar cyclic fan, one by one.  

\case{V} The set $V(t)$ is the image of $V$ under $\varphi(\cdot,t)$, and is therefore finite and nonempty.  The map $\varphi(\cdot,t)$ is invertible, so that $V(t)$ is in bijection with $V$.  In particular, the cardinality does not depend on $t$.

\case{origin} The radial spherical coordinate is nonzero for every element of $V(t)$.  Hence $V(t)$ does not contain $\orz$.

\case{independence}  For $\{\v,\rho \v\}\in E$, the angle 
$\alpha=\op{arc}_V(\orz,\{\varphi(\v,t),\varphi(\rho \v,t)\})$
is independent of $t$.  The independence property is equivalent to $\alpha\ne0,\pi$.  Thus, the independence property for $E$ implies
the independence for $E(t)$.

\case{intersection} The points $V(t)$ are contained in the union of two half-planes $A_1,A_t$.  The deformation is the identity on $A_1$ and an isometry $A_0\to A_t$ on the second half-plane.  These bijections preserve the incidence relations of blades of the cones $C(\ee)$.  

\case{cyclic hypermap}~\case{face} The combinatorial properties of the hypermap do not depend on $t$.  In particular, the hypermap has face $F(t)$ and the hypermap is isomorphic to $H_{2k}$.

\case{angle} The azimuth angle $\op{azim}(x(\varphi(\u,t)))$ is fixed for $\u\ne \v,\w$ and is decreasing in $t$ for $\u\in \{\v,\w\}$.  Hence, the upper bound on the angle is preserved.

\case{wedge}  $V(t)\subset A_0\cup A_t$, where $A_0$ and $A_t$ are the
half-planes described above.  Now $\bWdart(x(\varphi(\u,t)))$ is a half-space containing $A_0$ and $A_t$ when $\u\ne \v,\w$.  Also, $\bWdart(x(\varphi(\u,t)))$ is a wedge with bounding half-planes $A_0$ and $A_t$ when $\u\in \{\v,\w\}$.  Hence
$V(t)\subset A_0\cup A_t\subset \bWdart(x(\varphi(\u,t)))$ for all $\u\in V$.

\case{lunar} The points $\v,\w\in V(t)$ remain fixed and hence remain dependent.  Thus, the cyclic fan remains lunar.  
\end{proof}
\indy{Index}{angle!azimuth}%

Next  consider a deformation of a cyclic fan.  The following lemma gives a list of conditions that ensure that the deformation remains a cyclic fan throughout the deformation.

\begin{note}%XX
The next lemma is related to compactness.
If it is rephrased so that $I$ can be a sequence and the conclusion
is about the limit, it implies under the given conditions 
that the limit of cyclic fans is a cyclic fans.
\end{note}


\begin{lemma}\guid{JASDHOQ}\rating{ZZ} \label{lemma:cyclic-fan-deform}
Let $I = \leftclosed 0,a\rightclosed$.  Let $\varphi$ be a deformation of the cyclic fan $(V,E,F)$ over
the interval $I$.    Suppose that 
\begin{itemize}
\item The deformation is flat.
\item $\varphi(\u,0)=\u$ for all $\u\in V$. 
%\item $\angle(\v(t))\le \pi$ for all $\v\in V$; (follows from flatness)
\item $0 < \arc_V(\orz,\{\varphi(\v,t),\varphi(\rho \v,t)\}) < \pi$, for all $t\in I$ and all $\v\in V$.
\item $0 < \normo{\v(t)}$ for all $t\in I$ and $\v\in V$.
\item If $t\in I$, and if $\u,\v,\w\in V$ are distinct, 
then $C\{\u(t)\}\cap C\{\v(t),\w(t)\} = \{\orz\}$.
%\item $(V(t),E(t))$ is generic, for $0\le t<t_0$.
\end{itemize}
Then $(V(t),E(t),F(t))$ is a cyclic fan for all $t\in I$.
\end{lemma}
\indy{Index}{fan!cyclic}%
\indy{Index}{deformation}%

\begin{proof}
Each of the properties of a cyclic fan will be examined in turn.  Some of the arguments are nearly identical to those in the proof of Lemma~\ref{lemma:lunar-deform}.

\case{V}  The set $V(t)$ is the image of $V$ under $\varphi(\cdot,t)$, and is therefore finite and nonempty. The lower bound on $\op{arc}_V$ implies that the cardinality of $V(t)$ is independent of $t$.

\case{origin}  The radial coordinate of each element of $V(t)$ is nonzero.  Hence $V(t)$ does not contain $\orz$.

\case{independence}  For $\{\v,\rho \v\}\in E$, the angle 
$\op{arc}_V(\orz,\{\varphi(\v,t),\varphi(\rho \v,t)\})$ is less than $\pi$.
This gives the
the independence result for $E(t)$.

\case{intersection} If the intersection property fails:
$$
C(\ee) \cap C(\ee') \ne C(\ee \cap \ee'),
$$
for some $t\in I$ and some $\ee,\ee'\in E(t)\cup \{\{\v(t)\}: \v\in V\}$,
then a compactness argument (applied to the compact sets $C(\ee)\cap S^2$)
shows that there is a smallest $t>0$ for which the intersection property
holds.  For the smallest possible $t=t_0$, the intersection cannot assume
the form
\begin{equation}\label{eqn:inter}
C^0(\ee) \cap C^0(\ee') \ne \emptyset,
\end{equation}
with $\ee,\ee'\in E(t_0)$ and $\ee\cap \ee'=\emptyset$, because such an intersection is transversal and the intersection continues for some value smaller than $t_0$.  The other types of intersection are enumerated in the assumption list of the lemma, so that the intersection property must hold.  Thus, the deformation is a fan for all $t\in I$.

\case{cyclic hypermap} \case{face}  Let $\sigma(t,\v)$ be the azimuth cycle on $E(t)(\v)$.  It is equivariant:  $\sigma(t,\v) (\varphi(\w,t)) = \varphi(\sigma(\v,\w),t)$.   (This follows from the intersection property~(\ref{eqn:inter}).)  Thus, the combinatorial properties of the hypermap do not depend on $t$.  In particular, the hypermap has face $F(t)$ and the hypermap is isomorphic to $H_{2k}$.

\case{angle}  The upper bound $\pi$ on the azimuth angle is preserved by the flatness condition.

\case{wedge}  Finally, it remains to be seen that 
\begin{equation}\label{eqn:includeVW}
V(t)\subset \bWdart(x(\v(t)))
\end{equation} 
for all $\v\in V$ and $t\in I$.  Otherwise, there is a largest time $0\le t_0\in I$ for which inclusion~(\ref{eqn:includeVW}) holds for every $\v\in V$.  Assume that
$$
\u(t)\in \bWdart(x(\v(t)))
$$ 
fails for $t>t_0$.  By construction $\u\ne \v,\rho \v,\rho^{-1} \v$.  
Then at time $t=t_0$, $(V(t),E(t),F(t))$ is a cyclic fan.  If that fan is not generic, then $V(t)$ is contained in a union of two half-planes.  The flatness condition forces the deformations to remain within the (evolving) half-planes. This gives the result for non-generic cyclic fans.  

Hence, assume without loss of generality that the cyclic fan is generic at time $t=t_0$. Write $\u(t) = \varphi(\rho^r \v,t)$ for some $0< r < k-1$.  The condition that $\u(t)$ reaches the boundary means that some $\beta_t(r)=0$ or $\beta_t(r)=\beta_t(k-1)$, (where we have added a time subscript to show the dependence of $\beta(i)$ on $t$).  Consider the first possibility only; the other case being nearly identical.  By Lemma~\ref{lemma:monotone}, $0=\beta_t(0)=\beta_t(1)=\cdots=\beta_t(r)$.  Thus,
$$\{\orz,\varphi(\v,t),\varphi(\rho \v,t),\ldots,\varphi(\rho^r \v,t)\}$$
is a coplanar set.  By the flatness constraint, the continued deformation of the fan must preserve the coplanarity of this set.  However, this (evolving) plane is the plane bounding $\bWdart(x(\v(t)))$.  Hence, the point $\u(t) = \varphi(\rho^iv ,t)$ never escapes. The conclusion follows.
\end{proof}

%%%%%%%%%%%





\begin{lemma}\guid{WSEWPCH}\tlabel{lemma:convex-hyp}\rating{400}
 The perimeter of every cyclic fan is at most $2\pi$.
\end{lemma}
\indy{Index}{fan!cyclic}%
\indy{Index}{perimeter}%

\begin{proof} In Lemmas~\ref{lemma:circular} and \ref{lemma:lunar}, the perimeter has already been shown to be exactly $2\pi$ when the cyclic fan is circular or lunar.  Without loss of generality, assume the generic case.

Suppose for a contradiction that the lemma is false.  Consider all counterexamples
that minimize the cardinality of $V$.  Among all such counterexamples, pick a counterexample with the smallest number of darts $x\in D$ such that $\op{azim}(x) = \pi$.

A cyclic fan $(V,E,F)$ is determined by $V$ and the cyclic permutation $\rho:V\to V$:  $E=\{\{\v,\rho \v\}\mid \v\in V\}$ and $F = \{(\v,\rho \v)\mid \v\in V\}$.

In this particular counterexample, if there is any dart $x=(\v,\w)\in F$ with $\op{azim}(x)=\pi$, then there is a new cyclic fan $(V',E',F')$ with $V' = V\setminus\{\v\}$ and $\rho':V'\to V'$ given by 
$$
\rho'(\u) = \begin{cases}
\rho(\u), & \text{if } \rho(\u)\ne \v;\\
\rho(\v), & \text{if }\rho(\u) = \v.\\
\end{cases}
$$
This is a cyclic fan with the same perimeter, contrary to the presumed minimality of the counterexample.  Thus $\op{azim}(x) <\pi$, for all $x\in F$.

If $\card(V) <3$, then the cyclic fan is circular or lunar, which has aleady been treated.  If $\card(V)=3$, then $V=\{\v_1,\v_2,\v_3\}$.  By the triangle inequality $\arc_V(\orz,\{\v_2,\v_3\}) \le \arc_V(\orz,\{\v_2,-\v_1\})+\arc_V(\orz,\{-\v_1,\v_3\})$.  Thus,
$$
\begin{array}{rll}
\op{per} &=\arc_V(\orz,\{\v_1,\v_2\}) + \arc_V(\orz,\{\v_2,\v_3\}) + \arc_V(\orz,\{\v_1,\v_3\})\\
&\le(\arc_V(\orz,\{\v_1,\v_2\})+\arc(\orz,\{\v_2,-\v_1\}))+(\arc_V(\orz,\{\v_1,\v_3\})+\arc_V(\orz,\{-\v_1,\v_3\})) \\
   &= \pi+\pi.
\end{array}
$$

Now assume that $\card(V)\ge 4$.  Select $\v\in V$.  Consider a deformation of the cyclic fan $\varphi:V\times I \to \ring{R}^3$ that fixes $V\setminus\{\v\}$, and gives motion to $\v$:
$$
\varphi(\v,t) = (1-t) \v - t \rho \v.
$$
This is increasing in the perimeter.    Eventually, for some smallest $t=t_0$ a non-generic cyclic fan is reached (and the perimeter has increased to $2\pi$) or some $\angle(\varphi(\u,t_0))=\pi$ (and the minimality condition fails).  Either way, by Lemma~\ref{lemma:cyclic-fan-deform}, until time $t_0$, the fans in the deformation are cyclic.  Either way, the proof is complete. 
\end{proof}

Here is a second proof of the same lemma.  It is conceptually much simpler, but more difficult to formalize.  It is based on polar polygons (a generalization of polar triangles to spherical polygons).

\begin{proof} A fan does not have any faces of cardinality less than three.
Every blade of the fan has radian measure less than $\pi$.  
\indy{Index}{polygon!polar}%

Consider the case of a spherical triangle.  If the edges of the
the triangle are $a_i$ and the angles of the polar
triangle are $\beta_i$, then $\beta_i=\pi-a_i$.
The the perimeter is 
$$a_1+a_2+a_3 = 2\pi - (\beta_1 -\beta_2 - \beta_3-\pi)= 2\pi-\op{sol} < 2\pi,$$
because the solid angle $\op{sol}$ of the polar triangle is always strictly positive.
\indy{Index}{triangle!spherical}%

Similarly, if the edges of the spherical polygon are
$a_i$, then the angles of the polar polygon are $\beta_i = \pi-a_i$.
The perimeter is
$$
a_1+\cdots+a_n  = 2\pi- \op{sol}< 2\pi,
$$
where $\op{sol} = 2\pi-\sum a_i$ is the solid angle of the polar polygon.
%~\cite[\p.261]{williamson:2008}.
\indy{Notation}{zzDelta $\op{sol}$ (area)}%
\end{proof}



\section{Polyhedron}

This section shows that a polyhedron determines a fan.  It begins by recalling basic terminology about affine and convex sets.

\begin{definition}[affine~set,~affine~hull,~affine~dimension]
An  {\it affine set} $A\subset\ring{R}^n$ is a set of the form
$$
A=\op{aff}(S)
$$
The
affine hull of $P\subset\ring{R}^n$ is the smallest affine set containing $P$.  The affine dimension of $P$ (written $\dimaff(P)$) is $\card(S)-1$, where $S$ is a set of smallest cardinality such that
$$
P \subset \op{aff}(S).
$$
\end{definition}
In particular, the affine dimension of the empty set is $-1$.
\indy{Index}{affine}%
\indy{Index}{dimension}%
\indy{Index}{vector space!affine}%
\indy{Index}{affine hull}%
\indy{Notation}{dimaff@$\dimaff$}%

\begin{definition}[relative interior,~closure,~relative boundary] Let $A$ be the affine hull of a set $P\subset\ring{R}^n$.    An interior point $\p$ of $P$ is a point that contains an open ball $B(\p,r)$ entirely contained in $P$.  A point $\p$ of $P$ belongs to the relative interior of $P$ if there is an open ball such that $B(\p,r) \cap A\subset P$.  Let $\op{ri}(P)$ be the set of relative interior points.  The closure of $P$ (denoted $\op{cl}(P)$)  is the set
$$
\op{cl}(P) = \{\p \mid \forall\,r >0.~ B(\p,r) \cap P \ne \emptyset\}.
$$
The complement $\op{cl}(P)\setminus \op{ri}(P)$ is the {\it relative boundary} of $P$.
\end{definition}
\indy{Notation}{ri (relative interior)}%
\indy{Notation}{cl (closure)}%
\indy{Index}{convex}%
\indy{Index}{affine hull}%
\indy{Index}{closure}%
\indy{Index}{interior!relative}%
\indy{Index}{relative boundary}%

\begin{definition}[face,~facet,~edge,~extreme~point]
Let $P$ be a convex set.  A {\it face} of $P$ is a convex set $F$ such that the conditions
$$
\v,\w\in P,\quad s \v + t \w \in F,\quad s>0,\quad t>0,\quad s+t = 1,
$$ 
imply that $\v,\w\in F$.  A face $F$ is {\it proper} if $F\ne \emptyset,P$.    An extreme point (resp. edge) is a face of $P$ of affine dimension $0$ ($1$, respectively).   A facet of $P$ is a proper face of affine dimension $\dimaff(P)-1$.
\indy{Index}{face}%
\indy{Index}{proper}%
\indy{Index}{facet}%
\indy{Index}{edge}%
\indy{Index}{vertex}%
\indy{Index}{dimension} %
% A point $\u\in P$ is an extreme point of $P$, if for every $\v,\w\in P\setminus\{\u\}$, the point $\v$ is not of the form $t \v + (1-t) \w$, with $0\le t\le 1$.
\end{definition}

\begin{remark} The term {\it face} occurs in this book with two meanings: the face of a hypermap and the face of a convex set.  The two contexts are sufficiently different that we hope to avoid misunderstanding.
\end{remark}

\begin{lemma}[Krein-Milman]\guid{MUGGQUF}\rating{0} Every compact convex set $P\subset\ring{R}^n$ is the convex hull of its set of extreme points.
\end{lemma}

\begin{proof}  See \cite[Theorem~2.6.16]{webster:1994}.
\end{proof}


\begin{definition}[polyhedron,~vertex]  A {\it polyhedron} is the intersection of
a finite number of closed half-spaces in $\ring{R}^n$.  An extreme point of a polyhedron is also called a {\it vertex}.
\end{definition}
\indy{Index}{polyhedron}%

\begin{lemma}\guid{LTHQIAA}\rating{ZZ}\label{lemma:aff-poly}
An affine set in $\ring{R}^n$ is a polyhedron.
\end{lemma}

\begin{proof} See \cite[Cor~1.4.2]{webster:1994}.
\end{proof}

A polyhedron is closed and convex.  An intersection of faces of a convex set is again a face.  A bounded polyhedron falls within the scope of the Krein-Milman theorem.  In particular, a bounded polyhedron is the convex hull of its set of vertices.
\indy{Index}{closed}%

Let $P\subset\ring{R}^n$ be a bounded polyhedron with affine hull $A$. Write 
$$
P = A \cap A^+_1 \cap \cdots \cap A^+_r,
$$
where
$A^+_i = \{\p\mid \u_i\cdot \p \le a_i\}$ with bounding hyperplane
$A_i=\{\p\mid \u_i \cdot \p = a_i\}$, for some $\u_i\in \ring{R}^n$ and $a_i\in\ring{R}$. 
Assume that this representation is minimal in the sense that none of the factors $A^+_i$ may be omitted.  Let $F_i = A_i\cap P$.
\indy{Notation}{P@$P$ (polyhedron)}%


\begin{lemma}\guid{CZZHBLI}\rating{ZZ}\label{lemma:webster}  
Let $P\subset\ring{R}^n$ be a bounded polyhedron.  Then
\indy{Index}{polyhedron}%
\begin{enumerate}
\item The facets of $P$ are $F_i$, $i=1,\ldots,r$.
\item The relative boundary of $P$ is $F_1\cup\cdots \cup F_r$.
\item Every proper face is the intersection of the facets that contain it.
\item Every face of a face of $P$ is a face of $P$.
\item The vertices of a face $F$ are precisely the vertices of $P$ that are contained in $F$.
\item If $F$ and $F'$ are two faces of $P$ whose relative interiors meet, then
$F=F'$.
\end{enumerate}
\end{lemma}
\indy{Index}{facet}%
\indy{Index}{relative boundary}%
\indy{Index}{face}%

\begin{proof} See \cite[Thm~3.2.1]{webster:1994} for the first three conclusions.
See \cite[Th~2.6.5]{webster:1994} for the proof of the next conclusion,

Turn to the fifth conclusion.  A vertex of $F$ is a face of $P$ (of dimension $0$) by the fourth conclusion.  Hence every vertex of $F$ is a vertex of $P$.  Conversely, a face of $P$ contained in $F$ is a fortiori a face of $F$.

See \cite[Cor~2.6.7]{webster:1994} for the final conclusion.
\end{proof}

\begin{corollary}\guid{QOEPBJD}\rating{ZZ}
A face of a polyhedron is a polyhedron.  
\end{corollary}

\begin{proof} By Lemma~\ref{lemma:webster}, each facet is defined by a system of linear inequalities.  (See Lemma~\ref{lemma:aff-poly}.)  A proper face is an intersection of finitely many facets, and is therefore given by the conjunction of the inequalities defining the various facets.
\end{proof}


\begin{lemma}\guid{NEHRQPR}\rating{ZZ} \label{lemma:scale} 
Let $P$ be a bounded polyhedron with $\orz$ as an interior point.  Suppose that there are proper faces $F,F'$ of $P$, points $\p\in F$, $\q\in F'$, and positive scalars $s,t >0$ such that $s \p = t \q$.  Then $s=t$.
\end{lemma}

\begin{proof}  The faces $F,F'$ are subsets of facets of $P$.  It does no harm to assume that $F$ and $F'$ are themselves facets.   Without loss of generality, assume for a contradiction that $s=1$ and $t>1$.  By Lemma~\ref{lemma:webster}, 
 $F = A_i \cap P$, where $A_i = \{\q \mid \q\cdot \u = a\}$ for some $\u$ and $a$.  Also, 
$$
C\{\p\}\cap P = \op{conv}\{\orz,\p\} = \{\q \mid \orz\le \q\cdot \u \le a\}.
$$
In particular, $t \p\not\in P$, for $t>1$.  This contradiction gives $s = t$.
\end{proof}





\begin{definition} Let $P$ be a bounded polyhedron.
Let $V_P$ be the set of vertices of $P$.  Let $E_P$ be the set of pairs $\{\v,\w\}$ of vertices such that $\op{conv}\{\v,\w\}$ is an edge of $P$.
\end{definition}
\indy{Index}{polyhedron}%
\indy{Notation}{E@$E_P$ (edge)}%

\begin{lemma}\guid{JLIGZGS}\label{lemma:polyhedron}% \rating{800} including azim<pi.
Let $P$ be a bounded polyhedron in $\ring{R}^3$ with the interior point $\orz$.
Then $(V_P,E_P)$ is a fan.
\end{lemma}
\indy{Index}{fan}%

\begin{proof} The properties of a fan can be checked one by one.
By the Krein-Milman lemma, the set of vertices is non-empty.  By Lemma~\ref{lemma:webster}, there are finitely many faces, so that $V_P$ is finite.  Since $\orz$ is an interior point, it does not meet any face.  In particular, $\orz\not\in V_P$.   In particular,
for all $\ee\in E_P$, 
$\orz\not\in \op{conv}(\ee)$.

Suppose for a contradiction that $\{\v,\w\}\in E_P$ and that $\v$ and $\w$ are dependent.  As $\orz\not\in \op{conv}(\ee)$, some dependency has the form $s \v = t \w$, for some $s, t>0$.  By Lemma~\ref{lemma:scale}, $s=t$ and $\v=\w$, which is contrary to the definition of edge as a face of dimension $1$.

Finally, the intersection property $C(\ee)\cap C(\ee') = C(\ee \cap \ee')$ can be checked.
By Lemma~\ref{lemma:scale},
$$
C(\ee) \cap C(\ee') = \{t \p \mid \p\in \op{conv}(\ee) \cap \op{conv}(\ee') \text{ and } t \ge 0\}.
$$
$\op{conv}(\ee)$ and $\op{conv}(\ee')$ are both faces of $P$.  The intersection is again a face of $P$.  The intersection is the convex hull of its vertices, that is, the convex hull of $\ee \cap \ee'$.  Thus,
$$
C(\ee)\cap C(\ee') = \{t \p \mid \p\in \op{conv}(\ee\cap \ee')\} = C(\ee \cap \ee').
$$
Thus, all the defining conditions of a fan are satisfied.
\end{proof}


\begin{lemma}\guid{AMHFNXP}\rating{ZZ}\label{lemma:WF} 
Let $P$ be a bounded polyhedron in $\ring{R}^3$ with $\orz$ as an interior point.  Let $(V_P,E_P)$ be the associated fan.  There is a bijection between the facets of $P$ and the topological components of $Y(V_P,E_P)$ given by 
$$
F \mapsto W_F = \{t \p \mid \p\in \op{ri}(F),~t >0\}.
$$
\end{lemma}
\indy{Index}{component!topological}%

\begin{proof} It is enough to check that the following four claims about  $W_F$.

\claim { $W_F$ is connected.} Indeed, by Lemma~\ref{lemma:webster}, the relative interior of a convex polyhedron is the intersection of an affine set with open half-spaces, which is the intersection of convex sets, and is therefore convex. The set $\op{ri}(F)$ is convex, hence connected.    The positive half-line $I=\{t\mid t>0\}$ is connected.  The continuous image of the connected set $\op{ri}(F)\times I$ of these two sets is $W_F$.  Hence $W_F$ is connected.

\claim { $W_F$ is  open.}  Indeed, this is a standard $\epsilon$-argument.  Let $A$ be the affine hull of $F$.  For any $\p\in \op{ri}(F)$, pick $r>0$ such that $B(\p,r)\cap A\subset \op{ri}(F)$.  Pick $r'>0$ and $0<\epsilon<1$ such that for all $\q\in B(\p,r')$, there exists $t$ such that $|t|<\epsilon$ and $(1+t)\q\in A$.  After shrinking $r'$,  if $\q\in B(\p,r')$, then $(1+t)\q \in B(\p,r)\cap A \subset \op{ri}(F)$.   That is, $B(\p,r')\subset W_F$.  Hence $W_F$ is open.

\claim { The sets $W_F$ are pairwise disjoint, and the map $F\mapsto W_F$ is one-to-one.}  Indeed, select any two facets $F,F'$ for which $W_F\cap W_{F'}\ne \emptyset$.  That is, there exist $\p\in \op{ri}(F)$, $\q\in \op{ri}(F')$, and $s,t>0$ such that
$s \p = t \q$.  By Lemma~\ref{lemma:scale}, $s=t$ and $\p=\q\in \op{ri}(F)\cap \op{ri}(F')$.  By the final statement of Lemma~\ref{lemma:webster}, this implies that $F=F'$.

\claim { The union of the sets $W_F$ is $Y(V_P,E_P)$.}  Indeed, select any $\p\in Y(V_P,E_P)$.  As $\orz$ lies in the interior of the bounded polyhedron, we may rescale $\p$ by a positive scalar $t$ so that $t \p$ lies in the boundary of $P$, and hence (by Lemma~\ref{lemma:webster}) in a facet $F$.  If $t \p \in \op{ri}(F)$, then $\p\in W_F$, as desired.  Otherwise, $t \p$ lies in the relative boundary of $F$.  The facets of a three dimensional polyhedron have dimension $2$; and the facets forming the relative boundary of $F$ have dimension $1$.  These faces are edges of $P$.  Thus, $t \p$ lies in an edge of $P$, so that $\p\in X(V_P,E_P)$, which is contrary to the assumption that $\p\in Y(V_P,E_P)$.  The conclusion follows.

From these claims, it follows that the sets $W_F$ are the topological components of $Y(V_P,E_P)$.
\end{proof}
\indy{Index}{connected}%

\begin{lemma}\guid{WBLARHH}\rating{ZZ}\label{lemma:facet-bi}
Let $P\subset\ring{R}^3$ be a bounded polyhedron with interior point $\orz$.  The
facets of $P$ are in bijection with the faces of $\op{hyp}(V_P,E_P)$, under the
correspondence
$$
F\leftrightarrow F' \text{ if and only if } W_F = U_{F'}.
$$
\end{lemma}

\begin{proof}  The faces of the hypermap are in bijection with the set $[Y]$ of topological components of $Y(V_P,E_P)$.  The facets of $P$ are also in bijection with $[Y]$.
\end{proof}

\begin{lemma}\guid{BSXAQBQ}\rating{ZZ} Let $P$ be a bounded polyhedron with $\orz$ as an interior point.  Then $\op{azim}(x) < \pi$  for every dart $x$ in the hypermap $\op{hyp}(V_P,E_P)$.
\end{lemma}
\indy{Index}{polyhedron}%
\indy{Index}{interior!point}%
\indy{Index}{hypermap}%
\indy{Index}{dart}%

\begin{proof}   The dart $x=(\v,\w)$ leads into some topological component $U_x$, which is equal to $W_F$, for some facet $F$ of $P$.  The relative interior of $F$ is contained in $W_F\subset \Wdart(x)$.  The facet $F$ is contained in $\bWdart(x)$. Now
$$
\bWdart(x) = \Wdart(x)\cup A,
$$
where $A$ is the union of the two bounding half-planes.   The relative interior of $F$ does not meet $A$.   

By Lemma~\ref{lemma:scale}, the vertex $\v$ is a face of $F$.  The vertex $\v$ is the intersection of edges (that is, facets) of $F$ containing $\v$.  These edges are contained in $A$.  Each of the two half-planes forming $A$ contains such an edge. (In fact, each contains exactly one edge.)
\indy{Index}{component!topological}%
\indy{Index}{dart}%
\indy{Index}{wedge}%
\indy{Index}{vertex}%
\indy{Index}{interior!relative}%

If $\op{azim}(x)>\pi$, the segment between points chosen on the relative interiors of edges (of $F$ meeting $\v$) in the two different bounding half-planes is not contained in $\bWdart(x)$.  This is contrary to the convexity of $F$.
\indy{Index}{convex}%
\indy{Notation}{azim}%

If $\op{azim}(x)=\pi$, then $A$ is a plane.  It is the bounding plane of a half-space containing $F$.  Directly from the definition of face, it can be checked that the intersection $A\cap F$ is a proper face of $F$.  This face contains an edge (which is a facet of $F$) and must therefore be a single edge.  This contradicts the observation that $A\cap F$ contains at least two edges.  Hence $\op{azim}(x)<\pi$.
\end{proof}


