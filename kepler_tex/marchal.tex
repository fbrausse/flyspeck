% file started March 22, 2009
% Marchal objective function

\def\lam{\lambda}
\def\Lam{\Lambda}
\def\bl{{\underline{\lam}}}
\def\bm{{\underline{\mu}}}
\def\norm#1{{\|#1\|}}
\def\angle#1#2#3{{\op{angle}(#1,{#2,#3})}}

\chapter{Formulation}

\section{Rogers's partition}

\begin{definition}[saturated packing]
A packing $\Lam\subset \ring{R}^3$ is a set such that
$$\forall \lam~\mu\in \Lam.~  \norm{\lam-\mu} < 2 \Rightarrow (\lam=\mu).$$
The packing is saturated if for every $v\in\ring{R}^3$,   there exists $\lam\in\Lam$
such that $\norm{\lam-v}\le 2$.
\end{definition}

We think of $\Lam$ as the set of centers of a  packing of congruent balls of radius $1$.
To be saturated means that there is no room for further balls to be added to the packing.
There is no loss in generality in assuming that the packing is saturated, when searching
for the greatest possible density of a packing.

Given a packing $\Lam$, Rogers gives a partition of Euclidean space into
simplices with vertices at $\Lam$ \cite{Rog58}.   This section describes his partition.

Let $\Omega(\lam)$  be the closed Voronoi cell centered at $\lam$:
$$
  \Omega(\lam) = \{x \mid  \norm{x-\lam} \le \norm{x-\mu},\ \lam\ne\mu\in\Lam\}.
$$
If $S\subset\Lam$, let $\Omega(S)$ be the intersection of the family:
$$\Omega(S)  = \bigcap \{\Omega(\lam)\mid \lam\in S \}.$$
We call $\Omega(S)$ the $S$-face of $\Omega(\lam)$.

For $X\subset\ring{R}^3$, we let $\dim(X)$ be the dimension of the affine hull
of $X$: $\dim(X) = \dim(\op{aff}(X))$.

If $\bl=(\lam_0,\ldots,\lam_k)$ and $j\le k$ write $\bl[j] = (\lam_0,\ldots,\lam_j)$.
Let $\Lam(k)$ be the set of $k+1$-tuples $\bl=(\lam_0,\ldots,\lam_k)$ such
that 
\begin{equation}\label{eqn:omega-dim}
\dim(\Omega(\bl[j]))+1 = \dim\Omega(\bl[j-1])
\end{equation}
for all $0<j\le k$.
In particular, $\Lam(0)=\Lam$.  Also, $\Lam(1)$ is the
set of all pairs $(\lam,\mu)$ such that the Voronoi cells at $\lam$ and $\mu$ meet along
a face of codimension $1$, and
so forth.


Define $v(\bl)$ recursively on $\Lam(k)$ by
$$v(\lam[0]) = \lam[0]$$
and $v(\lam[k+1])$ is the closest point on $\Omega\{\lam[k+1]\}$ to $v(\lam[k])$.  The point is defined whenever $\Omega\{\lam[k+1]\}$ is nonempty.
The set $\Omega\{\lam[k+1]\}$ is convex and compact.  Thus, the point $v(\lam[k+1])$ exists
uniquely.

For $\bl\in\Lam(k)$, let 
$$R(j,\bl) = \op{conv}\{v(\lam[j]), v(\lam[j+1]),\ldots,v(\lam[k])\}.$$  Set $R(\bl)=R(0,\bl)$.


\begin{lemma} 
For any saturated packing $\Lambda$, we have
$$\ring{R}^3 = \bigcup \{ R(\bl) \mid \bl\in \Lam(3)\}.$$
\end{lemma}

\begin{proof}
We have $$\ring{R}^3 = \bigcup \{\Omega(\lam)\mid \lam\in \Lam(0)\}.$$
So it is enough to show that
$$\Omega(\bl[0]) = \bigcup \{ R(\bl') \mid \bl'\in \Lam(3),~\bl[0]=\bl'[0]\}.$$
We have
$$\Omega(\bl[0]) = \bigcup \op{conv}(c(\bl[0]),\{\Omega(\bl[1])\mid (\bl[1])\in \Lam(1)\}).$$
So it is enough to show that
$$\Omega(\bl[1]) = \bigcup \{ R(1,\bl') \mid \bl'[1]=\bl[1],~\bl'\in \Lam(3)\}.$$
Repeating, it is enough to show that
$$\Omega(\bl[3]) = \bigcup\{R(3,\bl')\mid\bl'[3]=\bl[3],~\bl'\in\Lambda(3)\}.$$
The right-hand side is the singleton $\{v(\bl[3])\}$.  The left-hand side
contains this point and is contained in a properly decreasing chain of affine spaces:
$\ring{R}^3$, the bisector of $\lam_0$ and $\lam_1$, and so forth.  This determines a point,
so the two sides are equal.
\end{proof}

\begin{lemma}  The intersection of any two distinct $R(\bl)$ and $R(\bm)$ is
contained in a plane (hence has measure zero).
\end{lemma}

Combined with the previous lemma, we see that the simplices $R(\bl)$ partition Euclidean
space.

\begin{proof}  Let $\bl = (\lambda_0,\ldots)$ and $\mu = (\mu_0,\ldots)$.
If $\lambda_0\ne\mu_0$, the intersection of the simplices lies in $\Omega\{\lam_0,\mu_0\}$
and we are done.  Let $k+1$ the first index such that
$$\op{conv}(v(\lam_0),\ldots,v(\lam_0,\ldots,\lam_{k+1}))\ne
\op{conv}(v(\mu_0),\ldots,v(\mu_0,\ldots,\mu_{k+1})).
$$
By induction $\Omega\{\lam_0,\ldots,\lam_k\} = \Omega\{\mu_0,\ldots,\mu_k\}$
but
$$\Omega\{\lam_0,\ldots,\lam_{k+1}\} \ne \Omega\{\mu_0,\ldots,\mu_{k+1}\}.$$
The intersection lies in the convex hull $C$ of
$\{v(\lam_0),\ldots,v(\lam_0,\ldots,\lam_k)\}$ and
$V=\Omega\{\lam_0,\ldots,\lam_{k+1},\mu_{k+1}\}$.  The set $V$ lies in an affine space of 
codimension $k+2$
and $C$ has codimension $(k+2) - (k+1) = 1$.
\end{proof}

\begin{lemma}\label{lemma:v2} Let $\bl=(\lam_0,\ldots,\lam_3)\in\Lambda(3)$ and fix $0\le j\le 3$.  Assume that
$$
\norm{v(\bl[j]) - v(\bl[0])} < \sqrt2.
$$
Then $v(\bl[j])$ is the circumcenter of the points $S_j =\{\lam_0,\ldots,\lam_j\}$ and
lies in the convex hull of $S_j$.  The points $v(\bl[j])$, for $j=0,1,2,3$, are distinct.
\end{lemma}

\begin{proof} By definition, an element $\bl\in\Lambda(3)$ gives dimensions: 
$$\Omega\{\lam_0,\ldots,\lam_j\} = 3-j.$$  The case $j=0$ of the lemma is trivially
satisfied.  Assume by induction the result holds for numbers less than $j$.

Now $j>0$.
The circumcenter $p=p_{j}$ of the set $S_{j}$ is the point on the plane $\op{aff}(S_{j})$
closest to $p_{j-1}=v(\bl[j-1])$.  We claim that $p$ lies in $\Omega(S_{j})$.  Otherwise
there is a point $\mu\in\Lambda$ closer to $p$ than any $\lambda\in S_{j}$.  
The angles $\angle{p}{\mu}{\lam_i}$ are obtuse for $i\le j$.  We make a case-by-case
argument for each $j$.

If $j=1$, the points $p,\lam_0,\lam_1$ are collinear and cannot give two obtuse angles.

If $j=2$, $\mu$ lies in the intersection of half spaces with bounding plane $\mu$
and normal $-\lambda_i$.  Let $\mu'$ be the projection of $\mu$ to the plane containing
$p,\lam_0,\lam_1,\lam_2$. The four points $\mu',\lam_0,\lam_1,\lam_2$ can be arranged
cyclically around $p$, each forming an obtuse angle with the next.  A circle around $p$
cannot give four obtuse angles.


If $j=3$, assume that $\lam_0,\ldots,\lam_4$ are labeled in cyclic order around the line
$\op{aff}\{p,\mu\}$.  Consider the dihedral angle 
  $$
  \gamma_i=\gamma=\dih(\{p,\mu\},\{\lam_i,\lam_{i+1}\}).
  $$
By the law of cosines the angle $\gamma$ is given in terms of the edges of the spherical
triangle $a,b,c$ by
$$
  \cos c - \cos a \cos b = \sin a \sin b \cos \gamma.
$$
All the terms on the left-hand side are negative, so $\gamma =\gamma_i > \pi/2$.
This is impossible, as the sum of the four dihedral angles $\gamma_i$ is $2\pi$.
This completes the proof that $v(\bl[j])$ is the circumcenter.

Next we show that this point lies in the convex hull of $S_j$.
If $j=0$, there is nothing to show.  If $j=1$, the point is the midpoint of the convex hull.
If $j=2$, the point is the circumcenter of an acute triangle.  If $j=3$, the point is the
circumcenter of a simplex such that every face has positive orientation (see XX).  Thus,
in every case the point lies in the convex hull.

The distances $\norm{v(\bl[j])-v(\bl[0])}$ are increasing, so it is enough to show
that $v(\bl[j])\ne v(\bl[j+1])$.  If we had equality, then the circumcenter $v(\bl[j])$
would have an equally close packing point $\lambda_{j+1}\in\Lambda$, which is impossible
the the first part of the proof.
\end{proof}

\begin{lemma}   Let $\bl\in\Lambda(k)$.  Assume that $\norm{v(\bl)-v(\bl[0])}<\sqrt2$.
Let $\bm$ be any permutation of the components of $\bl$.  Then $\bm\in\Lambda(k)$ and
 $v(\bl) = v(\bm)$.
\end{lemma}

\begin{proof} 
Since the sets $\Omega(v(\bl[j]))$ satisfy (\ref{eqn:omega-dim}), we have that
$\Omega(v(\bl))$ is a point consisting of the singleton $\{v(\bl)\}$, which is the
circumcenter of the simplex with vertices $\{\lam_0,\ldots,\lam_k\}$.  This describes
the point $v(\bl)$ in a way that is independent of the permutation.

We check that the condition (\ref{eqn:omega-dim}) holds for the permutation $\mu$.
The proof of Lemma~\ref{lemma:v2} shows that the midpoint of $\op{conv}(\mu_0,\mu_1)$
lies in $\Omega(\bm[1])$ and since the inequalities are strict, some neighborhood
of this midpoint in the bisecting plane of $\{mu_0,\mu_1\}$ lies in $\Omega(\bm[1])$.
Thus, $\dim(\Omega(\bm[1]))=2$.  We continue in this fashion, showing that each dimension
$\dim(\Omega(\bm[j]))$ drops by exactly one.
\end{proof}

\begin{lemma}\label{lemma:Rconv} Let $\bl = (\lam_0,\ldots,\lam_k)\in\Lambda(k)$.  Assume that $\norm{v(\bl)-v(\bl[0])}<\sqrt2$.
For any permutation $\pi$, let $\pi(\bl)\in\Lam(k)$ be the permuted entry.  Let
$S(k)$ be the group of all permutations on $k+1$ letters.   Then
$$
\op{conv}\{\lam_0,\ldots,\lam_k\} = \bigcup \{ R(\pi(\bl)) : \pi\in S(k)\}.
$$
\end{lemma}

\begin{proof} Let $L = \{\lam_0,\ldots,\lam_k\}$.  We prove it by induction on $k$.
When $k=0$, the result is trivial.  Now assume $k>0$.

The circumcenter $v(\bl)$ of $L$ lies in the convex hull of these
point (see the proof of Lemma~\ref{lemma:v2}).  Thus, the left-hand side is the union
of the cones over the (k+1)-faces:
$$
\op{conv}(S) = \bigcup\{ \op{conv}(v(\bl),L\setminus \{\lam_i\}\mid i=0,\ldots,k) \}.
$$
The sets $L\setminus \{\lam_i\}$ can be identified with  cosets of $S(k)/S(k-1)$.
By induction $L\setminus \{\lam_i\}$ is the union of $R(\bm)$ as $\bm$ runs
over all permutations $S(k-1)$ of $L\setminus \{\lam_i\}$.
The result follows by induction.
\end{proof}

We remark that the Rogers's simplices $R(\bl)$ are compatible with the Voronoi
decomposition of space (by construction).  Also, by Lemma~\ref{lemma:Rconv}, under
mild restrictions on the circumradius, they can also be reassembled into simplices
with vertices at the centers of the packing (the Delaunay simplices).  

\section{Marchal's partition}

C, Marchal has introduced a new approach to the Keper conjecture that is manifestly superior to the one in \cite{DCG}.  If his approach can be pushed
to completion, it would cut years off the Flyspeck project.

His articles claim to give
a {\it demonstration} of the Kepler conjecture \cite{Mar08}, \cite{Marc07}.  However, the
mathematically rigorous part of the article only gives a reduction
of the problem to an optimization problem in a finite number of
variables.  The method of gradient descent is then used to explore
the local minima of the optimization problem in finitely many variables.

Marchal's partition of space is a variant of Rogers's partition into simplices
$R(\bl)$.  The main part of construction is 
the decomposition obtained by truncating the Voronoi cells
by a ball of radius $\sqrt2$.  In a few carefully chosen situations he assembles the simplices
into a larger convex hull along the lines of Lemma~\ref{lemma:Rconv}.

Let $r(\bl[i]) = \norm{v(\bl[i])-\lam_0}$.  The numbers $r(\bl[i])$ are increasing with $i$.

\begin{definition} Let $R=R(\bl)$ be a Rogers simplex with $\bl=(\lam_0,\ldots,\lam_3)$.
\hfill\break\smallskip  
{\bf The $0$-cell} of $R$ is
$$
R(\bl)_0 = \{x\in R(\bl) \mid \norm{v(\lam_0)-x} > \sqrt2.
$$
\bigskip
{\bf The $1$-cell} of $R$ is 
$$
R(\bl)_1 = \op{conv}(v(\lam_0),T_1),\quad T_1 = \{x \in R(\bl) \mid \norm{v(\lam_0)-x}= \sqrt2\}.
$$
\bigskip
{\bf The $2$-cell} of $R$ is
$$
\begin{array}{rll}
R(\bl)_2 &= \op{conv}(v(\bl[0]),v(\bl[1]),T_2),\quad \\
  T_2 &= \{x \in R(\bl)\cap \Omega(\bl[1]) \mid \norm{\lam_0-x}=\norm{\lam_1-x} =\sqrt2\}.
\end{array}
$$
\bigskip
{\bf The $3$-cell} of $R$ is defined to be empty unless 
$$
r(\bl[2]) <\sqrt2 \le r(\bl[3]).
$$
When this inequality holds,
there is a a unique point $p(\bl[2])$ in
$\op{conv}(\bl[2],\bl[3])$ at distance exactly $\sqrt2$ from $\lam_0$.  
Define the $3$ cell to be
$$
R(\bl)_3 = \op{conv}\{p(\bl[2]),\lam_0,\lam_1,\lam_2\}.
$$
\bigskip
{\bf The $4$-cell} of $R$ is defined to be empty unless
$$
r(\bl[3]) <\sqrt2.
$$
When this inequality holds, define the $4$ cell to be
$$
R(\bl)_4 = \op{conv}\{\lam_0,\lam_1,\lam_2,\lam_3\}.
$$
\end{definition}

Note the the $0$, $1$, and $2$-cells are always subsets of $R$.  However, the $3$ and
$4$-cells are finite unions of Rogers simplices.

\begin{lemma}  The $0,\ldots,4$-cells of all Rogers simplices $R(\bl)$, for $\bl\in \Lam(3)$
give a partition of $\ring{R}^3$.  An $i$-cell is never equal to a $j$-cell when $i\ne j$.
Two $3$-cells $R(\bl)_3 = R(\bm)_3$ are equal exactly when
$(\lam_0,\lam_1,\lam_2)$ is a permutation of $(\mu_0,\mu_1,\mu_2)$.  Two $4$-cells are
equal exactly when $\bl$ is a permutation of $\bm$.
\end{lemma}

\begin{proof}  First we will prove that cells are either disjoint or equal.  At the same
time, we determine when $4$-cells or $3$-cells are equal to one another.
By Lemma~XX, the $4$-cell $R(\bl)_4$ is a union of the Rogers simplices
$R(\bm)$, as $\bm$ runs over permutations of $\bl$. 
 Two $4$-cells
that meet are equal. 
Every $4$-cell comes from a simplex
$R(\bl)$ with $r(\bl)<\sqrt2$.  This condition gives $R(\bl)_i=\emptyset$, for $i=0,1,2,3$.

Similarly, the $3$-cell is a union
of the convex hulls $\op{conv}(p(\bm[2]),R(\bm[2]))$ as $\bm[2]$ runs over permutations of $\bl[2]$.  Note that the point $p(\bm[2])=p(\bl[2])$ is independent of the permutation, since
it is determined as the point at distance $\sqrt2$ from $\lam_0$ along the line through
from $v(\bm[2])=v(\bl[2])$ perpendicular to the plane $\op{aff}\{\lam_0,\lam_1,\lam_2\}$
(in the half-space of $\bl[3]$). Two $3$-cells that meet are equal and come from parameters that are permutations of
one another as described.   The intersection $R(\bl)_3$ cannot meet $R(\bl)_i$, for $i<3$, in
a set of full dimension, because the plane $P(\bl[2])=\op{aff}\{\lam_0,\lam_1,p\}$ separates them.

The $2$-cell $R(\bl)_2$ is separated from the $0$ and $1$-cells $R(\bl)_i$
by the cone $P(\bl[1])$ with apex $\lam_0$
passing through $T_2$. The $1$-cell is separated from $0$-cells the the sphere $P(\bl[0])$
of radius
$\sqrt2$, centered at $\lam_0$.

Finally, we show that every point $x$ in $\ring{R}^3$ belongs to a cell.  By the Rogers
partition, the point $x$ belongs to a Rogers simplex $R(\bl)$.  If $r(\bl)<\sqrt2$, then
$x$ belongs to a $4$-cell.  Otherwise $x\in R(\bl)$ belongs to $R(\bl)_i$ according to
which side of the plane $P(\bl[2])$, cone $P(\bl[1])$, and sphere $P(\bl[0])$ the point
lies, as described above.
\end{proof}


\section{Kissing number estimates}

This section shows how Conjecture~\ref{conj:m1} would follow from an explicit estimate
related to the Gregory-Newton problem


We define the following constants and functions.
$$
\begin{array}{lll}
\alpha=\alpha_{cm} &= \arccos(1/3)\\
K=K_{cm} &= (3\alpha-\pi)\sqrt2/(12\pi - 30\alpha)\\
M = M_{cm} &= (18\alpha-7\pi)\sqrt2/(144\pi-360\alpha)\\
f(r) = f_{cm}(r) &=
\begin{cases}
 (\sqrt2-r) (r-1.3254) (9r^2 - 17 r + 3)/(1.627 (\sqrt2-1))& r\le\sqrt2\\
 0 & r >\sqrt2.
\end{cases}
\\
\end{array}
$$
We have 
\begin{equation}\label{eqn:km}K - 12M = \sqrt{1/2}\end{equation}
and
\begin{equation}f(1) = 1,\quad f(\sqrt2) =0\end{equation}


\begin{conjecture}[Marchal-2]\label{conj:m1} For any saturated packing $\Lam$, and
any $\lam_0\in\Lam$, we have
$$
\sum_{\bl=(\lam_0,\lam_1)\in\Lam(1)} f(r(\bl)) \le 12.
$$
\end{conjecture}

\begin{theorem}
Conjecture~\ref{conj:m1} implies the Kepler conjecture.
\end{theorem}

\begin{proof} 
We show that $A(\lam_0)  = 8 K - \sum 8 M f(r(\bl)) -\op{vol}(\Omega(\lam_0))$ is fcc-compatible and negligeable.  The
result then follows from \cite[Lemma~3.3]{DCG}.  This is fcc-compatible directly
by equation~(\ref{eqn:km})
and Conjecture~\ref{conj:m1}.  The issue is to prove it negligeable.  Explicitly, we need
to show there exists a constant  $C$ such that or all $r\ge 1$ and all $x\in\ring{R}^3$:
\begin{equation}\label{eqn:neg}
\sum 8K - \sum (\sum 8 M f(r)) - \sum \op{vol}(\Omega(\lam))) \le C r^2,
\end{equation}
where the outer sum runs over $\lam\in \Lam(x,r)$.


Define the {\it total solid angle} and the {\it basic dihedral angles} of $i$-cells as follows for
$i>0$.  The total solid angle is the sum of the solid angles of the $i$-cell, summed
over all the extreme points of the cell that belong to $\Lambda$.  For a $0$-cell
the total solid angle is zero. For $1$ and $2$-cells,
it is just the solid angle of the cell at $\lam_0$.  For a $3$-cell, it is the sum of the
solid angles at $\lam_0,\lam_1,\lam_2$.  And for a $4$-cell, it is the sum of the solid
angles at $\lam_0,\ldots,\lam_3$. Write $\op{tsol}(X)$ for the total solid angle of a cell $X$.


The  basic dihedral angles of a cell $X = R(\bl)_i$ are indexed by the set $D(X)$ of
edges $\op{conv}(\lam_0,v(\bl[1]))$ that lie on the boundary of the cell.  The value
$\dih(X,d)$ of
of the basic dihedral angle indexed by $d$ is just the dihedral angle along that edge
of the boundary.  The indexing set $X$ is empty for  $0$ and $1$-cells.
The (single) basic  dihedral angle of a $2$-cell is
the same as the radian angle subtended by the arc $T_2$ in the construction of $2$-cells.
The basic dihedral angles of a $3$-cell are the dihedral angles along the
six directed edges $(\lam_i,\lam_j)$, $i,j=0,1,2$.  The basic dihedral angles of a $4$-cell are
the dihedral angles along any directed edge.  Each element $d\in D(X)$ also determines
the real number $r(d) = \norm{v(\bl[1])-\lam_0}$.

We have the Marchal's fundamental estimate for any cell $X$:
\begin{equation}\label{eqn:mfe}
0 \ge \left(\frac{2K}{\pi}\right) \op{tsol}(X) - \left(\frac{4M}{\pi}\right)
\sum_{d\in D(X)} \dih(X,d) f(r(d)) - \op{vol}(X).
\end{equation}
(Note that this is an inequality in at most six variables; the most difficult case to prove
is that of a $4$-cell.)  The volumes and solid angles and so forth are given by the 
explicit formulas.

Sum the inequality~(\ref{eqn:mfe}) over all cells in a large ball $B(x,r)$ to get an
inequality of the form $0\ge T_1 + T_2 + T_3$ for three sums $T_i = T_i(r)$.  We compare this term-by-term
with the three terms $T'_i(r)$ of the desired equation~(\ref{eqn:neg}).  The solid angles around each point sum to
$4\pi$, and the dihedral angles around each directed edge sum to $2\pi$, so we see that
the three terms satisfy
$$T'_i(r) \le T_i(r) + C r^2,$$
for some constant $C$ and error term $C r^2$ coming from the boundary effects of the cells $X$ that meet the boundary of $B(x,r)$.  The result follows.
\end{proof}


