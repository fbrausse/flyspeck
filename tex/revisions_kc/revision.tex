% Revisions to the Kepler Conjecture.
% Author: Hales, Harrison, McLaughlin, Nipkow, Obua, Zumkeller

% email: hales@pitt.edu
%
% latex format

% History:
% Branched from dcg_errata.tex on Oct 8, 2008


\documentclass[11pt]{amsart}
%\documentclass{llncs}
\usepackage{graphicx}
\usepackage{url}
\usepackage{amsfonts}
\usepackage{amscd}
\usepackage{amssymb}
\usepackage{alltt}
%\usepackage{amsmath,amsthm}

% generate revision number by
% svn propset svn:keywords "LastChangedRevision" revision.tex
\def\svninfo{%
  TeXed on \today; \hfill\break
  Repository Root: https://flyspeck.googlecode.com/svn \hfill\break
  SVN $LastChangedRevision$
  }
%-%


% Math notation.
\def\op#1{{\text{#1}}}
\newcommand{\mc}[1]{{\mathcal{#1}}}
\newcommand{\ring}[1]{\mathbb{#1}}
%\def\to{{\ensuremath{\quad\Longrightarrow\quad}}}
\def\lto{\ensuremath{\,\leadsto\,}}
\def\line{$\ell$}
\def\text{\hbox}

% Typesetting:
\def\coloneq{\mathrel{\mathop:}=}
\def\sfrac#1#2{{\textstyle \frac {#1} {#2}}}
\def\eqref#1{(\ref{#1})}

% Flyspeck:
\def\pt{\mathrm{pt}}
\def\doct{\delta_{\mathrm{oct}}}
\def\asolid{\mathrm{a}}
\def\sqroot{\mathrm{sqrt}}
\def\rcp{\mathrm{rcp}}
\def\bstein{\mathrm{B}}



\newtheorem{definition}[subsubsection]{Definition}
\newtheorem{thm}[subsubsection]{Theorem}
\newtheorem{lemma}[subsubsection]{Lemma}
\newtheorem{assumption}[subsubsection]{Assumption}
\newtheorem{corollary}[subsubsection]{Corollary}
\newtheorem{remark}[subsubsection]{Remark}


\parindent=0pt
\parskip=\baselineskip

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\title{Revising the proof of the Kepler Conjecture}

\author[Hales]{Thomas C. Hales}
\address[T.~Hales]{Math Department, University of Pittsburgh}
\email{hales@pitt.edu}

\author[Harrison]{John Harrison}
\address[J.~Harrison]{Intel}

\author[McLaughlin]{Sean McLaughlin}
\address[S.~McLaughlin]{CMU}

\author[Nipkow]{Tobias Nipkow}
\address[T.~Nipkow]{TUM}

\author[Obua]{Steven Obua}
\address[S.~Obua]{TUM}

\author[Zumkeller]{Roland Zumkeller}
\address[R.~Zumkeller]{Palaiseau}

\begin{abstract}
The Kepler conjecture asserts that no packing of congruent balls in three-dimensional Euclidean space can
have density greater than that of the face-centered cubic packing.  The original proof,
announced in 1998 and published in 2006, is long and complex. The process of  revision and review did not end with the publication of the proof.
This article summarizes the current status of several long-term iniatiatives to
reorganize the original proof into a more transparent form and to provide a greater
level of certification of the correctness of the computer code and other details of the proof.
\end{abstract}


\maketitle

\section{Introduction}

In 2006, {\it Discrete and Computational Geometry} devoted a special issue to the
proof of the Kepler Conjecture on sphere packings, which asserts that no
packing of congruent balls in three-dimensional Euclidean space can
have density greater than that of the face-centered cubic packing \cite{Hales:2006:DCG}.
This density is $\pi/\sqrt{18}$.

The proof is long and complex.  The editors' forward to that issue remarks
that ``the reviewing of these papers ws a particularly enormous and daunting task.''
``The main portion of the reviewing took place in a seminar run at E\"otvos University
over a 3 year period.  Some computer experiments were done in a detailed check.
The nature of this proof, consisting in part of a large number of inequalities having
little internal structure, and a complicated proof tree, makes it hard for humans
to check every step reliably.  Detailed checking of specific assertions found them to
be essentially correct in every case tested.  The reviewing process produced in the
reviewers a strong degree of conviction of the essential correctness of the proof
approach, and that the reduction method led to nonlinear programming problems of
tractable size.''

The process of review and revision did not end when the proof was published.
This article summarizes the current status of several long-term iniatiatives to
reorganize the original proof into a more transparent form and to provide a greater
level of certification of the correctness of the computer code and other details of the proof.

\section{The Flyspeck Project}

\subsection{Formal Proof}


\subsection{Formal Proof of the Kepler Conjecture}


\subsection{An outline of the initiatives}

This section gives a summary of several different initiatives related to the Kepler conjecture.

\subsubsection{Standard ML reimplementation of the code}

S. McLaughlin has reimplemented the computer code that is used in the proof
of the Kepler conjecture.  Section~\ref{sec:code} describes the difficulties
in verifying the computer code in its original form.  Section~\ref{sec:sean}
describes the reimplementation.

\subsubsection{Verifying nonlinear inequalities with Bernstein bases}

\subsubsection{Graph generation}

\subsubsection{Linear programming}

\subsubsection{Formal Blueprint}

\subsubsection{Text formalization}

\subsubsection{Automated Translation}

\subsubsection{Extensions to HOL Light}



\section{HOL Light}

(to be supplied by Harrison)


\section{Standard ML Reimplementation of Code}

\subsection{Code}
\label{sec:code}



The Hales and Ferguson proof of the Kepler
Conjecture~\cite{Hales:2005:Annals} relies significantly
on computation. Computer code is used extensively, and is
central both to the correctness of the result and to a thorough
understanding of the proof. 

  There are 4 major difficulties with understanding and verifying
this particular code base. The first and most glaring difficulty is
simply the amount of code. At Hales' website~\cite{website:Hales:1998:Code}
there are well over 50,000 lines of programs in Java, C++, and
Mathematica. This represents only the calculations Hales did himself.
Sam Ferguson also completed many of the calculations with a completely
different code base of 137,000\footnote{There is a large amount of
code copying in Ferguson's code, resulting in a much larger code base.
The number of distinct lines is difficult to measure} lines of C. By
contrast, the proof of the Four Color Theorem by Robinson \textit{et.
al.}~\cite{Robertson:1997:JCTB} is less than 3,000 lines of C.

Another difficulty is in the organization of the code. The
calculations were done over the space of four years and involved % 10->4, tch, Oct 11, 2008
thousands of executions of the various programs. The variety of
computational tasks include, among others, estimating global bounds on
inequalities using nonlinear methods, proving inequalities rigorously
using interval arithmetic, generating graphs satisfying certain
properties, generating linear programs from graphs, and bounding
linear programs. Despite a labeling scheme used by Hales to uniquely
identify his calculations, many computations relied upon by the proof
are difficult to find in the original source code. To locate, for
instance, computation ``CALC-821707685'' from Hales' paper in
\emph{Discrete and Computational Geometry}~\cite{Hales:2006:DCG},
p.159, you can search on the website~\cite{website:Hales:1998:Code} in
vain. Ferguson has no such naming convention. While we believe records
of the computations do exist, it is not always an easy matter
to find them without the authors' guidance.

The third difficulty lies in the complexity of the implementation. For instance,
the software Hales developed to prove the inequalities upon which his
paper rests is relatively complicated. Processing power at the time
(1985-1995) was just barely capable of completing the computations he
requested. To keep the length of execution to days or weeks instead of
months or years, Hales extensively optimized his code. The
optimizations were often implemented without comment in the source,
and in some cases were difficult for us to understand.  

Finally, Hales uses C++ and Ferguson uses C to carry out
\emph{interval arithmetic} calculations. In the process, they
explicitly set the IEEE 754~\cite{IEEE:1985:IEE754} rounding modes on
the floating point unit. There are a number of difficulties with using
floating point numbers and rounding modes directly. The first is that
reasoning about floating point instructions requires a relatively deep
understanding of the machine architecture~\cite{Monniaux:2008:TOPLAS}.
For instance, setting the rounding mode\footnote{In Hales C++ code
base the rounding modes are explicitly changed at least 400 times.}
changes the state of the processor itself. Such an instruction has a
global effect on all subsequent floating point computations. Moreover,
compilers, libraries, and even processors are notorious for unsound
implementations of the 754 standard. A GCC mailing list entry from
1998\footnote{\url{http://gcc.gnu.org/ml/gcc/1998-02/msg00998.html}},
3 years after the Kepler project was completed, contains the following
comment (after describing fixes for a number of other 754-related
bugs): ``When you use fpu/cpu to do rounding, you have to mark the
variable volatile. Otherwise, the compiler may do some thing [sic] you don't
want.'' On the other hand, the volatile keyword is not well defined by
the C language definition~\cite{Kernighan:1988:C}, meaning that a C
program using the volatile keyword is undefined by the
language definition. This is an unsatisfactory state of affairs.

% ------------------------------------------------------------------------------
%  Motivation                                                                   
% ------------------------------------------------------------------------------



\subsection{Motivation and Current Status}
\label{sec:sean}

Our motivation in this work is to bring the computational aspects of
the Kepler conjecture closer to the level of simplicity and clarity
necessary for formalization by a proof assistant. Our goals are:

\begin{enumerate}
\item The code should be rewritten in a functional language with a
  rigorous definition whose semantics resembles those supported by
  proof assistants such as HOL Light and Coq.
\item The implementation should be written in a subset of the language
  that is easily translatable to the object languages of Coq and HOL
  Light. This means it should not, for instance, use features such as state
  (references) that do not have obvious analogues in proof assistants.
\item The implementation should be able to avoid the use of floating
  point numbers and rounding modes.
\item The code should be organized in such a way that any
  computation upon which the proof relies can be evaluated from a single
  interface.  This will allow Flyspeck developers to easily find and
  check the paper results during the formalization process.
\end{enumerate} 

\noindent This
work is in the spirit of Robinson, \textit{et.
al.}~\cite{Robertson:1997:JCTB}, which simplified the original code of
Appel and Haken~\cite{Appel:1986:FourColor}, and was used by Gonthier to
construct the fully formal proof~\cite{Gonthier:2005:FourColor} in the
Coq proof assistant. 

We chose Standard ML for the reimplementation for a number of reasons.
It has a formal definition~\cite{Milner:1990:SML}, and thus programs
have a meaning apart from the particular compiler used. It has a
foreign function interface that allows us to use external libraries
with relative ease. It has an expressive module system, and thus it is
possible to write the code with respect to an abstract libraries and
arithmetics. This allows us, for instance, to use multiple independent
implementations of interval arithmetic such as
MPFI~\cite{Revol:2005:MPFI}, as well as our own implementation using
floating point numbers. SML also has a very efficient
compiler~\cite{website:MLton}\footnote{Our SML implementation runs at
worst twice as slow as Hales C++ implementation compiled with GCC.}.

We have made significant progress toward our goals. Almost all the
code has been completely rewritten~\cite{McLaughlin:2008:KeplerCode} in
SML. The graph generator
from~\cite{Nipkow:2005:Tame} has been incorporated into the user
interface. Using the module system, we have completed a generic linear
programming interface to check the linear programs. We have
incorporated the GLPK and CPLEX libraries for solving linear programs
via the foreign function interface. The dual variables of the linear
programming solutions are rigorously checked in SML using interval
arithmetic, similar to Obua's work in~\cite{Obua:2005:Thesis}. We have
also incorporated the nonlinear optimization packages CFSQP and Knitro
into our interface to allow (non-rigorous) testing of inequalities.
This has allowed us to catch a number of transcription errors in
revisions of the Kepler proof. Thus, we have a fairly complete suite
of software support for the Flyspeck project. We are now in the
process of organizing and reevaluating the thousands of computations
found in the proof.


\section{Generating Planar Graphs}
\label{sec:graph}

(to be supplied by Nipkow)

\section{Verifying Linear Programming}
\label{sec:lp}

(to be supplied by Obua)

\section{Proving Nonlinear Inequalities with Bernstein bases}
\label{sec:zumkeller}

The list of about thousand non-linear inequalities forms the computationally
hardest part of the proof. This section presents a technique aimed at proving
these, based on polynomial approximation and the Bernstein bases. We feel that
our approach better fits the requirements of formal proof, as outlined in
section \ref{sec:sean} and hope to refine it to eventually cover all Flyspeck
inequalities.

The proof contains the following definitions \cite{sp1}:
\begin{eqnarray*}
\pt &\coloneq& - \frac \pi 3 + 4 \arctan \frac{\sqrt 2}5\\
\doct &\coloneq& \frac {\pi - 4 \arctan \frac{\sqrt 2}5}{2 \sqrt 2}\\
\Delta(y) &\coloneq& \frac 1 4
  \left|
  \begin{array}{ccccc}
    0 & 1 & 1 & 1 & 1 \\
    1 & 0 & y_3 & y_2 & y_1 \\
    1 & y_3 & 0 & y_4 & y_5 \\
    1 & y_2 & y_4 & 0 & y_6 \\
    1 & y_1 & y_5 & y_6 & 0
  \end{array}
  \right|^2
  %=\begin{array}{l}
  %  y_1y_4(-y_1 + y_2 + y_3 -y_4 + y_5 + y_6)\\
  %  {} + y_2y_5(y_1 - y_2 + y_3 + y_4 -y_5 + y_6)\\
  %  {} + y_3y_6(y_1 + y_2 - y_3 + y_4 + y_5 - y_6)\\
  %  {} - y_2y_3y_4 - y_1y_3y_5 - y_1y_2y_6 -y_4y_5y_6\\
  %\end{array}
  \\
\asolid_0(y) &\coloneq& y_1 y_2 y_3 + \sfrac 1 2 (
y_1^2 y_2 + y_1 y_2^2 + y_1^2 y_3 + y_2^2 y_3 + y_1 y_3^2 \\
&&\qquad\qquad\qquad {} + y_2 y_3^2 - y_1 y_4^2 - y_2 y_5^2 - y_3 y_6^2)\\
\asolid_1(y) &\coloneq& \asolid_0 (y_1, y_5, y_6, y_4, y_2, y_3)\\
\asolid_2(y) &\coloneq& \asolid_0 (y_2, y_4, y_6, y_5, y_1, y_3)\\
\asolid_3(y) &\coloneq& \asolid_0 (y_4, y_5, y_3, y_1, y_2, y_6)\\
\gamma(y) &\coloneq& 
- \frac \doct 6 \sqrt {\Delta(y)} + \frac 2 3 \sum_{i=0}^3 \arctan \frac
{\sqrt{\Delta(y)}} {\asolid_i(y)}
\end{eqnarray*}

Our guiding example will be inequality 586468779. Its statement is:
\begin{equation}
\forall y \in [2,2.51]^6.\; \gamma(y) \le \pt \label{gamma-pt}
\end{equation}
Interval arithmetic, used to prove the inequalities in the original proof,
suffers from the \emph{dependency problem}: the minimum and maximum of the
formula $x-x$ are overestimated because $[a,b] - [a,b] = [a-b,b-a]$, although
$x-x$ is clearly $0$. Subdividing $[a,b]$ into $[a,\sfrac{a+b}2]$ and
$[\sfrac{a+b}2,b]$, and then re-evaluating the formula yields an improved
result. However, depending on the problem, the number of required subdivisions
can be very large. This is why checking some inequalities takes a very long
time.

\subsection{From Geometrical Functions to Polynomials}
Fortunately, better methods than interval arithmetic are available, if the
function under consideration is polynomial. A quick look at $\gamma$ tells us
that \eqref{gamma-pt} is not polynomial, since it has occurrences of
$\sqrt\cdot$, $1/\cdot$, and $\arctan$. Is it nevertheless possible to reduce it
to a polynomial problem? Two strategies come to mind:

First, algebraic laws such as $\sqrt a \le b \Leftrightarrow a \le b^2$ (if
$b \ge 0$) and $\frac a b \le c \Leftrightarrow a \le bc$ (if $b>0$) can often
be used to eliminate occurrences of $\sqrt\cdot$ and $1/\cdot$. The list of
trigonometric identities is endless. For our example, Vega's rule $\arctan a +
\arctan b = \arctan \frac {a + b} {1 - ab}$ seems useful. Unfortunately, this
technique quite often yields huge expressions that are difficult to deal with by
there sheer size. Also, a reduction to a polynomial may simply be
impossible (we suspect that this is the case for \eqref{gamma-pt}).

A second technique is based on replacing $\gamma$ with a polynomial $g$ that
fits above it, but is sill smaller than $\pt$. Clearly, if there exists a $g$
such that
\begin{equation}
\forall y \in [2,2.51]^6.\; \gamma(y) \le g(y) \label{gamma-g}
\end{equation}
and
\begin{equation}
\forall y \in [2,2.51]^6.\; g(y) \le \pt, \label{g-pt}
\end{equation}
then by transitivity \eqref{gamma-pt} holds.

Such a polynomial $g$ can be obtained by replacing $\sqrt{\cdot}$, $1/\cdot$ and
$\arctan$ with polynomial approximations. We only need to ensure that we use
upper approximations for positive occurrences and lower approximations for
negative ones. Only occurrences whose arguments contain variables need to be
replaced, since e.g. $\sqrt 2$ is a (constant) polynomial itself.

In the definition of $\gamma$ the function $\arctan{}$ occurs positively, so it is
replaced by an upper approximation $\overline{\arctan}$. The term
$\frac{\sqrt{\Delta(y)}} {\asolid_i(y)}$ is first unfolded to $ {\sqrt{\Delta(y)}}
\cdot \frac 1 {\asolid_i(y)}$. Both the square root and reciprocal occur
positively again, so they can be replaced by upper approximations
 $\overline\sqroot$ and $\overline\rcp$, respectively. This yields
$\overline{\arctan} (\overline\sqroot(\Delta(y)) \cdot
\overline\rcp(\asolid_i(y)))$ in all four summands. It remains only the
$\sqrt\cdot$ occurring negatively after $-\frac \doct 6$, which is to be
replaced by a lower approximation $\underline\sqroot$.

We choose the following approximations:
\begin{eqnarray*}
\overline{\arctan}(t) &\coloneq& \arctan \frac{\sqrt 2}5 + \frac {25} {27}\left(t - \frac{\sqrt 2}5\right)\\
\overline\rcp(t) &\coloneq& \frac 1 4 - \frac {37 t} {1600} + \frac {t^2} {1000}- \frac{13 t^3} {640000} + \frac {t^4} {6400000}\\
\underline\sqroot(t) &\coloneq& 8 \sqrt 2 + \frac 3 {64 (\pi - 4 \arctan \frac{\sqrt 2}5)} (t - 128)\\
\overline\sqroot(t) &\coloneq& 8 \sqrt 2 + \frac 1 {16 \sqrt 2}(t -128)\\
\end{eqnarray*}

These approximations are valid w.r.t. \eqref{gamma-pt}. For example,
$$\forall t \in\Delta ([2,2.51]^6).\; \sqrt{t} \le \overline\sqroot(t).$$ This
can be established by elementary means, knowing that $\Delta ([2,2.51]^6)
\subseteq [128;501]$. The latter can be automatically shown by the method
outlined in subsection \ref{bernstein}.

Our construction of $g$ therefore ensures \eqref{gamma-g}. Moreover, using
polynomial interpolation, we have carefully chosen the approximations such that
$$\gamma (2,2,2,2,2,2) = g (2,2,2,2,2,2) = \pt. \label{eq-gamma-g-pt}$$
This is important, because otherwise \eqref{gamma-pt} cannot hold.

% TODO note on potential pitfall when imbricating approximations


\subsection{Bounding Polynomials}
\label{bernstein}

In order to prove \eqref{gamma-pt}, it remains to be shown that $g(y) \le \pt$.
This can be done with the help of Bernstein polynomials. We briefly outline the
case of a single variable $x$ here.

The $i$th Bernstein basis polynomial of order $k$ is defined as $$\bstein^k_i(x)
\coloneq {k \choose i}x^i(1-x)^i.$$

For a polynomial $p$ and a vector $b \in \mathbb R^k$, if $$p = \sum_{i=0}^k b_i
\cdot \bstein^k_i$$ then $b$ is called the \emph{Bernstein representation} of
$p$. In this case $$\forall x \in [0;1].\; p(x) \le \max_i b_i.$$

This property is tremendously useful: it gives us an upper bound on $p$, namely
the largest coefficient of $p$'s Bernstein representation. By a change of
variable we can reduce any domain to $[0,1]$. The generalization to the
multivariate case is straight-forward \cite{garloff, roland-thesis}.

In order to bound a polynomial it thus suffices to convert it into Bernstein
representation. This can be done by a matrix multiplication (the Bernstein basis
of order $k$ forms a basis of the vector space of all polynomials of degree up
to $k$). For practical purposes it is however crucial to use a more efficient algorithm
(cf. \cite{garloff, roland-thesis}).

Note that $g$ contains irrational coefficients. This is a consequence of
requirement \eqref{eq-gamma-g-pt} and cannot be avoided. However, we were able
to choose the approximation polynomials in a way such that the transcendental
part is canceled by $\pt$ (hence the occurrence of $\pi - 4 \arctan \frac{\sqrt
  2}5$ in the formula for $\underline\sqroot$). It turns out that the polynomial
$p(y) \coloneq \sqrt 2 (g(y) - \pt)$ has rational coefficients! This can be
easily checked with symbolic algebra software.

It can thus be converted to a Bernstein without rounding, using the algorithm
presented in \cite{roland-thesis}. The only divisions performed in this method
are by powers of 2, which can be efficiently represented using dyadic numbers.

The polynomial $p$ consists of 12945 monomials and has total degree 18. A
prototype implementation in Haskell returns $0$ as the maximum for $p$ in about
ten minutes. Thus $\sqrt 2 (g(y) - \pt) \le 0$ and $g(y) \le \pt$.





\section{Deformation Argument, page 131}

[p.131]
In Section~12.7, the argument in the first two
paragraphs about reducing to a polygon is incomplete, because it doesn't show that the deformation can be done in such a way that the distances remain at least $2$.  The Remark~12.7 about this issue only applies to the subsequent 
deformations.  This is a serious issue that requires an extended explanation.

To make sure that there are no problems with the deformation,
I need to repeat a number of estimates from DCG, sometimes with
a minor variation.  (I am currently preparing the Blueprint
Version of the proof of Kepler, and some of what I write here
includes improvements made for that version.)  A few of
these need new interval arithmetic calculations.  I am
do not have access to interval arithmetic code right now, so for the moment these remain hypotheses.


If we only use distinguished edges of length
at most $2.91$, no problems arise.  This is
because geometric considerations give
  $$E(2,2,2,2.51,2,2.51,2,2,2) > 2.91.$$
However, this does not solve the problem, because
loops are allowed to have edges of length as
great as $3.2$.

This issue does not occur in the proof of the dodecahedral conjecture.  There we can start with edges of length up to length $2.91$, and make the deformations described in Section~12.7.  After deformations have made each subregion into a simple polygon, the edges can be extended out to $3.2$, and the argument continues as before.

The problem is with loops which have an anchored simplex with an edge in the range $[2.91,3.2]$.  To fix the problem, we need to be much more aggressive 
in expunging upright quarters.  Thus, we need to revisit earlier sections of the text that erase upright quarters.

Before we get into this too far, I want to clean up the presentation in the published proof.  When the upright quarters do not mask any flat quarters, then we follow the terminology of the published proof for what it means to erase upright quarters.  When the anchored simplices around an upright diagonal mask flat quarters $Q_1,\ldots,Q_r$, then we say that we can {\it expunge} the anchored simplices $S_1,\ldots,S_k$ with penalty $\pi_0$, if 
  $$
  \sum_{i=0}^k \sigma^*(S_i) - 4\delta_{oct}\op{vol}(\delta_P(v))
  < \pi_0 + \sum_{i=0}^k \op{s-vor}_0(S_i)
   +\sum_{i=0}^r (\op{mask}(Q_i) - \op{s-vor}_0(Q_i)).
  $$
We take $\sigma^*(S)$ to be $\sigma(S)$ when $S$ is an upright quarter; $\sigma(V_S(t_S))$ when it is a simplex of type $C$; and $\op{s-vor}_0(S)$ otherwise.
Here $\op{mask}(Q)$ is the following function on various domains (compare $\hat\sigma$ defined in Sec~11.10).  (Imagine each of the
cases as taking the value $-\infty$ outside
the constraint of the case constraint.)
  $$
  \op{mask} = \op{max}
  \begin{cases}
  \Gamma{}{},   & \eta_{234},\eta_{456}\le \sqrt2\\
  \op{s-vor}, & \eta_{234}\ge \sqrt2\\
  \op{s-vor}_0 - 0.0063, & y_4\ge 2.6, y_1\ge 2.2\\
  \op{s-vor}_0 - 0.0114, & y_4 \ge 2.7\\
  \op{bound}_{456}, & \eta_{456}\ge \sqrt2.\\
  \end{cases}
  $$
where
  $$
  \op{bound}_{456}(Q) = \min
  \begin{cases}
  \op{s-vor}_0(Q) &\\
  Z(3,1) &\\
  \op{sol}(Q)\zeta\,\op{pt} - D(3,1).&\\
  \end{cases}
  $$
The function $\op{mask}(Q)$ assembles all the the estimates ever used
on a masked flat quarter.
When we merely erase rather than expunge, the sum over $r$ is absent. Compare p.112, Section~11.1.
If there are no masked flat quarters,  there is no distinction between erasing and expunging.   In general, we try to expunge rather than just erase.

\begin{lemma}
{\it We can always expunge $3$-crowded configurations.}  
\end{lemma}

\begin{proof}
To expunge,
we need a new inequality for upright quarters of compression type:
   $$
   \Gamma(S) < \op{octavor}_0(S) + 0.5\,\op{dih}(S) - 0.54125.
   \qquad \text{\sc(HYPOTHESIS I\_9467217686)}
   $$
Case 1: Assume first that there is no masked quarter.
When all three upright quarters have compression type, we use
$\sum_{(3)} \op{dih}(S) \le \pi$ to get
   $$\sum_{(3)}(\sigma-\op{vor}_0) < 
      [0.5\pi - 3 (0.54125)] < 0.$$
When one of the three uprights has Voronoi type, we use
  $$\sum_{(3)}(\sigma - \op{vor}_0 ) <
    (0.5(\pi - 0.956_{\text{dih min}}) - 2(0.54125)) 
    - 0.02274_{\kappa}
    + \xi_V < 0.$$
When two or three uprights have Voronoi type, then we use
   $$\sum_{(3)}(\sigma - \op{vor}_0 ) <
   \xi_\Gamma + 2\xi_V -0.02274 < 0.$$
Case 2: Assume that there is masked flat quarter.  Then there
is exactly one and the upright diagonal is not enclosed over it.
The proof of Lemma~11.23 (page 121) applies to this situation
to show that we can expunge the $3$-crowded upright diagonal.
\end{proof}

Note that by expunging the $3$-crowded upright diagonal, we
no longer need the argument of page 117 that follows the statement of Lemma~11.9.  Also, Lemma~11.12 is no longer needed on page 118.
In particular, the interval calculations 855294746 that use truncation at $\sqrt2$ are no longer needed.  We no longer
need Lemma~11.10 that states all the anchored simplices are
quarters.

\begin{lemma}
We can always expunge an upright diagonal that is enclosed
over a masked flat quarter in an exceptional region, except possibly a loop with three quarters and one other anchored simplex with $y_4\in (2.51,2.91)$.
\end{lemma}

\begin{proof}
  (Since one of the cases of
the function $\op{mask}(Q)$ is $\op{s-vor}_0$, when
$\eta_{456}\ge\sqrt2$, in this situation there is no difference between erasing and expunging.) Let $\{0,v\}$ be the upright
diagonal.  Let $\{0,v_1,v_2,v_3\}$ be the flat quarter, with
diagonal $\{v_1,v_3\}$.  If $|v-v_2|>2t_0$, then geometric
considerations show that the upright diagonal is not in the
$Q$-system.  (It is part of an isolated quarter, or inside
a quad.)  So we have $|v-v_2|\le 2t_0$.  We are in the situation of
$\op{bound}_{456}$ ($\eta_{456}\ge0$).  
Lemma~11.27 (page 124) and the estimates
of Inequality~13.1 (page 147) and~13.2 (page 148)
prove the the two upright quarters with anchor $v_2$ can
be erased.  In the case that there are three anchors to the upright diagonal, the proof is now complete.  In the remaining case, by Corollary~11.25, 11.17, there are four anchors, forming a loop (with four anchored simplices).  Moreover, at least three of the anchored simplices are upright quarters.  We use the following
calculation: if an anchored simplex has $y_4\in [2.91,3.2]$, then
\begin{equation}\label{eqn:0201}
 \kappa < -0.0201\qquad\text{(HYPOTHESIS I\_1427782443)}.
\end{equation}
If an anchored simplex
in the loop has $y_4> 2.91$, then we expunge the two upright quarters with anchor $v_2$ as described above. The third quarter and
anchored simplex give
  $\xi_V - 0.0201_\kappa < 0$.
Also, the ``masked''
anchored simplex $S=\{0,v,v_1,v_3\}$ satisfies $\op{s-vor}_0(S) <0$
(because there are no quoins and $\phi(1,t_0)<0$).
Hence the upright diagonal can be expunged.
\end{proof}


\begin{lemma}
We can always expunge in the cases with fewer than four or more than five anchors.
\end{lemma}

\begin{proof}
Expunge context $(2,1)$ as in Section~11.2.  Expunge contexts $(3,1)$ and $(3,2)$
as in Section~11.3 (or Lemma~11.26 if there is a masked flat
quarter).  Section~11.4 shows that six or more anchors do not
occur in a contravening star.  
\end{proof}

\subsection{five anchors}

We review the results on five anchors. 
Lemmas~11.4, 11.5 show that in the five anchored situation there is at most one large gap in a contravening star.  When there is one large gap (Lemma~11.18), the four anchored simplices are all upright quarters. If the five anchors form a loop, the parameters are $(n,k)=(5,0)$ or $(5,1)$.  (The proof that we are over target in cases $(5,\ge2)$ relies on drawing an edge of length up to length $3.2$.  However, since this immediately puts the figure over target, so that the deformation argument is not needed, and there is no need to restrict to lengths $\le 2.91$.) Also, in the case $(5,0)$, the standard region is a polygon to begin with and no deformation is required.  Thus, the only two cases in which the deformation argument is relevant are one large gap (OLGA5) and a loop (L51) with parameters $(5,1)$.

(OLGA5) When there is one large gap five anchors, we have estimates of the score and squander
from Lemmas~11.18 and Lemmas~11.19.  In particular, the material from the upright diagonal squanders at least 
  $$(0.4 + 0.02274) > \op{squander-target}/2.$$  We can expunge with penalty
  $$\max \left(\begin{array}{lll}
  3\xi_\Gamma + \xi_{\kappa,\Gamma}\\
  2\xi_\Gamma + 0.0114 - 0.02274_\kappa\\
  2 (0.0114) - 0.02274_\kappa\\
  \end{array}
   \right)\le 0.03344 < 3\xi_\Gamma.$$
  
(L51) When there is a loop $(n,k)=(5,1)$, 
the material from the loop satisfies by the table
of page 155
  $$
  \tau > 0.5941 > \op{squander-target}/2,\quad \sigma < -0.376.
  $$
When the upright diagonal has height $h$, and there exists an anchored simplex
with $y_4 > 2.91$, we can expunge with penalty
  $$
  \begin{cases}
  2 \max(2\xi'_\Gamma,0.0114+2\xi_V) < 3\xi_\Gamma, & h \ge 2.57\\
  2 \max(2\xi_\Gamma,0.0114+2\xi_V) - 0.0201_\kappa < 3 \xi_\Gamma, & h < 2.57\\
  \end{cases}
  $$
Write L51e for a loop 51 with some $y_4 > 2.91$ and L51s, otherwise.

\subsection{four anchors}
We review four anchors.
Lemma~11.21 treats two large gaps.  If there is one large gap and a masked flat, then it can be expunged (Lemma~11.23).  If there
is no masked flat (OLGA4), 
the anchored simplices can be erased with penalty $0.008$ (or even $0.0022$ if some anchored simplex is not a quarter) by Lemma~11.23.  For loops, the context $(n,k)=(4,0)$
is not relevant for deformation, because it is a quad cluster.  This leaves contexts $(4,1)$, $(4,2)$, $(4,3)$, described on page 155. 

(L43) We can expunge an $(n,k)=(4,3)$ loop if there is an anchored simplex with $y_4\ge 2.91$.  (There is no masked quarter and no distinction between erasing and expunging.)  We use Equation~\ref{eqn:0201} and $\xi_\Gamma - 0.0201 < 0$.  So on a $(4,3)$ loop we may assume that the anchored simplices satisfy $y_4 < 2.91$.

(L42) Consider an $(n,k)=(4,2)$ loop when there is an anchored simplex with $y_4\ge 2.91$.  
If there is a masked flat (wlog we can take the diagonal not to be enclosed, since we have treated enclosed already),  we can expunge the diagonal $2\xi_V - 0.0201_\kappa < \min(-0.0063,-0.0114)$.  If the height of the diagonal satisfies $y_1\ge 2.57$, we can erase: $2\xi_V - 0.0201_\kappa < 0$.  We introduce the following
hypothesis on anchored simplices with $y_1 \le 2.57$ and $y_4 \ge 2.91$:
  \begin{equation}
  \kappa(S) < - 0.022\qquad\text{(HYPOTHESIS I\_8220246614)}
  \end{equation}
Also, if $2.57\le y_1\le\sqrt8$ and $y_4\ge 2.91$, then
  \begin{equation}
  \kappa(S) < - 0.03\qquad\text{(HYPOTHESIS I\_2333917810)}
  \end{equation}
(These are stronger inequalities than the hypthesis Equation~\ref{eqn:0201} mentioned earlier, so a separate proof of the earlier inequality is not needed.)
Then the material squandered around the loop is, by the chart of page 155, at least 
  $$
  0.3992 + 0.022_\kappa > \op{squander-target}/2.
  $$
We can expunge with penalty $\max(2\xi_\Gamma,0.0114+2\xi_V)$.
Write L42s for a loop 42 such that all $y_4\le 2.91$ and $L42e$ for a loop
42 such that some $y_4>2.91$.

  
(L41) Consider an $(n,k)=(4,1)$ loop when there is an anchored simplex with $y_4\ge 2.91$ and the upright diagonal has height at least $2.57$.  If there is a masked
flat quarter, we may assume that the diagonal is not enclosed (that case
has been treated above).  It can be expunged: $$-0.03_\kappa + \xi'_\Gamma + 2\xi_V < \min(-0.0063,-0.0114).$$  If there is no masked flat quarter, it can
still be expunged (erased):  $3\xi'_\Gamma - 0.03_\kappa < 0$.  What remains are loops L41 with $y_4\le 2.91$ or diagonal height at most $2.57$.

(L41e257) consider an $(n,k)=(4,1)$ loop with $y_4>2.91$ for some anchored simplex $S_0$ and diagonal
height at most $2.57$.  (Call these L41e257.)  
\begin{lemma}
If the dihedral angle of $S_0$ is at least $2\pi - 3.3$, and if $\kappa(S_0)< -2\xi_\Gamma$
then the loop can be expunged.
\end{lemma}
\begin{proof}
Note that in this context there is not a masked flat with enclosed diagonal, because $\pi + 0.956 > 3.3$.  If there is a masked flat
we can expunge: $-0.029 + \xi_\Gamma < -0.0114$.  We follow Case~1 of the argument used to expunge $3$-crowded configurations. 
When all three upright quarters have compression type, we use
$\sum_{(3)} \op{dih}(S) \le 3.3$ to get
   $$\kappa(S_0) + \sum_{(3)}(\sigma-\op{vor}_0) < 
      - 2\xi_\Gamma + [0.5 (3.3) - 3 (0.54125)] < 0.$$
When one or more of the three uprights have Voronoi type, we use
  $$\kappa(S_0) + \sum_{(3)}(\sigma - \op{vor}_0 ) <
    -2 \xi_\Gamma
    +2 \xi_\Gamma
     =0.$$
\end{proof}
Assume that all loops satisfying these conditions have been expunged.



There is at most one of OLGA5, L51e, L42e because any two add up to more
than the squander target.  We can expunge the OLGA5, L51e, or L42e together
with all the OLGA4's with penalty at most $\pi_{max}=0.06688$ (Lemma~12.6 continues
to hold in this slightly modified situation.)  When we expunge all this,
we are only left with loops such that every $y_4\le 2.91$ (call these constricted loops) and with loops L41
with diagonal height at most 2.57.    We subdivide the subregions first with
distinguished edges of length at most $2\sqrt2$, then out to $2.91$ (provided
that it doesn't form a special simplex and provided the edge doesn't cross another distinguished edge).  Doing this separates off all the
constricted loops.  

As in DCG, we work with a single standard region, 
removing all vertices and edges
external to the region.

\subsection{deformation argument}

It is in this setting that we finally apply the reduction to polygon argument of
Section~12.7.  The deformation should move rigidly all the anchored simplices around each L41e257.  
The stopping condition for the deformations is any of the three
following.  (A) A new edge develops of length $\le2.91$ between two vertices
of height $\le 2.51$ such that (a1) does not cross any other such edge or anchor and such that (a2) is not a special diagonal.  (B) An upright diagonal in a L41e257 acquires a new anchor
(with distance exactly $2t_0$ to the top of the diagonal).  (C) The distance
between tops of upright diagonals becomes $2$.  In general, there
may be several connected components of the boundary of the subregion.
When a stopping condition brings two components together, other deformation is carried out bringing other components components together until stopping
conditions are reached for each component.  Similar remarks apply
to single components whose boundaries are not simple.

\begin{lemma}
We claim edges of types $A,B,C$ do not cross.
\end{lemma}

\begin{proof}
The proof goes as follows.
By assumption edges of type $A$ do not cross one another.
There is no $CC$, $BC$, or $BB$ crossing by geometric considerations:
   $$
   \begin{array}{lll}
   \mc{E}(2,2,2,2.57,2.57,2,2,2,2) &> 2.86 > \sqrt8.\\
   \mc{E}(2,2,2,2.57,2.51,2.51,2,2,2) &> 2.73 > 2.51.\\
   \end{array}
   $$
An $A$ edge does not cross over a $B$ or $C$ edge by geometric considerations:
   $$
   \mc{E}(2,2,2,2.51,2.91,2.51,2,2,2) > 2.51.
   $$
In a crossing of an edge of type $A$ under an edge of type $C$, we
may assume that some endpoint of the $A$-edge has distance at least $2.51$
from some endpoint of the $C$-edge.  (Otherwise, the stopping condition
is already met with $B$-edges before the $A$-edge had a chance to form.)
This $AC$-crossing cannot form by geometric considerations:
   $$
   \mc{E}(2,2,2,2.57,2.57,2,2.51,2,2) > 2.91.
   $$
Similar remarks apply for an $A$ under $B$ crossing.  We may assume that
the distance from the anchor to an endpoint of $A$ is at least $\sqrt8$
or that the distance from the top of the upright diagonal to $A$ is
at least $2.51$.  Otherwise the stopping conditions prevent the formation.
We have
   $$
   \begin{array}{lll}
   \mc{E}(2,2,2,2.57,2.51,2.51,\sqrt8,2,2) > 2.91\\
   \mc{E}(2,2,2,2.57,2.51,2.51,2,2.51,2) > 2.91\\
   \end{array}
   $$
This completes the proof of the claim.
\end{proof}

Recall that by Corollary~11.6, a vertex of height at most $2t_0$ is
never enclosed over an anchored simplex.  We can also assert that
a vertex of height at most $2.57$ is never enclosed over an anchored
simplex.  In fact, if this occurs, in view of what has been expunged,
the vertex is part of a L41e257.  In view of the results on the non-crossing
of edges, an anchor of that loop  would also be enclosed over the
anchored simplex, which is impossible by Corollary~11.6.

\begin{lemma}
We claim that the stopping condition with type
$B$ edges never occurs.
\end{lemma}

\begin{proof}
Let $\{0,v\}$ be the upright diagonal, and let $\{v_1,\ldots,v_4\}$ be the anchors.  let $v_0$ be a new anchor that forms, say between $v_1$ and $v_4$.  If $|v_0-v_1|< 3.2$ and $|v_0-v_4|<3.2$, then we have distinguished edges $\{v_0,v_1\}$ and $\{v_0,v_4\}$.  This makes $v_0$ rigidly attached to the other anchors, so that the deformation cannot have occurred.  Thus, we may assume that $|v_0-v_1|\ge 3.2$.  This is an impossible geometric situation.  In fact, geometric considerations show we cannot simultaneously have
  $$
  \op{dih}(0,v,v_1,v_0) + \op{dih}(0,v,v_0,v_4)\le 3.0
  $$
and $\{v_4,v_1\}$ has length at most $3.2$ and passes through $\{0,v,v_0\}$.  

We add a few details.  Recall, we have expunged loops L41e257 in which there is an anchored simplex with $y_4\ge 2.91$, $\kappa(S)<-2\xi_\Gamma$ and $\op{dih}(S)\ge 2\pi-3.3$.  The new anchor (from type B) breaks the slice into two
pieces.  
In this situation, we have that $\kappa = \kappa_1 + \kappa_2$, where $\kappa_1 < -0.029$ as usual.  Assume that
$y_1\in[2.51,2.57]$, $y_4\in[2,2.51]$, $y_5=2.51$, then (compare $(y_1,\ldots,y_6) = (2.51,2,2.51,2,2.51,2)$: 
   $$\kappa_2 =\kappa(S_2) < -2\xi_\Gamma + 0.029.\qquad 
      \text{(HYPOTHESIS I\_6863978831)}$$
So $\kappa < -2\xi_\Gamma$.  We may then assume that on an unexpunged
loop, we have $\op{dih}(S)\le 2\pi-3.3\approx 2.98319 < 3.0 - 2(0.0084)$.
So the result follows from the calculations on the given domain:
    $$
    \begin{array}{lllll}
    \op{dih}(y_1,\ldots,y_6) > \op{dih}(2.51,2.51,y_3,y_4,y_5,2.51) - 0.0084&\\
    \Delta(2.51^2,x_2,x_3,3.2^2,x_5,x_6) &\ge 0 \\ \quad \Rightarrow 
    \op{dih}(2.51,2.51,y_3,2,y_5,2.51) + \op{dih}(2.51,y_2,2.51,3.2,2.51,y_6) &\ge 3.0\\
    \text{(HYPOTHESES I\_6410186704, I\_3008133607, I\_5617427593)}
    \end{array} 
    $$
\end{proof}

\begin{lemma}
We claim that the stopping condition with type $C$ edges never
occurs.
\end{lemma}

\begin{proof}
Assume to the contrary that such an edge forms.
Let $\{0,v\}$ and $\{0,w\}$ be the upright diagonals of height at most
$2.57$.  let $v_1,\ldots,v_r$ be the anchors of $\{0,v\}$.  By argument on $B$-edges in the previous
paragraph, we may assume that $r=4$, the number of anchors in a L41e257 loop.  Order the anchors so
that the edge $C$ between $v$ and $w$ appears
between $v_1$ and $v_4$.  We claim that the
conditions $|w-v_1|\ge 2.51$ and $|w-v_4|\ge 2.51$ cannot
both hold for geometric reasons.
Otherwise we have a configuration $\{0,v,w,v_1,v_4\}$ with the edge $\{v_1,v_4\}$ passing through $\{0,v,w\}$ and $|v_1-v_4|\le 3.2$.  Geometric considerations show that this cannot happen.  At the other extreme, if $|w-v_1|<2.51$ and $|w-v_4|<2.51$, then $v_1,v_4$ are anchors of $w$.  This is a rigid situation that could not have been deformed; so it never arises.  

Thus, we have (say) $|w-v_1|<2.51$ and $|w-v_4|\ge 2.51$.  Let $w_4$ be the anchor of $w$ following $v_1$ in the cyclic order around $w$.
We have a configuration of six point $\{0,v,w,v_1,v_4,w_4\}$.  The edges $\{v_1,v_4\}$ and $\{v_1,w_4\}$ pass through $\{0,v,w\}$ and have length at most $3.2$.  If the distance $|v_4-w_4|<\sqrt8$, then we have a distinguished edge $(v_4,w_4)$.  This creates a rigid configuration that admits no deformation.  So it could not have occurred.  We may assume that $|v_4-w_4|\ge 3.2$.  Then a calculation shows $\op{dih}(0,v_1,w_4,v_4) > 1.2$ (HYPOTHESIS I\_2377396571).    Another calculation shows that
$\op{dih}(0,v_1,w,v) < 1.2$ (HYPOTHESIS I\_3656545285).  However, this is a contradiction, because
  $$
  \op{dih}(0,v_1,w,v)+\op{dih}(0,v_1,w_4) + \op{dih}(0,v_1,v,v_4) = \op{dih}(0,v,v_4,w_4).
  $$
This completes the proof that the $C$ edge cannot form.
\end{proof}



Thus, deformation only creates new $A$ edges.  We continue deformations until each polygon is simple.  Then we continue in DCG as before.  We add additional edges up to length $3.2$; break off L41e257 loops; and obtain estimates as in DCG.


%\twocolumn
\parskip=0.2\baselineskip
\section{Errata}


\subsection{Relation between the Abridged and Unabridged Versions}

The abridged version of the Kepler conjecture
in the Annals \cite{Hales:2005:Annals}
was generated by the same tex
files as the unabridged version in \cite{Hales:2006:DCG}.

Because of the way these documents were produced
from the same tex files,
it seems that nearly every correction to
the abridged version will also be a correction to the unabridged version.
We list the errata for the
unabridged version. The same list applies to corresponding 
passages in the abridged version.  


\subsection{Format}

Each correction gives its location in \cite{Hales:2006:DCG}.
The location
\line+n counts down from the top of the page, or
if a section or lemma number is provided, it
counts from the top of that organizational unit.
The location \line-n counts up from the bottom
of the page. Footnotes are not included in the
count from the bottom.  Every line containing
text of any sort is included in the count,
including displayed equations, section headings,
and so forth.  The material to the left of $\lto$ 
indicates original text, and material to the right of the
arrow gives replacement text.  Text in italic provides
comments about the corrections.


\subsection{Code}

In addition to the corrections to the text mentioned below, 
there have been some corrections to the computer code.
This includes code in Java, Mathematica, Objective CAML, and C++.
They are described in detail elsewhere \cite{Hales:2008:Errata}.


\subsection{Listing}

[p.47,Lemma~5.16] $Q\lto F$

[p.49,\line+2] supposed \lto suppose
	
[p.63,Lemma~7.10]
	${\mathcal S}$-system \lto $Q$-system
	
[p.73][p.124] Some applications of Theorem~8.4 rely on
the proof of the theorem, which is more general than
the statement of the theorem.  

[p.75,Remark~8.11]
	show\lto shows

[p.78,\line-7] constraints \lto constraint

[p.86,\line+14] Let $\{0,v\}$ be 
          the diagonal of an upright quarter in the $Q$-system
        \lto
       Let $v$ be a vertex with $2t_0<|v|<\sqrt8$.
	
          Remark: Section~9 assumes that the diagonal belongs to
          a quarter in the $Q$-system, but Lemma~10.14 uses these
          results when $\{0,v\}$ has $0$ or $1$ anchors.  To make
          this coherent, we should assume throughout Section~9 that
          we have the weaker condition that whenever $\{0,v\}$ has
          two or more anchors it belongs to a quarter in the $Q$-system.
          The proofs of Section~9 all go through in this context.
          (Lemma~9.7 is all that is relevant here.)

[p.87,Definition~9.3]
	In definition of $\Delta(v,W^e)$, we
	can have some $Q$ (as in Fig~9.1)
	with negative orientation.
	In this case, $E_v\cap E_i$ can clip
	the other side.  We want the object
	without clipping, so the definition must
	be modified slightly to reflect this.
	
[p.88,Definition~9.6]
	The definition is poorly worded.  First of
	all, it requires that the subscript to
	$\epsilon$ should be a vertex, but then in
	the displayed equation, it makes $w/2$ the
	subscript, which needn't be a vertex.  To
	define $\epsilon'$, move from $w/2$ along
	the ray through $x'$ until an edge of the
	Voronoi cell is encountered.  If $v,w,u$
	are the three vertices defining that edge,
	then set $\epsilon'_v(\Lambda,x)=u$.
	Degenerate cases, such as when two different
	edges are encountered at the same time,
	can be resolved in any reasonable fashion.
	
[p.88,Lemma~9.7,\line+2] 
	$w$\text{ and } $v$\lto $w$ \text{ and } $u$

	
[p.88,L.~9.7,Claim~1]
	\text{ with } $|w - w'|\le 2t_0$, \text{ and }
	\lto \text{ with }

	
[p.88,L.~9.7,\line+5]
         Then: $\lto$ Let
          $
          R'_w = \{x\in R_w \cap(0,\{u,w\})\mid 
          \epsilon_0(x,\{u,w\}) = u.
          $
          Assume that $R'_w$ is not empty. Then:
         %{\it (This hypothesis is satisfied
        %in every application of Lemma~9.7.
        %We note that this forces the orientation of $\{0,v,w'\}$ to
        %be negative in $Q=\{0,v,w',u\}$, which in turn forces $Q$
        %to be a quarter.)}

[p88,L.~9.7,Claim~3]
        $R_w \lto R'_w$

[p.89,\line+2]
	$
	\{w,v\}\lto\{w,u\}
	$

[p.92,\line+16,\line+21]
   $     \max_j u_j \lto \max_j |u_j|$
	
[p.93,\line-4]
	$
	\text{obstructed from }w \lto
	\text{obstructed from }w'
	$
		
[p.93,\line-2]
	$
	\text{from some} \lto \text{for some}
	$

[p.99,\line+1]
        $
        \text{start} \lto \text{star}
        $

[p.105,Lemma~10.14]  In the proof of the cases involving
   $0$ or $1$ anchor, a combination of the decompositions from
   Section~8.4 and Section~9 are used.  These decompositions haven't
   been shown to be compatible.  
   FIX: It is better to combine
   $\Delta(v,W)$ with $t_0$-truncation on the rest of the quad-cluster.
   With a $t_0$ truncation, we no longer have the non-positivity results
   from Section~8.  (The quoins give a positive contribution.) However,
   I have checked that
   the estimate on $\Delta(v,W)$ is sufficiently small that we still
   obtain a constant less than $-1.04\,\op{pt}$.
   

[p.116][p.121] Definition~11.7 allows masked
flat in definition of $3$-unconfined.
Definition~11.24 requires no masked flats
in the same definition.  FIX: Use Definition~11.24 (no masked flats).  Where masked flats occur,
treat them with Lemma~11.23, parts (1) and (2).

[p.116,\line+1] 
	$
	\text{Lemma}~4.16 \lto \text{Lemma}~4.17
	$

[p.117,before Lemma~11.9]
	$
	\text{two others} \lto \text{three others}
	$
	
[p.117,Def~11.8]
    $
    y1 \lto y_1
    $
    
 
[p.119,Definition~11.5]  By definition, we require a masked flat quarter to
be a strict quarter. 
	
[p.121] See p.116.

[p.121,\line-5]
	$
	0.2274 \lto 0.02274
	$
	
[p.123. flat case (2)]  It is missing
isolated quarters cut from the side.
To fix this, in condition 2(f), 
	$
	\eta_{456}\ge\sqrt2 \lto
	\eta_{456}\ge\sqrt2 \text{ or } \eta_{234}\ge\sqrt2.
	$
	
[p.124] See p.73.
	
[p.126]  Theorem~12.1 needs to be stated in
a form that allows the application in pp.251-252
and Lemma~13.5.  In these applications, the
regions are smaller than standard regions.
Yet in the statement of the theorem, the regions
are standard regions.  This is not a problem
in practice, because the proof is at a much
finer level of decomposition than standard regions.
However, the wording needs to be changed so
that the theorem applies precisely.

[p.126] 
Theorem~12.1 should include $\sigma_R(D)\le s_n$
with $s_3 = 1\,\op{pt}$ and $s_4=0$, and
$\tau_R(D) \ge t_3 = 0$.

[p.131] There is a long note in a separate section below about
the deformation arguments on this page.


[p.139,Lemma~12.18,proof,\line+3] 
	$C_0(|v|,\pi) \lto
	C_0^u(|v|,\pi)
	$
	
[p.139,Lemma~12.18] 
	$
	\tau_0(C_0^u(2t_0,\pi))-\pi_{\text{max}}\lto
	\tau_0(C_0^u(2.2,\pi))-\pi_{\text{max}}
	$

[p.144,\line+11,\line+17]
	$2t_0^2 \lto (2t_0)^2
	$

%c
[p.146]
		$S_n^\pm$ \lto
	of 3-crowded, 3-undefined, and
	4-crowded combinations

%c	
[p.148,Sect. 13.6]  This entire
section is misplaced.  It belongs with
Sections 25.5 and 25.6.

%c
[p.149,before 13.7]
the diagrams\lto
	Figs~25.1--25.4

%c	
[p.149,p.156] $\delta_{loop}$ is not defined.

[p.156,Lemma~13.5,\line+4]
	$$
	\begin{array}{lll}
	\text{respectively for }\tau_R(D)\lto\\
	\text{respectively, for }\sigma_R(D) \text{ and }
	\tau_R(D),  
	\end{array}
	$$

%c
[p.164,\line-1] 
	This shows$\ldots$ occur.
	\lto This completes the proof.


%c
[p.173,\line+4] {\it Insert the subscript on $b$,
as in Proposition~15.5, starting on page 173:}
   $b$ \lto $b_q$.



	
[p.182,Lemma~16.7]  I do not understand why
the bound holds on each half.  It seems that
the decomposition into the halves might not be
compatible with the geometry: cone or quoin
terms might ``cross over'' into the other half.
At any rate, it is not a direct consequence
of Theorem~8.4.

Proposed fix: Show by an interval arithmetic
calculation that each side separately satisfies
that bound $0$ if each vertex has height at most $2.3$ (HYPOTHESIS I\_5127197465).
If any vertex has height greater than $2.3$ show that the $\op{vor}_0$-scored quad cluster scores
less than $-1.04\,\op{pt}$.  For this, we may use the deformations of Lemmas~12.10 and 13.1.  We may also use calculation I\_474496219, which shows that if the diagonal reaches $2\sqrt2$, each half is at most $0.009$.  By these deformations and this calculation, the result now follows from calculation (HYPOTHESIS I\_7710172071).
%%XX
% Check in Mathematica NMaximize, so this is at least reasonable.

[p.241]  {\it `Mixed' is defined so as to include
the pure analytic case.  In earlier papers,
`mixed' excludes the pure analytic.  }
	$$
	\text{mixed}\lto\text{mixed or pure}
	$$
	
[p.243,\line+13,\line+14,\line+15]
	{\it Delete three sentences:}
	`Let $v_{12}$ be $\ldots$  We let $\ldots$
	 Break the pentagon $\ldots$'
	
[p.248,last displayed formula]  
	$=$ \lto $+$
{\it so that it reads}
	$$
	\sum_i f_{R_i}(D) \le \hat\sigma(Q_i) +
	\op{vor}_{R',0}(D) + \pi_R
	$$

[p.252,Sec.~25.7,Cases~2 and 3]  {\it `The flat quarter'
is mentioned, but there are no flat quarters
that have been introduced into the context.  
This passage
has been moved by a cut-and-paste edit to a
place it does not belong.}

[p.254,\line+7]
to branch combine \lto to combine

Please report further errors to
Thomas C. Hales.

\bibliographystyle{abbrv}
\bibliography{all}

\bigskip
\svninfo






\end{document}
