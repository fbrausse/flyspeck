
let KY_CHEAT_TAC = MP_TAC (mk_fthm([],`F`)) THEN MESON_TAC[];;

let gamma_y_pos_le = prove (
  `!V X e. packing V /\ saturated V /\ mcell_set V X /\ edgeX V X e
                        ==> &0 <= gammaY V X lmfun e`, KY_CHEAT_TAC);;

(* Begin to prove KIZHLTL4 *)
(* ========================================================================== *)
(*                                                                            *)                                                                       
(*    #use "/home/ky/flyspeck/working/marchal_cells_3.hl";;                   *)
(*    #use "/home/ky/flyspeck/working/empty.hl";;                             *)
(*                                                                            *)                                                                       
(* ========================================================================== *)

let BETA_SET_2_THM = prove
 (`!g:(A->bool)->B u0 v0. (\({u, v}). g {u, v}) {u0, v0} = g {u0, v0}`,
 GEN_TAC THEN REWRITE_TAC[GABS_DEF;GEQ_DEF] THEN
 CONV_TAC SELECT_CONV THEN EXISTS_TAC `g:(A->bool)->B` THEN
 REWRITE_TAC[]);;

(* ========================================================================== *)

let KIZHLTL4_concl = 
  `!V. ?c. !r. saturated V /\ packing V /\ &1 <= r
               ==> (&8 * mm2 / pi) *
                   sum {X | X SUBSET ball (vec 0,r) /\ mcell_set V X}
                   (\X. sum (edgeX V X)
                        (\({u, v}). if {u, v} IN edgeX V X
                                    then dihX V X (u,v) * lmfun (hl [u; v])
                                    else &0)) +
                   c * r pow 2 <=
                   &8 *
                   mm2 *
                   sum (V INTER ball (vec 0,r))
                   (\u. sum {v | v IN V /\ ~(u = v) /\ dist (u,v) <= &2 * h0}
                        (\v. lmfun (hl [u; v])))`;;

(* ========================================================================== *)

g KIZHLTL4_concl;;
e (REPEAT STRIP_TAC);;
e (ASM_CASES_TAC `saturated V /\ packing V`);;
e (ABBREV_TAC `c = &8 * mm2 * d`);;
e (EXISTS_TAC `c:real`);;  (* choose c later *)

(* ------------------------------------------------------------------------- *)

e (REPEAT STRIP_TAC);;
e (ABBREV_TAC `S1 = {X | X SUBSET ball (vec 0,r) /\ mcell_set V X}`);;
e (ABBREV_TAC `V1:real^3->bool = V INTER ball (vec 0, r)`);;
e (ABBREV_TAC `T1 = {{u,v:real^3} | u IN V1 /\ v IN V1}`);;

e (NEW_GOAL `FINITE (S1:(real^3->bool)->bool)`);;
e (EXPAND_TAC "S1");;
e (ASM_SIMP_TAC[FINITE_MCELL_SET_LEMMA]);;

e (NEW_GOAL `FINITE (T1:(real^3->bool)->bool)`);;
e (EXPAND_TAC "T1");;
e (REWRITE_TAC[GSYM set_of_list]);;
e (MATCH_MP_TAC FINITE_SUBSET);;
e (EXISTS_TAC `IMAGE (set_of_list) {[u; v:real^3] | u IN V1 /\ v IN V1}`);;
e (STRIP_TAC);;
e (MATCH_MP_TAC FINITE_IMAGE);;
e (REWRITE_TAC[SET_RULE `{[u;v] | u IN s /\ v IN s} = 
                         {y | ?u0 u1. u0 IN s /\ u1 IN s /\ y = [u0; u1]}`]);;
e (MATCH_MP_TAC FINITE_LIST_KY_LEMMA_2);;
e (EXPAND_TAC "V1" THEN MATCH_MP_TAC Packing3.KIUMVTC);;
e (ASM_REWRITE_TAC[]);;
e (SET_TAC[]);;

e (ABBREV_TAC 
   `S2 = {X | X SUBSET ball (vec 0,r) /\ mcell_set V X /\ ~NULLSET X}`);;
e (NEW_GOAL `FINITE (S2:(real^3->bool)->bool)`);;
e (MATCH_MP_TAC FINITE_SUBSET);;
e (EXISTS_TAC `S1:(real^3->bool)->bool`);;
e (ASM_REWRITE_TAC[]);;
e (EXPAND_TAC "S1" THEN EXPAND_TAC "S2" THEN SET_TAC[]);;

e (ABBREV_TAC `g = (\X. (\({u, v}). 
                            if {u, v} IN edgeX V X
                            then dihX V X (u,v) * lmfun (hl [u; v])
                            else &0))`);;
e (REWRITE_WITH 
`sum S1  (\X. sum (edgeX V X)
                 (\({u, v}). if {u, v} IN edgeX V X
                             then dihX V X (u,v) * lmfun (hl [u; v])
                             else &0)) = 
 sum S1 (\X. sum (edgeX V X) (\({u, v}). g X {u,v}))`);;
e (MATCH_MP_TAC SUM_EQ);;

e (EXPAND_TAC "S1" THEN REWRITE_TAC[IN_ELIM_THM; IN; mcell_set_2]);;
e (REPEAT STRIP_TAC);;
e (MATCH_MP_TAC SUM_EQ);;
e (REWRITE_WITH `!x'. x' IN edgeX V x <=> 
                      ?u v. VX V x u /\ VX V x v /\ ~(u = v) /\ x' = {u, v}`);;
e (REWRITE_TAC[IN; IN_ELIM_THM; edgeX]);;
e (MESON_TAC[]);;
e (REPEAT STRIP_TAC);;

e (ABBREV_TAC `f_temp = (\u v. if edgeX V x {u, v}
             then dihX V x (u,v) * lmfun (hl [u; v])
             else &0)`);;
e (NEW_GOAL `!u v. (f_temp:real^3->real^3->real) u v = f_temp v u`);;
e (EXPAND_TAC "f_temp" THEN REWRITE_TAC[BETA_THM]);;
e (REWRITE_TAC[HL; set_of_list; SET_RULE `{a,b} = {b,a}`]);;
e (REPEAT GEN_TAC THEN COND_CASES_TAC);;
e (COND_CASES_TAC);;
e (REWRITE_WITH `dihX V x (u',v') = dihX V x (v',u')`);;
e (MATCH_MP_TAC DIHX_SYM);;
e (ASM_REWRITE_TAC[IN; mcell_set; IN_ELIM_THM]);;
e (EXISTS_TAC `i:num` THEN EXISTS_TAC `ul:(real^3)list` THEN ASM_REWRITE_TAC[]);;
e (UP_ASM_TAC THEN MESON_TAC[]);;
e (COND_CASES_TAC);;
e (UP_ASM_TAC THEN MESON_TAC[]);;
e (REFL_TAC);;

e (REWRITE_WITH `(\({u, v}). if edgeX V x {u, v}
             then dihX V x (u,v) * lmfun (hl [u; v])
             else &0) = (\({u, v}). f_temp u v)`);;
e (EXPAND_TAC "f_temp");;
e (REWRITE_TAC[]);;

e (REWRITE_TAC[BETA_SET_2_THM; ASSUME `x' = {u,v:real^3}`]);;
e (REWRITE_WITH `(\({u, v}). f_temp u v) {u, v} = 
                             (f_temp:real^3->real^3->real) u v`);;
e (MATCH_MP_TAC BETA_PAIR_THM);;
e (ASM_REWRITE_TAC[]);;

e (REWRITE_WITH `(g:(real^3->bool)->(real^3->bool)->real) x = 
                 (\({u, v}). f_temp u v)`);;
e (EXPAND_TAC "f_temp" THEN EXPAND_TAC "g" THEN REWRITE_TAC[IN]);;
e (ONCE_REWRITE_TAC[EQ_SYM_EQ]);;
e (MATCH_MP_TAC BETA_PAIR_THM);;
e (ASM_REWRITE_TAC[]);;

(* ----------------------------------------------------------------------- *)

e (REWRITE_WITH `sum S1 (\X. sum (edgeX V X) (\({u, v}). g X {u, v})) = 
                 sum S1 (\X. sum (edgeX V X)  (g X))`);;
e (MATCH_MP_TAC SUM_EQ);;
e (REWRITE_TAC[] THEN REPEAT STRIP_TAC);;
e (MATCH_MP_TAC SUM_EQ);;
e (REWRITE_TAC[edgeX; IN; IN_ELIM_THM] THEN REPEAT STRIP_TAC);;
e (ASM_REWRITE_TAC[BETA_SET_2_THM]);;

e (REWRITE_WITH `sum S1 (\X. sum (edgeX V X) (g X)) = 
                 sum S2 (\X. sum (edgeX V X) (g X))`);;
e (MATCH_MP_TAC SUM_SUPERSET);;
e (STRIP_TAC);;
e (EXPAND_TAC "S1" THEN EXPAND_TAC "S2" THEN SET_TAC[]);;
e (EXPAND_TAC "S1" THEN EXPAND_TAC "S2" THEN REWRITE_TAC[IN; IN_ELIM_THM]);;
e (REPEAT STRIP_TAC);;
e (MATCH_MP_TAC SUM_EQ_0);;
e (REPEAT STRIP_TAC);;

e (ABBREV_TAC `f_temp = (\u v. if edgeX V x {u, v}
             then dihX V x (u,v) * lmfun (hl [u; v])
             else &0)`);;
e (NEW_GOAL `!u v. (f_temp:real^3->real^3->real) u v = f_temp v u`);;
e (EXPAND_TAC "f_temp" THEN REWRITE_TAC[BETA_THM]);;
e (REWRITE_TAC[HL; set_of_list; SET_RULE `{a,b} = {b,a}`]);;
e (REPEAT GEN_TAC THEN COND_CASES_TAC);;
e (COND_CASES_TAC);;
e (REWRITE_WITH `dihX V x (u,v) = dihX V x (v,u)`);;

e (MATCH_MP_TAC DIHX_SYM);;
e (ASM_REWRITE_TAC[IN; mcell_set; IN_ELIM_THM]);;
e (UP_ASM_TAC THEN MESON_TAC[]);;
e (COND_CASES_TAC);;
e (UP_ASM_TAC THEN MESON_TAC[]);;
e (REFL_TAC);;

e (REWRITE_WITH `(g:(real^3->bool)->(real^3->bool)->real) x = 
                 (\({u, v}). f_temp u v)`);;
e (EXPAND_TAC "f_temp" THEN EXPAND_TAC "g" THEN REWRITE_TAC[IN]);;
e (UNDISCH_TAC `x' IN edgeX V x` THEN REWRITE_TAC[IN;IN_ELIM_THM; edgeX]);;
e (STRIP_TAC);;
e (ASM_SIMP_TAC[BETA_PAIR_THM]);;
e (EXPAND_TAC "f_temp");;
e (COND_CASES_TAC);;
e (REWRITE_TAC[dihX]);;
e (COND_CASES_TAC);;
e (REAL_ARITH_TAC);;
e (NEW_GOAL `F`);;
e (ASM_MESON_TAC[]);;
e (UP_ASM_TAC THEN MESON_TAC[]);;
e (REFL_TAC);;

e (ABBREV_TAC `Q2 = {{u0, u1:real^3} | u0 IN V1 /\ u1 IN V1}`);;
e (NEW_GOAL `FINITE (Q2:(real^3->bool)->bool)`);;
e (EXPAND_TAC "Q2" THEN MATCH_MP_TAC FINITE_SET_PRODUCT_KY_LEMMA);;
e (EXPAND_TAC "V1" THEN MATCH_MP_TAC Pack2.KIUMVTC);;
e (ASM_REWRITE_TAC[]);;

e (REWRITE_WITH 
 `sum S2 (\X. sum (edgeX V X) (g X)) =
  sum S2 (\X. sum {e | e IN Q2 /\ edgeX V X e} (g X))`);;
e (MATCH_MP_TAC SUM_EQ);;
e (EXPAND_TAC "S2" THEN REWRITE_TAC[IN; IN_ELIM_THM]);;
e (REPEAT STRIP_TAC);;
e (AP_THM_TAC THEN AP_TERM_TAC);;
e (REWRITE_TAC[SET_RULE `a = b <=> b SUBSET a /\ a SUBSET b`]);;
e (STRIP_TAC);;
e (SET_TAC[]);;
e (REWRITE_TAC[SET_RULE `A SUBSET {y | T2 y /\ A y} <=> A SUBSET T2`]);;
e (EXPAND_TAC "Q2" THEN REWRITE_TAC[SUBSET; edgeX; IN; IN_ELIM_THM]);;
e (REPEAT STRIP_TAC);;
e (EXPAND_TAC "V1" THEN REWRITE_TAC[IN_ELIM_THM]);;
e (EXISTS_TAC `u:real^3` THEN EXISTS_TAC `v:real^3`);;
e (REWRITE_TAC[ASSUME `x' = {u, v:real^3}`; IN_INTER;
               MESON[IN] `V (x:real^3) <=> x IN V`]);;
e (NEW_GOAL `VX V x = V INTER x`);;
e (MATCH_MP_TAC Hdtfnfz.HDTFNFZ);;
e (UNDISCH_TAC `mcell_set V x` THEN REWRITE_TAC[mcell_set; IN; IN_ELIM_THM]);;
e (STRIP_TAC);;
e (EXISTS_TAC `ul:(real^3)list` THEN EXISTS_TAC `i:num`);;
e (ASM_REWRITE_TAC[]);;
e (ASM_SET_TAC[]);;

e (REWRITE_WITH 
  `sum S2 (\X. sum {e | e IN Q2 /\ edgeX V X e} (g X)) = 
   sum Q2 (\x. sum {X | X IN S2 /\ edgeX V X x} (\X. g X x))`);;
e (REWRITE_WITH 
  `sum S2 (\X. sum {e | e IN Q2 /\ edgeX V X e} (g X)) = 
   sum S2 (\X. sum {e | e IN Q2 /\ edgeX V X e} (\x.g X x))`);;
e (REWRITE_TAC[ETA_AX]);;
e (ASM_SIMP_TAC[SUM_SUM_RESTRICT]);;

e (ABBREV_TAC 
  `Q3 = {{u0:real^3, u1} | u0 IN V1 /\ u1 IN V1 /\ CARD {u0, u1} = 2}`);;
e (ABBREV_TAC 
  `Q4 = {{u0:real^3, u1} | u0 IN V1 /\ u1 IN V1 /\ CARD {u0, u1} = 2 /\
                           hl[u0;u1] < sqrt (&2)}`);;
e (NEW_GOAL `sum Q2 (\x. sum {X | X IN S2 /\ edgeX V X x} (\X. g X x)) = 
             sum Q3 (\x. sum {X | X IN S2 /\ edgeX V X x} (\X. g X x))`);;
e (MATCH_MP_TAC SUM_SUPERSET);;
e (EXPAND_TAC "Q2" THEN EXPAND_TAC "Q3" THEN REWRITE_TAC[IN; IN_ELIM_THM] THEN 
   REPEAT STRIP_TAC);;
e (SET_TAC[]);;
e (REWRITE_WITH `{X | S2 X /\ edgeX V X x} = {}`);;
e (MATCH_MP_TAC (SET_RULE `(!y. ~(y IN X)) ==> X = {}`));;

e (EXPAND_TAC "S2" THEN REWRITE_TAC[IN; IN_ELIM_THM; edgeX] THEN 
   REPEAT STRIP_TAC);;
e (UNDISCH_TAC `~(?u0:real^3 u1. 
                 (V1 u0 /\ V1 u1 /\ CARD {u0, u1} = 2) /\ x = {u0, u1})`);;
e (REWRITE_TAC[]);;
e (EXISTS_TAC `u:real^3` THEN EXISTS_TAC `v:real^3`);;
e (REPEAT STRIP_TAC);;
e (ASM_SET_TAC[]);;
e (ASM_SET_TAC[]);;
e (ASM_REWRITE_TAC[Geomdetail.CARD2]);;
e (UP_ASM_TAC THEN MESON_TAC[]);;
e (REWRITE_TAC[SUM_CLAUSES]);;

e (NEW_GOAL `sum Q3 (\x. sum {X | X IN S2 /\ edgeX V X x} (\X. g X x)) = 
             sum Q4 (\x. sum {X | X IN S2 /\ edgeX V X x} (\X. g X x))`);;
e (MATCH_MP_TAC SUM_SUPERSET);;
e (EXPAND_TAC "Q4" THEN EXPAND_TAC "Q3" THEN REWRITE_TAC[IN; IN_ELIM_THM] THEN 
   REPEAT STRIP_TAC);;
e (SET_TAC[]);;

e (REWRITE_WITH `{X | S2 X /\ edgeX V X x} = {}`);;
e (MATCH_MP_TAC (SET_RULE `(!y. ~(y IN X)) ==> X = {}`));;

e (EXPAND_TAC "S2" THEN REWRITE_TAC[IN; IN_ELIM_THM; edgeX] THEN 
   REPEAT STRIP_TAC);;
e (UNDISCH_TAC 
  `~(?u0:real^3 u1.
       (V1 u0 /\ V1 u1 /\ CARD {u0, u1} = 2 /\ hl [u0; u1] < sqrt (&2)) /\
        x = {u0, u1})`);;
e (REWRITE_TAC[]);;
e (EXISTS_TAC `u:real^3` THEN EXISTS_TAC `v:real^3`);;
e (REPEAT STRIP_TAC);;
e (ASM_SET_TAC[]);;
e (ASM_SET_TAC[]);;
e (ASM_REWRITE_TAC[Geomdetail.CARD2]);;


e (KY_CHEAT_TAC);;
   (* Easy nhung nen viet rieng 1 bo de khang dinh neu u v thuoc VX V X thi 
      hl [u;v] <= sqrt (&2)
   *)
e (UP_ASM_TAC THEN MESON_TAC[]);;
e (REWRITE_TAC[SUM_CLAUSES]);;

e (ASM_REWRITE_TAC[]);;

e (MATCH_MP_TAC (REAL_ARITH `(?b. a <= b /\ b + d <= e) ==> a + d <= e`));;
e (EXISTS_TAC `(&8 * mm2 / pi) *
     sum Q4 (\x. sum {X | mcell_set V X /\ x IN edgeX V X} (\X. g X x))`);;
e (STRIP_TAC);;
e (REWRITE_TAC[REAL_ARITH `a * b <= a * c <=> &0 <= a * (c - b)`]);;
e (MATCH_MP_TAC REAL_LE_MUL THEN STRIP_TAC);;
e (MATCH_MP_TAC REAL_LE_MUL THEN STRIP_TAC);;
e (REAL_ARITH_TAC);;
e (MATCH_MP_TAC REAL_LE_DIV THEN SIMP_TAC[ZERO_LE_MM2_LEMMA; PI_POS_LE]);;
e (REWRITE_TAC[REAL_ARITH `&0 <= a - b <=> b <= a`]);;
e (MATCH_MP_TAC SUM_LE THEN REPEAT STRIP_TAC);;
e (MATCH_MP_TAC FINITE_SUBSET);;
e (EXISTS_TAC `Q2:(real^3->bool)->bool`);;
e (ASM_REWRITE_TAC[] THEN ASM_SET_TAC[]);;
e (REWRITE_TAC[BETA_THM]);;
e (MATCH_MP_TAC SUM_SUBSET_SIMPLE);;

e (STRIP_TAC);;
e (REWRITE_TAC[IN] THEN MATCH_MP_TAC Marchal_cells_3.FINITE_EDGE_X2);;
e (UP_ASM_TAC THEN EXPAND_TAC "Q4" THEN REWRITE_TAC[IN; IN_ELIM_THM] 
   THEN STRIP_TAC);;
e (EXISTS_TAC `u0:real^3` THEN EXISTS_TAC `u1:real^3` THEN ASM_REWRITE_TAC[]);;
e (REPEAT STRIP_TAC);;

e (EXPAND_TAC "S2" THEN REWRITE_TAC[IN] THEN SET_TAC[]);;
e (REWRITE_TAC[BETA_THM]);;
e (REWRITE_WITH `g x' x = gammaY V x' lmfun x`);;
e (EXPAND_TAC "g" THEN REWRITE_TAC[gammaY]);;
e (MATCH_MP_TAC gamma_y_pos_le);;

e (UP_ASM_TAC THEN ASM_REWRITE_TAC[IN_DIFF; IN; IN_ELIM_THM]);;
e (MESON_TAC[]);;
e (REWRITE_WITH 
  `sum Q4 (\x. sum {X | mcell_set V X /\ x IN edgeX V X} (\X. g X x)) = 
   sum Q4 (\x. &2 * pi * lmfun (radV x))`);;
e (MATCH_MP_TAC SUM_EQ);;
e (REPEAT STRIP_TAC);;
e (REWRITE_TAC[BETA_THM]);;
e (EXPAND_TAC "g");;

e (REWRITE_TAC[HL; BETA_THM; set_of_list]);;
e (UP_ASM_TAC THEN EXPAND_TAC "Q4" THEN REWRITE_TAC[IN; IN_ELIM_THM]);;
e (STRIP_TAC);;

e (REWRITE_WITH `sum {X | mcell_set V X /\ edgeX V X x}
 (\X. (\({u, v}). if edgeX V X {u, v}
                  then dihX V X (u,v) * lmfun (radV {u, v}) else &0) x) = 
                sum {X | mcell_set V X /\ edgeX V X x}
 (\X. (if edgeX V X {u0, u1}
                  then dihX V X (u0,u1) * lmfun (radV {u0, u1}) else &0))`);;
e (MATCH_MP_TAC SUM_EQ);;
e (ASM_REWRITE_TAC[IN; IN_ELIM_THM; BETA_THM] THEN REPEAT STRIP_TAC);;
e (ABBREV_TAC 
  `f_temp = (\u v. if edgeX V x' {u, v}
                   then dihX V x' (u,v) * lmfun (radV {u, v}) else &0)`);;
e (NEW_GOAL `!u:real^3 v:real^3. 
            (f_temp:real^3->real^3->real) u v = f_temp v u`);;
e (EXPAND_TAC "f_temp" THEN REWRITE_TAC[BETA_THM]);;
e (REWRITE_TAC[HL; set_of_list; SET_RULE `{a,b} = {b,a}`]);;
e (REPEAT GEN_TAC THEN COND_CASES_TAC);;
e (COND_CASES_TAC);;
e (REWRITE_WITH `dihX V x' (u,v) = dihX V x' (v,u)`);;

e (MATCH_MP_TAC DIHX_SYM);;
e (ASM_REWRITE_TAC[IN; mcell_set; IN_ELIM_THM]);;
e (UP_ASM_TAC THEN MESON_TAC[]);;
e (COND_CASES_TAC);;
e (UP_ASM_TAC THEN MESON_TAC[]);;
e (REFL_TAC);;

e (REWRITE_WITH 
 `(\({u, v}). if edgeX V x' {u, v}
              then dihX V x' (u,v) * lmfun (radV {u, v})
              else &0)
    = (\({u, v}). f_temp u v)`);;
e (EXPAND_TAC "f_temp" THEN REWRITE_TAC[IN]);;
e (REWRITE_WITH 
  `(if edgeX V x' {u0, u1}
   then dihX V x' (u0,u1) * lmfun (radV {u0, u1}) else &0) = 
   f_temp u0 u1`);;
e (EXPAND_TAC "f_temp" THEN REWRITE_TAC[IN]);;
e (MATCH_MP_TAC BETA_PAIR_THM);;
e (ASM_REWRITE_TAC[]);;


e (NEW_GOAL `FINITE {X | mcell_set V X /\ edgeX V X x}`);;
e (MATCH_MP_TAC Marchal_cells_3.FINITE_EDGE_X2);;
e (EXISTS_TAC `u0:real^3` THEN EXISTS_TAC `u1:real^3` THEN ASM_REWRITE_TAC[]);;
e (ASM_SIMP_TAC [SUM_CASES]);;

e (REWRITE_TAC[SET_RULE 
 `{X | X IN {X | mcell_set V X /\ edgeX V X {u0, u1}} /\ edgeX V X {u0, u1}} =
  {X | mcell_set V X /\ edgeX V X {u0, u1}} /\ 
  {X | X IN {X | mcell_set V X /\ edgeX V X {u0, u1}} /\ 
      ~edgeX V X {u0, u1}} = {}`; SUM_CLAUSES; REAL_ARITH `a + &0 = a`]);;
e (REWRITE_TAC[SUM_RMUL]);;
e (REWRITE_WITH 
  `sum {X | mcell_set V X /\ edgeX V X {u0, u1}} (\X. dihX V X (u0,u1)) = 
   &2 * pi`);;
e (REWRITE_WITH 
  `{X | mcell_set V X /\ edgeX V X {u0, u1}} = 
   {X | mcell_set V X /\ {u0, u1} IN edgeX V X}`);;
e (REWRITE_TAC[IN]);;
e (MATCH_MP_TAC GRUTOTI);;
e (ASM_REWRITE_TAC[MESON[Geomdetail.CARD2] `~(a = b) <=> CARD {a, b} = 2`]);;
e (ASM_SET_TAC[]);;
e (REAL_ARITH_TAC);;

e (REWRITE_TAC[SUM_LMUL; REAL_ARITH `(&8 * mm2 / pi) * &2 * pi * a = 
                                     (&8 * mm2) * (pi / pi) * (&2 * a)`]);;
e (REWRITE_WITH `pi / pi = &1`);;
e (MATCH_MP_TAC REAL_DIV_REFL);;
e (REWRITE_TAC[PI_NZ]);;
e (REWRITE_TAC[REAL_ARITH `&1 * a = a`]);;
e (EXPAND_TAC "c");;
e (REWRITE_TAC[REAL_ARITH 
  `(&8 * mm2) * a + (&8 * mm2 * d) * b <= &8 * mm2 * c <=> 
   &0 <= (&8 * mm2) * (c - a - d * b)`]);;
e (MATCH_MP_TAC REAL_LE_MUL);;
e (SIMP_TAC[REAL_LE_MUL; REAL_ARITH `&0 <= &8`; ZERO_LE_MM2_LEMMA]);;
e (REWRITE_TAC[REAL_ARITH `&0 <= a - b - c <=> b + c <= a`]);;

e (EXPAND_TAC "Q4");;
e (ABBREV_TAC `V2 = (\x. V1 )`

search [`&0 <= mm2`];;


search [`~(pi = &0)`];;


b();;

b();;

critical_edgeX;;
hplus;;
search [`sqrt (&2) < t`];;
search [`sqrt (&2) < hplus`];;
edgeX;;
VX;;


;;

GRUTOTI;;

;;

b();;




p();;
search [`FINITE {X | mcell_set V X /\ edgeX V X x}`];;

SUM_CASES;;

search [`sum s (\x. if A then B else C)`]
;;







e (UNDISCH_TAC `x' IN edgeX V x` THEN REWRITE_TAC[IN;IN_ELIM_THM; edgeX]);;
e (STRIP_TAC);;
e (ASM_SIMP_TAC[BETA_PAIR_THM]);;
e (EXPAND_TAC "f_temp");;
e (COND_CASES_TAC);;
e (REWRITE_TAC[dihX]);;
e (COND_CASES_TAC);;
e (REAL_ARITH_TAC);;
e (NEW_GOAL `F`);;
e (ASM_MESON_TAC[]);;
e (UP_ASM_TAC THEN MESON_TAC[]);;
e (REFL_TAC);;




b();;






b();;


e (ASM_REWRITE_TAC[BETA_SET_2_THM]);;


BETA_PAIR_THM;;


e (ABBREV_TAC `g2 = (\u v. dihX V X (u,v) * lmfun (radV {u, v})
                  else &0)`);;
e (REWRITE_WITH `sum {X | mcell_set V X /\ x IN edgeX V X} (\X. g X x) = 
   sum {X | mcell_set V X /\ x IN edgeX V X} (\X. (dihX V X x) * (lmfun (radV x)))`);;



GRUTOTI;;

b();;


BETA_SET_2_THM;;



b();;



search [`(\x. (\y. f x y) y)`];;

p();;
b();;



HL;;

lmfun;;


p();;
b();;

p();;
seans_fn();;
b();;

gammaY;;



b();;
 ""
search [`gammaY`];;

search [`sum s f <= sum t f`];;


b();;


b();;

search [`mm2`];;

e (
b();;
GRUTOTI;;

e (EXPAND_TAC "Q2");;

e (EXPAND_TAC "S2");;





b();;













