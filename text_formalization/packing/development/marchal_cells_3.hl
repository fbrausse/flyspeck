(* ========================================================================= *)
(*                FLYSPECK - BOOK FORMALIZATION                              *)
(*                                                                           *)
(*      Authour   : VU KHAC KY                                               *)
(*      Book lemma:                                                          *)
(*      Chaper    : Packing (Marchal Cells 3)                                *)
(*                                                                           *)
(* ========================================================================= *)

let HD_IN_ROGERS = prove (
 `!V ul. saturated V /\ packing V /\ barV V 3 ul ==> HD ul IN rogers V ul`,
REPEAT STRIP_TAC THEN 
ASM_SIMP_TAC[ROGERS_EXPLICIT] THEN 
MATCH_MP_TAC IN_SET_IMP_IN_CONVEX_HULL_SET THEN SET_TAC[]);; 

(* ==================================================================== *)
g `!V ul. saturated V /\ packing V /\ barV V 3 ul ==> 
          rogers V ul SUBSET voronoi_closed V (HD ul)`;;
e (REPEAT STRIP_TAC);;
e (ASM_SIMP_TAC[ROGERS_EXPLICIT]);;
e (NEW_GOAL `voronoi_closed V (HD ul) = 
   convex hull (voronoi_closed V ((HD ul):real^3))`);;
e (ONCE_REWRITE_TAC[EQ_SYM_EQ]);;
e (REWRITE_TAC[CONVEX_HULL_EQ]);;
e (REWRITE_TAC[Packing3.CONVEX_VORONOI_CLOSED]);;
e (ONCE_ASM_REWRITE_TAC[]);;
e (MATCH_MP_TAC Marchal_cells.CONVEX_HULL_SUBSET);;

e (NEW_GOAL `?u0 u1 u2 u3. ul = [u0;u1;u2;u3:real^3]`);;
e (MATCH_MP_TAC BARV_3_EXPLICIT);;
e (EXISTS_TAC `V:real^3->bool` THEN ASM_SET_TAC[]);;
e (UP_ASM_TAC THEN STRIP_TAC);;

e (REWRITE_TAC[GSYM OMEGA_LIST_N]);;
e (REWRITE_WITH `voronoi_closed V (omega_list_n V ul 0) = 
                 voronoi_list V (truncate_simplex 0 ul)`);;
e (ASM_REWRITE_TAC[OMEGA_LIST_N; TRUNCATE_SIMPLEX_EXPLICIT_0; VORONOI_LIST; 
   VORONOI_SET; set_of_list; HD] THEN SET_TAC[]);;

e (NEW_GOAL `omega_list_n V ul 0 IN 
   voronoi_list V (truncate_simplex 0 ul)`);;
e (MATCH_MP_TAC Rogers.OMEGA_LIST_N_IN_VORONOI_LIST_GEN);;
e (EXISTS_TAC `3` THEN ASM_REWRITE_TAC[] THEN ARITH_TAC);;
e (NEW_GOAL `omega_list_n V ul 1 IN 
   voronoi_list V (truncate_simplex 0 ul)`);;
e (MATCH_MP_TAC Rogers.OMEGA_LIST_N_IN_VORONOI_LIST_GEN);;
e (EXISTS_TAC `3` THEN ASM_REWRITE_TAC[] THEN ARITH_TAC);;
e (NEW_GOAL `omega_list_n V ul 2 IN 
   voronoi_list V (truncate_simplex 0 ul)`);;
e (MATCH_MP_TAC Rogers.OMEGA_LIST_N_IN_VORONOI_LIST_GEN);;
e (EXISTS_TAC `3` THEN ASM_REWRITE_TAC[] THEN ARITH_TAC);;
e (NEW_GOAL `omega_list_n V ul 3 IN 
   voronoi_list V (truncate_simplex 0 ul)`);;
e (MATCH_MP_TAC Rogers.OMEGA_LIST_N_IN_VORONOI_LIST_GEN);;
e (EXISTS_TAC `3` THEN ASM_REWRITE_TAC[] THEN ARITH_TAC);;
e (ASM_SET_TAC[]);;

let ROGERS_SUBSET_VORONOI_CLOSED = top_thm ();;

(* ==================================================================== *)

g `!V ul i r X . 
      packing V /\ 
      saturated V /\ 
      barV V 3 ul /\ 
      X = mcell i V ul /\ 
     ~(X = {}) /\ ~(i = 0)
     ==> (HD ul IN X)`;;
e (REPEAT STRIP_TAC);;

e (NEW_GOAL `?u0 u1 u2 u3. ul = [u0;u1;u2;u3:real^3]`);;
e (MATCH_MP_TAC BARV_3_EXPLICIT);;
e (EXISTS_TAC `V:real^3->bool` THEN ASM_SET_TAC[]);;
e (UP_ASM_TAC THEN STRIP_TAC);;

e (ASM_REWRITE_TAC[HD]);;
e (ASM_CASES_TAC `i = 1`);;
e (ASM_REWRITE_TAC[MCELL_EXPLICIT; mcell1]);;
e (COND_CASES_TAC);;
e (ASM_SIMP_TAC[IN_DIFF;IN_INTER; HD; TL; IN_CBALL; DIST_REFL;  
   TRUNCATE_SIMPLEX_EXPLICIT_1; rcone_gt; rconesgn]);;
e (REPEAT STRIP_TAC);;
e (REWRITE_WITH `u0 = HD ul /\ [u0; u1; u2; u3:real^3] = ul`);;
e (ASM_REWRITE_TAC[HD]);;
e (MATCH_MP_TAC HD_IN_ROGERS);;
e (ASM_REWRITE_TAC[]);;
e (MATCH_MP_TAC SQRT_POS_LE);;
e (REAL_ARITH_TAC);;
e (UP_ASM_TAC THEN REWRITE_TAC[IN; IN_ELIM_THM; VECTOR_ARITH 
  `(u0 - u0) dot (u1 - u0) = &0`; DIST_REFL]);;
e (REAL_ARITH_TAC);;
e (NEW_GOAL `F`);;
e (NEW_GOAL `X:real^3->bool = {}`);;
e (REWRITE_TAC[ASSUME `X = mcell i V ul`; ASSUME `i = 1`; MCELL_EXPLICIT; mcell1]);;
e (COND_CASES_TAC);;
e (NEW_GOAL `F`);;
e (ASM_MESON_TAC[]);;
e (ASM_MESON_TAC[]);;
e (REFL_TAC);;
e (ASM_MESON_TAC[]);;
e (ASM_MESON_TAC[]);;

e (ASM_CASES_TAC `i = 2`);;
e (ASM_REWRITE_TAC[MCELL_EXPLICIT; mcell2]);;
e (COND_CASES_TAC);;
e (LET_TAC);;
e (ASM_SIMP_TAC[IN_INTER; HD; TL; DIST_REFL;  
   TRUNCATE_SIMPLEX_EXPLICIT_1; rcone_ge; rconesgn; IN; IN_ELIM_THM]);;
e (REPEAT STRIP_TAC);;
e (REWRITE_TAC[VECTOR_ARITH `(u0 - u0) dot (u1 - u0) = &0`]);;
e (REAL_ARITH_TAC);;
e (REWRITE_TAC[GSYM NORM_POW_2; GSYM dist; REAL_POW_2]);;
e (REWRITE_TAC[REAL_ARITH `a * a >= a * a * b <=> &0 <= a * a * (&1 - b)`]);;
e (MATCH_MP_TAC REAL_LE_MUL);;
e (REWRITE_TAC[DIST_POS_LE]);;
e (MATCH_MP_TAC REAL_LE_MUL);;
e (REWRITE_TAC[DIST_POS_LE]);;
e (ABBREV_TAC `s = hl (truncate_simplex 1 [u0; u1; u2; u3:real^3])`);;
e (EXPAND_TAC "a");;
e (REWRITE_TAC[REAL_ARITH `&0 <= a - b <=> b <= a`]);;
e (REWRITE_WITH `s / sqrt (&2) <= &1 <=> s <= &1 * sqrt (&2)`);;
e (MATCH_MP_TAC REAL_LE_LDIV_EQ);;
e (MATCH_MP_TAC SQRT_POS_LT THEN REAL_ARITH_TAC);;
e (ASM_REAL_ARITH_TAC);;

e (REWRITE_WITH `[u0; u1; u2; u3:real^3] = ul`);;
e (ASM_REWRITE_TAC[]);;
e (ABBREV_TAC `m = mxi V ul`);;
e (ABBREV_TAC `s3 = omega_list_n V ul 3`);;
e (REWRITE_WITH `aff_ge {u0, u1:real^3} {m, s3} u0 <=>
                 u0 IN aff_ge {u0, u1} {m, s3}`);;
e (REWRITE_TAC[IN]);;
e (NEW_GOAL `u0 IN convex hull {u0,u1,m,s3:real^3}`);;
e (MATCH_MP_TAC IN_SET_IMP_IN_CONVEX_HULL_SET);;
e (SET_TAC[]);;
e (NEW_GOAL `convex hull {u0,u1,m,s3:real^3} SUBSET aff_ge {u0, u1} {m, s3}`);;
e (REWRITE_TAC[Marchal_cells_2_new.CONVEX_HULL_4_SUBSET_AFF_GE_2_2]);;
e (UP_ASM_TAC THEN UP_ASM_TAC THEN SET_TAC[]);;
e (NEW_GOAL `F`);;
e (NEW_GOAL `X:real^3->bool = {}`);;
e (REWRITE_TAC[ASSUME `X = mcell i V ul`; ASSUME `i = 2`; MCELL_EXPLICIT; mcell2]);;
e (COND_CASES_TAC);;
e (NEW_GOAL `F`);;
e (ASM_MESON_TAC[]);;
e (ASM_MESON_TAC[]);;
e (REFL_TAC);;
e (ASM_MESON_TAC[]);;
e (ASM_MESON_TAC[]);;

e (ASM_CASES_TAC `i = 3`);;
e (ASM_REWRITE_TAC[MCELL_EXPLICIT; mcell3]);;
e (COND_CASES_TAC);;
e (REWRITE_TAC[set_of_list;TRUNCATE_SIMPLEX_EXPLICIT_2]);;
e (MATCH_MP_TAC IN_SET_IMP_IN_CONVEX_HULL_SET);;
e (SET_TAC[]);;
e (NEW_GOAL `F`);;
e (NEW_GOAL `X:real^3->bool = {}`);;
e (REWRITE_TAC[ASSUME `X = mcell i V ul`; ASSUME `i = 3`; MCELL_EXPLICIT; mcell3]);;
e (COND_CASES_TAC);;
e (NEW_GOAL `F`);;
e (ASM_MESON_TAC[]);;
e (ASM_MESON_TAC[]);;
e (REFL_TAC);;
e (ASM_MESON_TAC[]);;
e (ASM_MESON_TAC[]);;

e (ASM_CASES_TAC `i >= 4`);;
e (ASM_SIMP_TAC[MCELL_EXPLICIT; mcell4]);;
e (COND_CASES_TAC);;
e (REWRITE_TAC[set_of_list]);;
e (MATCH_MP_TAC IN_SET_IMP_IN_CONVEX_HULL_SET);;
e (SET_TAC[]);;
e (NEW_GOAL `F`);;
e (NEW_GOAL `X:real^3->bool = {}`);;
e (SIMP_TAC[ASSUME `X = mcell i V ul`; ASSUME `i >= 4`; MCELL_EXPLICIT; mcell4]);;
e (COND_CASES_TAC);;
e (NEW_GOAL `F`);;
e (ASM_MESON_TAC[]);;
e (ASM_MESON_TAC[]);;
e (REFL_TAC);;
e (ASM_MESON_TAC[]);;
e (ASM_MESON_TAC[]);;

e (NEW_GOAL `F`);;
e (ASM_ARITH_TAC);;
e (ASM_MESON_TAC[]);;

let HD_IN_MCELL = top_thm();;

(* ==================================================================== *)
g `!V ul i r X . 
      packing V /\ 
      saturated V /\ 
      barV V 3 ul /\ 
      X = mcell i V ul /\ 
      X SUBSET ball (vec 0, r) /\ 
     ~(X = {}) 
     ==> (!u. u IN set_of_list ul ==> u IN ball (vec 0, r + &6))`;;
e (REPEAT STRIP_TAC);;

(* Case i = 0 *)
e (ASM_CASES_TAC `i = 0`);;
e (UNDISCH_TAC `X = mcell i V ul`THEN ASM_REWRITE_TAC[MCELL_EXPLICIT; mcell0]);;
e (STRIP_TAC);;
e (NEW_GOAL `!s. s IN rogers V ul ==> dist (HD ul, s) < &2`);;
e (REPEAT STRIP_TAC);;
e (NEW_GOAL `rogers V ul SUBSET voronoi_closed V (HD ul)`);;
e (ASM_SIMP_TAC[ROGERS_SUBSET_VORONOI_CLOSED]);;
e (NEW_GOAL `s:real^3 IN voronoi_closed V (HD ul)`);;
e (ASM_SET_TAC[]);;
e (UNDISCH_TAC `saturated (V:real^3->bool)`);;
e (REWRITE_TAC[saturated]);;
e (REPEAT STRIP_TAC);;
e (NEW_GOAL `?y. y IN V /\ dist (s, y:real^3) < &2`);;
e (ASM_MESON_TAC[]);;
e (UP_ASM_TAC THEN STRIP_TAC);;
e (UNDISCH_TAC `s:real^3 IN voronoi_closed V (HD ul)` THEN REWRITE_TAC[voronoi_closed; IN; IN_ELIM_THM]);;
e (REPEAT STRIP_TAC);;
e (NEW_GOAL `dist (s,HD ul) <= dist (s,y:real^3)`);;
e (FIRST_ASSUM MATCH_MP_TAC);;
e (ASM_SET_TAC[]);;
e (ONCE_REWRITE_TAC[DIST_SYM] THEN ASM_REAL_ARITH_TAC);;
e (NEW_GOAL `?s. s:real^3 IN X`);;
e (ASM_SET_TAC[]);;
e (UP_ASM_TAC THEN STRIP_TAC);;
e (NEW_GOAL `dist (HD ul, s:real^3) < &2`);;
e (FIRST_ASSUM MATCH_MP_TAC);;
e (ASM_SET_TAC[]);;

e (NEW_GOAL `set_of_list (ul:(real^3)list) SUBSET ball (HD ul,&4)`);;
e (MATCH_MP_TAC BARV_3_IMP_FINITE_lemma2);;
e (EXISTS_TAC `V:real^3->bool`);;
e (ASM_REWRITE_TAC[]);;
e (MATCH_MP_TAC Packing3.HD_IN_SET_OF_LIST);;
e (REWRITE_WITH `LENGTH (ul:(real^3)list) = 3 + 1 /\ 
                 CARD (set_of_list ul) = 3 + 1`);;
e (MATCH_MP_TAC Rogers.BARV_IMP_LENGTH_EQ_CARD);;
e (EXISTS_TAC `V:real^3->bool` THEN ASM_REWRITE_TAC[]);;
e (ARITH_TAC);;
e (NEW_GOAL `u:real^3 IN ball (HD ul, &4)`);;
e (ASM_SET_TAC[]);;
e (UP_ASM_TAC THEN REWRITE_TAC[IN_BALL]);;
e (STRIP_TAC);;
e (NEW_GOAL `dist (vec 0,u) <= dist (vec 0, s) + dist (s, u:real^3)`);;
e (REWRITE_TAC[DIST_TRIANGLE]);;
e (NEW_GOAL `dist (s, u) <= dist (s, HD ul) + dist (HD ul, u:real^3)`);;
e (REWRITE_TAC[DIST_TRIANGLE]);;
e (NEW_GOAL `dist (vec 0,u) <=  
   dist (vec 0,s) + dist (s,HD ul) + dist (HD ul,u:real^3)`);;
e (ASM_REAL_ARITH_TAC);;
e (NEW_GOAL `dist (s:real^3, HD ul) < &2`);;
e (ONCE_REWRITE_TAC[DIST_SYM] THEN ASM_REWRITE_TAC[]);;
e (NEW_GOAL `dist (vec 0,s:real^3) < r`);;
e (REWRITE_TAC[GSYM IN_BALL]);;
e (ASM_SET_TAC[]);;
e (ASM_REAL_ARITH_TAC);;

(* Case i != 0 *)

e (NEW_GOAL `?u0 u1 u2 u3. ul = [u0;u1;u2;u3:real^3]`);;
e (MATCH_MP_TAC BARV_3_EXPLICIT);;
e (EXISTS_TAC `V:real^3->bool` THEN ASM_SET_TAC[]);;
e (UP_ASM_TAC THEN STRIP_TAC);;
e (NEW_GOAL `(HD ul):real^3 IN X`);;
e (MATCH_MP_TAC HD_IN_MCELL);;
e (EXISTS_TAC `V:real^3->bool` THEN EXISTS_TAC `i:num`);;
e (ASM_REWRITE_TAC[]);;
e (NEW_GOAL `(HD ul):real^3 IN ball (vec 0, r)`);;
e (ASM_SET_TAC[]);;
e (UP_ASM_TAC THEN REWRITE_TAC[IN_BALL] THEN STRIP_TAC);;
e (NEW_GOAL `dist (vec 0,u) <= dist (vec 0,HD ul) + dist (HD ul, u:real^3)`);;
e (REWRITE_TAC[DIST_TRIANGLE]);;
e (NEW_GOAL `set_of_list (ul:(real^3)list) SUBSET ball (HD ul,&4)`);;
e (MATCH_MP_TAC BARV_3_IMP_FINITE_lemma2);;
e (EXISTS_TAC `V:real^3->bool`);;
e (ASM_REWRITE_TAC[HD; set_of_list]);;
e (SET_TAC[]);;
e (NEW_GOAL `u:real^3 IN ball (HD ul, &4)`);;
e (ASM_SET_TAC[]);;
e (UP_ASM_TAC THEN REWRITE_TAC[IN_BALL]);;
e (STRIP_TAC);;
e (ASM_REAL_ARITH_TAC);;

let FINITE_MCELL_SET_lemma1 = top_thm();;

(* ==================================================================== *)

g FINITE_MCELL_SET_LEMMA_concl;;
e (REPEAT STRIP_TAC);;

e (REWRITE_WITH `FINITE {X | X SUBSET ball (vec 0,r) /\ mcell_set V X} <=>
   FINITE {X | X SUBSET ball (vec 0,r) /\ mcell_set V X /\ ~(X = {})}`);;
e (ASM_CASES_TAC `{} IN {X | X SUBSET ball (vec 0,r) /\ mcell_set V X}`);;
e (REWRITE_WITH `{X | X SUBSET ball (vec 0,r) /\ mcell_set V X} = 
   {} INSERT {X | X SUBSET ball (vec 0,r) /\ mcell_set V X /\ ~(X = {})}`);;
e (ONCE_REWRITE_TAC[SET_RULE `A = B <=> B SUBSET A /\ A SUBSET B`]);;
e (REPEAT STRIP_TAC);;
e (REWRITE_TAC[INSERT_SUBSET]);;
e (ASM_REWRITE_TAC[]);;
e (SET_TAC[]);;
e (REWRITE_TAC[SUBSET_INSERT_DELETE]);;
e (ONCE_REWRITE_TAC[SUBSET] THEN ONCE_REWRITE_TAC[IN_DELETE] THEN REWRITE_TAC[IN_ELIM_THM]);;
e (SET_TAC[]);;
e (REWRITE_TAC[FINITE_INSERT]);;
e (REWRITE_WITH `{X | X SUBSET ball (vec 0,r) /\ mcell_set V X} = 
  {X | X SUBSET ball (vec 0,r) /\ mcell_set V X /\ ~(X = {})}`);;
e (ONCE_REWRITE_TAC[SET_RULE `A = B <=> B SUBSET A /\ A SUBSET B`]);;
e (REPEAT STRIP_TAC);;
e (SET_TAC[]);;
e (ONCE_REWRITE_TAC[SUBSET] THEN ONCE_REWRITE_TAC[IN] 
   THEN REWRITE_TAC[IN_ELIM_THM]);;
e (REPEAT STRIP_TAC);;
e (ASM_REWRITE_TAC[]);;
e (ASM_REWRITE_TAC[]);;
e (NEW_GOAL `{} IN {X | X SUBSET ball (vec 0,r) /\ mcell_set V X}`);;
e (ONCE_REWRITE_TAC[IN] THEN REWRITE_TAC[IN_ELIM_THM]);;
e (ASM_MESON_TAC[]);;
e (ASM_MESON_TAC[]);;

e (ABBREV_TAC 
  `S = {X | X SUBSET ball (vec 0,r) /\ mcell_set V X /\ ~(X = {})}`);;
e (ABBREV_TAC `s1:(real^3->bool) = V INTER ball (vec 0, r + &6)`);;
e (ABBREV_TAC `s2 = {ul:(real^3)list |  ?u0 u1 u2 u3.
               u0 IN s1 /\
               u1 IN s1 /\
               u2 IN s1 /\
               u3 IN s1 /\
               ul = [u0; u1; u2; u3]}`);;
e (ABBREV_TAC `s3 = {(i:num, ul:(real^3)list) | i IN 0..4 /\ ul IN s2}`);;
e (NEW_GOAL`S SUBSET {X| ?t. t IN s3 /\ X = (\t. mcell (FST t) V (SND t)) t}`);;
e (EXPAND_TAC "S" THEN EXPAND_TAC "s3");;
e (ONCE_REWRITE_TAC[SUBSET] THEN ONCE_REWRITE_TAC[IN] THEN  
   REWRITE_TAC[IN_ELIM_THM; FST; SND; mcell_set]);;
e (REPEAT STRIP_TAC);;
e (EXISTS_TAC `((if i <= 4 then i else 4), ul:(real^3)list)`);;
e (ASM_REWRITE_TAC[FST;SND]);;
e (REPEAT STRIP_TAC);;
e (EXISTS_TAC `(if i <= 4 then i else 4)` THEN EXISTS_TAC `ul:(real^3)list`);;
e (REWRITE_TAC[]);;
e (REPEAT STRIP_TAC);;
e (COND_CASES_TAC);;
e (ASM_REWRITE_TAC[IN_NUMSEG_0]);;
e (ASM_REWRITE_TAC[IN_NUMSEG_0] THEN ARITH_TAC);;
e (EXPAND_TAC "s2");;
e (NEW_GOAL `?u0 u1 u2 u3. ul = [u0;u1;u2;u3:real^3]`);;
e (MATCH_MP_TAC BARV_3_EXPLICIT);;
e (EXISTS_TAC `V:real^3->bool` THEN ASM_SET_TAC[]);;
e (UP_ASM_TAC THEN STRIP_TAC THEN ONCE_REWRITE_TAC[IN]);;
e (REWRITE_TAC[IN_ELIM_THM]);;
e (EXISTS_TAC `u0:real^3` THEN EXISTS_TAC `u1:real^3`);;
e (EXISTS_TAC `u2:real^3` THEN EXISTS_TAC `u3:real^3`);;
e (ASM_REWRITE_TAC[]);;

e (NEW_GOAL `!u:real^3. u IN set_of_list ul ==> u IN s1`);;
e (EXPAND_TAC "s1" THEN REPEAT STRIP_TAC);;
e (REWRITE_TAC[IN_INTER]);;
e (STRIP_TAC);;
e (NEW_GOAL `set_of_list ul SUBSET (V:real^3->bool)`);;
e (MATCH_MP_TAC Packing3.BARV_SUBSET);;
e (EXISTS_TAC `3` THEN ASM_MESON_TAC[IN]);;
e (ASM_SET_TAC[]);;
e (NEW_GOAL `!u:real^3. u IN set_of_list ul ==> u IN ball (vec 0,r + &6)`);;
e (MATCH_MP_TAC FINITE_MCELL_SET_lemma1);;
e (EXISTS_TAC `V:real^3->bool` THEN EXISTS_TAC `i:num` THEN 
   EXISTS_TAC `x:real^3->bool`);;
e (ASM_MESON_TAC[IN]);;
e (ASM_SIMP_TAC[]);;
e (REPEAT STRIP_TAC);;
e (FIRST_ASSUM MATCH_MP_TAC THEN ASM_REWRITE_TAC[set_of_list] THEN SET_TAC[]);;
e (FIRST_ASSUM MATCH_MP_TAC THEN ASM_REWRITE_TAC[set_of_list] THEN SET_TAC[]);;
e (FIRST_ASSUM MATCH_MP_TAC THEN ASM_REWRITE_TAC[set_of_list] THEN SET_TAC[]);;
e (FIRST_ASSUM MATCH_MP_TAC THEN ASM_REWRITE_TAC[set_of_list] THEN SET_TAC[]);;

e (COND_CASES_TAC);;
e (REFL_TAC);;
e (NEW_GOAL `i >= 4`);;
e (ASM_ARITH_TAC);;
e (ASM_SIMP_TAC[MCELL_EXPLICIT; ARITH_RULE `4 >= 4`]);;
e (MATCH_MP_TAC FINITE_SUBSET);;

e (EXISTS_TAC `{X | ?t. t IN s3 /\ X = (\t. mcell (FST t) V (SND t)) t}`);;
e (ASM_REWRITE_TAC[]);;
e (MATCH_MP_TAC FINITE_IMAGE_EXPAND);;
e (EXPAND_TAC "s3");;
e (MATCH_MP_TAC FINITE_PRODUCT);;
e (REWRITE_TAC[FINITE_NUMSEG]);;
e (EXPAND_TAC "s2");;
e (MATCH_MP_TAC FINITE_SET_LIST_LEMMA);;
e (EXPAND_TAC "s1");;
e (MATCH_MP_TAC Packing3.KIUMVTC);;
e (ASM_REWRITE_TAC[]);;

let FINITE_MCELL_SET_LEMMA = top_thm();;


