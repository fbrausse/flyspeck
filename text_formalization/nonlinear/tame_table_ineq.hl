(* ========================================================================== *)
(* FLYSPECK - BOOK FORMALIZATION                                              *)
(*                                                                            *)
(* Chapter: Nonlinear                                                  *)
(* Author: Thomas C. Hales                                                    *)
(* Date: 2011-05-13                                                           *)
(* ========================================================================== *)

(*

STILL MISSING: quad inequalites for non ad hoc tame table.


*)

(* New test inequalities from May 2011.  Redo all the tameTableD calculations,
    together with associated nontriangular ad hoc LP estimates. 

    The three nontriangular ad hoc LP estimates are
   In head.mod:
   tauB4h 9620775909 apex4 tau >= 0.477, quad, diags >= sqrt8, one edge [2.52,sqrt8]
   tau5h  9620775909-5 std5 INTER std56flatfree, tau >= 0.696, pent, diags >= sqrt8,

   In body.mod:
   9563139965D, dart4_diag3_b, tau >= 0.467, quad, diags >= 3.

*)


(* This file does *not* treat the standard quad LP cases:
     ["3862621143";"4240815464";"6944699408";"7043724150"]
    which are proved by usual quad methods (with Dim_red_backsym option *)

let all_forall = Sphere.all_forall;;


addtex (Section,"Tame Table D","Deformation 206 and general facts");;


Parse_ineq.execute_cfsqp
  {
idv = "206 ee";
doc = "If  minor diag >= 3, then 3/1.26 > 2.38 and we can contract.
          15.53: arc[2,2,2.52]2 < arc[2,2,Sqrt[15.53]].
           Added May 12, 2011.";
tags = [Cfsqp;Tex;Flypaper[];];
ineq = all_forall `ineq
  [
  (&1 , e1, &1 + sol0/ pi);
  (&1 , e2, &1 + sol0/ pi);
  (&1 , e3, &1 + sol0/ pi);
  ((&2 / h0) pow 2, a2, (&2 * h0) pow 2);
  ((&2/ h0) pow 2, b2, #3.01 pow 2);
  (#2.38 pow 2, c2, #15.53)
  ]
   ((num1 e1 e2 e3 a2 b2 c2 ) > &0) `;
};;


Parse_ineq.execute_cfsqp
{
  idv = "8008451940 A";
  doc="Used to maintain nonreflexivity when making 206-deformations.";
  tags = [Cfsqp;Xconvert;Tex];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (&2,y2,#2.52);
    (&2,y3,#2.0);
    (#3.01,y4,#3.01);
    (&2,y5,#2.52);
      (&2,y6,&2)
  ]
(dih_y y1 y2 y3 y4 y5 y6 > pi / &2)`;
};;

Parse_ineq.execute_cfsqp
{
  idv = "8008451940 B";
  doc="Used to maintain nonreflexivity when making 206-deformations.";
  tags = [Cfsqp;Xconvert;Tex];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (&2,y2,&2);
    (&2,y3,&2);
    (#3.01,y4,#3.01);
    (&2,y5,#2.52);
      (&2,y6,#2.52)
  ]
(dih_y y1 y2 y3 y4 y5 y6 > pi / &2)`;
};;



Parse_ineq.execute_cfsqp
{
  idv = "";
  doc="upper bound on minor diagonal is 3.915 when top edges are 2.
     The bound on y4 comes from the triangle inequality.";
  tags = [Cfsqp;Xconvert;Tex];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (&2,y2,#2.52);
    (&2,y3,#2.52);
    (&2,y4,#4.52);
    (&2,y5,&2);
    (&2,y6,&2)
  ]
((y4 < #3.915) \/ 
  delta_y y1 y2 y3 y4 y5 y6 < &0
)`;
};;


Parse_ineq.execute_cfsqp
{
  idv = "";
  doc="Used to make matan approx in hex case (top diags 2).
   y4 bound 5.04 comes from the triangle inequality.";
  tags = [Cfsqp;Xconvert;Tex];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (&2,y2,#2.52);
    (&2,y3,#2.52);
    (#3.01,y4,#5.04);
    (&2,y5,#2.52);
      (&2,y6,#2.52)
  ]
(dih2_y y1 y2 y3 y4 y5 y6 < pi / &2 \/
  delta_y y1 y2 y3 y4 y5 y6 < &0
)`;
};;





addtex (Section,"Tame Table D","Hexagons, top edges all 2");;

Parse_ineq.execute_cfsqp
{
  idv = "";
  doc="This is the main pure hexagon case with all top edges 2
   and all diagonals at least 3.01.
   TameTableD[6,0]=0.7578 has been replaced with 0.6.
   The hexagon is split by three minor diagonals forming a triangle.
   The center piece (weighted 1/3) is combined with each outer triangle.
   The 0.34 correction term averages to zero.

    In practice, this should be broken into 2 cases:
   (0) dih_y y7 .... <= pi/2, and delta allowed to tend to zero, and matan formulas.
   (1) dih_y y7 .... >= pi/2, with delta bounded from zero.";
  tags = [Cfsqp;Xconvert;Tex];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (&2,y2,#2.52);
    (&2,y3,#2.52);
    (#3.01,y4,#3.915);
    (#3.01,y5,#3.915);
      (#3.01,y6,#3.915);
    (&2,y7,#2.52);
   (&2,y8,&2);
   (&2,y9,&2)
  ]
    ((taum y1 y2 y3 y4 y5 y6 )/ &3 + taum y7 y2 y3 y4 y9 y8
 + #0.34 * (&2 * y4 - y5 - y6)   >  (#0.6)/ &3   
 \/ y_of_x eulerA_x y1 y2 y3 y4 y5 y6 < &0 
\/ delta_y y7 y2 y3 y4 y9 y8 < &0
)`;
};;

(*
This is close enough.  Modify the D[6,0] constant.
0.339 -> -0.0019
0.34 ->  -0.001146
0.341 -> -0.0015386
*)

addtex (Section,"Tame Table D","Pentagons, all top edges 2");;

addtex(Comment,"",
  "
  The context is a pentagon whose top edges are all 2.
  The diagonals are all at least 3.01.
  Since tameTableD[5,0] < 0.696, the tameTableD[5,0] bound is a corollary of 0.696.
  Thus, it is enough to treat 0.696.

  The general strategy is that there must exist a triangle with
  minor diag <= 3.63 and angle <= 2.355.
    The constant 2.355 comes from the tau calculation:
    Solve[5x - 3(Pi + sol0) == 0.696, x]  (* gives 2.354... *)
  The constant 3.63 comes by an ineq that follows.
  This triangle is cut from the pentagon, leaving a quad case that can be done directly.
  The lower bound of tau on the cut triangle is 0.
  ");;

Parse_ineq.execute_cfsqp
{
  idv = "un";
  doc="pentagon case, clipped smallest angled side triangle.
   If dih clipped < 2.355, then y4 < 3.63.
  ";
  tags = [Cfsqp;Xconvert;Tex];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (#2.0,y2,#2.52);
    (&2,y3,#2.52);
    (#3.63,y4,#3.915);
    (&2,y5,&2);
      (&2,y6,&2)
  ]
(
(dih_y y1 y2 y3 y4 y5 y6 > #2.355 )\/ 
  (delta_y y1 y2 y3 y4 y5 y6 < &0)  )`;
};;

Parse_ineq.execute_cfsqp
{
  idv = "un";
  doc="pentagon case, clipped smallest angled side triangle.
   If all dih > 2.355, then tau >= 5 (2.355) - 3 (pi + sol0) > 0.696 =largest pent constant";
  tags = [Cfsqp;Xconvert;Tex;Penalty(50.0,500.0)];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (#2.0,y2,#2.52);
    (&2,y3,#2.52);
    (#3.01,y4,#3.63);
    (&2,y5,&2);
      (&2,y6,&2)
  ]
(
  ( taum y1 y2 y3 y4 y5 y6  > #0.0) \/
  (delta_y y1 y2 y3 y4 y5 y6 < &0) \/
(dih_y y1 y2 y3 y4 y5 y6 > #2.355 ) )`;
};;


Parse_ineq.execute_cfsqp
{
  idv = "un";
  doc="pentagon case, clipped smallest angled side triangle.
   Here is an additional linear constraint on edge lengths.";
  tags = [Cfsqp;Xconvert;Tex;Penalty(50.0,500.0)];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (#2.0,y2,#2.52);
    (&2,y3,#2.52);
    (#3.01,y4,#3.63);
    (&2,y5,&2);
      (&2,y6,&2)
  ]
(
  ( (y4 - #3.2) < #0.55 * (y2 + y3 - &4)) \/
  (delta_y y1 y2 y3 y4 y5 y6 < &0) \/
(dih_y y1 y2 y3 y4 y5 y6 > #2.355 ) )`;
};;


Parse_ineq.execute_cfsqp
{
  idv = "un";
  doc="pentagon case, quad piece, cut along y9";
  tags = [Cfsqp;Xconvert;Tex;Penalty(50.0,500.0)];
  ineq = all_forall `ineq [
      (#2.0,y1,&2 * h0);
      (#2.0,y2,&2 * h0);
      (#2.0,y3,&2 * h0);
      (#3.01,y4,#3.915);
      (#2.0,y5,&2);
      (#2.0,y6,&2);
      (#2.0,y7,&2 * h0);
      (#2.0,y8,&2);
      (#3.01,y9,#3.63)]
(( tauq y1 y2 y3 y4 y5 y6 y7 y8 y9  > #0.696) \/
  ((y9 - #3.2) > #0.55 * (y2 + y7 - &4)) \/
  ( enclosed y1 y5 y6 y4 y2 y3 y7 y8 y9 < #3.01 ))`;
};;

addtex (Section,"Tame Table D","Pentagons table[4,1]");;

addtex(Comment,"",
"
The context is a pentagon with one edge in the range [2.52,3.01], obtained
by a cut on a hexagon.  
All diagonals are at least 3.01.
All noncut top edges are 2.
This constant appears directly in the ad hoc LP inequalities
and as part of the tameTableD[6,0] calculation.
");;

(*
tameTableD[4,1]=0.6548 = tameTableD[6,0]-tameTableD[2,1].
*)

Parse_ineq.execute_cfsqp
  {
idv = "2065952723  experiment";
doc = "In a pentagon with one long edge, we can contract the long edge to 2.52, 
   or even to 2, using 2 diags.
   The constant 2.38 < 3.01/h0.";
tags = [Cfsqp;Tex;Flypaper[];];
ineq = all_forall `ineq
  [
  (&1 , e1, &1 + sol0/ pi);
  (&1 , e2, &1 + sol0/ pi);
  (&1 , e3, &1 + sol0/ pi);
  ((&2 / h0) pow 2, a2, #3.01 pow 2);
  (#2.38 pow 2, b2, #15.53);
  (#2.38 pow 2, c2, #15.53)
  ]
   ((num1 e1 e2 e3 a2 b2 c2  > &0) ) `;
};;


addtex(Comment,"",
"
 We continue to contract the long edge, even make it less than 2.52,
    until it reaches 2, in which case (0) the 0.696 estimate takes over.

    (1) Or until a diagonal hits 3.01, where  the long edge lands in the  triangle,
   leaving a quad with top edges 2,2,2,3.01.  The shortest edge of the quad
   is given by Solve[Delta[x,2,2,x,2,3.01]==0,x], which implies x <= 3.166.
   Cut along this diagonal to triangulate.

    (2) Or until two diagonals hit 3.01, triangulating the pent. 
    There are two diagonals, because after the first hits and is fixed at 3.01 
   assuming the long edge lands in the quad, 
    we can continue contraction on the quad.

  Note: if a flat node develops (with some edge > 2), 
  the usual tricks can be used to dissolve it.
");;


Parse_ineq.execute_cfsqp
{
  idv = "un";
  doc="clipped triangle in pentagon case (4,1).  
    In the application to tameTableD[4,1], we have y4=3.01, y6=2, 
   Ineq is slightly generalized for later use.";
  tags = [Cfsqp;Xconvert;Tex;Penalty(50.0,500.0)];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (#2.0,y2,#2.52);
    (&2,y3,#2.52);
    (sqrt8,y4,#3.01);
    (&2,y5,#2.52);
      (&2,y6,#2.52)
  ]
(
  ( taum y1 y2 y3 y4 y5 y6  - #0.1 * (#3.01 - y4) > #0.11) \/
  (delta_y y1 y2 y3 y4 y5 y6 < &0) 
 )`;
};;


Parse_ineq.execute_cfsqp
{
  idv = "un";
  doc="pentagon case, clipped A-piece triangle.
   prove constraint on edge lengths.";
  tags = [Cfsqp;Xconvert;Tex;Penalty(50.0,500.0)];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (#2.0,y2,#2.52);
    (&2,y3,#2.52);
    (#3.01,y4,#3.01);
    (#3.01,y5,#3.01);
      (&2,y6,#2.52)
  ]
(
  ( taum y1 y2 y3 y4 y5 y6 > tame_table_d 4 1 - &2 * #0.11) \/
  (delta_y y1 y2 y3 y4 y5 y6 < &0) 
 )`;
};;


Parse_ineq.execute_cfsqp
{
  idv = "un";
  doc="pentagon case (4,1), quad piece, cut along y9";
  tags = [Cfsqp;Xconvert;Tex;Penalty(50.0,500.0)];
  ineq = all_forall `ineq [
      (#2.0,y1,&2 * h0);
      (#2.0,y2,&2 * h0);
      (#2.0,y3,&2 * h0);
      (#3.01,y4,#3.915);
      (#2.0,y5,&2);
      (#2.0,y6,&2);
      (#2.0,y7,&2 * h0);
      (#2.0,y8,&2);
      (#3.01,y9,#3.01)]
(( tauq y1 y2 y3 y4 y5 y6 y7 y8 y9  > tame_table_d 4 1 -  #0.11) \/
  ( enclosed y1 y5 y6 y4 y2 y3 y7 y8 y9 < #3.01 ))`;
};;



addtex (Section,"Tame Table D","Ad hoc quadrilaterals");;

addtex(Comment,"",
"
Let's start with the ad hoc inequality:  9563139965D.
    By top edge contraction arguments, we may assume that 
    (0) all top edges have length 2, or 
    (1) both diagonals have length 3 (by contracting in different ways).
    The first case (0) is impossible by geomeric considerations: 
    edges=2 ==> some diagonal <= sqrt8.
    So both diagonals have length 3.
    This has been completely solved in a series 9563139965D in ineq.hl.
");;


addtex(Comment,"",
"Next the ad hoc LP inequality in head.mod :
    tauB4h 9620775909. tau >= 0.477, quad, diags >= sqrt8, one edge [2.52,sqrt8].
  This comes from a pentagon that has a 'flat quarter'.

  Case 1: a diagonal < 3.01.  Here we make no deformations.  We cut 
  the quad into two triangles.

   Case 2: both diags > 3.01.  In this case we bound the shorter diagonal.
    Solve[Delta[x, 2, 2, x, 2, sqrt8] == 0, x] // N gives x <= 3.108
 *)
");;




Parse_ineq.execute_cfsqp
{
  idv = "un";
  doc=" 0.477 estimate, clipped A-piece triangle.
   Case 1.
   We reuse the other cut triangle (bound 0.11) from above.
   We have not done it here, but we could extremize edges y5 and y6.";
  tags = [Cfsqp;Xconvert;Tex;Penalty(50.0,500.0)];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (#2.0,y2,#2.52);
    (&2,y3,#2.52);
    (sqrt8,y4,#3.01);
    (#2.52,y5,sqrt8);
      (&2,y6,#2.52)
  ]
(
  ( taum y1 y2 y3 y4 y5 y6 + #0.1 * (#3.01 - y4) > #0.477 -  #0.11) \/
  (delta_y y1 y2 y3 y4 y5 y6 < &0) 
 )`;
};;

Parse_ineq.execute_cfsqp
{
  idv = "un";
  doc="0.477 bound, quad case both diags > 3.01, y9 long.
    In this case top edge deformations have been fully applied,
     so that all short top edges are 2.";
  tags = [Cfsqp;Xconvert;Tex;Penalty(50.0,500.0)];
  ineq = all_forall `ineq [
      (#2.0,y1,&2 * h0);
      (#2.0,y2,&2 * h0);
      (#2.0,y3,&2 * h0);
      (#3.01,y4,#3.108);
      (#2.0,y5,&2);
      (#2.0,y6,&2);
      (#2.0,y7,&2 * h0);
      (#2.0,y8,&2);
      (#2.52,y9,sqrt8)]
(( tauq y1 y2 y3 y4 y5 y6 y7 y8 y9  > #0.477) \/
  ( enclosed y1 y5 y6 y4 y2 y3 y7 y8 y9 < #3.01 ))`;
};;

addtex(Comment,"",
"
   Now third ad hoc LP inequality:  Quad 0.696. 
   tau5h  9620775909-5 std5 INTER std56flatfree, tau >= 0.696, pent, diags >= sqrt8,
   It drops to a quad case if some diag of pent has length <= 3.01 and a cut is made.
   Contract top edges of quad until 3 have length 2.
   Short diag: Solve[Delta[x,2,2,x,2,3.01]==0,x]//N, gives x <= 3.166
");;


Parse_ineq.execute_cfsqp
{
  idv = "un";
  doc="quad case both diags > 3.01, y9 long";
  tags = [Cfsqp;Xconvert;Tex;Penalty(50.0,500.0)];
  ineq = all_forall `ineq [
      (#2.0,y1,&2 * h0);
      (#2.0,y2,&2 * h0);
      (#2.0,y3,&2 * h0);
      (#3.01,y4,#3.166);
      (#2.0,y5,&2);
      (#2.0,y6,&2);
      (#2.0,y7,&2 * h0);
      (#2.0,y8,&2);
      (sqrt8,y9,#3.01)]
(( tauq y1 y2 y3 y4 y5 y6 y7 y8 y9    > #0.696 - #0.11) \/
  ( enclosed y1 y5 y6 y4 y2 y3 y7 y8 y9 < #3.01 ))`;
};;

addtex (Section,"Tame Table D","Quadrilaterals (non ad hoc)");;

addtex(Comment,"",
"
This is the calculation of quadrilaterals (non ad hoc). TameTableD[r,s],
 for (r+s=4): (4,0), (3,1) (2,2).
By triangulating cases away, we may assume that both diagonals are => 3.01.
If there is adjacent short edges [2,2.52], we may deform so that both =2.
We can extremize the long edges [2.52,3.01].

In the case (4,0), when top edges are 2, some diagonal < 3.01, so nothing to do here.

In the case (3,1), there are two cases, depending on y9.  Both can be eliminated
without further interval calculations as follows:
  In fact,
  Solve[Delta[x, 2, 2, x, 2, 2.52] == 0, x], gives x< 3.01, so one is  impossible.
  Solve[Delta[x,2,2,x,2,3.01]==0,x], gives x < 3.166.  This domain
  was already encountered in the Quad 0.696 case.
  Since tameTableD[3,1] < 0.696 - 0.11, this is covered by a previous quad ineq.

Now consider (2,2). Six cases total up to symmetry.
  factor of 2 whether the long edges are adjacent.
  factor of 3 the number {0,1,2} of the long edges that are minimal 2.52.

 
");;


Parse_ineq.execute_cfsqp
{
  idv = "un";
  doc="quad case both diags > 3.01, y9 long";
  tags = [Cfsqp;Xconvert;Tex;Penalty(50.0,500.0)];
  ineq = all_forall `ineq [
      (#2.0,y1,&2 * h0);
      (#2.0,y2,&2 * h0);
      (#2.0,y3,&2 * h0);
      (#3.01,y4,#3.166);
      (#2.0,y5,&2);
      (#2.0,y6,&2);
      (#2.0,y7,&2 * h0);
      (#2.0,y8,&2);
      (#3.01,y9,#3.01)]
(( tauq y1 y2 y3 y4 y5 y6 y7 y8 y9    > tameTableD 3 1 - #0.11) \/
  ( enclosed y1 y5 y6 y4 y2 y3 y7 y8 y9 < #3.01 ))`;
};;



addtex (Section,"Tame Table D","Triangles");;

(*
If the cut edge is between [sqrt8,3.01], the triangle (2,1) has tau < tame_table_d 2 1.
Nevertheless tau > 0.11
We must compensate by putting an extra (tame_table_d 2 1 - 0.11) in the other pieces.
*)

(*
Special LP.  The case.
   tauB4h 9620775909 apex4 tau >= 0.477, quad, diags >= sqrt8, one edge [2.52,sqrt8]
   This can split into a triangle (2,1) [2.52,sqrt8][sqrt8,3.01] and a triangle (1,2).
   In this case we run a similar calc, replace tame_table_d entries with 0.477 - 0.11.
   
   tau5h  9620775909-5 std5 INTER std56flatfree, tau >= 0.696, pent, diags >= sqrt8,
   This will give an A-piece with [sqrt8,3.01][sqrt8,3.01].  need 0.696 - 2 0.11.

   9563139965D, dart4_diag3_b, tau >= 0.467, quad, diags >= 3.
   No triangle occurs here.  No diagonal drawn.

*)

Parse_ineq.execute_cfsqp
{
  idv = "un";
  doc="triangle 2,1";
  tags = [Cfsqp;Xconvert;Tex;Penalty(50.0,500.0)];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (#2.0,y2,#2.52);
    (&2,y3,#2.52);
    (&2,y4,&2);
    (&2,y5,&2);
      (#2.52,y6,#2.52)
  ]
(
   taum y1 y2 y3 y4 y5 y6  > tame_table_d 2 1
 )`;
};;

Parse_ineq.execute_cfsqp
{
  idv = "un";
  doc="triangle 2,1";
  tags = [Cfsqp;Xconvert;Tex;Penalty(50.0,500.0)];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (#2.0,y2,#2.52);
    (&2,y3,#2.52);
    (&2,y4,&2);
    (&2,y5,&2);
      (sqrt8,y6,sqrt8)
  ]
(
   taum y1 y2 y3 y4 y5 y6  > tame_table_d 2 1
 )`;
};;

(* skip 2,1 long edge 3.01 *)

Parse_ineq.execute_cfsqp
{
  idv = "un";
  doc="triangle 1,2";
  tags = [Cfsqp;Xconvert;Tex;Penalty(50.0,500.0)];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (#2.0,y2,#2.52);
    (&2,y3,#2.52);
    (&2,y4,&2);
    (#2.52,y5,#2.52);
      (#2.52,y6,#2.52)
  ]
(
   taum y1 y2 y3 y4 y5 y6  > tame_table_d 1 2
 )`;
};;

Parse_ineq.execute_cfsqp
{
  idv = "un";
  doc="triangle 1,2";
  tags = [Cfsqp;Xconvert;Tex;Penalty(50.0,500.0)];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (#2.0,y2,#2.52);
    (&2,y3,#2.52);
    (&2,y4,&2);
    (#2.52,y5,#2.52);
      (sqrt8,y6,sqrt8)
  ]
(
   taum y1 y2 y3 y4 y5 y6  > tame_table_d 1 2 + tame_table_d 2 1 - #0.11
          
 )`;
};;


Parse_ineq.execute_cfsqp
{
  idv = "un";
  doc="triangle 1,2 ad hoc  case.
    If the y4 edge is extremal at 2.52, we get at least tameTableD[0,3] > 0.477-0.11.
     So that case folds into the [0,3] case.";
  tags = [Cfsqp;Xconvert;Tex;Penalty(50.0,500.0)];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (#2.0,y2,#2.52);
    (&2,y3,#2.52);
    (&2,y4,&2);
    (#2.52,y5,sqrt8);
      (sqrt8,y6,#3.01)
  ]
(
   taum y1 y2 y3 y4 y5 y6 + #0.1 * (#3.01 - y6) > #0.477 - #0.11
          
 )`;
};;



Parse_ineq.execute_cfsqp
{
  idv = "un";
  doc="triangle 1,2";
  tags = [Cfsqp;Xconvert;Tex;Penalty(50.0,500.0)];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (#2.0,y2,#2.52);
    (&2,y3,#2.52);
    (&2,y4,&2);
    (#2.52,y5,#2.52);
      (#3.01,y6,#3.01)
  ]
(
   taum y1 y2 y3 y4 y5 y6  > tame_table_d 1 2 + tame_table_d 2 1 - #0.11
 )`;
};;


Parse_ineq.execute_cfsqp
{
  idv = "un";
  doc="triangle 1,2";
  tags = [Cfsqp;Xconvert;Tex;Penalty(50.0,500.0)];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (#2.0,y2,#2.52);
    (&2,y3,#2.52);
    (&2,y4,&2);
    (sqrt8,y5,sqrt8);
      (#3.01,y6,#3.01)
  ]
(
   taum y1 y2 y3 y4 y5 y6  > tame_table_d 1 2 + &2 *(tame_table_d 2 1 - #0.11)
 )`;
};;

Parse_ineq.execute_cfsqp
{
  idv = "un";
  doc="triangle 1,2";
  tags = [Cfsqp;Xconvert;Tex;Penalty(50.0,500.0)];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (#2.0,y2,#2.52);
    (&2,y3,#2.52);
    (&2,y4,&2);
    (#3.01,y5,#3.01);
      (#3.01,y6,#3.01)
  ]
(
   taum y1 y2 y3 y4 y5 y6  > tame_table_d 1 2 + &2 *(tame_table_d 2 1 - #0.11)
 )`;
};;


Parse_ineq.execute_cfsqp
{
  idv = "un";
  doc="triangle 1,2, ad hoc 0.696 case ";
  tags = [Cfsqp;Xconvert;Tex;Penalty(50.0,500.0)];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (#2.0,y2,#2.52);
    (&2,y3,#2.52);
    (&2,y4,&2);
    (sqrt8,y5,#3.01);
      (sqrt8,y6,#3.01)
  ]
(
   taum y1 y2 y3 y4 y5 y6 + #0.1 * (#3.01 - y5)  + #0.1 * (#3.01 - y6) > 
   #0.696 - &2 * #0.11
 )`;
};;

Parse_ineq.execute_cfsqp
{
  idv = "un";
  doc="triangle 1,2, ad hoc 0.696 case LP";
  tags = [Cfsqp;Xconvert;Tex;Penalty(50.0,500.0)];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (#2.0,y2,#2.52);
    (&2,y3,#2.52);
    (#2.52,y4,#2.52);
    (sqrt8,y5,#3.01);
      (sqrt8,y6,#3.01)
  ]
(
   taum y1 y2 y3 y4 y5 y6   >    #0.696 - &2 * #0.11
 )`;
};;



Parse_ineq.execute_cfsqp
{
  idv = "un";
  doc="triangle 0,3";
  tags = [Cfsqp;Xconvert;Tex;Penalty(50.0,500.0)];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (#2.0,y2,#2.52);
    (&2,y3,#2.52);
    (#2.52,y4,#2.52);
    (#2.52,y5,#2.52);
      (#2.52,y6,#2.52)
  ]
(
   taum y1 y2 y3 y4 y5 y6  > tame_table_d 0 3 + &3 *(tame_table_d 2 1 - #0.11)
 )`;
};;


Parse_ineq.execute_cfsqp
{
  idv = "un";
  doc="triangle 0,3";
  tags = [Cfsqp;Xconvert;Tex;Penalty(50.0,500.0)];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (#2.0,y2,#2.52);
    (&2,y3,#2.52);
    (#2.52,y4,#2.52);
    (#2.52,y5,#2.52);
      (#3.01,y6,#3.01)
  ]
(
   taum y1 y2 y3 y4 y5 y6  > tame_table_d 0 3 + &3 *(tame_table_d 2 1 - #0.11)
 )`;
};;


Parse_ineq.execute_cfsqp
{
  idv = "un";
  doc="triangle 0,3";
  tags = [Cfsqp;Xconvert;Tex;Penalty(50.0,500.0)];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (#2.0,y2,#2.52);
    (&2,y3,#2.52);
    (#2.52,y4,#2.52);
    (#3.01,y5,#3.01);
      (#3.01,y6,#3.01)
  ]
(
   taum y1 y2 y3 y4 y5 y6  > tame_table_d 0 3 + &3 *(tame_table_d 2 1 - #0.11)
 )`;
};;

Parse_ineq.execute_cfsqp
{
  idv = "un";
  doc="triangle 0,3";
  tags = [Cfsqp;Xconvert;Tex;Penalty(50.0,500.0)];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (#2.0,y2,#2.52);
    (&2,y3,#2.52);
    (#3.01,y4,#3.01);
    (#3.01,y5,#3.01);
      (#3.01,y6,#3.01)
  ]
(
   taum y1 y2 y3 y4 y5 y6  > tame_table_d 0 3 + &3 *(tame_table_d 2 1 - #0.11)
 )`;
};;





addtex (Section,"Experiments","");;

Parse_ineq.execute_cfsqp
  {
idv = "2065952723  experiment";
doc = "In a pentagon with one long edge, we can contract the long edge, using 2 diags";
tags = [Cfsqp;Tex;Flypaper[];];
ineq = all_forall `ineq
  [
  (&1 , e1, &1 + sol0/ pi);
  (&1 , e2, &1 + sol0/ pi);
  (&1 , e3, &1 + sol0/ pi);
  (&2 pow 2, a2, #3.01 pow 2);
  (#2.38 pow 2, b2, #15.53);
  (#2.38 pow 2, c2, #15.53)
  ]
   ((num1 e1 e2 e3 a2 b2 c2  > &0) ) `;
};;


Parse_ineq.execute_cfsqp
  {
idv = "hex  experiment, reflex vertex.";
doc = "can go reflexive in a hex";
tags = [Cfsqp;Tex;Flypaper[];];
ineq = all_forall `ineq
  [
  (&2,y1,#2.52);
  (&2,y2,#2.52);
  (&2,y3,#2.52);
  (#3.01,y4,#3.915);
  (&2,y5,&2);
  (&2,y6,&2)
  ]
  ( taum y1 y2 y3 y4 y5 y6 > &0 \/
   (delta_y y1 y2 y3 y4 y5 y6 < (#0.24 pow 2) * ups_x (y2 * y2) (y3* y3) (y4*y4)))`;
};;



Parse_ineq.execute_cfsqp
  {
idv = "hex  experiment contraction.";
doc = "another failed experiment";
tags = [Cfsqp;Tex;Flypaper[];];
ineq = all_forall `ineq
  [
  (&1 , e1, &1 + sol0/ pi);
  (&1 , e2, &1 + sol0/ pi);
  (&1 , e3, &1 + sol0/ pi);
  (&1 , e4, &1 + sol0/ pi);
  (#3.35 pow 2, a2, #3.915 pow 2);
  ((&2/ h0) pow 2, b2,&4);
  ((&2/ h0) pow 2, c2,&4);
  (#3.01 pow 2, r2,#3.915 pow 2);
  (#3.01 pow 2, s2,#3.915 pow 2)
  ]
   (( rat1 e1 e2 e3 a2 b2 c2 +  rat1 e4 e2 e3 a2 r2 s2  > &0) 
    \/ delta_x (&4) (&4) (&4) a2 b2 c2 < &0 
    eulerA_x (&4) (&4) (&4) a2 r2 s2 < &0 \/
    (dih_x (&4) (&4) (&4) a2 b2 c2 > #2.588 )) `;
};;


Parse_ineq.execute_cfsqp
  {
idv = "hex  experiment";
doc = "cut away a triangle with penalty 0.08";
tags = [Cfsqp;Tex;Flypaper[];];
ineq = all_forall `ineq
  [
  (&2,y1,#2.52);
  (&2,y2,#2.52);
  (&2,y3,#2.52);
  (#3.01,y4,#3.35);
  (&2,y5,&2);
  (&2,y6,&2)
  ]
  ( taum y1 y2 y3 y4 y5 y6 > -- #0.08 \/
   (dih_y y1 y2 y3 y4 y5 y6 > #2.588))`;
};;


(*

 (e1 * dih_x (&4) (&4) (&4) a2 b2 c2 + e2 * dih_x (&4) (&4) (&4) b2 c2 a2
        + e3 * dih_x (&4) (&4) (&4) c2 a2 b2 - (pi + sol0) > -- #0.2) \/

*)


Parse_ineq.execute_cfsqp
{
  idv = "1928747871-0";
  doc="pure hexagon case";
  tags = [Cfsqp;Xconvert;Tex];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (&2,y2,#2.52);
    (&2,y3,#2.52);
    (#3.01,y4,#3.915);
    (#3.01,y5,#3.915);
      (#3.01,y6,#3.915)
  ]
    (taum y1 y2 y3 y4 y5 y6 
    >  tame_table_d 6 0   \/ y_of_x eulerA_x y1 y2 y3 y4 y5 y6 < &0 )`;
};;

Parse_ineq.execute_cfsqp
{
  idv = "1928747871-1";
  doc="pure hexagon case";
  tags = [Cfsqp;Xconvert;Tex];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (&2,y2,#2.52);
    (&2,y3,#2.52);
    (#3.01,y4,#3.915);
    (#3.01,y5,#3.915);
      (#3.01,y6,#3.915)
  ]
(let y126 = edge_flat y6 y1 (&2)    (&2) y2 in
(let y135 = edge_flat y5 y1 (&2)    (&2) y5 in
(let y234 = edge_flat y4 y2 (&2)    (&2) y3 in
    (taum y1 y2 y3 y4 y5 y6 
  + taum y126 y1 y2 y6 (&2) (&2)
  + taum y135 y1 y3 y5 (&2) (&2)
  + taum y234 y2 y3 y4 (&2) (&2) 
    > &3 * #0.001 + tame_table_d 6 0  ) \/
  y_of_x eulerA_x y1 y2 y3 y4 y5 y6 < &0 \/  
 (y126 < #2.0 \/ y126 > #2.52 \/
  y135 < #2.0 \/ y135 > #2.52 \/ 
  y234 < #2.0 \/ y234 > #2.52))))`;
};;


Parse_ineq.execute_cfsqp
{
  idv = "1928747871-2";
  doc="pure hexagon case";
  tags = [Cfsqp;Xconvert;Tex];
  ineq = all_forall `ineq [
    (&2,y1,#2.4);
    (&2,y2,#2.4);
    (&2,y3,#2.4);
    (#3.01,y4,#3.47);
    (#3.01,y5,#3.47);
      (#3.01,y6,#3.47)
  ]
((taum y1 y2 y3 y4 y5 y6 > tame_table_d 6 0  ) \/
  y_of_x eulerA_x y1 y2 y3 y4 y5 y6 < &0)`;
};;


Parse_ineq.execute_cfsqp
{
  idv = "1928747871-(1)";
  doc="pure hexagon case, side triangle";
  tags = [Cfsqp;Xconvert;Tex];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (#2.0,y2,#2.52);
    (&2,y3,#2.52);
    (#3.01,y4,#3.915);
    (&2,y5,&2);
      (&2,y6,&2)
  ]
(
(let y234 = edge_flat y4 y3 (&2)     (&2) y2 in
(taum y1 y2 y3 y4 y5 y6 + #0.013 > taum y234 y2 y3 y4 y5 y6) \/
(y234 > #2.52) \/ (y234 < #2.0)))`;
};;

Parse_ineq.execute_cfsqp
{
  idv = "1928747871-(2)";
  doc="pure hexagon case, side triangle (2)";
  tags = [Cfsqp;Xconvert;Tex];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (#2.0,y2,#2.52);
    (&2,y3,#2.52);
    (#3.01,y4,#3.915);
    (&2,y5,&2);
      (&2,y6,&2)
  ]
(
(taum y1 y2 y3 y4 y5 y6 + #0.001 > taum (#2.52) y2 y3 y4 y5 y6) \/
(delta_y (#2.52) y2 y3 y4 y5 y6 < &0) \/ (delta_y y1 y2 y3 y4 y5 y6 < &0) \/
taum (#2.52) y2 y3 y4 y5 y6 > taum (&2) y2 y3 y4 y5 y6 
)`;
};;

  

Parse_ineq.execute_cfsqp
{
  idv = "1928747871-(3)";
  doc="pure hexagon case, side triangle (3)";
  tags = [Cfsqp;Xconvert;Tex];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (#2.0,y2,#2.52);
    (&2,y3,#2.52);
    (#3.01,y4,#3.915);
    (&2,y5,&2);
      (&2,y6,&2)
  ]
(
  ( taum y1 y2 y3 y4 y5 y6 + #0.09 > taum (&2) y2 y3 y4 y5 y6) \/
  (delta_y (&2) y2 y3 y4 y5 y6 < &0) \/
(delta_y (#2.52) y2 y3 y4 y5 y6 < &0) \/
 (delta_y y1 y2 y3 y4 y5 y6 < &0)
)`;
};;

(* taum (#2.52) y2 y3 y4 y5 y6 > taum (&2) y2 y3 y4 y5 y6 \/

*)



Parse_ineq.execute_cfsqp
{
  idv = "";
  doc="upper bound on minor variable when top edges are 2.
   This has been replaced with  a delta version.";
  tags = [Cfsqp;Penalty(50.0,500.0);Xconvert;Tex;Deprecated];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (&2,y2,#2.52);
    (&2,y3,#4.52)
  ]
((y3 < #3.915) \/ (arclength y1 (&2) (&2) + arclength y2 (&2) (&2) < arclength y1 y2 y3)
 \/ (y3 > y1 + y2) )`;
};;


Parse_ineq.execute_cfsqp
{
  idv = "test temp";
  doc="pure hexagon case";
  tags = [Cfsqp;Xconvert;Tex];
  ineq = all_forall `ineq [
    (&2,y1,#2.52);
    (&2,y2,#2.52);
    (&2,y3,#2.52);
    (#3.3,y4,#3.915);
    (&2,y5,&2);
      (&2,y6,&2)
  ]
    (rhazim  y1 y2 y3 y4 y5 y6  + #0.6 * (-- &2 * y1 +  y2 + y3) > &0 \/ delta_y y1 y2 y3 y4 y5 y6 < &0)`;
};;



add  {
idv = "2065952723 C-3z";
doc = "If  minor diag >= 3, then 3/1.26 > 2.38 and we can contract.
          15.53: arc[2,2,2.52]2 < arc[2,2,Sqrt[15.53]].
           Added May 12, 2011.
       Replace May 15, 2011, with an inequality with bigger upper b2 bound.";
tags = [Cfsqp;Tex;Flypaper[];Deprecated];
ineq = all_forall `ineq
  [
  (&1 , e1, &1 + sol0/ pi);
  (&1 , e2, &1 + sol0/ pi);
  (&1 , e3, &1 + sol0/ pi);
  ((&2 / h0) pow 2, a2, (&2 * h0) pow 2);
  ((&2 / h0) pow 2, b2, (&2 * h0) pow 2);
  (#2.38 pow 2, c2, #15.53)
  ]
   ((num1 e1 e2 e3 a2 b2 c2 ) > &0) `;
};;


Parse_ineq.execute_cfsqp
  {
idv = "206 ee2";
doc = "FALSE";
tags = [Cfsqp;Tex;Flypaper[];];
ineq = all_forall `ineq
  [
  (&1 , e1, &1 + sol0/ pi);
  (&1 , e2, &1 + sol0/ pi);
  (&1 , e3, &1 + sol0/ pi);
  ((&2 ) pow 2, a2, (#3.01) pow 2);
  ((&2) pow 2, b2, #3.01 pow 2);
  (#2.38 pow 2, c2, #15.53)
  ]
   ((num1 e1 e2 e3 a2 b2 c2 ) > &0) `;
};;
